{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/document-viewer/src/lib/DocumentViewerPage/rpJSON/RPJSONViewer.tsx"],"sourcesContent":["import React, { useState } from \"react\"\nimport { CqsChunkSentence, CqsItem, RpqlFilter, Watchlist } from \"@rp/common/api-types\"\nimport { HEADER_HEIGHT } from \"@rp/common/settings\"\nimport { checkDocument } from \"@rp/react/common/rpjson\"\nimport { Appearance, RpJsonDocument, RpJsonError } from \"@rp/react/rpjson/types\"\nimport { RPTooltip } from \"@rp/react/web/common/base-components\"\nimport { MaxWidthContainer } from \"@rp/react/web/common/composite-components\"\nimport { HtmlPageHead } from \"@rp/react/web/common/header-components\"\nimport { useDeviceInfo } from \"@rp/react/web/common/hooks\"\nimport { tagManagerEvents } from \"@rp/react/web/common/vendors/utils\"\nimport { DocumentDiscovery } from \"@rp/react/web/discovery-sidebar/document-discovery\"\nimport { Fade, Grid, IconButton } from \"@rp/react/web/mui/core\"\nimport { ArrowBack } from \"@rp/react/web/mui/icons\"\nimport { getUrlWithTextFragment } from \"@rp/web/utils\"\nimport { DocumentLoader } from \"../../DocumentLoader\"\nimport { DocumentViewer } from \"../../DocumentViewer\"\nimport { CustomDocumentHeaderProps } from \"../../DocumentViewer.types\"\nimport { ErrorDocumentViewer } from \"../../ErrorDocumentViewer\"\nimport { LimitedDocumentViewer } from \"../../LimitedDocumentViewer\"\n\nconst TOOLBAR_HEIGHT = 44 // So Document Discovery is aligned with it\nconst MIN_PANEL_PADDING = 60 // Minimum distance from the header, when loading f.e.\n\ntype RPJSONViewerProps = {\n  backTitle: string\n  disableBackButton: boolean\n  disableCheckbox: boolean | undefined\n  disableDocumentDiscovery: boolean | undefined\n  documentId: string\n  error: RpJsonError | null\n  expression?: RpqlFilter\n  handleClick: () => void\n  rpjsonHeaderOffset: number | undefined\n  isPrivate: boolean\n  isRpJsonLoading: boolean\n  onAddToWatchlist: ((watchlist: Watchlist) => void) | undefined\n  onChange: ((item: CqsItem) => void) | undefined\n  onExclude: ((item: CqsItem) => void) | undefined\n  rpjsonDocument: RpJsonDocument | undefined\n  selectedDetection: CqsChunkSentence | undefined\n  setSelectedDetection: React.Dispatch<React.SetStateAction<CqsChunkSentence | undefined>>\n  shouldUseScrollTrigger: boolean\n  viewerPaddingTop?: string\n  name: string\n  customDocumentHeaderProps?: CustomDocumentHeaderProps\n  customBackgroundColor?: string\n}\n\nfunction RPJSONViewer({\n  backTitle,\n  disableBackButton,\n  disableCheckbox,\n  disableDocumentDiscovery,\n  documentId,\n  error,\n  expression,\n  handleClick,\n  rpjsonHeaderOffset,\n  isPrivate,\n  isRpJsonLoading,\n  onAddToWatchlist,\n  onChange,\n  onExclude,\n  rpjsonDocument,\n  selectedDetection,\n  setSelectedDetection,\n  shouldUseScrollTrigger,\n  viewerPaddingTop,\n  name,\n  customDocumentHeaderProps,\n  customBackgroundColor,\n}: RPJSONViewerProps) {\n  const { isWideScreen, isMobile } = useDeviceInfo()\n  const { isLimited, url } = checkDocument(rpjsonDocument)\n  const [fixedRef, setFixedRef] = useState<HTMLDivElement | null>(null)\n\n  const handleDetectionClick = (detection: Appearance) => {\n    if (isLimited) {\n      tagManagerEvents.documentOutbound({\n        documentId,\n        sentenceId: `${documentId}-${detection.pnum}-${detection.snum}`,\n        sourceName: rpjsonDocument?.document.source.name,\n        sourceId: rpjsonDocument?.document.source.rp_source_id,\n        component: \"documentDiscovery\",\n      })\n\n      window.open(getUrlWithTextFragment(url, detection.text), \"_blank\", \"noreferrer\")\n      return\n    }\n    setSelectedDetection({ pnum: detection.pnum, snum: detection.snum })\n  }\n\n  const isPane = customDocumentHeaderProps?.variant === \"pane\"\n\n  return (\n    <Fade\n      in={Boolean(documentId)}\n      mountOnEnter\n      unmountOnExit\n      style={{ paddingTop: viewerPaddingTop }}\n    >\n      <MaxWidthContainer\n        sx={{ backgroundColor: customBackgroundColor ?? \"background.default\" }}\n        disableGutters={isPane}\n        isPane\n      >\n        <Grid container columnSpacing={3}>\n          {isMobile || isPane ? null : (\n            <Grid item xs={1} container alignItems=\"start\" justifyContent=\"right\">\n              {window.history.length === 1 || disableBackButton ? null : (\n                <RPTooltip title={backTitle} arrow placement=\"top\">\n                  <IconButton\n                    data-testid=\"back-arrow-button\"\n                    onClick={handleClick}\n                    sx={{ marginTop: \"10px\", position: \"fixed\" }}\n                  >\n                    <ArrowBack />\n                  </IconButton>\n                </RPTooltip>\n              )}\n            </Grid>\n          )}\n\n          <Grid\n            item\n            xs={isMobile || isPane ? 12 : 6}\n            marginRight={isWideScreen && !isPane ? \"36px\" : 0}\n            data-testid=\"document-viewer\"\n            sx={{\n              // allow the user to bring the last line up on mobile\n              paddingBottom: isMobile && !isPane ? \"100px\" : 0,\n            }}\n          >\n            {isRpJsonLoading ? <DocumentLoader /> : <HtmlPageHead title={name} />}\n            {error && <ErrorDocumentViewer error={error} />}\n            {rpjsonDocument && !isLimited ? (\n              <DocumentViewer\n                headerHeight={HEADER_HEIGHT}\n                rpjsonDocument={rpjsonDocument}\n                namespace={isPrivate ? \"private\" : \"public\"}\n                selectedDetection={selectedDetection}\n                fixedRef={fixedRef}\n                setFixedRef={setFixedRef}\n                rpjsonHeaderOffset={rpjsonHeaderOffset}\n                shouldUseScrollTrigger={shouldUseScrollTrigger}\n                customDocumentHeaderProps={customDocumentHeaderProps}\n                customBackgroundColor={customBackgroundColor}\n              />\n            ) : null}\n            {rpjsonDocument && isLimited ? (\n              <LimitedDocumentViewer\n                rpjsonDocument={rpjsonDocument}\n                externalContentUrl={url}\n                namespace={isPrivate ? \"private\" : \"public\"}\n                setFixedRef={setFixedRef}\n                fixedRef={fixedRef}\n                documentId={documentId}\n              />\n            ) : null}\n          </Grid>\n\n          {isMobile || disableDocumentDiscovery ? null : (\n            <Grid\n              item\n              xs={4}\n              pt={`${fixedRef ? fixedRef.clientHeight - TOOLBAR_HEIGHT : MIN_PANEL_PADDING}px`}\n              sx={{ transition: \"padding-top 0.3s\" }}\n              zIndex={7}\n            >\n              <DocumentDiscovery\n                isLoading={isRpJsonLoading}\n                rpjsonDocument={rpjsonDocument}\n                disableCheckbox={disableCheckbox}\n                expression={expression}\n                onChange={onChange}\n                onExclude={onExclude}\n                selectedDetection={selectedDetection}\n                onDetectionClick={handleDetectionClick}\n                onAddToWatchlist={onAddToWatchlist}\n              />\n            </Grid>\n          )}\n        </Grid>\n      </MaxWidthContainer>\n    </Fade>\n  )\n}\n\nexport default RPJSONViewer\n"],"names":["TOOLBAR_HEIGHT","MIN_PANEL_PADDING","RPJSONViewer","backTitle","disableBackButton","disableCheckbox","disableDocumentDiscovery","documentId","error","expression","handleClick","rpjsonHeaderOffset","isPrivate","isRpJsonLoading","onAddToWatchlist","onChange","onExclude","rpjsonDocument","selectedDetection","setSelectedDetection","shouldUseScrollTrigger","viewerPaddingTop","name","customDocumentHeaderProps","customBackgroundColor","isWideScreen","isMobile","useDeviceInfo","isLimited","url","checkDocument","fixedRef","setFixedRef","useState","handleDetectionClick","detection","tagManagerEvents","documentOutbound","sentenceId","pnum","snum","sourceName","document","source","sourceId","rp_source_id","component","window","open","getUrlWithTextFragment","text","isPane","variant","Fade","in","Boolean","mountOnEnter","unmountOnExit","style","paddingTop","MaxWidthContainer","sx","backgroundColor","disableGutters","Grid","container","columnSpacing","item","xs","alignItems","justifyContent","history","length","RPTooltip","title","arrow","placement","IconButton","data-testid","onClick","marginTop","position","ArrowBack","marginRight","paddingBottom","DocumentLoader","HtmlPageHead","ErrorDocumentViewer","DocumentViewer","headerHeight","HEADER_HEIGHT","namespace","LimitedDocumentViewer","externalContentUrl","pt","clientHeight","transition","zIndex","DocumentDiscovery","isLoading","onDetectionClick"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
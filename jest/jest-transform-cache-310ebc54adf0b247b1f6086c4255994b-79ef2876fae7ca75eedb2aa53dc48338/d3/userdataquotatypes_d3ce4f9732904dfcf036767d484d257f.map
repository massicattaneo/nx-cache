{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/common/api-types/src/lib/user-data-quota.types.ts"],"sourcesContent":["import { z } from \"zod\"\n\nconst OrganizationConsumedSchema = z.unknown()\nconst UserConsumedSchema = z.object({\n  searchFollowed: z.number(),\n  searchSaved: z.number(),\n  searchScheduled: z.number(),\n  searchShared: z.number(),\n  watchlistsCreated: z.number(),\n  watchlistsShared: z.number(),\n})\n\nconst UserQuotaSchema = z.object({\n  searchMaxFollowed: z.number(),\n  searchMaxSaved: z.number(),\n  searchMaxScheduled: z.number(),\n  searchMaxShared: z.number(),\n  watchlistMaxCreated: z.number(),\n  watchlistMaxShared: z.number(),\n})\nconst OrganizationQuotaSchema = z.unknown()\n\nconst featureAccessPolicies = [\n  \"search\",\n  \"chat\",\n  \"chat:file\",\n  \"chat:watchlist\",\n  \"chat:jobs\",\n  \"chat:pricing\",\n  \"chat:sentiment\",\n  \"chat:estimates\",\n  \"chat:crunchbase\",\n  \"chat:knowledge_graph\",\n  \"chat:serp\",\n  \"chat:etf_holdings\",\n  \"watchlist\",\n  \"file\",\n  \"file:upload\",\n  \"file:index\",\n  \"support:intercom\",\n  \"support:subscription_mngt\",\n  \"content:read\",\n  \"extra:brief\",\n  \"agent\",\n  \"api_keys:create\",\n  \"api_keys:update\",\n  \"api_keys:delete\",\n  \"api_keys:read\",\n] as const\n\nfunction isFeatureAccessPolicy(policy: unknown): policy is typeof featureAccessPolicies[number] {\n  return featureAccessPolicies.includes(policy as typeof featureAccessPolicies[number])\n}\n\nfunction cleanFeatureAccessPolicy(\n  policy: string,\n): typeof featureAccessPolicies[number] | undefined {\n  if (policy === \"upload\" || policy === \"index\") {\n    return `file:${policy}`\n  }\n\n  if (!isFeatureAccessPolicy(policy)) {\n    return undefined\n  }\n\n  return policy\n}\n\nconst FeatureAccessPolicySchema = z.string().transform(cleanFeatureAccessPolicy)\n\nconst contentAccessPolicies = [\n  \"public\",\n  \"premium\",\n  \"fs_transcripts\",\n  \"sec_filings\",\n  \"streetaccount\",\n  \"moreover\",\n  \"midnight_trader\",\n  \"fxstreet\",\n  \"alliance_news\",\n  \"benzinga\",\n  \"fly_on_the_wall\",\n  \"dna_english_translated\",\n  \"dow_jones\",\n  \"asia_transcripts\",\n  \"capital_markets\",\n  \"quartr_transcripts\",\n  \"quartr_audios\",\n  \"quartr_presentation_materials\",\n  \"quartr_reports\",\n  \"quartr_transcripts\",\n  \"pricing_culture\",\n  \"middle_eastern_markets\",\n  \"financial_times\",\n  \"crypto_markets\",\n  \"expert_networks\",\n] as const\n\nconst EntitlementSchema = z.object({\n  slug: z.string(),\n  type: z.string(),\n  productTypes: z.array(z.string()),\n})\n\nfunction isContentAccessPolicy(policy: unknown): policy is typeof contentAccessPolicies[number] {\n  return contentAccessPolicies.includes(policy as typeof contentAccessPolicies[number])\n}\n\nfunction cleanContentAccessPolicy(\n  policy: string,\n): typeof contentAccessPolicies[number] | \"all\" | undefined {\n  return isContentAccessPolicy(policy) || policy === \"all\" ? policy : undefined\n}\n\nconst ContentAccessPolicySchema = z.string().transform(cleanContentAccessPolicy)\n\nexport const UserDataQuotaSchema = z.object({\n  contentAccessPolicies: z.array(ContentAccessPolicySchema).transform(policies => {\n    if (policies.includes(\"all\" as typeof contentAccessPolicies[number])) {\n      return contentAccessPolicies\n    }\n\n    const result = policies.filter(isContentAccessPolicy)\n    return [...result] as const\n  }),\n  featureAccessPolicies: z.array(FeatureAccessPolicySchema).transform(policies => {\n    const result = [...policies]\n\n    if (result.includes(\"file:index\")) {\n      result.push(\"file\", \"chat:file\")\n    }\n\n    return result.filter(isFeatureAccessPolicy)\n  }),\n  organizationConsumed: OrganizationConsumedSchema,\n  organizationQuota: OrganizationQuotaSchema,\n  userConsumed: UserConsumedSchema,\n  userQuota: UserQuotaSchema,\n  subscriptionStatus: z.string().optional(),\n  subscriptionRenewalDate: z.coerce.date().optional(),\n  subscriptionSource: z.string().optional(),\n  subscriptionFrequency: z.string().optional(),\n  testFeatureFlagField: z.string().optional(),\n  entitlements: z.record(z.string(), z.record(z.string(), EntitlementSchema)),\n})\n\nexport type UserDataQuota = z.infer<typeof UserDataQuotaSchema>\n"],"names":["UserDataQuotaSchema","OrganizationConsumedSchema","z","unknown","UserConsumedSchema","object","searchFollowed","number","searchSaved","searchScheduled","searchShared","watchlistsCreated","watchlistsShared","UserQuotaSchema","searchMaxFollowed","searchMaxSaved","searchMaxScheduled","searchMaxShared","watchlistMaxCreated","watchlistMaxShared","OrganizationQuotaSchema","featureAccessPolicies","isFeatureAccessPolicy","policy","includes","cleanFeatureAccessPolicy","undefined","FeatureAccessPolicySchema","string","transform","contentAccessPolicies","EntitlementSchema","slug","type","productTypes","array","isContentAccessPolicy","cleanContentAccessPolicy","ContentAccessPolicySchema","policies","result","filter","push","organizationConsumed","organizationQuota","userConsumed","userQuota","subscriptionStatus","optional","subscriptionRenewalDate","coerce","date","subscriptionSource","subscriptionFrequency","testFeatureFlagField","entitlements","record"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
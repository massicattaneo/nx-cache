{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/development/src/lib/trpc/chat-ws-api/smartGridPrompt.ts"],"sourcesContent":["import { format } from \"date-fns\"\nimport { dbGenerators } from \"../../../database\"\nimport { generateChatMessages } from \"../../database/generators/generateChat\"\nimport { ChatResponseHandler } from \"./chat-handlers.type\"\n\nexport const smartGridPrompt: ChatResponseHandler = async ({\n  inputMessage,\n  requestId,\n  files,\n  entities,\n}) => {\n  const date = format(Date.now(), \"MMM dd, yyyy\")\n  const content = `#  MORNING DIGEST\\n## ${date}\\n\\n### TOP HEADLINES\\n* **The The Associated Press Co.** is talking with Twitter Inc. about a potential acquisition.`\n  const interaction = dbGenerators.generateChatInteraction({\n    inputMessage,\n    content,\n  })\n  const queries = [{ query: \"Highlights from European market trading sessions\", query_id: 0 }]\n  const messages = generateChatMessages({\n    requestId,\n    interaction,\n    content,\n    queries,\n    files: files.filter(item => item.rpjson),\n    entities,\n  })\n  return {\n    messages: [\n      messages.status(\"Routing your query to the appropriate data source\"),\n      messages.status(\"Searching ...\"),\n      messages.statusQuery(),\n      ...messages.auditTraces(),\n      ...messages.statusCollapse(),\n      messages.statusConcluding(),\n      ...messages.next((content, cqsFiles) =>\n        content.split(\"\\n\").map((content, index, array) => {\n          const [file1, file2] = cqsFiles\n          if (index === array.length - 1 && file1 && file2) {\n            const text = `${content} \\`:ref[LIST:[CQS:${file1.rpjson?.document.rp_document_id}-0][CQS:${file1.rpjson?.document.rp_document_id}-1][CQS:${file2.rpjson?.document.rp_document_id}-0]]\\` `\n            return { content: text }\n          }\n          return { content: content + \"\\n\" }\n        }),\n      ),\n      messages.sources([\n        {\n          type: \"EXTERNAL\",\n          name: \"Associated Press News\",\n          hd: \"Read the latest headlines, breaking news, and videos at APNews.com\",\n          url: \"https://apnews.com/\",\n          faviconUrl: \"https://apnews.com/favicon.ico\",\n        },\n      ]),\n      messages.complete(),\n    ],\n    interaction,\n  }\n}\n"],"names":["smartGridPrompt","inputMessage","requestId","files","entities","date","format","Date","now","content","interaction","dbGenerators","generateChatInteraction","queries","query","query_id","messages","generateChatMessages","filter","item","rpjson","status","statusQuery","auditTraces","statusCollapse","statusConcluding","next","cqsFiles","split","map","index","array","file1","file2","length","text","document","rp_document_id","sources","type","name","hd","url","faviconUrl","complete"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAKaA;;;eAAAA;;;yBALU;0BACM;8BACQ;AAG9B,MAAMA,kBAAuC,OAAO,EACzDC,YAAY,EACZC,SAAS,EACTC,KAAK,EACLC,QAAQ,EACT;IACC,MAAMC,OAAOC,IAAAA,eAAM,EAACC,KAAKC,GAAG,IAAI;IAChC,MAAMC,UAAU,CAAC,sBAAsB,EAAEJ,KAAK,qHAAqH,CAAC;IACpK,MAAMK,cAAcC,sBAAY,CAACC,uBAAuB,CAAC;QACvDX;QACAQ;IACF;IACA,MAAMI,UAAU;QAAC;YAAEC,OAAO;YAAoDC,UAAU;QAAE;KAAE;IAC5F,MAAMC,WAAWC,IAAAA,kCAAoB,EAAC;QACpCf;QACAQ;QACAD;QACAI;QACAV,OAAOA,MAAMe,MAAM,CAACC,CAAAA,OAAQA,KAAKC,MAAM;QACvChB;IACF;IACA,OAAO;QACLY,UAAU;YACRA,SAASK,MAAM,CAAC;YAChBL,SAASK,MAAM,CAAC;YAChBL,SAASM,WAAW;eACjBN,SAASO,WAAW;eACpBP,SAASQ,cAAc;YAC1BR,SAASS,gBAAgB;eACtBT,SAASU,IAAI,CAAC,CAACjB,SAASkB,WACzBlB,QAAQmB,KAAK,CAAC,MAAMC,GAAG,CAAC,CAACpB,SAASqB,OAAOC;oBACvC,MAAM,CAACC,OAAOC,MAAM,GAAGN;oBACvB,IAAIG,UAAUC,MAAMG,MAAM,GAAG,KAAKF,SAASC,OAAO;4BACJD,eAAgDA,gBAAgDC;wBAA5I,MAAME,OAAO,CAAC,EAAE1B,QAAQ,kBAAkB,GAAEuB,gBAAAA,MAAMZ,MAAM,cAAZY,oCAAAA,cAAcI,QAAQ,CAACC,cAAc,CAAC,QAAQ,GAAEL,iBAAAA,MAAMZ,MAAM,cAAZY,qCAAAA,eAAcI,QAAQ,CAACC,cAAc,CAAC,QAAQ,GAAEJ,gBAAAA,MAAMb,MAAM,cAAZa,oCAAAA,cAAcG,QAAQ,CAACC,cAAc,CAAC,OAAO,CAAC;wBAC1L,OAAO;4BAAE5B,SAAS0B;wBAAK;oBACzB;oBACA,OAAO;wBAAE1B,SAASA,UAAU;oBAAK;gBACnC;YAEFO,SAASsB,OAAO,CAAC;gBACf;oBACEC,MAAM;oBACNC,MAAM;oBACNC,IAAI;oBACJC,KAAK;oBACLC,YAAY;gBACd;aACD;YACD3B,SAAS4B,QAAQ;SAClB;QACDlC;IACF;AACF"}
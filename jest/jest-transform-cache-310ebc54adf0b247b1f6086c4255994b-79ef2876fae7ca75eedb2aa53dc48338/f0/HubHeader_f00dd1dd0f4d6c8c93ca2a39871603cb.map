{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/apps/client-web/src/app/components/Hub/HubHeader/HubHeader.tsx"],"sourcesContent":["import { useRef } from \"react\"\nimport { useNavigate } from \"react-router-dom\"\nimport { RpqlFilter, Watchlist } from \"@rp/common/api-types\"\nimport { WATCHLIST_FEATURE_NAME } from \"@rp/common/settings\"\nimport { defaultSaveName } from \"@rp/common/utils\"\nimport { useIsWatchlistLimitMet } from \"@rp/react/common/hooks\"\nimport { useAccount } from \"@rp/react/common/providers\"\nimport { useCreateSavedQuery } from \"@rp/react/tanstack-api/user-data-queries\"\nimport { UploadInputRef } from \"@rp/react/web/common/base-components\"\nimport { SearchMobileHeader } from \"@rp/react/web/common/composite-components\"\nimport { UploadFiles } from \"@rp/react/web/common/files\"\nimport { useDeviceInfo } from \"@rp/react/web/common/hooks\"\nimport { Header, HeaderButton, HeaderSearchBar } from \"@rp/react/web/common/layout\"\nimport { useModal } from \"@rp/react/web/common/providers\"\nimport { tagManagerEvents } from \"@rp/react/web/common/vendors/utils\"\nimport { Typography } from \"@rp/react/web/mui/core\"\nimport { CHAT_ROUTE, SEARCH_ROUTE, WATCHLIST_NEW } from \"@rp/react/web/router\"\nimport { useQueryClient } from \"@tanstack/react-query\"\nimport { HubHeaderProps } from \"./HubHeader.types\"\n\nexport const HubHeader = ({\n  label,\n  buttonLabel,\n  onClick,\n  icon,\n  filterTerm,\n  setFilterTerm,\n  id,\n  placeholder,\n  hideSearch = false,\n  hideMobileSearch = false,\n  page,\n  onFileUpload,\n  rightItems = [],\n}: HubHeaderProps) => {\n  const { isMobile } = useDeviceInfo()\n  const navigate = useNavigate()\n  const createQuery = useCreateSavedQuery()\n  const queryClient = useQueryClient()\n  const buttonRef = useRef<UploadInputRef>(null)\n\n  const { quota } = useAccount()\n  const {\n    planComparisonModal: { handleOpen: planComparisonHandleOpen },\n  } = useModal()\n  const hasMetWatchlistLimit = useIsWatchlistLimitMet(quota)\n  // ========================\n  // Header Button Actions\n  // ========================\n  const runWatchlistSearch = () => {\n    if (!id) return\n\n    // Get the name of the watchlist\n    const watchlist = queryClient.getQueryData<Watchlist>([\"watchlists\", id])\n    const name = watchlist?.name ?? defaultSaveName(\"search\")\n\n    // Create a query with the watchlist filter\n    const expression: RpqlFilter = {\n      type: \"and\",\n      value: [{ type: \"watchlist\", operation: \"in\", value: id }],\n    }\n\n    // POST to create a saved query\n    createQuery.mutateAsync(\n      {\n        name,\n        query: {\n          expression,\n        },\n      },\n      {\n        onSuccess: response => {\n          // Send the event to GTM\n          tagManagerEvents.queryInit({\n            queryId: response.id,\n            location: \"watchlist\",\n            queryType: \"watchlist\",\n          })\n          // Navigate to the search page\n          navigate(`/search/${response.id}`)\n        },\n      },\n    )\n  }\n\n  const buttonActions = {\n    goToSearch() {\n      navigate(SEARCH_ROUTE)\n    },\n    createWatchlist() {\n      hasMetWatchlistLimit\n        ? planComparisonHandleOpen(WATCHLIST_FEATURE_NAME)\n        : navigate(WATCHLIST_NEW)\n    },\n    uploadFiles() {\n      buttonRef.current?.open()\n    },\n    newChat() {\n      navigate(CHAT_ROUTE)\n    },\n    runWatchlistSearch,\n  }\n\n  let rightContent = [...rightItems]\n  if (!hideSearch) {\n    rightContent = [\n      <HeaderSearchBar\n        key=\"header-search-bar\"\n        filterTerm={filterTerm}\n        onChange={value => setFilterTerm(value)}\n        placeholder={placeholder}\n      />,\n      ...rightContent,\n    ]\n  }\n\n  if (buttonLabel) {\n    const { IconButton, Icon } = icon ?? {}\n    const StartIcon = IconButton ?? Icon\n\n    rightContent = [\n      ...rightContent,\n      <HeaderButton\n        key=\"header-button\"\n        disabled={onClick === undefined}\n        onClick={onClick && buttonActions[onClick]}\n        startIcon={StartIcon ? <StartIcon /> : null}\n      >\n        {buttonLabel}\n        <UploadFiles\n          location=\"filesPage\"\n          multiple\n          ref={buttonRef}\n          onSubmit={() => {\n            onFileUpload?.()\n          }}\n        />\n      </HeaderButton>,\n    ]\n  }\n\n  if (isMobile) {\n    return (\n      <SearchMobileHeader\n        filterTerm={filterTerm}\n        setFilterTerm={setFilterTerm}\n        placeholder={placeholder}\n        title={page}\n        hideSearch={hideMobileSearch}\n      />\n    )\n  }\n\n  return (\n    <Header\n      leftColumns={3}\n      rightColumns={9}\n      leftContent={\n        <Typography variant=\"h5\" fontWeight={700} letterSpacing={-0.25}>\n          {label}\n        </Typography>\n      }\n      rightContent={rightContent}\n    />\n  )\n}\n"],"names":["HubHeader","label","buttonLabel","onClick","icon","filterTerm","setFilterTerm","id","placeholder","hideSearch","hideMobileSearch","page","onFileUpload","rightItems","isMobile","useDeviceInfo","navigate","useNavigate","createQuery","useCreateSavedQuery","queryClient","useQueryClient","buttonRef","useRef","quota","useAccount","planComparisonModal","handleOpen","planComparisonHandleOpen","useModal","hasMetWatchlistLimit","useIsWatchlistLimitMet","runWatchlistSearch","watchlist","getQueryData","name","defaultSaveName","expression","type","value","operation","mutateAsync","query","onSuccess","response","tagManagerEvents","queryInit","queryId","location","queryType","buttonActions","goToSearch","SEARCH_ROUTE","createWatchlist","WATCHLIST_FEATURE_NAME","WATCHLIST_NEW","uploadFiles","current","open","newChat","CHAT_ROUTE","rightContent","HeaderSearchBar","onChange","IconButton","Icon","StartIcon","HeaderButton","disabled","undefined","startIcon","UploadFiles","multiple","ref","onSubmit","SearchMobileHeader","title","Header","leftColumns","rightColumns","leftContent","Typography","variant","fontWeight","letterSpacing"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
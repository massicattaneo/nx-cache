{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/tanstack-api/watchlist/src/useDeleteWatchlist.ts"],"sourcesContent":["import { AxiosError } from \"axios\"\nimport { axiosClient } from \"@rp/react/axios-client\"\nimport { watchlistCustomerIo } from \"@rp/react/common/customer-io\"\nimport { SnackbarEnqueueAction } from \"@rp/react/common/types\"\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\"\nimport { WatchlistCollection } from \"./watchlist.types\"\n\nconst USER_DATA_ROOT = \"/user-data/watchlists\"\n\ntype Ownership = \"user\" | \"company\"\n\nconst watchlistQueryKeys = {\n  all: (ownership?: Ownership) =>\n    ownership ? ([\"watchlists\", ownership] as const) : ([\"watchlists\"] as const),\n  watchlist: (watchlistId: string) => [\"watchlist\", watchlistId] as const,\n}\n\nconst destroy = async (watchlistId: string) => {\n  await axiosClient.delete(`${USER_DATA_ROOT}/${watchlistId}`)\n}\n\nconst useDeleteWatchlist = ({ enqueueError }: { enqueueError?: SnackbarEnqueueAction }) => {\n  const queryClient = useQueryClient()\n\n  return useMutation({\n    mutationFn: destroy,\n    onMutate: watchlistId => {\n      const previous = queryClient.getQueriesData({ queryKey: watchlistQueryKeys.all() })\n\n      queryClient.setQueriesData<WatchlistCollection>(\n        { queryKey: watchlistQueryKeys.all() },\n        old => {\n          if (!old || !Array.isArray(old)) {\n            return old\n          }\n          return { results: old?.results.filter(item => item.id !== watchlistId) }\n        },\n      )\n\n      return previous\n    },\n    onError: (error, __, context) => {\n      if (error instanceof AxiosError) {\n        enqueueError?.(error?.response?.data?.message ?? \"An error occurred\")\n      }\n      if (context) {\n        for (const [queryKey, previous] of context) {\n          queryClient.setQueryData(queryKey, previous)\n        }\n      }\n    },\n    onSuccess: (_, watchlistId) => {\n      watchlistCustomerIo.watchlistApi.delete({\n        watchlistId,\n        interactionTimestamp: Date.now() * 1000,\n        entities: null,\n      })\n      queryClient.refetchQueries({ queryKey: watchlistQueryKeys.all() })\n    },\n  })\n}\n\nexport { useDeleteWatchlist }\n"],"names":["useDeleteWatchlist","USER_DATA_ROOT","watchlistQueryKeys","all","ownership","watchlist","watchlistId","destroy","axiosClient","delete","enqueueError","queryClient","useQueryClient","useMutation","mutationFn","onMutate","previous","getQueriesData","queryKey","setQueriesData","old","Array","isArray","results","filter","item","id","onError","error","__","context","AxiosError","response","data","message","setQueryData","onSuccess","_","watchlistCustomerIo","watchlistApi","interactionTimestamp","Date","now","entities","refetchQueries"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BA8DSA;;;eAAAA;;;uBA9DkB;6BACC;4BACQ;4BAEQ;AAG5C,MAAMC,iBAAiB;AAIvB,MAAMC,qBAAqB;IACzBC,KAAK,CAACC,YACJA,YAAa;YAAC;YAAcA;SAAU,GAAc;YAAC;SAAa;IACpEC,WAAW,CAACC,cAAwB;YAAC;YAAaA;SAAY;AAChE;AAEA,MAAMC,UAAU,OAAOD;IACrB,MAAME,wBAAW,CAACC,MAAM,CAAC,CAAC,EAAER,eAAe,CAAC,EAAEK,YAAY,CAAC;AAC7D;AAEA,MAAMN,qBAAqB,CAAC,EAAEU,YAAY,EAA4C;IACpF,MAAMC,cAAcC,IAAAA,0BAAc;IAElC,OAAOC,IAAAA,uBAAW,EAAC;QACjBC,YAAYP;QACZQ,UAAUT,CAAAA;YACR,MAAMU,WAAWL,YAAYM,cAAc,CAAC;gBAAEC,UAAUhB,mBAAmBC,GAAG;YAAG;YAEjFQ,YAAYQ,cAAc,CACxB;gBAAED,UAAUhB,mBAAmBC,GAAG;YAAG,GACrCiB,CAAAA;gBACE,IAAI,CAACA,OAAO,CAACC,MAAMC,OAAO,CAACF,MAAM;oBAC/B,OAAOA;gBACT;gBACA,OAAO;oBAAEG,OAAO,EAAEH,gBAAAA,0BAAAA,IAAKG,OAAO,CAACC,MAAM,CAACC,CAAAA,OAAQA,KAAKC,EAAE,KAAKpB;gBAAa;YACzE;YAGF,OAAOU;QACT;QACAW,SAAS,CAACC,OAAOC,IAAIC;YACnB,IAAIF,iBAAiBG,iBAAU,EAAE;oBAChBH,sBAAAA;oBAAAA;gBAAflB,yBAAAA,mCAAAA,aAAekB,CAAAA,+BAAAA,kBAAAA,6BAAAA,kBAAAA,MAAOI,QAAQ,cAAfJ,uCAAAA,uBAAAA,gBAAiBK,IAAI,cAArBL,2CAAAA,qBAAuBM,OAAO,cAA9BN,0CAAAA,+BAAkC;YACnD;YACA,IAAIE,SAAS;gBACX,KAAK,MAAM,CAACZ,UAAUF,SAAS,IAAIc,QAAS;oBAC1CnB,YAAYwB,YAAY,CAACjB,UAAUF;gBACrC;YACF;QACF;QACAoB,WAAW,CAACC,GAAG/B;YACbgC,+BAAmB,CAACC,YAAY,CAAC9B,MAAM,CAAC;gBACtCH;gBACAkC,sBAAsBC,KAAKC,GAAG,KAAK;gBACnCC,UAAU;YACZ;YACAhC,YAAYiC,cAAc,CAAC;gBAAE1B,UAAUhB,mBAAmBC,GAAG;YAAG;QAClE;IACF;AACF"}
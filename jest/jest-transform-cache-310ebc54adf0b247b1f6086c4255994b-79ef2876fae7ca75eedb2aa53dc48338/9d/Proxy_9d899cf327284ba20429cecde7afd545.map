{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/common/utils/src/lib/design-patterns/Proxy.ts"],"sourcesContent":["import { Callback, Context, Next, Stack } from \"./Stack\"\n\nclass Proxy<T extends Array<unknown>> {\n  private _autoProceedToAfter: boolean\n  private _beforeFn: Array<Callback<T, Context>>\n  private _afterFn: Array<Callback<T, Context>>\n\n  constructor({ autoProceedToAfter = false } = {}) {\n    this._autoProceedToAfter = autoProceedToAfter\n    this._beforeFn = []\n    this._afterFn = []\n  }\n\n  before(callback: Callback<T, Context>) {\n    this._beforeFn.push(callback)\n    return () => this._beforeFn.splice(this._beforeFn.indexOf(callback), 1)\n  }\n  after(callback: Callback<T, Context>) {\n    this._afterFn.push(callback)\n    return () => this._afterFn.splice(this._afterFn.indexOf(callback), 1)\n  }\n  use(callback = (next: Next<T>, ...args: T): T => args, context?: Context) {\n    return (...args: T) => {\n      let result: T | undefined\n      const stack = new Stack<T, Context>(context ?? {})\n      stack.add(function (next, ..._) {\n        next(...args)\n      })\n      this._beforeFn.forEach(cb => stack.add(cb))\n      stack.add((next, ...innerArgs) => {\n        result = callback.call(context, next, ...innerArgs)\n        this._autoProceedToAfter && next(...result)\n      })\n      this._afterFn.forEach(cb => stack.add(cb))\n      stack.run()\n      return result?.[0]\n    }\n  }\n}\n\nexport { Proxy }\n"],"names":["Proxy","before","callback","_beforeFn","push","splice","indexOf","after","_afterFn","use","next","args","context","result","stack","Stack","add","_","forEach","cb","innerArgs","call","_autoProceedToAfter","run","constructor","autoProceedToAfter"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAwCSA;;;eAAAA;;;uBAxCsC;;;;;;;;;;;;;;AAE/C,MAAMA;IAWJC,OAAOC,QAA8B,EAAE;QACrC,IAAI,CAACC,SAAS,CAACC,IAAI,CAACF;QACpB,OAAO,IAAM,IAAI,CAACC,SAAS,CAACE,MAAM,CAAC,IAAI,CAACF,SAAS,CAACG,OAAO,CAACJ,WAAW;IACvE;IACAK,MAAML,QAA8B,EAAE;QACpC,IAAI,CAACM,QAAQ,CAACJ,IAAI,CAACF;QACnB,OAAO,IAAM,IAAI,CAACM,QAAQ,CAACH,MAAM,CAAC,IAAI,CAACG,QAAQ,CAACF,OAAO,CAACJ,WAAW;IACrE;IACAO,IAAIP,WAAW,CAACQ,MAAe,GAAGC,OAAeA,IAAI,EAAEC,OAAiB,EAAE;QACxE,OAAO,CAAC,GAAGD;YACT,IAAIE;YACJ,MAAMC,QAAQ,IAAIC,YAAK,CAAaH,oBAAAA,qBAAAA,UAAW,CAAC;YAChDE,MAAME,GAAG,CAAC,SAAUN,IAAI,EAAE,GAAGO,CAAC;gBAC5BP,QAAQC;YACV;YACA,IAAI,CAACR,SAAS,CAACe,OAAO,CAACC,CAAAA,KAAML,MAAME,GAAG,CAACG;YACvCL,MAAME,GAAG,CAAC,CAACN,MAAM,GAAGU;gBAClBP,SAASX,SAASmB,IAAI,CAACT,SAASF,SAASU;gBACzC,IAAI,CAACE,mBAAmB,IAAIZ,QAAQG;YACtC;YACA,IAAI,CAACL,QAAQ,CAACU,OAAO,CAACC,CAAAA,KAAML,MAAME,GAAG,CAACG;YACtCL,MAAMS,GAAG;YACT,OAAOV,mBAAAA,6BAAAA,MAAQ,CAAC,EAAE;QACpB;IACF;IA9BAW,YAAY,EAAEC,qBAAqB,KAAK,EAAE,GAAG,CAAC,CAAC,CAAE;QAJjD,uBAAQH,uBAAR,KAAA;QACA,uBAAQnB,aAAR,KAAA;QACA,uBAAQK,YAAR,KAAA;QAGE,IAAI,CAACc,mBAAmB,GAAGG;QAC3B,IAAI,CAACtB,SAAS,GAAG,EAAE;QACnB,IAAI,CAACK,QAAQ,GAAG,EAAE;IACpB;AA2BF"}
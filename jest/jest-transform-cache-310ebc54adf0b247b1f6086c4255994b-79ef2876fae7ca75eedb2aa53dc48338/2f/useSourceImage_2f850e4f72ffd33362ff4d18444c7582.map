{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/common/providers/src/useSourceImage.ts"],"sourcesContent":["import { useEffect, useState } from \"react\"\nimport { renameDuplicatedSources } from \"@rp/react/tanstack-api/llm-summary\"\n\ntype Value = { src: string; isLoaded: boolean; hasError: boolean; hd: string }\ntype SourceImage = {\n  id: string\n  hd: string\n  imageUrls?: Array<string> | null\n  name: string\n}\nconst images: Record<string, Value> = {}\nconst urlRegex = /^(ftp|http|https):\\/\\/[^ \"]+$/\n\nconst useSourceImage = (sources: Array<SourceImage>) => {\n  const summarySources = renameDuplicatedSources(sources)\n  const items = summarySources\n    .map(s => s.imageUrls)\n    .flat()\n    .filter(url => urlRegex.test(url ?? \"\"))\n  const source = summarySources.find(s =>\n    s.imageUrls?.find(url => url === items[0]) ? s : undefined,\n  )\n\n  const [result, setResult] = useState<Value>(\n    images[source?.id ?? \"\"] ?? { src: \"\", isLoaded: false, hasError: false, hd: \"\" },\n  )\n\n  const src = source?.imageUrls?.[0] ?? \"\"\n  const id = source?.id ?? \"\"\n  const hd = source?.hd ?? \"\"\n\n  useEffect(() => {\n    if (images[id]) {\n      setResult(images[id ?? \"\"])\n    } else if (src) {\n      const image = document.createElement(\"img\")\n      image.onload = () => {\n        images[id] = { src, isLoaded: true, hasError: false, hd }\n        setResult({ src, isLoaded: true, hasError: false, hd })\n      }\n      image.onerror = () => {\n        images[id] = { src, isLoaded: true, hasError: true, hd }\n        setResult({ src, isLoaded: true, hasError: true, hd })\n      }\n      image.src = src\n    } else {\n      setResult({ src: \"\", isLoaded: false, hasError: false, hd: \"\" })\n    }\n  }, [id, src, hd])\n\n  return result\n}\n\nexport { useSourceImage }\n"],"names":["useSourceImage","images","urlRegex","sources","source","summarySources","renameDuplicatedSources","items","map","s","imageUrls","flat","filter","url","test","find","undefined","result","setResult","useState","id","src","isLoaded","hasError","hd","useEffect","image","document","createElement","onload","onerror"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAqDSA;;;eAAAA;;;uBArD2B;4BACI;AASxC,MAAMC,SAAgC,CAAC;AACvC,MAAMC,WAAW;AAEjB,MAAMF,iBAAiB,CAACG;QAcVC;IAbZ,MAAMC,iBAAiBC,IAAAA,mCAAuB,EAACH;IAC/C,MAAMI,QAAQF,eACXG,GAAG,CAACC,CAAAA,IAAKA,EAAEC,SAAS,EACpBC,IAAI,GACJC,MAAM,CAACC,CAAAA,MAAOX,SAASY,IAAI,CAACD,gBAAAA,iBAAAA,MAAO;IACtC,MAAMT,SAASC,eAAeU,IAAI,CAACN,CAAAA;YACjCA;eAAAA,EAAAA,eAAAA,EAAEC,SAAS,cAAXD,mCAAAA,aAAaM,IAAI,CAACF,CAAAA,MAAOA,QAAQN,KAAK,CAAC,EAAE,KAAIE,IAAIO;;QAI1CZ,YAAPH;IADF,MAAM,CAACgB,QAAQC,UAAU,GAAGC,IAAAA,eAAQ,EAClClB,CAAAA,WAAAA,MAAM,CAACG,CAAAA,aAAAA,mBAAAA,6BAAAA,OAAQgB,EAAE,cAAVhB,wBAAAA,aAAc,GAAG,cAAxBH,sBAAAA,WAA4B;QAAEoB,KAAK;QAAIC,UAAU;QAAOC,UAAU;QAAOC,IAAI;IAAG;QAGtEpB;IAAZ,MAAMiB,MAAMjB,CAAAA,qBAAAA,mBAAAA,8BAAAA,oBAAAA,OAAQM,SAAS,cAAjBN,wCAAAA,iBAAmB,CAAC,EAAE,cAAtBA,gCAAAA,qBAA0B;QAC3BA;IAAX,MAAMgB,KAAKhB,CAAAA,cAAAA,mBAAAA,6BAAAA,OAAQgB,EAAE,cAAVhB,yBAAAA,cAAc;QACdA;IAAX,MAAMoB,KAAKpB,CAAAA,aAAAA,mBAAAA,6BAAAA,OAAQoB,EAAE,cAAVpB,wBAAAA,aAAc;IAEzBqB,IAAAA,gBAAS,EAAC;QACR,IAAIxB,MAAM,CAACmB,GAAG,EAAE;YACdF,UAAUjB,MAAM,CAACmB,eAAAA,gBAAAA,KAAM,GAAG;QAC5B,OAAO,IAAIC,KAAK;YACd,MAAMK,QAAQC,SAASC,aAAa,CAAC;YACrCF,MAAMG,MAAM,GAAG;gBACb5B,MAAM,CAACmB,GAAG,GAAG;oBAAEC;oBAAKC,UAAU;oBAAMC,UAAU;oBAAOC;gBAAG;gBACxDN,UAAU;oBAAEG;oBAAKC,UAAU;oBAAMC,UAAU;oBAAOC;gBAAG;YACvD;YACAE,MAAMI,OAAO,GAAG;gBACd7B,MAAM,CAACmB,GAAG,GAAG;oBAAEC;oBAAKC,UAAU;oBAAMC,UAAU;oBAAMC;gBAAG;gBACvDN,UAAU;oBAAEG;oBAAKC,UAAU;oBAAMC,UAAU;oBAAMC;gBAAG;YACtD;YACAE,MAAML,GAAG,GAAGA;QACd,OAAO;YACLH,UAAU;gBAAEG,KAAK;gBAAIC,UAAU;gBAAOC,UAAU;gBAAOC,IAAI;YAAG;QAChE;IACF,GAAG;QAACJ;QAAIC;QAAKG;KAAG;IAEhB,OAAOP;AACT"}
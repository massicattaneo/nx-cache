{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/common/customer-io/src/lib/watchlistCustomerIo.ts"],"sourcesContent":["import { adapters } from \"@rp/adapters\"\n\ntype SubmitCustomerIoPropsType = {\n  watchlistId: string\n  addedItems: number\n  previousItems: number\n  submitted: number\n  matched: number\n  conflicts: number\n  conflictsUnresolved: number\n  conflictsResolved: number\n  conflictsDeleted: number\n  matchedUnmodified: number\n  matchedModified: number\n  matchedDeleted: number\n}\n\ntype CancelCustomerIoPropsType = Pick<\n  SubmitCustomerIoPropsType,\n  \"submitted\" | \"previousItems\" | \"conflicts\" | \"matched\"\n>\n\ntype UploadModalCommonData = {\n  open: number | null\n  startUpload: number | null\n  endUpload: number | null\n  uploadMethod:\n    | \"dropOnPanel\"\n    | \"browseFromPanel\"\n    | \"browseFromTable\"\n    | \"dropOnModal\"\n    | \"browseFromModal\"\n    | \"none\"\n}\n\ntype WatchlistCreateData = {\n  watchlistId: string\n  interactionTimestamp: number\n  entities: Array<{ id: string }> | null\n}\n\ntype WatchlistUpdateData = WatchlistCreateData & {\n  updatedFields: Array<\"name\" | \"entities\" | \"sharedWith\">\n  sharedWith: Array<string> | null\n}\n\ntype CellClickData = {\n  dataView: string\n  column: string\n  watchlistId: string\n  entityId: string\n  cellValue: string | number\n  generatedPrompt: string\n}\n\nconst defaultData: UploadModalCommonData = {\n  open: null,\n  startUpload: null,\n  endUpload: null,\n  uploadMethod: \"none\",\n}\n\nconst uploadModalData: UploadModalCommonData = Object.assign({}, defaultData)\n\nconst sendUploadModalEvent = (name: string, data: Record<string, unknown>) => {\n  if (!uploadModalData.open) return\n  const common = {\n    sinceOpenModal: Date.now() - uploadModalData.open,\n    uploadMethod: uploadModalData.uploadMethod ?? \"none\",\n  }\n  if (uploadModalData.endUpload && uploadModalData.startUpload) {\n    Object.assign(common, {\n      sinceProcessingComplete: Date.now() - uploadModalData.endUpload,\n      processingFileDuration: uploadModalData.endUpload - uploadModalData.startUpload,\n    })\n  }\n  adapters.customerIo.track({ name, data: { ...common, ...data } })\n}\n\nexport const watchlistCustomerIo = {\n  watchlistApi: {\n    create(data: WatchlistCreateData) {\n      adapters.customerIo.track({\n        name: \"watchlist\",\n        data: {\n          action: \"create\",\n          ...data,\n        },\n      })\n    },\n    update(data: WatchlistUpdateData) {\n      adapters.customerIo.track({\n        name: \"watchlist\",\n        data: {\n          action: \"update\",\n          ...data,\n        },\n      })\n    },\n    delete(data: WatchlistCreateData) {\n      adapters.customerIo.track({\n        name: \"watchlist\",\n        data: {\n          action: \"delete\",\n          ...data,\n        },\n      })\n    },\n    favorite(data: WatchlistUpdateData & { cameFromSharedLink: boolean }) {\n      adapters.customerIo.track({\n        name: \"watchlist\",\n        data: {\n          action: \"favorite\",\n          ...data,\n        },\n      })\n    },\n    unfavorite(data: WatchlistUpdateData) {\n      adapters.customerIo.track({\n        name: \"watchlist\",\n        data: {\n          action: \"unfavorite\",\n          ...data,\n        },\n      })\n    },\n  },\n  uploadModal: {\n    setTimestamp(key: keyof UploadModalCommonData) {\n      Object.assign(uploadModalData, { [key]: Date.now() })\n    },\n    setUploadMethod(method: UploadModalCommonData[\"uploadMethod\"]) {\n      Object.assign(uploadModalData, { uploadMethod: method })\n    },\n    reset() {\n      Object.assign(uploadModalData, defaultData)\n    },\n    sendCancel(props: Partial<CancelCustomerIoPropsType> & { watchlistId: string }) {\n      sendUploadModalEvent(\"watchlistUpload\", {\n        type: \"cancel\",\n        ...props,\n      })\n    },\n    sendError(watchlistId: string, { message }: { message: string }) {\n      sendUploadModalEvent(\"watchlistUpload\", {\n        type: \"error\",\n        watchlistId,\n        errorMessage: message,\n      })\n    },\n    sendSubmit(props: SubmitCustomerIoPropsType) {\n      sendUploadModalEvent(\"watchlistUpload\", {\n        type: \"submit\",\n        ...props,\n      })\n    },\n  },\n  dataView: {\n    cellClick(data: CellClickData) {\n      adapters.customerIo.track({\n        name: \"watchlistDataViewInteracted\",\n        data: {\n          action: \"tableCellClick\",\n          ...data,\n        },\n      })\n    },\n    accessed(dataViewName: string) {\n      adapters.customerIo.track({\n        name: \"watchlistDataViewInteracted\",\n        data: {\n          action: \"accessed\",\n          dataViewName,\n        },\n      })\n    },\n    upgradeButtonClicked(dataViewName: string) {\n      adapters.customerIo.track({\n        name: \"watchlistDataViewInteracted\",\n        data: {\n          action: \"upgradeButtonClicked\",\n          dataViewName,\n        },\n      })\n    },\n    downloadButtonClicked(dataViewName: string) {\n      adapters.customerIo.track({\n        name: \"watchlistDataViewInteracted\",\n        data: {\n          action: \"csvExported\",\n          dataViewName,\n        },\n      })\n    },\n    columnsModified(data: {\n      dataViewName: string\n      columnsAdded: Array<string> | \"all\"\n      columnsRemoved?: Array<string>\n    }) {\n      adapters.customerIo.track({\n        name: \"watchlistDataViewInteracted\",\n        data: {\n          action: \"columnsModified\",\n          ...data,\n        },\n      })\n    },\n  },\n}\n"],"names":["watchlistCustomerIo","defaultData","open","startUpload","endUpload","uploadMethod","uploadModalData","Object","assign","sendUploadModalEvent","name","data","common","sinceOpenModal","Date","now","sinceProcessingComplete","processingFileDuration","adapters","customerIo","track","watchlistApi","create","action","update","delete","favorite","unfavorite","uploadModal","setTimestamp","key","setUploadMethod","method","reset","sendCancel","props","type","sendError","watchlistId","message","errorMessage","sendSubmit","dataView","cellClick","accessed","dataViewName","upgradeButtonClicked","downloadButtonClicked","columnsModified"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
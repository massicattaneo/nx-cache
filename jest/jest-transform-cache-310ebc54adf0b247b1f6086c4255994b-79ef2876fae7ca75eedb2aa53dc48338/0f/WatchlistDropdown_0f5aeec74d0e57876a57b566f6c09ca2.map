{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/cqs-query-bar/src/lib/dropdowns/WatchlistDropdown.tsx"],"sourcesContent":["import { useEffect } from \"react\"\nimport { generatePath, useNavigate } from \"react-router-dom\"\nimport { RpqlFlatArrayIdFilter } from \"@rp/common/api-types\"\nimport { useCqsByIdsContext } from \"@rp/react/tanstack-api/cqs-by-ids\"\nimport { useWatchlist } from \"@rp/react/tanstack-api/watchlist\"\nimport { RPTooltip } from \"@rp/react/web/common/base-components\"\nimport { useDeviceInfo } from \"@rp/react/web/common/hooks\"\nimport {\n  FormControl,\n  FormControlLabel,\n  IconButton,\n  Radio,\n  RadioGroup,\n  Skeleton,\n  Typography,\n  useTheme,\n} from \"@rp/react/web/mui/core\"\n// Components\nimport { OpenInNew } from \"@rp/react/web/mui/icons\"\nimport { WATCHLIST_EDIT, WATCHLIST_ID_ROUTE } from \"@rp/react/web/router\"\n// Hooks\nimport { operationLabel } from \"./AdvancedDropdown\"\n// Styles\nimport {\n  DropdownContainer,\n  DropdownItemContainer,\n  DropdownScroll,\n  DropdownTitle,\n  WatchlistTitleStyled,\n} from \"./CqsDropdown.styles\"\n\ntype WatchlistDropdownProps = {\n  filter: RpqlFlatArrayIdFilter\n  onChange: (operation: string) => void\n}\n\nconst LoadingPopover = () => (\n  <WatchlistTitleStyled style={{ display: \"inline-block\" }}>\n    <Skeleton />\n    <Skeleton />\n    <Skeleton />\n  </WatchlistTitleStyled>\n)\n\nconst WatchlistEntities = ({ items }: { items: Array<string> }) => {\n  const { addByIds, ids } = useCqsByIdsContext()\n  useEffect(() => {\n    addByIds(items.map(item => ({ queryType: \"entity\", key: item })))\n  }, [items, addByIds])\n\n  const entities = items.map(item => ids[item]).filter(entity => entity !== undefined)\n\n  const sortedEntities = entities.sort((a, b) => a.data.name.localeCompare(b.data.name))\n\n  if (sortedEntities.length === 0) {\n    return (\n      <Typography sx={{ height: 34, padding: \"0 20px\", marginBottom: \"10px\" }}>\n        This watchlist has no items\n      </Typography>\n    )\n  }\n\n  return (\n    <DropdownScroll>\n      {sortedEntities.map(entity => {\n        return (\n          <DropdownItemContainer key={entity?.data?.key}>\n            <div>\n              {entity.isError ? <Typography sx={{ fontSize: 14 }}>Error</Typography> : null}\n              {entity?.isLoading ? (\n                <Skeleton sx={{ display: \"inline-block\" }} width={50} />\n              ) : (\n                <Typography sx={{ fontSize: 14, overflow: \"hidden\", textOverflow: \"ellipsis\" }}>\n                  {entity?.data?.name}\n                </Typography>\n              )}\n            </div>\n          </DropdownItemContainer>\n        )\n      })}\n    </DropdownScroll>\n  )\n}\n\nconst AdvancedWatchlist = ({ filter, onChange }: WatchlistDropdownProps) => {\n  const theme = useTheme()\n  const options = [\"in\", \"not-in\"] as const\n\n  return (\n    <>\n      <FormControl sx={{ padding: \"0 20px\" }}>\n        <RadioGroup\n          defaultValue=\"in\"\n          name=\"radio-buttons-group\"\n          value={filter.operation}\n          onChange={(event, value) => onChange(value)}\n        >\n          {options.map(opt => (\n            <FormControlLabel\n              key={opt}\n              value={opt}\n              control={<Radio size=\"small\" />}\n              label={\n                <Typography sx={{ fontSize: 14 }}>\n                  {operationLabel({ option: opt, isSingleValue: true }) ?? opt}\n                </Typography>\n              }\n            />\n          ))}\n        </RadioGroup>\n      </FormControl>\n      <hr style={{ margin: \"10px 0px 20px\", borderColor: theme.palette.grey[600] }} />\n    </>\n  )\n}\n\nexport function WatchlistDropdown({ filter, onChange }: WatchlistDropdownProps) {\n  const navigate = useNavigate()\n  const { isMobile } = useDeviceInfo()\n\n  const { data, isLoading: isLoadingWatchlist, isError } = useWatchlist(filter.value)\n  const { id = \"\", name = \"\", items = [] } = data || {}\n\n  const title = `${name} ${items.length > 1 ? `(${items.length})` : \"\"}`\n\n  const handleRedirect = () => {\n    if (isMobile) {\n      navigate(generatePath(WATCHLIST_EDIT, { id }))\n    } else {\n      navigate(generatePath(WATCHLIST_ID_ROUTE, { id }))\n    }\n  }\n\n  if (isError) {\n    return (\n      <Typography sx={{ height: 34, padding: \"0 20px\", marginBottom: \"10px\" }}>\n        An error has occurred, please try again\n      </Typography>\n    )\n  }\n\n  return (\n    <DropdownContainer>\n      <AdvancedWatchlist filter={filter} onChange={onChange} />\n\n      {isLoadingWatchlist ? (\n        <LoadingPopover />\n      ) : (\n        <div\n          style={{\n            width: isMobile ? undefined : \"380px\",\n          }}\n        >\n          <WatchlistTitleStyled>\n            <DropdownTitle sx={{ marginBottom: 0, padding: \"0\" }}>{title} </DropdownTitle>\n            <RPTooltip placement=\"top\" title=\"View Watchlist\">\n              <IconButton onClick={handleRedirect} size=\"small\">\n                <OpenInNew sx={{ fontSize: 20 }} />\n              </IconButton>\n            </RPTooltip>\n          </WatchlistTitleStyled>\n          <WatchlistEntities items={items} />\n        </div>\n      )}\n    </DropdownContainer>\n  )\n}\n"],"names":["WatchlistDropdown","LoadingPopover","WatchlistTitleStyled","style","display","Skeleton","WatchlistEntities","items","addByIds","ids","useCqsByIdsContext","useEffect","map","item","queryType","key","entities","filter","entity","undefined","sortedEntities","sort","a","b","data","name","localeCompare","length","Typography","sx","height","padding","marginBottom","DropdownScroll","DropdownItemContainer","div","isError","fontSize","isLoading","width","overflow","textOverflow","AdvancedWatchlist","onChange","theme","useTheme","options","FormControl","RadioGroup","defaultValue","value","operation","event","opt","operationLabel","FormControlLabel","control","Radio","size","label","option","isSingleValue","hr","margin","borderColor","palette","grey","navigate","useNavigate","isMobile","useDeviceInfo","isLoadingWatchlist","useWatchlist","id","title","handleRedirect","generatePath","WATCHLIST_EDIT","WATCHLIST_ID_ROUTE","DropdownContainer","DropdownTitle","RPTooltip","placement","IconButton","onClick","OpenInNew"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
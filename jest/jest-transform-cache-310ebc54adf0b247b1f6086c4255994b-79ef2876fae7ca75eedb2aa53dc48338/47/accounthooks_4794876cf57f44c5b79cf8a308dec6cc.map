{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/common/hooks/src/lib/account/account.hooks.ts"],"sourcesContent":["import { SetActive, SignInResource } from \"@clerk/types\"\nimport { useQuotaDetails } from \"@rp/react/tanstack-api/user-data-quota\"\nimport { useAllWatchlists } from \"@rp/react/tanstack-api/watchlist\"\nimport { useMutation } from \"@tanstack/react-query\"\nimport { UserDataQuota } from \"../useUserQuota\"\n\ntype SignInType = SignInResource | undefined\ntype SetActiveType = SetActive | undefined\n\nconst useSendCode = (signIn: SignInType, errorAction: (err: Error) => void) => {\n  return useMutation({\n    mutationFn: signIn?.create,\n    onError: err => errorAction(err),\n  })\n}\n\nconst useResetPassword = (\n  signIn: SignInType,\n  setActive: SetActiveType,\n  onError: (error?: Error) => void,\n) => {\n  return useMutation({\n    mutationFn: signIn?.attemptFirstFactor,\n    onSuccess: result => {\n      if (result.status === \"complete\") {\n        setActive?.({ session: result.createdSessionId })\n      } else {\n        onError()\n      }\n    },\n    onError: error => {\n      onError(error)\n    },\n  })\n}\ntype BriefConfigModes = \"email\"\ntype BriefConfigAPIScheduleDay = \"mon\" | \"tue\" | \"wed\" | \"thu\" | \"fri\" | \"sat\" | \"sun\"\n\ntype BriefSchedule = {\n  days: Array<BriefConfigAPIScheduleDay>\n  hour: number\n  minute: number\n  timezone: string\n}\n\ntype BriefConfig = {\n  briefName: string\n  dateCreated: string\n  deliveryModes: Array<BriefConfigModes>\n  email: string\n  id: string\n  lastUpdated: string\n  schedule: BriefSchedule\n  userId: string\n  watchlistIds: Array<string>\n  overview: string | null\n}\n\nconst useIsBriefLimitMet = (\n  quota: UserDataQuota | undefined | null,\n  briefConfigs: Array<BriefConfig> | undefined | null,\n) => {\n  const { data: allInfo } = useQuotaDetails()\n  // const { data: briefConfigs } = useUserBriefConfigs()\n\n  const isFreemium =\n    quota?.subscriptionStatus !== \"SUBSCRIBED\" &&\n    quota?.subscriptionStatus !== \"TRIAL\" &&\n    quota?.subscriptionStatus !== \"TRIAL-PENDING\"\n  const briefsMaxQuota = allInfo?.briefs?.maxValue\n  const maxBriefsAllowed = briefsMaxQuota ? briefsMaxQuota : 0\n\n  const briefConsumed = briefConfigs ? briefConfigs?.length : 0\n\n  return isFreemium && maxBriefsAllowed <= briefConsumed\n}\n\nconst useIsWatchlistLimitMet = (quota: UserDataQuota | undefined | null) => {\n  const { data: allInfo } = useQuotaDetails()\n  const { data: results } = useAllWatchlists(\"user\")\n\n  const isFreemium =\n    quota?.subscriptionStatus !== \"SUBSCRIBED\" &&\n    quota?.subscriptionStatus !== \"TRIAL\" &&\n    quota?.subscriptionStatus !== \"TRIAL-PENDING\"\n  const watchlistMaxQuota = allInfo?.watchlist?.maxValue\n  const watchlistQuotaAllowed = watchlistMaxQuota ? watchlistMaxQuota : 0\n  const watchlistsConsumed = results ? results.length : 0\n\n  return isFreemium && watchlistQuotaAllowed <= watchlistsConsumed\n}\n\nconst useIsWatchlistEntityLimitMet = (\n  quota: UserDataQuota | undefined | null,\n  watchlistEntityAmount: number,\n) => {\n  const { data: allInfo } = useQuotaDetails()\n\n  const isFreemium =\n    quota?.subscriptionStatus !== \"SUBSCRIBED\" &&\n    quota?.subscriptionStatus !== \"TRIAL\" &&\n    quota?.subscriptionStatus !== \"TRIAL-PENDING\"\n  const watchlistEntityMaxQuota = allInfo?.watchlistEntity?.maxValue\n  const watchlistQuotaAllowed = watchlistEntityMaxQuota ? watchlistEntityMaxQuota : 0\n  const watchlistEntityConsumed = watchlistEntityAmount\n\n  return isFreemium && watchlistQuotaAllowed <= watchlistEntityConsumed\n}\n\nconst useIsFreemium = (quota: UserDataQuota | undefined | null) => {\n  const isFreemium =\n    quota?.subscriptionStatus !== \"SUBSCRIBED\" &&\n    quota?.subscriptionStatus !== \"TRIAL\" &&\n    quota?.subscriptionStatus !== \"TRIAL-PENDING\"\n\n  return isFreemium\n}\n\nexport {\n  useSendCode,\n  useResetPassword,\n  useIsBriefLimitMet,\n  useIsWatchlistLimitMet,\n  useIsWatchlistEntityLimitMet,\n  useIsFreemium,\n}\n"],"names":["useIsBriefLimitMet","useIsFreemium","useIsWatchlistEntityLimitMet","useIsWatchlistLimitMet","useResetPassword","useSendCode","signIn","errorAction","useMutation","mutationFn","create","onError","err","setActive","attemptFirstFactor","onSuccess","result","status","session","createdSessionId","error","quota","briefConfigs","allInfo","data","useQuotaDetails","isFreemium","subscriptionStatus","briefsMaxQuota","briefs","maxValue","maxBriefsAllowed","briefConsumed","length","results","useAllWatchlists","watchlistMaxQuota","watchlist","watchlistQuotaAllowed","watchlistsConsumed","watchlistEntityAmount","watchlistEntityMaxQuota","watchlistEntity","watchlistEntityConsumed"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
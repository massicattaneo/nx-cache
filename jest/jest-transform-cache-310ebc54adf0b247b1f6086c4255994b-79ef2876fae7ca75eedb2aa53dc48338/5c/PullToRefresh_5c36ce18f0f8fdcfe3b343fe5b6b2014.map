{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/common/base-components/src/PwaPullToRefresh/PullToRefresh.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\"\nimport { Box } from \"@rp/react/web/mui/core\"\nimport { LoadingSpinner } from \"../LoadingSpinner\"\nimport { RefreshIndicator } from \"./RefreshIndicator\"\n\nconst createTouchCoordinates = (x: number, y: number) => ({ x, y })\n\nconst getTouchesCoordinatesFrom = (event: TouchEvent) => {\n  return createTouchCoordinates(event.targetTouches[0].screenX, event.targetTouches[0].screenY)\n}\n\nconst isDisabled = () => window.getComputedStyle(document.body).overflowY === \"hidden\"\n\nconst PullToRefresh = () => {\n  const [dragStartPoint, setDragStartPoint] = useState(createTouchCoordinates(0, 0))\n  const [drag, setDrag] = useState(0)\n  const [isRefreshing, setIsRefreshing] = useState(false)\n\n  useEffect(() => {\n    const start = (event: TouchEvent) => {\n      if (isDisabled()) return\n      const { x, y } = getTouchesCoordinatesFrom(event)\n      setDragStartPoint({ x, y })\n      setDrag(0)\n    }\n    document.addEventListener(\"touchstart\", start, { passive: false })\n    return () => document.removeEventListener(\"touchstart\", start)\n  }, [])\n\n  useEffect(() => {\n    const end = () => {\n      if (isDisabled()) return\n      setDrag(prev => {\n        if (prev > 120 && window.scrollY <= 0) {\n          setIsRefreshing(true)\n          setTimeout(() => window.location.reload(), 500)\n        }\n        return 0\n      })\n      setDragStartPoint(createTouchCoordinates(0, 0))\n    }\n    document.addEventListener(\"touchend\", end, { passive: false })\n    return () => document.removeEventListener(\"touchend\", end)\n  }, [])\n\n  useEffect(() => {\n    if (dragStartPoint.y === 0) return\n    const move = (event: TouchEvent) => {\n      if (isDisabled()) return\n      const currentPoint = getTouchesCoordinatesFrom(event)\n      setDrag(currentPoint.y - dragStartPoint.y)\n    }\n    document.addEventListener(\"touchmove\", move, { passive: false })\n    return () => {\n      document.removeEventListener(\"touchmove\", move)\n    }\n  }, [dragStartPoint.y])\n\n  if (isRefreshing) return <LoadingSpinner fillBackground />\n\n  return (\n    <Box>\n      <RefreshIndicator size={50} drag={drag} />\n    </Box>\n  )\n}\n\nexport { PullToRefresh }\n"],"names":["PullToRefresh","createTouchCoordinates","x","y","getTouchesCoordinatesFrom","event","targetTouches","screenX","screenY","isDisabled","window","getComputedStyle","document","body","overflowY","dragStartPoint","setDragStartPoint","useState","drag","setDrag","isRefreshing","setIsRefreshing","useEffect","start","addEventListener","passive","removeEventListener","end","prev","scrollY","setTimeout","location","reload","move","currentPoint","LoadingSpinner","fillBackground","Box","RefreshIndicator","size"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAmESA;;;eAAAA;;;;uBAnE2B;sBAChB;gCACW;kCACE;AAEjC,MAAMC,yBAAyB,CAACC,GAAWC,IAAe,CAAA;QAAED;QAAGC;IAAE,CAAA;AAEjE,MAAMC,4BAA4B,CAACC;IACjC,OAAOJ,uBAAuBI,MAAMC,aAAa,CAAC,EAAE,CAACC,OAAO,EAAEF,MAAMC,aAAa,CAAC,EAAE,CAACE,OAAO;AAC9F;AAEA,MAAMC,aAAa,IAAMC,OAAOC,gBAAgB,CAACC,SAASC,IAAI,EAAEC,SAAS,KAAK;AAE9E,MAAMd,gBAAgB;IACpB,MAAM,CAACe,gBAAgBC,kBAAkB,GAAGC,IAAAA,eAAQ,EAAChB,uBAAuB,GAAG;IAC/E,MAAM,CAACiB,MAAMC,QAAQ,GAAGF,IAAAA,eAAQ,EAAC;IACjC,MAAM,CAACG,cAAcC,gBAAgB,GAAGJ,IAAAA,eAAQ,EAAC;IAEjDK,IAAAA,gBAAS,EAAC;QACR,MAAMC,QAAQ,CAAClB;YACb,IAAII,cAAc;YAClB,MAAM,EAAEP,CAAC,EAAEC,CAAC,EAAE,GAAGC,0BAA0BC;YAC3CW,kBAAkB;gBAAEd;gBAAGC;YAAE;YACzBgB,QAAQ;QACV;QACAP,SAASY,gBAAgB,CAAC,cAAcD,OAAO;YAAEE,SAAS;QAAM;QAChE,OAAO,IAAMb,SAASc,mBAAmB,CAAC,cAAcH;IAC1D,GAAG,EAAE;IAELD,IAAAA,gBAAS,EAAC;QACR,MAAMK,MAAM;YACV,IAAIlB,cAAc;YAClBU,QAAQS,CAAAA;gBACN,IAAIA,OAAO,OAAOlB,OAAOmB,OAAO,IAAI,GAAG;oBACrCR,gBAAgB;oBAChBS,WAAW,IAAMpB,OAAOqB,QAAQ,CAACC,MAAM,IAAI;gBAC7C;gBACA,OAAO;YACT;YACAhB,kBAAkBf,uBAAuB,GAAG;QAC9C;QACAW,SAASY,gBAAgB,CAAC,YAAYG,KAAK;YAAEF,SAAS;QAAM;QAC5D,OAAO,IAAMb,SAASc,mBAAmB,CAAC,YAAYC;IACxD,GAAG,EAAE;IAELL,IAAAA,gBAAS,EAAC;QACR,IAAIP,eAAeZ,CAAC,KAAK,GAAG;QAC5B,MAAM8B,OAAO,CAAC5B;YACZ,IAAII,cAAc;YAClB,MAAMyB,eAAe9B,0BAA0BC;YAC/Cc,QAAQe,aAAa/B,CAAC,GAAGY,eAAeZ,CAAC;QAC3C;QACAS,SAASY,gBAAgB,CAAC,aAAaS,MAAM;YAAER,SAAS;QAAM;QAC9D,OAAO;YACLb,SAASc,mBAAmB,CAAC,aAAaO;QAC5C;IACF,GAAG;QAAClB,eAAeZ,CAAC;KAAC;IAErB,IAAIiB,cAAc,qBAAO,qBAACe,8BAAc;QAACC,cAAc;;IAEvD,qBACE,qBAACC,SAAG;kBACF,cAAA,qBAACC,kCAAgB;YAACC,MAAM;YAAIrB,MAAMA;;;AAGxC"}
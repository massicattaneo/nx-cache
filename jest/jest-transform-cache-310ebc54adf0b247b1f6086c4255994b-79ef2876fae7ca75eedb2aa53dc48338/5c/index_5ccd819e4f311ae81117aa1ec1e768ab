af69d7d55f17a6c3411763d24b7fb58f
/**
 * @typedef {import('mdast').Link} Link
 * @typedef {import('mdast').PhrasingContent} PhrasingContent
 *
 * @typedef {import('mdast-util-from-markdown').CompileContext} CompileContext
 * @typedef {import('mdast-util-from-markdown').Extension} FromMarkdownExtension
 * @typedef {import('mdast-util-from-markdown').Handle} FromMarkdownHandle
 * @typedef {import('mdast-util-from-markdown').Transform} FromMarkdownTransform
 *
 * @typedef {import('mdast-util-to-markdown').ConstructName} ConstructName
 * @typedef {import('mdast-util-to-markdown').Options} ToMarkdownExtension
 *
 * @typedef {import('mdast-util-find-and-replace').RegExpMatchObject} RegExpMatchObject
 * @typedef {import('mdast-util-find-and-replace').ReplaceFunction} ReplaceFunction
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    gfmAutolinkLiteralFromMarkdown: function() {
        return gfmAutolinkLiteralFromMarkdown;
    },
    gfmAutolinkLiteralToMarkdown: function() {
        return gfmAutolinkLiteralToMarkdown;
    }
});
const _ccount = require("ccount");
const _devlop = require("devlop");
const _micromarkutilcharacter = require("micromark-util-character");
const _mdastutilfindandreplace = require("mdast-util-find-and-replace");
/** @type {ConstructName} */ const inConstruct = 'phrasing';
/** @type {Array<ConstructName>} */ const notInConstruct = [
    'autolink',
    'link',
    'image',
    'label'
];
function gfmAutolinkLiteralFromMarkdown() {
    return {
        transforms: [
            transformGfmAutolinkLiterals
        ],
        enter: {
            literalAutolink: enterLiteralAutolink,
            literalAutolinkEmail: enterLiteralAutolinkValue,
            literalAutolinkHttp: enterLiteralAutolinkValue,
            literalAutolinkWww: enterLiteralAutolinkValue
        },
        exit: {
            literalAutolink: exitLiteralAutolink,
            literalAutolinkEmail: exitLiteralAutolinkEmail,
            literalAutolinkHttp: exitLiteralAutolinkHttp,
            literalAutolinkWww: exitLiteralAutolinkWww
        }
    };
}
function gfmAutolinkLiteralToMarkdown() {
    return {
        unsafe: [
            {
                character: '@',
                before: '[+\\-.\\w]',
                after: '[\\-.\\w]',
                inConstruct,
                notInConstruct
            },
            {
                character: '.',
                before: '[Ww]',
                after: '[\\-.\\w]',
                inConstruct,
                notInConstruct
            },
            {
                character: ':',
                before: '[ps]',
                after: '\\/',
                inConstruct,
                notInConstruct
            }
        ]
    };
}
/**
 * @this {CompileContext}
 * @type {FromMarkdownHandle}
 */ function enterLiteralAutolink(token) {
    this.enter({
        type: 'link',
        title: null,
        url: '',
        children: []
    }, token);
}
/**
 * @this {CompileContext}
 * @type {FromMarkdownHandle}
 */ function enterLiteralAutolinkValue(token) {
    this.config.enter.autolinkProtocol.call(this, token);
}
/**
 * @this {CompileContext}
 * @type {FromMarkdownHandle}
 */ function exitLiteralAutolinkHttp(token) {
    this.config.exit.autolinkProtocol.call(this, token);
}
/**
 * @this {CompileContext}
 * @type {FromMarkdownHandle}
 */ function exitLiteralAutolinkWww(token) {
    this.config.exit.data.call(this, token);
    const node = this.stack[this.stack.length - 1];
    (0, _devlop.ok)(node.type === 'link');
    node.url = 'http://' + this.sliceSerialize(token);
}
/**
 * @this {CompileContext}
 * @type {FromMarkdownHandle}
 */ function exitLiteralAutolinkEmail(token) {
    this.config.exit.autolinkEmail.call(this, token);
}
/**
 * @this {CompileContext}
 * @type {FromMarkdownHandle}
 */ function exitLiteralAutolink(token) {
    this.exit(token);
}
/** @type {FromMarkdownTransform} */ function transformGfmAutolinkLiterals(tree) {
    (0, _mdastutilfindandreplace.findAndReplace)(tree, [
        [
            /(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,
            findUrl
        ],
        [
            /([-.\w+]+)@([-\w]+(?:\.[-\w]+)+)/g,
            findEmail
        ]
    ], {
        ignore: [
            'link',
            'linkReference'
        ]
    });
}
/**
 * @type {ReplaceFunction}
 * @param {string} _
 * @param {string} protocol
 * @param {string} domain
 * @param {string} path
 * @param {RegExpMatchObject} match
 * @returns {Array<PhrasingContent> | Link | false}
 */ // eslint-disable-next-line max-params
function findUrl(_, protocol, domain, path, match) {
    let prefix = '';
    // Not an expected previous character.
    if (!previous(match)) {
        return false;
    }
    // Treat `www` as part of the domain.
    if (/^w/i.test(protocol)) {
        domain = protocol + domain;
        protocol = '';
        prefix = 'http://';
    }
    if (!isCorrectDomain(domain)) {
        return false;
    }
    const parts = splitUrl(domain + path);
    if (!parts[0]) return false;
    /** @type {Link} */ const result = {
        type: 'link',
        title: null,
        url: prefix + protocol + parts[0],
        children: [
            {
                type: 'text',
                value: protocol + parts[0]
            }
        ]
    };
    if (parts[1]) {
        return [
            result,
            {
                type: 'text',
                value: parts[1]
            }
        ];
    }
    return result;
}
/**
 * @type {ReplaceFunction}
 * @param {string} _
 * @param {string} atext
 * @param {string} label
 * @param {RegExpMatchObject} match
 * @returns {Link | false}
 */ function findEmail(_, atext, label, match) {
    if (// Not an expected previous character.
    !previous(match, true) || // Label ends in not allowed character.
    /[-\d_]$/.test(label)) {
        return false;
    }
    return {
        type: 'link',
        title: null,
        url: 'mailto:' + atext + '@' + label,
        children: [
            {
                type: 'text',
                value: atext + '@' + label
            }
        ]
    };
}
/**
 * @param {string} domain
 * @returns {boolean}
 */ function isCorrectDomain(domain) {
    const parts = domain.split('.');
    if (parts.length < 2 || parts[parts.length - 1] && (/_/.test(parts[parts.length - 1]) || !/[a-zA-Z\d]/.test(parts[parts.length - 1])) || parts[parts.length - 2] && (/_/.test(parts[parts.length - 2]) || !/[a-zA-Z\d]/.test(parts[parts.length - 2]))) {
        return false;
    }
    return true;
}
/**
 * @param {string} url
 * @returns {[string, string | undefined]}
 */ function splitUrl(url) {
    const trailExec = /[!"&'),.:;<>?\]}]+$/.exec(url);
    if (!trailExec) {
        return [
            url,
            undefined
        ];
    }
    url = url.slice(0, trailExec.index);
    let trail = trailExec[0];
    let closingParenIndex = trail.indexOf(')');
    const openingParens = (0, _ccount.ccount)(url, '(');
    let closingParens = (0, _ccount.ccount)(url, ')');
    while(closingParenIndex !== -1 && openingParens > closingParens){
        url += trail.slice(0, closingParenIndex + 1);
        trail = trail.slice(closingParenIndex + 1);
        closingParenIndex = trail.indexOf(')');
        closingParens++;
    }
    return [
        url,
        trail
    ];
}
/**
 * @param {RegExpMatchObject} match
 * @param {boolean | null | undefined} [email=false]
 * @returns {boolean}
 */ function previous(match, email) {
    const code = match.input.charCodeAt(match.index - 1);
    return (match.index === 0 || (0, _micromarkutilcharacter.unicodeWhitespace)(code) || (0, _micromarkutilcharacter.unicodePunctuation)(code)) && (!email || code !== 47);
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9tY2F0dGFuZW8vd29ya3NwYWNlL2Zyb250ZW5kL25vZGVfbW9kdWxlcy9tZGFzdC11dGlsLWdmbS1hdXRvbGluay1saXRlcmFsL2xpYi9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEB0eXBlZGVmIHtpbXBvcnQoJ21kYXN0JykuTGlua30gTGlua1xuICogQHR5cGVkZWYge2ltcG9ydCgnbWRhc3QnKS5QaHJhc2luZ0NvbnRlbnR9IFBocmFzaW5nQ29udGVudFxuICpcbiAqIEB0eXBlZGVmIHtpbXBvcnQoJ21kYXN0LXV0aWwtZnJvbS1tYXJrZG93bicpLkNvbXBpbGVDb250ZXh0fSBDb21waWxlQ29udGV4dFxuICogQHR5cGVkZWYge2ltcG9ydCgnbWRhc3QtdXRpbC1mcm9tLW1hcmtkb3duJykuRXh0ZW5zaW9ufSBGcm9tTWFya2Rvd25FeHRlbnNpb25cbiAqIEB0eXBlZGVmIHtpbXBvcnQoJ21kYXN0LXV0aWwtZnJvbS1tYXJrZG93bicpLkhhbmRsZX0gRnJvbU1hcmtkb3duSGFuZGxlXG4gKiBAdHlwZWRlZiB7aW1wb3J0KCdtZGFzdC11dGlsLWZyb20tbWFya2Rvd24nKS5UcmFuc2Zvcm19IEZyb21NYXJrZG93blRyYW5zZm9ybVxuICpcbiAqIEB0eXBlZGVmIHtpbXBvcnQoJ21kYXN0LXV0aWwtdG8tbWFya2Rvd24nKS5Db25zdHJ1Y3ROYW1lfSBDb25zdHJ1Y3ROYW1lXG4gKiBAdHlwZWRlZiB7aW1wb3J0KCdtZGFzdC11dGlsLXRvLW1hcmtkb3duJykuT3B0aW9uc30gVG9NYXJrZG93bkV4dGVuc2lvblxuICpcbiAqIEB0eXBlZGVmIHtpbXBvcnQoJ21kYXN0LXV0aWwtZmluZC1hbmQtcmVwbGFjZScpLlJlZ0V4cE1hdGNoT2JqZWN0fSBSZWdFeHBNYXRjaE9iamVjdFxuICogQHR5cGVkZWYge2ltcG9ydCgnbWRhc3QtdXRpbC1maW5kLWFuZC1yZXBsYWNlJykuUmVwbGFjZUZ1bmN0aW9ufSBSZXBsYWNlRnVuY3Rpb25cbiAqL1xuXG5pbXBvcnQge2Njb3VudH0gZnJvbSAnY2NvdW50J1xuaW1wb3J0IHtvayBhcyBhc3NlcnR9IGZyb20gJ2RldmxvcCdcbmltcG9ydCB7dW5pY29kZVB1bmN0dWF0aW9uLCB1bmljb2RlV2hpdGVzcGFjZX0gZnJvbSAnbWljcm9tYXJrLXV0aWwtY2hhcmFjdGVyJ1xuaW1wb3J0IHtmaW5kQW5kUmVwbGFjZX0gZnJvbSAnbWRhc3QtdXRpbC1maW5kLWFuZC1yZXBsYWNlJ1xuXG4vKiogQHR5cGUge0NvbnN0cnVjdE5hbWV9ICovXG5jb25zdCBpbkNvbnN0cnVjdCA9ICdwaHJhc2luZydcbi8qKiBAdHlwZSB7QXJyYXk8Q29uc3RydWN0TmFtZT59ICovXG5jb25zdCBub3RJbkNvbnN0cnVjdCA9IFsnYXV0b2xpbmsnLCAnbGluaycsICdpbWFnZScsICdsYWJlbCddXG5cbi8qKlxuICogQ3JlYXRlIGFuIGV4dGVuc2lvbiBmb3IgYG1kYXN0LXV0aWwtZnJvbS1tYXJrZG93bmAgdG8gZW5hYmxlIEdGTSBhdXRvbGlua1xuICogbGl0ZXJhbHMgaW4gbWFya2Rvd24uXG4gKlxuICogQHJldHVybnMge0Zyb21NYXJrZG93bkV4dGVuc2lvbn1cbiAqICAgRXh0ZW5zaW9uIGZvciBgbWRhc3QtdXRpbC10by1tYXJrZG93bmAgdG8gZW5hYmxlIEdGTSBhdXRvbGluayBsaXRlcmFscy5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdmbUF1dG9saW5rTGl0ZXJhbEZyb21NYXJrZG93bigpIHtcbiAgcmV0dXJuIHtcbiAgICB0cmFuc2Zvcm1zOiBbdHJhbnNmb3JtR2ZtQXV0b2xpbmtMaXRlcmFsc10sXG4gICAgZW50ZXI6IHtcbiAgICAgIGxpdGVyYWxBdXRvbGluazogZW50ZXJMaXRlcmFsQXV0b2xpbmssXG4gICAgICBsaXRlcmFsQXV0b2xpbmtFbWFpbDogZW50ZXJMaXRlcmFsQXV0b2xpbmtWYWx1ZSxcbiAgICAgIGxpdGVyYWxBdXRvbGlua0h0dHA6IGVudGVyTGl0ZXJhbEF1dG9saW5rVmFsdWUsXG4gICAgICBsaXRlcmFsQXV0b2xpbmtXd3c6IGVudGVyTGl0ZXJhbEF1dG9saW5rVmFsdWVcbiAgICB9LFxuICAgIGV4aXQ6IHtcbiAgICAgIGxpdGVyYWxBdXRvbGluazogZXhpdExpdGVyYWxBdXRvbGluayxcbiAgICAgIGxpdGVyYWxBdXRvbGlua0VtYWlsOiBleGl0TGl0ZXJhbEF1dG9saW5rRW1haWwsXG4gICAgICBsaXRlcmFsQXV0b2xpbmtIdHRwOiBleGl0TGl0ZXJhbEF1dG9saW5rSHR0cCxcbiAgICAgIGxpdGVyYWxBdXRvbGlua1d3dzogZXhpdExpdGVyYWxBdXRvbGlua1d3d1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSBhbiBleHRlbnNpb24gZm9yIGBtZGFzdC11dGlsLXRvLW1hcmtkb3duYCB0byBlbmFibGUgR0ZNIGF1dG9saW5rXG4gKiBsaXRlcmFscyBpbiBtYXJrZG93bi5cbiAqXG4gKiBAcmV0dXJucyB7VG9NYXJrZG93bkV4dGVuc2lvbn1cbiAqICAgRXh0ZW5zaW9uIGZvciBgbWRhc3QtdXRpbC10by1tYXJrZG93bmAgdG8gZW5hYmxlIEdGTSBhdXRvbGluayBsaXRlcmFscy5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdmbUF1dG9saW5rTGl0ZXJhbFRvTWFya2Rvd24oKSB7XG4gIHJldHVybiB7XG4gICAgdW5zYWZlOiBbXG4gICAgICB7XG4gICAgICAgIGNoYXJhY3RlcjogJ0AnLFxuICAgICAgICBiZWZvcmU6ICdbK1xcXFwtLlxcXFx3XScsXG4gICAgICAgIGFmdGVyOiAnW1xcXFwtLlxcXFx3XScsXG4gICAgICAgIGluQ29uc3RydWN0LFxuICAgICAgICBub3RJbkNvbnN0cnVjdFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgY2hhcmFjdGVyOiAnLicsXG4gICAgICAgIGJlZm9yZTogJ1tXd10nLFxuICAgICAgICBhZnRlcjogJ1tcXFxcLS5cXFxcd10nLFxuICAgICAgICBpbkNvbnN0cnVjdCxcbiAgICAgICAgbm90SW5Db25zdHJ1Y3RcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGNoYXJhY3RlcjogJzonLFxuICAgICAgICBiZWZvcmU6ICdbcHNdJyxcbiAgICAgICAgYWZ0ZXI6ICdcXFxcLycsXG4gICAgICAgIGluQ29uc3RydWN0LFxuICAgICAgICBub3RJbkNvbnN0cnVjdFxuICAgICAgfVxuICAgIF1cbiAgfVxufVxuXG4vKipcbiAqIEB0aGlzIHtDb21waWxlQ29udGV4dH1cbiAqIEB0eXBlIHtGcm9tTWFya2Rvd25IYW5kbGV9XG4gKi9cbmZ1bmN0aW9uIGVudGVyTGl0ZXJhbEF1dG9saW5rKHRva2VuKSB7XG4gIHRoaXMuZW50ZXIoe3R5cGU6ICdsaW5rJywgdGl0bGU6IG51bGwsIHVybDogJycsIGNoaWxkcmVuOiBbXX0sIHRva2VuKVxufVxuXG4vKipcbiAqIEB0aGlzIHtDb21waWxlQ29udGV4dH1cbiAqIEB0eXBlIHtGcm9tTWFya2Rvd25IYW5kbGV9XG4gKi9cbmZ1bmN0aW9uIGVudGVyTGl0ZXJhbEF1dG9saW5rVmFsdWUodG9rZW4pIHtcbiAgdGhpcy5jb25maWcuZW50ZXIuYXV0b2xpbmtQcm90b2NvbC5jYWxsKHRoaXMsIHRva2VuKVxufVxuXG4vKipcbiAqIEB0aGlzIHtDb21waWxlQ29udGV4dH1cbiAqIEB0eXBlIHtGcm9tTWFya2Rvd25IYW5kbGV9XG4gKi9cbmZ1bmN0aW9uIGV4aXRMaXRlcmFsQXV0b2xpbmtIdHRwKHRva2VuKSB7XG4gIHRoaXMuY29uZmlnLmV4aXQuYXV0b2xpbmtQcm90b2NvbC5jYWxsKHRoaXMsIHRva2VuKVxufVxuXG4vKipcbiAqIEB0aGlzIHtDb21waWxlQ29udGV4dH1cbiAqIEB0eXBlIHtGcm9tTWFya2Rvd25IYW5kbGV9XG4gKi9cbmZ1bmN0aW9uIGV4aXRMaXRlcmFsQXV0b2xpbmtXd3codG9rZW4pIHtcbiAgdGhpcy5jb25maWcuZXhpdC5kYXRhLmNhbGwodGhpcywgdG9rZW4pXG4gIGNvbnN0IG5vZGUgPSB0aGlzLnN0YWNrW3RoaXMuc3RhY2subGVuZ3RoIC0gMV1cbiAgYXNzZXJ0KG5vZGUudHlwZSA9PT0gJ2xpbmsnKVxuICBub2RlLnVybCA9ICdodHRwOi8vJyArIHRoaXMuc2xpY2VTZXJpYWxpemUodG9rZW4pXG59XG5cbi8qKlxuICogQHRoaXMge0NvbXBpbGVDb250ZXh0fVxuICogQHR5cGUge0Zyb21NYXJrZG93bkhhbmRsZX1cbiAqL1xuZnVuY3Rpb24gZXhpdExpdGVyYWxBdXRvbGlua0VtYWlsKHRva2VuKSB7XG4gIHRoaXMuY29uZmlnLmV4aXQuYXV0b2xpbmtFbWFpbC5jYWxsKHRoaXMsIHRva2VuKVxufVxuXG4vKipcbiAqIEB0aGlzIHtDb21waWxlQ29udGV4dH1cbiAqIEB0eXBlIHtGcm9tTWFya2Rvd25IYW5kbGV9XG4gKi9cbmZ1bmN0aW9uIGV4aXRMaXRlcmFsQXV0b2xpbmsodG9rZW4pIHtcbiAgdGhpcy5leGl0KHRva2VuKVxufVxuXG4vKiogQHR5cGUge0Zyb21NYXJrZG93blRyYW5zZm9ybX0gKi9cbmZ1bmN0aW9uIHRyYW5zZm9ybUdmbUF1dG9saW5rTGl0ZXJhbHModHJlZSkge1xuICBmaW5kQW5kUmVwbGFjZShcbiAgICB0cmVlLFxuICAgIFtcbiAgICAgIFsvKGh0dHBzPzpcXC9cXC98d3d3KD89XFwuKSkoWy0uXFx3XSspKFteIFxcdFxcclxcbl0qKS9naSwgZmluZFVybF0sXG4gICAgICBbLyhbLS5cXHcrXSspQChbLVxcd10rKD86XFwuWy1cXHddKykrKS9nLCBmaW5kRW1haWxdXG4gICAgXSxcbiAgICB7aWdub3JlOiBbJ2xpbmsnLCAnbGlua1JlZmVyZW5jZSddfVxuICApXG59XG5cbi8qKlxuICogQHR5cGUge1JlcGxhY2VGdW5jdGlvbn1cbiAqIEBwYXJhbSB7c3RyaW5nfSBfXG4gKiBAcGFyYW0ge3N0cmluZ30gcHJvdG9jb2xcbiAqIEBwYXJhbSB7c3RyaW5nfSBkb21haW5cbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoXG4gKiBAcGFyYW0ge1JlZ0V4cE1hdGNoT2JqZWN0fSBtYXRjaFxuICogQHJldHVybnMge0FycmF5PFBocmFzaW5nQ29udGVudD4gfCBMaW5rIHwgZmFsc2V9XG4gKi9cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG5mdW5jdGlvbiBmaW5kVXJsKF8sIHByb3RvY29sLCBkb21haW4sIHBhdGgsIG1hdGNoKSB7XG4gIGxldCBwcmVmaXggPSAnJ1xuXG4gIC8vIE5vdCBhbiBleHBlY3RlZCBwcmV2aW91cyBjaGFyYWN0ZXIuXG4gIGlmICghcHJldmlvdXMobWF0Y2gpKSB7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICAvLyBUcmVhdCBgd3d3YCBhcyBwYXJ0IG9mIHRoZSBkb21haW4uXG4gIGlmICgvXncvaS50ZXN0KHByb3RvY29sKSkge1xuICAgIGRvbWFpbiA9IHByb3RvY29sICsgZG9tYWluXG4gICAgcHJvdG9jb2wgPSAnJ1xuICAgIHByZWZpeCA9ICdodHRwOi8vJ1xuICB9XG5cbiAgaWYgKCFpc0NvcnJlY3REb21haW4oZG9tYWluKSkge1xuICAgIHJldHVybiBmYWxzZVxuICB9XG5cbiAgY29uc3QgcGFydHMgPSBzcGxpdFVybChkb21haW4gKyBwYXRoKVxuXG4gIGlmICghcGFydHNbMF0pIHJldHVybiBmYWxzZVxuXG4gIC8qKiBAdHlwZSB7TGlua30gKi9cbiAgY29uc3QgcmVzdWx0ID0ge1xuICAgIHR5cGU6ICdsaW5rJyxcbiAgICB0aXRsZTogbnVsbCxcbiAgICB1cmw6IHByZWZpeCArIHByb3RvY29sICsgcGFydHNbMF0sXG4gICAgY2hpbGRyZW46IFt7dHlwZTogJ3RleHQnLCB2YWx1ZTogcHJvdG9jb2wgKyBwYXJ0c1swXX1dXG4gIH1cblxuICBpZiAocGFydHNbMV0pIHtcbiAgICByZXR1cm4gW3Jlc3VsdCwge3R5cGU6ICd0ZXh0JywgdmFsdWU6IHBhcnRzWzFdfV1cbiAgfVxuXG4gIHJldHVybiByZXN1bHRcbn1cblxuLyoqXG4gKiBAdHlwZSB7UmVwbGFjZUZ1bmN0aW9ufVxuICogQHBhcmFtIHtzdHJpbmd9IF9cbiAqIEBwYXJhbSB7c3RyaW5nfSBhdGV4dFxuICogQHBhcmFtIHtzdHJpbmd9IGxhYmVsXG4gKiBAcGFyYW0ge1JlZ0V4cE1hdGNoT2JqZWN0fSBtYXRjaFxuICogQHJldHVybnMge0xpbmsgfCBmYWxzZX1cbiAqL1xuZnVuY3Rpb24gZmluZEVtYWlsKF8sIGF0ZXh0LCBsYWJlbCwgbWF0Y2gpIHtcbiAgaWYgKFxuICAgIC8vIE5vdCBhbiBleHBlY3RlZCBwcmV2aW91cyBjaGFyYWN0ZXIuXG4gICAgIXByZXZpb3VzKG1hdGNoLCB0cnVlKSB8fFxuICAgIC8vIExhYmVsIGVuZHMgaW4gbm90IGFsbG93ZWQgY2hhcmFjdGVyLlxuICAgIC9bLVxcZF9dJC8udGVzdChsYWJlbClcbiAgKSB7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICByZXR1cm4ge1xuICAgIHR5cGU6ICdsaW5rJyxcbiAgICB0aXRsZTogbnVsbCxcbiAgICB1cmw6ICdtYWlsdG86JyArIGF0ZXh0ICsgJ0AnICsgbGFiZWwsXG4gICAgY2hpbGRyZW46IFt7dHlwZTogJ3RleHQnLCB2YWx1ZTogYXRleHQgKyAnQCcgKyBsYWJlbH1dXG4gIH1cbn1cblxuLyoqXG4gKiBAcGFyYW0ge3N0cmluZ30gZG9tYWluXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAqL1xuZnVuY3Rpb24gaXNDb3JyZWN0RG9tYWluKGRvbWFpbikge1xuICBjb25zdCBwYXJ0cyA9IGRvbWFpbi5zcGxpdCgnLicpXG5cbiAgaWYgKFxuICAgIHBhcnRzLmxlbmd0aCA8IDIgfHxcbiAgICAocGFydHNbcGFydHMubGVuZ3RoIC0gMV0gJiZcbiAgICAgICgvXy8udGVzdChwYXJ0c1twYXJ0cy5sZW5ndGggLSAxXSkgfHxcbiAgICAgICAgIS9bYS16QS1aXFxkXS8udGVzdChwYXJ0c1twYXJ0cy5sZW5ndGggLSAxXSkpKSB8fFxuICAgIChwYXJ0c1twYXJ0cy5sZW5ndGggLSAyXSAmJlxuICAgICAgKC9fLy50ZXN0KHBhcnRzW3BhcnRzLmxlbmd0aCAtIDJdKSB8fFxuICAgICAgICAhL1thLXpBLVpcXGRdLy50ZXN0KHBhcnRzW3BhcnRzLmxlbmd0aCAtIDJdKSkpXG4gICkge1xuICAgIHJldHVybiBmYWxzZVxuICB9XG5cbiAgcmV0dXJuIHRydWVcbn1cblxuLyoqXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJsXG4gKiBAcmV0dXJucyB7W3N0cmluZywgc3RyaW5nIHwgdW5kZWZpbmVkXX1cbiAqL1xuZnVuY3Rpb24gc3BsaXRVcmwodXJsKSB7XG4gIGNvbnN0IHRyYWlsRXhlYyA9IC9bIVwiJicpLC46Ozw+P1xcXX1dKyQvLmV4ZWModXJsKVxuXG4gIGlmICghdHJhaWxFeGVjKSB7XG4gICAgcmV0dXJuIFt1cmwsIHVuZGVmaW5lZF1cbiAgfVxuXG4gIHVybCA9IHVybC5zbGljZSgwLCB0cmFpbEV4ZWMuaW5kZXgpXG5cbiAgbGV0IHRyYWlsID0gdHJhaWxFeGVjWzBdXG4gIGxldCBjbG9zaW5nUGFyZW5JbmRleCA9IHRyYWlsLmluZGV4T2YoJyknKVxuICBjb25zdCBvcGVuaW5nUGFyZW5zID0gY2NvdW50KHVybCwgJygnKVxuICBsZXQgY2xvc2luZ1BhcmVucyA9IGNjb3VudCh1cmwsICcpJylcblxuICB3aGlsZSAoY2xvc2luZ1BhcmVuSW5kZXggIT09IC0xICYmIG9wZW5pbmdQYXJlbnMgPiBjbG9zaW5nUGFyZW5zKSB7XG4gICAgdXJsICs9IHRyYWlsLnNsaWNlKDAsIGNsb3NpbmdQYXJlbkluZGV4ICsgMSlcbiAgICB0cmFpbCA9IHRyYWlsLnNsaWNlKGNsb3NpbmdQYXJlbkluZGV4ICsgMSlcbiAgICBjbG9zaW5nUGFyZW5JbmRleCA9IHRyYWlsLmluZGV4T2YoJyknKVxuICAgIGNsb3NpbmdQYXJlbnMrK1xuICB9XG5cbiAgcmV0dXJuIFt1cmwsIHRyYWlsXVxufVxuXG4vKipcbiAqIEBwYXJhbSB7UmVnRXhwTWF0Y2hPYmplY3R9IG1hdGNoXG4gKiBAcGFyYW0ge2Jvb2xlYW4gfCBudWxsIHwgdW5kZWZpbmVkfSBbZW1haWw9ZmFsc2VdXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAqL1xuZnVuY3Rpb24gcHJldmlvdXMobWF0Y2gsIGVtYWlsKSB7XG4gIGNvbnN0IGNvZGUgPSBtYXRjaC5pbnB1dC5jaGFyQ29kZUF0KG1hdGNoLmluZGV4IC0gMSlcblxuICByZXR1cm4gKFxuICAgIChtYXRjaC5pbmRleCA9PT0gMCB8fFxuICAgICAgdW5pY29kZVdoaXRlc3BhY2UoY29kZSkgfHxcbiAgICAgIHVuaWNvZGVQdW5jdHVhdGlvbihjb2RlKSkgJiZcbiAgICAoIWVtYWlsIHx8IGNvZGUgIT09IDQ3KVxuICApXG59XG4iXSwibmFtZXMiOlsiZ2ZtQXV0b2xpbmtMaXRlcmFsRnJvbU1hcmtkb3duIiwiZ2ZtQXV0b2xpbmtMaXRlcmFsVG9NYXJrZG93biIsImluQ29uc3RydWN0Iiwibm90SW5Db25zdHJ1Y3QiLCJ0cmFuc2Zvcm1zIiwidHJhbnNmb3JtR2ZtQXV0b2xpbmtMaXRlcmFscyIsImVudGVyIiwibGl0ZXJhbEF1dG9saW5rIiwiZW50ZXJMaXRlcmFsQXV0b2xpbmsiLCJsaXRlcmFsQXV0b2xpbmtFbWFpbCIsImVudGVyTGl0ZXJhbEF1dG9saW5rVmFsdWUiLCJsaXRlcmFsQXV0b2xpbmtIdHRwIiwibGl0ZXJhbEF1dG9saW5rV3d3IiwiZXhpdCIsImV4aXRMaXRlcmFsQXV0b2xpbmsiLCJleGl0TGl0ZXJhbEF1dG9saW5rRW1haWwiLCJleGl0TGl0ZXJhbEF1dG9saW5rSHR0cCIsImV4aXRMaXRlcmFsQXV0b2xpbmtXd3ciLCJ1bnNhZmUiLCJjaGFyYWN0ZXIiLCJiZWZvcmUiLCJhZnRlciIsInRva2VuIiwidHlwZSIsInRpdGxlIiwidXJsIiwiY2hpbGRyZW4iLCJjb25maWciLCJhdXRvbGlua1Byb3RvY29sIiwiY2FsbCIsImRhdGEiLCJub2RlIiwic3RhY2siLCJsZW5ndGgiLCJhc3NlcnQiLCJzbGljZVNlcmlhbGl6ZSIsImF1dG9saW5rRW1haWwiLCJ0cmVlIiwiZmluZEFuZFJlcGxhY2UiLCJmaW5kVXJsIiwiZmluZEVtYWlsIiwiaWdub3JlIiwiXyIsInByb3RvY29sIiwiZG9tYWluIiwicGF0aCIsIm1hdGNoIiwicHJlZml4IiwicHJldmlvdXMiLCJ0ZXN0IiwiaXNDb3JyZWN0RG9tYWluIiwicGFydHMiLCJzcGxpdFVybCIsInJlc3VsdCIsInZhbHVlIiwiYXRleHQiLCJsYWJlbCIsInNwbGl0IiwidHJhaWxFeGVjIiwiZXhlYyIsInVuZGVmaW5lZCIsInNsaWNlIiwiaW5kZXgiLCJ0cmFpbCIsImNsb3NpbmdQYXJlbkluZGV4IiwiaW5kZXhPZiIsIm9wZW5pbmdQYXJlbnMiLCJjY291bnQiLCJjbG9zaW5nUGFyZW5zIiwiZW1haWwiLCJjb2RlIiwiaW5wdXQiLCJjaGFyQ29kZUF0IiwidW5pY29kZVdoaXRlc3BhY2UiLCJ1bmljb2RlUHVuY3R1YXRpb24iXSwicmFuZ2VNYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OyIsIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7Q0FjQzs7Ozs7Ozs7Ozs7SUFtQmVBLDhCQUE4QjtlQUE5QkE7O0lBeUJBQyw0QkFBNEI7ZUFBNUJBOzs7d0JBMUNLO3dCQUNNO3dDQUN5Qjt5Q0FDdkI7QUFFN0IsMEJBQTBCLEdBQzFCLE1BQU1DLGNBQWM7QUFDcEIsaUNBQWlDLEdBQ2pDLE1BQU1DLGlCQUFpQjtJQUFDO0lBQVk7SUFBUTtJQUFTO0NBQVE7QUFTdEQsU0FBU0g7SUFDZCxPQUFPO1FBQ0xJLFlBQVk7WUFBQ0M7U0FBNkI7UUFDMUNDLE9BQU87WUFDTEMsaUJBQWlCQztZQUNqQkMsc0JB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
{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/common/providers/src/QueryActionsContext/useQueryActions.tsx"],"sourcesContent":["import { matchPath, useLocation, useNavigate } from \"react-router-dom\"\nimport { useUser } from \"@clerk/clerk-react\"\nimport { red } from \"@mui/material/colors\"\nimport { CqsUserQueryOrContextQuery } from \"@rp/common/api-types\"\nimport { getSavedQuery } from \"@rp/react/tanstack-api/user-data-queries\"\nimport { ShareIcon } from \"@rp/react/web/common/base-components\"\nimport { Actions } from \"@rp/react/web/common/types\"\nimport { FeedViewIcon } from \"@rp/react/web/icons\"\nimport {\n  Add,\n  Block,\n  ContentCopy,\n  Delete,\n  Edit,\n  ManageSearch,\n  NotificationsOff,\n  Save,\n} from \"@rp/react/web/mui/icons\"\nimport { FEED_ID_ROUTE, SEARCHES_ROUTE, SEARCH_ID_ROUTE } from \"@rp/react/web/router\"\nimport { useQueryClient } from \"@tanstack/react-query\"\nimport { useFollow } from \"../FollowContext\"\nimport { useModal } from \"../ModalContext\"\nimport { useUpdateSchedule } from \"../Slack\"\nimport { useSnackbar } from \"../Snackbar\"\nimport { useCopySearchById } from \"../useCopySearch\"\n\ntype QueryActions = Record<\n  | \"follow\"\n  | \"feed\"\n  | \"share\"\n  | \"save\"\n  | \"copy\"\n  | \"copyInANewTab\"\n  | \"remove\"\n  | \"rename\"\n  | \"searchView\"\n  | \"removeNotifications\",\n  Actions[number]\n>\n\nconst useQueryActions = (savedQuery: CqsUserQueryOrContextQuery) => {\n  const loc = useLocation()\n  const isFeedView = !!matchPath(FEED_ID_ROUTE, loc.pathname) || false\n  const isSearchesPage = !!matchPath(SEARCHES_ROUTE, loc.pathname) || false\n  const { onFollow, isFollowing, isLoading, isPending } = useFollow(savedQuery.id)\n  const navigate = useNavigate()\n\n  // Sharing\n  const {\n    saveSearchModal: { handleOpen: handleOpenSave },\n    deleteSearchModal: { handleOpen: handleOpenDelete },\n    shareNameSearchModal: { handleOpen: openNameModal },\n    shareInfoModal: { handleOpen: openInfoModal },\n  } = useModal()\n\n  const { user } = useUser()\n  const { enqueueError } = useSnackbar()\n  const { mutateAsync } = useUpdateSchedule()\n  const queryClient = useQueryClient()\n  const { id, saveStatus, shared, name, ownerName, ownerUserId } = savedQuery || {}\n  const isShared = shared?.company.permission !== \"undefined\"\n  const isOwner = ownerUserId ? ownerUserId === user?.id : user?.id === ownerUserId\n  const { copy, copyInANewTab } = useCopySearchById(id)\n  const handleEdit = async () => {\n    handleOpenSave({ ...savedQuery, isLoading: true })\n    try {\n      const search = await getSavedQuery(queryClient, id)\n      handleOpenSave(search)\n    } catch (error) {\n      enqueueError(\"Oops! There was an error editing this search. Please try again...\")\n    }\n  }\n\n  const handleShareSearch = () => {\n    const shareData = {\n      saveStatus,\n      shared,\n      name,\n      id,\n      ownerName,\n      ownerUserId,\n      dataType: \"search\" as const,\n    }\n    if (saveStatus === \"unsaved\") {\n      openNameModal(shareData, () => openInfoModal(shareData))\n      return\n    }\n    openInfoModal(shareData)\n  }\n\n  const removeNotifications = () => {\n    mutateAsync({\n      destination: \"slack\",\n      queryId: savedQuery.id,\n      schedules: [],\n      queryName: savedQuery.name || \"\",\n      deleteAll: true,\n    })\n  }\n\n  // Feed view\n  const handleFeedView = () => {\n    navigate(FEED_ID_ROUTE.replace(\":id\", id))\n  }\n\n  // Delete modal\n  const handleDelete = () => {\n    handleOpenDelete({\n      id,\n      name: savedQuery.name ?? \"\",\n      onSuccess: async () => {\n        if (isSearchesPage) return\n\n        navigate(\"/\", { replace: true })\n      },\n    })\n  }\n\n  const queryActions = {\n    follow: {\n      id: \"follow\",\n      label: isFollowing ? \"Unfollow\" : \"Follow\",\n      icon: isFollowing ? <Block /> : <Add />,\n      onClick: () => onFollow(savedQuery),\n      disabledAction: () => isLoading || isPending,\n    },\n    feed: {\n      id: \"feed\",\n      label: isFeedView ? \"Search View\" : \"Feed View\",\n      icon: isFeedView ? <ManageSearch /> : <FeedViewIcon />,\n      onClick: () => {\n        isFeedView ? navigate(SEARCH_ID_ROUTE.replace(\":id\", id)) : handleFeedView()\n      },\n    },\n    searchView: {\n      id: \"searchView\",\n      label: \"Search View\",\n      icon: <ManageSearch />,\n      onClick: () => {\n        navigate(SEARCH_ID_ROUTE.replace(\":id\", id))\n      },\n    },\n    share: {\n      id: \"share\",\n      label: \"Share\",\n      icon: <ShareIcon shared={isShared} size={24} />,\n      onClick: handleShareSearch,\n    },\n    removeNotifications: {\n      id: \"removeNotifications\",\n      label: \"Remove Notifications\",\n      icon: <NotificationsOff style={{ color: red[\"500\"] }} />,\n      onClick: removeNotifications,\n      disabledAction: () => !isOwner,\n      color: red[\"500\"],\n    },\n    // llm: {\n    //   id: \"llm\",\n    //   label: \"Custom Instructions\",\n    //   icon: <AIBot />,\n    //   onClick: openCustomInstructions ?? (() => {}),\n    // },\n    rename: {\n      id: \"rename\",\n      label: \"Rename\",\n      icon: <Edit />,\n      onClick: handleEdit,\n      disabledAction: () => !isOwner,\n    },\n    save: {\n      id: \"save\",\n      label: \"Save Search\",\n      icon: <Save />,\n      onClick: handleEdit,\n      disabledAction: () => !isOwner,\n    },\n    copy: {\n      id: \"copy\",\n      label: \"Make a copy\",\n      icon: <ContentCopy />,\n      onClick: copy,\n      allowedAction: () => saveStatus !== \"saved\",\n    },\n    copyInANewTab: {\n      id: \"copyInANewTab\",\n      label: \"Make a copy\",\n      icon: <ContentCopy />,\n      onClick: copyInANewTab,\n      allowedAction: () => saveStatus !== \"saved\",\n    },\n    remove: {\n      id: \"remove\",\n      label: \"Delete\",\n      icon: <Delete />,\n      onClick: handleDelete,\n      disabledAction: () => !isOwner,\n    },\n  } satisfies QueryActions\n\n  return queryActions\n}\n\nexport { useQueryActions }\n"],"names":["useQueryActions","savedQuery","loc","useLocation","isFeedView","matchPath","FEED_ID_ROUTE","pathname","isSearchesPage","SEARCHES_ROUTE","onFollow","isFollowing","isLoading","isPending","useFollow","id","navigate","useNavigate","saveSearchModal","handleOpen","handleOpenSave","deleteSearchModal","handleOpenDelete","shareNameSearchModal","openNameModal","shareInfoModal","openInfoModal","useModal","user","useUser","enqueueError","useSnackbar","mutateAsync","useUpdateSchedule","queryClient","useQueryClient","saveStatus","shared","name","ownerName","ownerUserId","isShared","company","permission","isOwner","copy","copyInANewTab","useCopySearchById","handleEdit","search","getSavedQuery","error","handleShareSearch","shareData","dataType","removeNotifications","destination","queryId","schedules","queryName","deleteAll","handleFeedView","replace","handleDelete","onSuccess","queryActions","follow","label","icon","Block","Add","onClick","disabledAction","feed","ManageSearch","FeedViewIcon","SEARCH_ID_ROUTE","searchView","share","ShareIcon","size","NotificationsOff","style","color","red","rename","Edit","save","Save","ContentCopy","allowedAction","remove","Delete"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
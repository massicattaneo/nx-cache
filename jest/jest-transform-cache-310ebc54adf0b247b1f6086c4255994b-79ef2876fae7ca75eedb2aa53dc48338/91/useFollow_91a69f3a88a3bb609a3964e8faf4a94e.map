{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/common/providers/src/FollowContext/useFollow.ts"],"sourcesContent":["import { useCallback, useEffect, useState } from \"react\"\nimport { CqsSavedQuery } from \"@rp/common/api-types\"\nimport {\n  getSavedQuery,\n  usePinQuery,\n  useUserQueries,\n} from \"@rp/react/tanstack-api/user-data-queries\"\nimport { useDynamicCQSName } from \"@rp/react/tanstack-api/user-data-queries\"\nimport { useQueryClient } from \"@tanstack/react-query\"\nimport { useModal } from \"../ModalContext\"\nimport { useSnackbar } from \"../Snackbar\"\n\ntype OnFollowProps = {\n  id?: string\n  saveStatus?: CqsSavedQuery[\"saveStatus\"]\n}\n\nconst useFollow = (id: string) => {\n  const { makeDynamicName } = useDynamicCQSName()\n  const { data, isLoading: isLoadingQueries } = useUserQueries()\n  const [isUnfollowModalOpen, setIsOpenUnfollow] = useState(false)\n  const [isFollowModalOpen, setIsOpenFollow] = useState(false)\n  const { enqueueError } = useSnackbar()\n  const { mutateAsync: pinQuery, isPending: isPinning } = usePinQuery({ enqueueError })\n  const queryClient = useQueryClient()\n  const isLoading = isLoadingQueries\n  const isPending = isPinning\n  const loading = isLoading || isPending\n  const [isFollowing, setIsFollowing] = useState(\n    data?.results.find(q => q.id === id)?.pinned || false,\n  )\n  const { unfollowSearchModal, followSearchModal } = useModal()\n\n  useEffect(() => {\n    setIsFollowing(data?.results.find(q => q.id === id)?.pinned || false)\n  }, [data, id, loading])\n\n  const onFollow = useCallback(\n    async (props: OnFollowProps) => {\n      const { id, saveStatus } = props\n      const queryData = await getSavedQuery(queryClient, id ?? \"\")\n      const name = queryData ? makeDynamicName(queryData) : \"\"\n      if (!id) return\n      const query = data ? data.results.find(q => q.id === id) : undefined\n      const isFollowing = query ? !!query.pinned : false\n      if (saveStatus === \"unsaved\") {\n        setIsOpenFollow(true)\n        followSearchModal.handleOpen({\n          id,\n          name: name || \"\",\n          saveStatus,\n          isLoading: loading,\n          onClose: () => {\n            setIsOpenFollow(false)\n          },\n        })\n      } else if (!isFollowing) {\n        pinQuery(id)\n      } else {\n        setIsOpenUnfollow?.(true)\n        unfollowSearchModal.handleOpen({\n          id,\n          name: query?.name || name || \"\",\n          saveStatus,\n          isLoading: loading,\n          onClose: () => setIsOpenUnfollow?.(false),\n        })\n      }\n    },\n    [data, followSearchModal, loading, makeDynamicName, pinQuery, queryClient, unfollowSearchModal],\n  )\n\n  return {\n    isLoading,\n    isPending,\n    onFollow,\n    isFollowing,\n    isUnfollowModalOpen,\n    isFollowModalOpen,\n  }\n}\n\nexport { useFollow }\n"],"names":["useFollow","id","data","makeDynamicName","useDynamicCQSName","isLoading","isLoadingQueries","useUserQueries","isUnfollowModalOpen","setIsOpenUnfollow","useState","isFollowModalOpen","setIsOpenFollow","enqueueError","useSnackbar","mutateAsync","pinQuery","isPending","isPinning","usePinQuery","queryClient","useQueryClient","loading","isFollowing","setIsFollowing","results","find","q","pinned","unfollowSearchModal","followSearchModal","useModal","useEffect","onFollow","useCallback","props","saveStatus","queryData","getSavedQuery","name","query","undefined","handleOpen","onClose"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAkFSA;;;eAAAA;;;uBAlFwC;iCAM1C;4BAEwB;8BACN;0BACG;AAO5B,MAAMA,YAAY,CAACC;QAYfC;IAXF,MAAM,EAAEC,eAAe,EAAE,GAAGC,IAAAA,kCAAiB;IAC7C,MAAM,EAAEF,IAAI,EAAEG,WAAWC,gBAAgB,EAAE,GAAGC,IAAAA,+BAAc;IAC5D,MAAM,CAACC,qBAAqBC,kBAAkB,GAAGC,IAAAA,eAAQ,EAAC;IAC1D,MAAM,CAACC,mBAAmBC,gBAAgB,GAAGF,IAAAA,eAAQ,EAAC;IACtD,MAAM,EAAEG,YAAY,EAAE,GAAGC,IAAAA,qBAAW;IACpC,MAAM,EAAEC,aAAaC,QAAQ,EAAEC,WAAWC,SAAS,EAAE,GAAGC,IAAAA,4BAAW,EAAC;QAAEN;IAAa;IACnF,MAAMO,cAAcC,IAAAA,0BAAc;IAClC,MAAMhB,YAAYC;IAClB,MAAMW,YAAYC;IAClB,MAAMI,UAAUjB,aAAaY;IAC7B,MAAM,CAACM,aAAaC,eAAe,GAAGd,IAAAA,eAAQ,EAC5CR,CAAAA,iBAAAA,4BAAAA,qBAAAA,KAAMuB,OAAO,CAACC,IAAI,CAACC,CAAAA,IAAKA,EAAE1B,EAAE,KAAKA,iBAAjCC,yCAAAA,mBAAsC0B,MAAM,KAAI;IAElD,MAAM,EAAEC,mBAAmB,EAAEC,iBAAiB,EAAE,GAAGC,IAAAA,sBAAQ;IAE3DC,IAAAA,gBAAS,EAAC;YACO9B;QAAfsB,eAAetB,CAAAA,iBAAAA,4BAAAA,qBAAAA,KAAMuB,OAAO,CAACC,IAAI,CAACC,CAAAA,IAAKA,EAAE1B,EAAE,KAAKA,iBAAjCC,yCAAAA,mBAAsC0B,MAAM,KAAI;IACjE,GAAG;QAAC1B;QAAMD;QAAIqB;KAAQ;IAEtB,MAAMW,WAAWC,IAAAA,kBAAW,EAC1B,OAAOC;QACL,MAAM,EAAElC,EAAE,EAAEmC,UAAU,EAAE,GAAGD;QAC3B,MAAME,YAAY,MAAMC,IAAAA,8BAAa,EAAClB,aAAanB,eAAAA,gBAAAA,KAAM;QACzD,MAAMsC,OAAOF,YAAYlC,gBAAgBkC,aAAa;QACtD,IAAI,CAACpC,IAAI;QACT,MAAMuC,QAAQtC,OAAOA,KAAKuB,OAAO,CAACC,IAAI,CAACC,CAAAA,IAAKA,EAAE1B,EAAE,KAAKA,MAAMwC;QAC3D,MAAMlB,cAAciB,QAAQ,CAAC,CAACA,MAAMZ,MAAM,GAAG;QAC7C,IAAIQ,eAAe,WAAW;YAC5BxB,gBAAgB;YAChBkB,kBAAkBY,UAAU,CAAC;gBAC3BzC;gBACAsC,MAAMA,QAAQ;gBACdH;gBACA/B,WAAWiB;gBACXqB,SAAS;oBACP/B,gBAAgB;gBAClB;YACF;QACF,OAAO,IAAI,CAACW,aAAa;YACvBP,SAASf;QACX,OAAO;YACLQ,8BAAAA,wCAAAA,kBAAoB;YACpBoB,oBAAoBa,UAAU,CAAC;gBAC7BzC;gBACAsC,MAAMC,CAAAA,kBAAAA,4BAAAA,MAAOD,IAAI,KAAIA,QAAQ;gBAC7BH;gBACA/B,WAAWiB;gBACXqB,SAAS,IAAMlC,8BAAAA,wCAAAA,kBAAoB;YACrC;QACF;IACF,GACA;QAACP;QAAM4B;QAAmBR;QAASnB;QAAiBa;QAAUI;QAAaS;KAAoB;IAGjG,OAAO;QACLxB;QACAY;QACAgB;QACAV;QACAf;QACAG;IACF;AACF"}
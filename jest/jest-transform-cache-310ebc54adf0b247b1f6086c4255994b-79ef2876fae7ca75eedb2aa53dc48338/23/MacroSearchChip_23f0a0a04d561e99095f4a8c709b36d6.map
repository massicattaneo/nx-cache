{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/cqs-query-bar/src/lib/chips/MacroSearchChip.tsx"],"sourcesContent":["import { Fragment, MouseEvent, forwardRef, useState } from \"react\"\nimport { RpqlFlatArrayFilter, RpqlFlatMatchFilter } from \"@rp/common/api-types\"\nimport { useDisableIOSTouch } from \"@rp/react/web/common/hooks\"\nimport { tagManagerEvents } from \"@rp/react/web/common/vendors/utils\"\nimport { QueryIcon } from \"@rp/react/web/icons\"\nimport { NameDisplay } from \"../NameDisplay\"\nimport { CqsQueryBarContext } from \"../cqs-query-bar.types\"\nimport { MacroSearchesDropdown } from \"../dropdowns/MacroSearchesDropdown\"\nimport { BaseChip } from \"./BaseChip\"\nimport { ChipLabel, PopoverStyled, Separator, TotalDisplay } from \"./Chip.styles\"\nimport { getMacroChipLabel, useMacroSearchFilter } from \"./macroSearchChipUtils\"\n\ntype MacroSearchChipProps = {\n  filter: RpqlFlatMatchFilter\n  onRemove?: () => void\n  query?: CqsQueryBarContext\n  flatFilters?: Array<RpqlFlatArrayFilter | null>\n}\n\nconst MacroSearchChip = forwardRef<HTMLDivElement, MacroSearchChipProps>(\n  ({ filter, onRemove, query, flatFilters }, ref) => {\n    const [anchorEl, setAnchorEl] = useState<HTMLElement | null>(null)\n    const filters =\n      flatFilters ?? filter.value.map(id => query?.actions.expression.getFilter(id) ?? null)\n    const open = Boolean(anchorEl)\n    useDisableIOSTouch(open)\n\n    const { value: macroSearchFilter, isLoading } = useMacroSearchFilter(filters, filter.type)\n    const total = macroSearchFilter.length\n\n    const handleClick = (event: MouseEvent<HTMLElement>) => {\n      setAnchorEl(event.currentTarget)\n    }\n\n    const onDropDownRemove = (id: string, group: RpqlFlatArrayFilter) => {\n      setAnchorEl(null)\n      const child = query?.actions.expression.getFilter(id)\n      const isParentSingle = Array.isArray(filter?.value) && filter?.value.length === 1\n      const isChildSingle =\n        Array.isArray(child?.value) && child?.value.length === group.value.length\n      if (!child) return\n\n      tagManagerEvents.queryRefinement({\n        action: \"remove\",\n        component: \"queryBar\",\n        queryId: query?.id ?? \"\",\n        queryType: child.type,\n        savedStatus: query?.saveStatus ?? \"unsaved\",\n      })\n\n      if (isParentSingle && isChildSingle) {\n        query?.actions.expression.removeFilters([filter.id])\n      } else {\n        query?.actions.expression.removeMacroSearchContent(filter.id, group)\n      }\n    }\n\n    if (!macroSearchFilter.length) return null\n\n    return (\n      <>\n        <BaseChip\n          clickable\n          icon={<QueryIcon icon={filter.type} />}\n          onClick={handleClick}\n          onRemove={onRemove}\n          selected={query && open}\n          ref={ref}\n        >\n          <ChipLabel>\n            {macroSearchFilter.map((item, subIndex) => {\n              return (\n                <Fragment key={`fragment-${item.value}`}>\n                  <NameDisplay data={{ data: { name: getMacroChipLabel(item) }, isLoading }} />\n                  {subIndex < total - 1 ? <Separator /> : null}\n                </Fragment>\n              )\n            })}\n          </ChipLabel>\n          {total > 1 ? <TotalDisplay>({total})</TotalDisplay> : null}\n        </BaseChip>\n        {query ? (\n          <PopoverStyled\n            open={open}\n            anchorEl={anchorEl}\n            onClose={() => setAnchorEl(null)}\n            anchorOrigin={{ vertical: \"bottom\", horizontal: \"left\" }}\n          >\n            <MacroSearchesDropdown filter={macroSearchFilter} onRemove={onDropDownRemove} />\n          </PopoverStyled>\n        ) : null}\n      </>\n    )\n  },\n)\n\nexport { MacroSearchChip }\nexport type { MacroSearchChipProps }\n"],"names":["MacroSearchChip","forwardRef","filter","onRemove","query","flatFilters","ref","anchorEl","setAnchorEl","useState","filters","value","map","id","actions","expression","getFilter","open","Boolean","useDisableIOSTouch","macroSearchFilter","isLoading","useMacroSearchFilter","type","total","length","handleClick","event","currentTarget","onDropDownRemove","group","child","isParentSingle","Array","isArray","isChildSingle","tagManagerEvents","queryRefinement","action","component","queryId","queryType","savedStatus","saveStatus","removeFilters","removeMacroSearchContent","BaseChip","clickable","icon","QueryIcon","onClick","selected","ChipLabel","item","subIndex","Fragment","NameDisplay","data","name","getMacroChipLabel","Separator","TotalDisplay","PopoverStyled","onClose","anchorOrigin","vertical","horizontal","MacroSearchesDropdown"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAgGSA;;;eAAAA;;;;uBAhGkD;uBAExB;uBACF;uBACP;6BACE;uCAEU;0BACb;4BACyC;sCACV;AASxD,MAAMA,gCAAkBC,IAAAA,iBAAU,EAChC,CAAC,EAAEC,MAAM,EAAEC,QAAQ,EAAEC,KAAK,EAAEC,WAAW,EAAE,EAAEC;IACzC,MAAM,CAACC,UAAUC,YAAY,GAAGC,IAAAA,eAAQ,EAAqB;IAC7D,MAAMC,UACJL,wBAAAA,yBAAAA,cAAeH,OAAOS,KAAK,CAACC,GAAG,CAACC,CAAAA;YAAMT;eAAAA,CAAAA,sCAAAA,kBAAAA,4BAAAA,MAAOU,OAAO,CAACC,UAAU,CAACC,SAAS,CAACH,iBAApCT,iDAAAA,sCAA2C;IAAG;IACtF,MAAMa,OAAOC,QAAQX;IACrBY,IAAAA,yBAAkB,EAACF;IAEnB,MAAM,EAAEN,OAAOS,iBAAiB,EAAEC,SAAS,EAAE,GAAGC,IAAAA,0CAAoB,EAACZ,SAASR,OAAOqB,IAAI;IACzF,MAAMC,QAAQJ,kBAAkBK,MAAM;IAEtC,MAAMC,cAAc,CAACC;QACnBnB,YAAYmB,MAAMC,aAAa;IACjC;IAEA,MAAMC,mBAAmB,CAAChB,IAAYiB;QACpCtB,YAAY;QACZ,MAAMuB,QAAQ3B,kBAAAA,4BAAAA,MAAOU,OAAO,CAACC,UAAU,CAACC,SAAS,CAACH;QAClD,MAAMmB,iBAAiBC,MAAMC,OAAO,CAAChC,mBAAAA,6BAAAA,OAAQS,KAAK,KAAKT,CAAAA,mBAAAA,6BAAAA,OAAQS,KAAK,CAACc,MAAM,MAAK;QAChF,MAAMU,gBACJF,MAAMC,OAAO,CAACH,kBAAAA,4BAAAA,MAAOpB,KAAK,KAAKoB,CAAAA,kBAAAA,4BAAAA,MAAOpB,KAAK,CAACc,MAAM,MAAKK,MAAMnB,KAAK,CAACc,MAAM;QAC3E,IAAI,CAACM,OAAO;YAKD3B,WAEIA;QALfgC,uBAAgB,CAACC,eAAe,CAAC;YAC/BC,QAAQ;YACRC,WAAW;YACXC,SAASpC,CAAAA,YAAAA,kBAAAA,4BAAAA,MAAOS,EAAE,cAATT,uBAAAA,YAAa;YACtBqC,WAAWV,MAAMR,IAAI;YACrBmB,aAAatC,CAAAA,oBAAAA,kBAAAA,4BAAAA,MAAOuC,UAAU,cAAjBvC,+BAAAA,oBAAqB;QACpC;QAEA,IAAI4B,kBAAkBG,eAAe;YACnC/B,kBAAAA,4BAAAA,MAAOU,OAAO,CAACC,UAAU,CAAC6B,aAAa,CAAC;gBAAC1C,OAAOW,EAAE;aAAC;QACrD,OAAO;YACLT,kBAAAA,4BAAAA,MAAOU,OAAO,CAACC,UAAU,CAAC8B,wBAAwB,CAAC3C,OAAOW,EAAE,EAAEiB;QAChE;IACF;IAEA,IAAI,CAACV,kBAAkBK,MAAM,EAAE,OAAO;IAEtC,qBACE;;0BACE,sBAACqB,kBAAQ;gBACPC,SAAS;gBACTC,oBAAM,qBAACC,gBAAS;oBAACD,MAAM9C,OAAOqB,IAAI;;gBAClC2B,SAASxB;gBACTvB,UAAUA;gBACVgD,UAAU/C,SAASa;gBACnBX,KAAKA;;kCAEL,qBAAC8C,qBAAS;kCACPhC,kBAAkBR,GAAG,CAAC,CAACyC,MAAMC;4BAC5B,qBACE,sBAACC,eAAQ;;kDACP,qBAACC,wBAAW;wCAACC,MAAM;4CAAEA,MAAM;gDAAEC,MAAMC,IAAAA,uCAAiB,EAACN;4CAAM;4CAAGhC;wCAAU;;oCACvEiC,WAAW9B,QAAQ,kBAAI,qBAACoC,qBAAS,QAAM;;+BAF3B,CAAC,SAAS,EAAEP,KAAK1C,KAAK,CAAC,CAAC;wBAK3C;;oBAEDa,QAAQ,kBAAI,sBAACqC,wBAAY;;4BAAC;4BAAErC;4BAAM;;yBAAmB;;;YAEvDpB,sBACC,qBAAC0D,yBAAa;gBACZ7C,MAAMA;gBACNV,UAAUA;gBACVwD,SAAS,IAAMvD,YAAY;gBAC3BwD,cAAc;oBAAEC,UAAU;oBAAUC,YAAY;gBAAO;0BAEvD,cAAA,qBAACC,4CAAqB;oBAACjE,QAAQkB;oBAAmBjB,UAAU0B;;iBAE5D;;;AAGV"}
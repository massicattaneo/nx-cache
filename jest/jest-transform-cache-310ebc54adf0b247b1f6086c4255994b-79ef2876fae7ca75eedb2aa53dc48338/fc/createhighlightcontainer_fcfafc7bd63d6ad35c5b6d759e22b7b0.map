{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/rpjson/src/lib/create-react-elements/create-highlight-container.ts"],"sourcesContent":["import { createRoot } from \"react-dom/client\"\nimport { EnhancedTextBlock } from \"@rp/react/rpjson/types\"\nimport { CLASS_NAMES, ROOT_WRAPPER_CLASSNAME, TEXT_ROOT_PREFIX } from \"../constants\"\nimport { Highlight } from \"./create-react-elements.types\"\n\nconst hasAllTheSameY = (rects: Array<DOMRect>) => {\n  const filtered = rects\n    .map(item => item.y)\n    .filter((item, index, array) => array.indexOf(item) === index)\n  return filtered.length === 1\n}\n\nconst sumWidth = (rects: Array<DOMRect>) => {\n  return rects.reduce((sum, item) => sum + item.width, 0)\n}\n\nconst getSimilarElements = (rpJsonId: string) => {\n  return Array.from(\n    document.querySelectorAll<HTMLElement>(\n      `.${ROOT_WRAPPER_CLASSNAME} .${CLASS_NAMES.ID_PREFIX}${rpJsonId}`,\n    ),\n  )\n}\n\nexport const getClassNameInfo = (target: HTMLElement | null) => {\n  const className = target?.className ?? \"\"\n  const [, rpJsonId = \"\"] = className.match(new RegExp(`${CLASS_NAMES.ID_PREFIX}([^\\\\s]*)`)) || []\n  const [, rpJsonType = \"\"] =\n    className.match(new RegExp(`${CLASS_NAMES.TYPE_PREFIX}([^\\\\s]*)`)) || []\n  const [, reactId = -1] =\n    className.match(new RegExp(`${CLASS_NAMES.REACT_ID_PREFIX}([^\\\\s]*)`)) || []\n  return { rpJsonId, rpJsonType, reactId: Number(reactId) }\n}\n\nexport const getWidth = (rects: Array<DOMRect>, wrapper?: DOMRect) => {\n  if (!rects.length) return 0\n  if (!wrapper) return 0\n  const returnValue = hasAllTheSameY(rects)\n    ? sumWidth(rects)\n    : Math.max(...rects.map(i => i.right)) - Math.min(...rects.map(i => i.left))\n  return Math.min(returnValue, wrapper.width)\n}\n\nexport const getHeight = (rects: Array<DOMRect>) => {\n  if (!rects.length) return 0\n  return hasAllTheSameY(rects)\n    ? Math.max(...rects.map(i => i.height))\n    : Math.max(...rects.map(i => i.bottom)) - Math.min(...rects.map(i => i.top))\n}\n\nexport const getLeft = (rects: Array<DOMRect>, wrapper?: DOMRect) => {\n  if (!rects.length) return 0\n  if (!wrapper) return 0\n  return Math.min(...rects.map(item => item.left)) - wrapper.left\n}\n\nexport const getTop = (rects: Array<DOMRect>, wrapper?: DOMRect) => {\n  if (!rects.length) return 0\n  if (!wrapper) return 0\n  return Math.min(...rects.map(item => item.top)) - wrapper.top\n}\n\nexport const getTargets = (elements: Array<HTMLElement>, target: HTMLElement) => {\n  return (elements.length ? Array.from(elements) : [target]).filter(el => {\n    const { left, right } = el?.getBoundingClientRect() || { left: 0, right: 0 }\n    return left !== right\n  })\n}\n\nconst createDOMContainer = () => {\n  const el = document.createElement(\"div\")\n  el.className = \"rpjson-tooltip-positioned-wrapper\"\n  el.style.position = \"absolute\"\n  el.style.top = \"0px\"\n  el.style.left = \"0px\"\n  return el\n}\n\nexport const renderOver = (targets: Array<HTMLElement>) => {\n  const [target] = targets\n  return (Component: React.ReactElement) => {\n    const container = createDOMContainer()\n    target.appendChild(container)\n    const root = createRoot(container)\n    root.render(Component)\n    return () => {\n      const [...containers] = Array.from(\n        target.querySelectorAll(\".rpjson-tooltip-positioned-wrapper\"),\n      )\n      containers.forEach(cont => {\n        root.unmount()\n        target.removeChild(cont)\n      })\n    }\n  }\n}\n\nexport const applyStyle = (targets: Array<HTMLElement>, style: object) => {\n  const initial: Array<HTMLElement> = []\n  const elements = targets.reduce((array, element) => {\n    Object.assign(element.style, style)\n    return array.concat(element)\n  }, initial)\n  return () => {\n    elements.forEach(element => {\n      Object.keys(style).forEach(key => {\n        Object.assign(element.style, { [key]: \"\" })\n      })\n    })\n  }\n}\n\nconst getFirstParentByClassName = (target: HTMLElement | null): HTMLElement => {\n  if (!target) return document.body\n  if (target.className === ROOT_WRAPPER_CLASSNAME) return target\n  return getFirstParentByClassName(target.parentElement)\n}\n\nexport const getPlaceholderBox = (targets: Array<HTMLElement>) => {\n  const rects = targets.map(element => element.getBoundingClientRect())\n  const wrapper = getFirstParentByClassName(targets[0]).getBoundingClientRect()\n  const width = getWidth(rects, wrapper)\n  const height = getHeight(rects)\n  const left = getLeft(rects, wrapper)\n  const top = getTop(rects, wrapper)\n  return { width, height, left, top }\n}\n\nexport const getSimilarMatches = (similarElements: Array<HTMLElement>) => {\n  return Array.from(similarElements)\n    .map(el => Number(getClassNameInfo(el).reactId))\n    .filter((id, index, array) => array.indexOf(id) === index)\n}\n\nexport const getHighlight = (target: HTMLElement, { id }: EnhancedTextBlock): Highlight => {\n  const { rpJsonId, rpJsonType, reactId } = getClassNameInfo(target)\n  const root = document.querySelector(`.${TEXT_ROOT_PREFIX}${id}`)\n  const elements = root\n    ? Array.from(root.querySelectorAll<HTMLElement>(`.${CLASS_NAMES.REACT_ID_PREFIX}${reactId}`))\n    : []\n  const targets = getTargets(elements, target)\n  const similarElements = getSimilarElements(rpJsonId)\n\n  return {\n    relativePlaceholderBox: getPlaceholderBox(targets),\n    rpJsonId,\n    rpJsonType,\n    reactId,\n    similarMatches: getSimilarMatches(similarElements),\n    applyStyle: style => applyStyle(targets, style),\n    renderOver: renderOver(targets),\n  }\n}\n"],"names":["applyStyle","getClassNameInfo","getHeight","getHighlight","getLeft","getPlaceholderBox","getSimilarMatches","getTargets","getTop","getWidth","renderOver","hasAllTheSameY","rects","filtered","map","item","y","filter","index","array","indexOf","length","sumWidth","reduce","sum","width","getSimilarElements","rpJsonId","Array","from","document","querySelectorAll","ROOT_WRAPPER_CLASSNAME","CLASS_NAMES","ID_PREFIX","target","className","match","RegExp","rpJsonType","TYPE_PREFIX","reactId","REACT_ID_PREFIX","Number","wrapper","returnValue","Math","max","i","right","min","left","height","bottom","top","elements","el","getBoundingClientRect","createDOMContainer","createElement","style","position","targets","Component","container","appendChild","root","createRoot","render","containers","forEach","cont","unmount","removeChild","initial","element","Object","assign","concat","keys","key","getFirstParentByClassName","body","parentElement","similarElements","id","querySelector","TEXT_ROOT_PREFIX","relativePlaceholderBox","similarMatches"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
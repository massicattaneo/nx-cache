{"version":3,"sources":["../../src/core/DndProvider.tsx"],"sourcesContent":["import type { BackendFactory, DragDropManager } from 'dnd-core'\nimport { createDragDropManager } from 'dnd-core'\nimport type { FC, ReactNode } from 'react'\nimport { memo, useEffect } from 'react'\n\nimport { DndContext } from './DndContext.js'\n\nexport type DndProviderProps<BackendContext, BackendOptions> =\n\t| {\n\t\t\tchildren?: ReactNode\n\t\t\tmanager: DragDropManager\n\t  }\n\t| {\n\t\t\tbackend: BackendFactory\n\t\t\tchildren?: ReactNode\n\t\t\tcontext?: BackendContext\n\t\t\toptions?: BackendOptions\n\t\t\tdebugMode?: boolean\n\t  }\n\nlet refCount = 0\nconst INSTANCE_SYM = Symbol.for('__REACT_DND_CONTEXT_INSTANCE__')\n\n/**\n * A React component that provides the React-DnD context\n */\nexport const DndProvider: FC<DndProviderProps<unknown, unknown>> = memo(\n\tfunction DndProvider({ children, ...props }) {\n\t\tconst [manager, isGlobalInstance] = getDndContextValue(props) // memoized from props\n\t\t/**\n\t\t * If the global context was used to store the DND context\n\t\t * then where theres no more references to it we should\n\t\t * clean it up to avoid memory leaks\n\t\t */\n\t\tuseEffect(() => {\n\t\t\tif (isGlobalInstance) {\n\t\t\t\tconst context = getGlobalContext()\n\t\t\t\t++refCount\n\n\t\t\t\treturn () => {\n\t\t\t\t\tif (--refCount === 0) {\n\t\t\t\t\t\tcontext[INSTANCE_SYM] = null\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn\n\t\t}, [])\n\n\t\treturn <DndContext.Provider value={manager}>{children}</DndContext.Provider>\n\t},\n)\n\nfunction getDndContextValue(props: DndProviderProps<unknown, unknown>) {\n\tif ('manager' in props) {\n\t\tconst manager = { dragDropManager: props.manager }\n\t\treturn [manager, false]\n\t}\n\n\tconst manager = createSingletonDndContext(\n\t\tprops.backend,\n\t\tprops.context,\n\t\tprops.options,\n\t\tprops.debugMode,\n\t)\n\tconst isGlobalInstance = !props.context\n\n\treturn [manager, isGlobalInstance]\n}\n\nfunction createSingletonDndContext<BackendContext, BackendOptions>(\n\tbackend: BackendFactory,\n\tcontext: BackendContext = getGlobalContext(),\n\toptions: BackendOptions,\n\tdebugMode?: boolean,\n) {\n\tconst ctx = context as any\n\tif (!ctx[INSTANCE_SYM]) {\n\t\tctx[INSTANCE_SYM] = {\n\t\t\tdragDropManager: createDragDropManager(\n\t\t\t\tbackend,\n\t\t\t\tcontext,\n\t\t\t\toptions,\n\t\t\t\tdebugMode,\n\t\t\t),\n\t\t}\n\t}\n\treturn ctx[INSTANCE_SYM]\n}\n\ndeclare const global: any\nfunction getGlobalContext() {\n\treturn typeof global !== 'undefined' ? global : (window as any)\n}\n"],"names":["DndProvider","_objectWithoutProperties","source","excluded","refCount","INSTANCE_SYM","Symbol","for","memo","_param","children","props","manager","isGlobalInstance","getDndContextValue","useEffect","context","getGlobalContext","_jsx","DndContext","Provider","value","dragDropManager","createSingletonDndContext","backend","options","debugMode","ctx","createDragDropManager","global","window"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BA0BAA;;;eAAAA;;;;yBAzBsC;uBAEN;4BAEL;AAL3B,SAAAC,yBAAAC,MAAA,EAAAC,QAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoBA,IAAIC,WAAW;AACf,MAAMC,eAAeC,OAAOC,GAAG,CAAC;IAKnBP,cAAW,WAAA,GAA2CQ,IAAAA,WAAI,EACtE,SAASR,YAAYS,MAAsB;QAAtB,EAAEC,QAAQ,EAAY,GAAtBD,QAAeE,QAAKV,yBAApBQ,QAAsB;QAApBC;;IACtB,MAAM,CAACE,SAASC,iBAAiB,GAAGC,mBAAmBH,OAAO,sBAAsB;;IACpF;;;;MAKAI,IAAAA,gBAAS,EAAC;QACT,IAAIF,kBAAkB;YACrB,MAAMG,UAAUC;YAChB,EAAEb;YAEF,OAAO;gBACN,IAAI,EAAEA,aAAa,GAAG;oBACrBY,OAAO,CAACX,aAAa,GAAG;;;;QAI3B;OACE,EAAE;IAEL,OAAA,WAAA,GAAOa,IAAAA,eAAA,EAACC,sBAAU,CAACC,QAAQ,EAAA;QAACC,OAAOT;kBAAUF;;;AAI/C,SAASI,mBAAmBH,KAAyC;IACpE,IAAI,aAAaA,OAAO;QACvB,MAAMC,UAAU;YAAEU,iBAAiBX,MAAMC,OAAO;;QAChD,OAAO;YAACA;YAAS;SAAM;;IAGxB,MAAMA,UAAUW,0BACfZ,MAAMa,OAAO,EACbb,MAAMK,OAAO,EACbL,MAAMc,OAAO,EACbd,MAAMe,SAAS;IAEhB,MAAMb,mBAAmB,CAACF,MAAMK,OAAO;IAEvC,OAAO;QAACJ;QAASC;KAAiB;;AAGnC,SAASU,0BACRC,OAAuB,EACvBR,UAA0BC,kBAAkB,EAC5CQ,OAAuB,EACvBC,SAAmB;IAEnB,MAAMC,MAAMX;IACZ,IAAI,CAACW,GAAG,CAACtB,aAAa,EAAE;QACvBsB,GAAG,CAACtB,aAAa,GAAG;YACnBiB,iBAAiBM,IAAAA,8BAAqB,EACrCJ,SACAR,SACAS,SACAC;;;IAIH,OAAOC,GAAG,CAACtB,aAAa;;AAIzB,SAASY;IACR,OAAO,OAAOY,WAAW,cAAcA,SAAUC"}
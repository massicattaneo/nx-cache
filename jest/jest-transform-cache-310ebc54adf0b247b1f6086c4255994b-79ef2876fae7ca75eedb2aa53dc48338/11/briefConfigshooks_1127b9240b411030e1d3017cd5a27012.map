{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/tanstack-api/brief/src/briefConfig/briefConfigs.hooks.ts"],"sourcesContent":["import { AxiosError } from \"axios\"\nimport { mapToISOTimestamp } from \"@rp/common/utils\"\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\"\nimport { BriefConfig, BriefConfigAPI } from \"../brief.types\"\nimport {\n  createBrief,\n  deleteBriefConfigById,\n  editBriefConfig,\n  loadAllBriefs,\n  loadBriefConfigById,\n} from \"./briefConfigs.services\"\n\nconst USE_QUERY_RETRY_DEFAULT = 3\n\nconst briefQueryKeys = {\n  all: () => [\"brief\"],\n  brief: (briefId: string | undefined) => [\"brief\", briefId] as const,\n}\n\nconst useUserBriefConfigs = (refetchOnMount = false) => {\n  return useQuery({\n    queryKey: briefQueryKeys.all(),\n    queryFn: loadAllBriefs,\n    gcTime: refetchOnMount ? undefined : Infinity,\n    staleTime: refetchOnMount ? undefined : Infinity,\n    select: briefs => briefs.map(mapToISOTimestamp),\n    refetchOnMount,\n  })\n}\n\ntype UseBriefConfigByIdProps = {\n  briefId: string | undefined\n  disableRetry?: boolean\n}\n\nconst useBriefConfigById = ({ briefId, disableRetry }: UseBriefConfigByIdProps) => {\n  return useQuery<BriefConfig | null, AxiosError>({\n    enabled: !!briefId,\n    queryKey: briefQueryKeys.brief(briefId),\n    queryFn: () => loadBriefConfigById(briefId),\n    gcTime: Infinity,\n    staleTime: Infinity,\n    select: brief => brief && mapToISOTimestamp(brief),\n    retry: disableRetry ? false : USE_QUERY_RETRY_DEFAULT,\n  })\n}\n\nconst useDeleteUserBriefConfig = (onError: () => void, onSuccess: () => void) => {\n  const queryClient = useQueryClient()\n\n  return useMutation({\n    mutationFn: deleteBriefConfigById,\n    onSuccess,\n    onError,\n\n    onSettled: (_data, _error, briefId) => {\n      queryClient.removeQueries({ queryKey: briefQueryKeys.brief(briefId) })\n      queryClient.refetchQueries({ queryKey: briefQueryKeys.all() })\n    },\n  })\n}\n\nconst useEditUserBriefConfig = (\n  onError: () => void,\n  onSuccess: () => void,\n  briefId: string | undefined,\n) => {\n  const queryClient = useQueryClient()\n\n  return useMutation({\n    mutationFn: (briefConfig: BriefConfigAPI) => editBriefConfig(briefConfig, briefId),\n    onSuccess,\n    onError,\n    onSettled: () => queryClient.refetchQueries({ queryKey: briefQueryKeys.all() }),\n  })\n}\n\nconst useCreateUserBriefConfigs = () => {\n  const queryClient = useQueryClient()\n  return useMutation({\n    mutationFn: createBrief,\n    onSuccess: data => {\n      queryClient.setQueryData(briefQueryKeys.brief(data.id), data)\n      const all = queryClient.getQueryData<Array<BriefConfig>>(briefQueryKeys.all())\n      if (all) {\n        queryClient.setQueryData(briefQueryKeys.all(), [...all, data])\n      }\n    },\n  })\n}\n\nexport {\n  useBriefConfigById,\n  useCreateUserBriefConfigs,\n  useDeleteUserBriefConfig,\n  useEditUserBriefConfig,\n  useUserBriefConfigs,\n}\n"],"names":["useBriefConfigById","useCreateUserBriefConfigs","useDeleteUserBriefConfig","useEditUserBriefConfig","useUserBriefConfigs","USE_QUERY_RETRY_DEFAULT","briefQueryKeys","all","brief","briefId","refetchOnMount","useQuery","queryKey","queryFn","loadAllBriefs","gcTime","undefined","Infinity","staleTime","select","briefs","map","mapToISOTimestamp","disableRetry","enabled","loadBriefConfigById","retry","onError","onSuccess","queryClient","useQueryClient","useMutation","mutationFn","deleteBriefConfigById","onSettled","_data","_error","removeQueries","refetchQueries","briefConfig","editBriefConfig","createBrief","data","setQueryData","id","getQueryData"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;;;;;;;;IA4FEA,kBAAkB;eAAlBA;;IACAC,yBAAyB;eAAzBA;;IACAC,wBAAwB;eAAxBA;;IACAC,sBAAsB;eAAtBA;;IACAC,mBAAmB;eAAnBA;;;uBA/FgC;4BACoB;sCAQ/C;AAEP,MAAMC,0BAA0B;AAEhC,MAAMC,iBAAiB;IACrBC,KAAK,IAAM;YAAC;SAAQ;IACpBC,OAAO,CAACC,UAAgC;YAAC;YAASA;SAAQ;AAC5D;AAEA,MAAML,sBAAsB,CAACM,iBAAiB,KAAK;IACjD,OAAOC,IAAAA,oBAAQ,EAAC;QACdC,UAAUN,eAAeC,GAAG;QAC5BM,SAASC,mCAAa;QACtBC,QAAQL,iBAAiBM,YAAYC;QACrCC,WAAWR,iBAAiBM,YAAYC;QACxCE,QAAQC,CAAAA,SAAUA,OAAOC,GAAG,CAACC,wBAAiB;QAC9CZ;IACF;AACF;AAOA,MAAMV,qBAAqB,CAAC,EAAES,OAAO,EAAEc,YAAY,EAA2B;IAC5E,OAAOZ,IAAAA,oBAAQ,EAAiC;QAC9Ca,SAAS,CAAC,CAACf;QACXG,UAAUN,eAAeE,KAAK,CAACC;QAC/BI,SAAS,IAAMY,IAAAA,yCAAmB,EAAChB;QACnCM,QAAQE;QACRC,WAAWD;QACXE,QAAQX,CAAAA,QAASA,SAASc,IAAAA,wBAAiB,EAACd;QAC5CkB,OAAOH,eAAe,QAAQlB;IAChC;AACF;AAEA,MAAMH,2BAA2B,CAACyB,SAAqBC;IACrD,MAAMC,cAAcC,IAAAA,0BAAc;IAElC,OAAOC,IAAAA,uBAAW,EAAC;QACjBC,YAAYC,2CAAqB;QACjCL;QACAD;QAEAO,WAAW,CAACC,OAAOC,QAAQ3B;YACzBoB,YAAYQ,aAAa,CAAC;gBAAEzB,UAAUN,eAAeE,KAAK,CAACC;YAAS;YACpEoB,YAAYS,cAAc,CAAC;gBAAE1B,UAAUN,eAAeC,GAAG;YAAG;QAC9D;IACF;AACF;AAEA,MAAMJ,yBAAyB,CAC7BwB,SACAC,WACAnB;IAEA,MAAMoB,cAAcC,IAAAA,0BAAc;IAElC,OAAOC,IAAAA,uBAAW,EAAC;QACjBC,YAAY,CAACO,cAAgCC,IAAAA,qCAAe,EAACD,aAAa9B;QAC1EmB;QACAD;QACAO,WAAW,IAAML,YAAYS,cAAc,CAAC;gBAAE1B,UAAUN,eAAeC,GAAG;YAAG;IAC/E;AACF;AAEA,MAAMN,4BAA4B;IAChC,MAAM4B,cAAcC,IAAAA,0BAAc;IAClC,OAAOC,IAAAA,uBAAW,EAAC;QACjBC,YAAYS,iCAAW;QACvBb,WAAWc,CAAAA;YACTb,YAAYc,YAAY,CAACrC,eAAeE,KAAK,CAACkC,KAAKE,EAAE,GAAGF;YACxD,MAAMnC,MAAMsB,YAAYgB,YAAY,CAAqBvC,eAAeC,GAAG;YAC3E,IAAIA,KAAK;gBACPsB,YAAYc,YAAY,CAACrC,eAAeC,GAAG,IAAI;uBAAIA;oBAAKmC;iBAAK;YAC/D;QACF;IACF;AACF"}
{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/common/composite-components/src/StoryCard/StoryCardRanking/StoryCardRanking.tsx"],"sourcesContent":["import { SyntheticEvent, useEffect, useState } from \"react\"\nimport { CqsSentenceEntity } from \"@rp/common/api-types\"\nimport { useCqsByIdsContext } from \"@rp/react/tanstack-api/cqs-by-ids\"\nimport { useFeedback } from \"@rp/react/web/common/providers\"\nimport { Link, Popover, Rating, Typography } from \"@rp/react/web/mui/core\"\nimport { FeedbackContainer, LabelContainer } from \"./StoryCardRanking.styles\"\nimport { StoryCardRankingDetections } from \"./StoryCardRankingDetections\"\nimport { useUniqueDetections } from \"./useUniqueDetections\"\n\nconst LABELS = [\n  \"Irrelevant\",\n  \"Irrelevant Subjective\",\n  \"Barely Relevant\",\n  \"Barely Relevant Subjective\",\n  \"Somewhat Relevant\",\n  \"Somewhat Relevant Subjective\",\n  \"Relevant\",\n  \"Relevant Subjective\",\n  \"Highly Relevant\",\n  \"Highly Relevant Subjective\",\n] as const\n\ntype Props = {\n  sentenceId: string\n  resultIndex: number\n  sentenceEntities: Array<CqsSentenceEntity>\n  headlineEntities: Array<CqsSentenceEntity>\n  documentId: string\n  hideRating?: boolean\n  parentIndex?: number\n}\n\nconst getManagementConsoleHref = (documentId: string): string | undefined => {\n  return `https://marbella-console.ravenpack.com/mc/news-analysis?uuid=${documentId}&generation=5&mode=rpxml&tab=matches`\n}\n\nexport const StoryCardRanking = ({\n  sentenceId,\n  resultIndex,\n  sentenceEntities,\n  headlineEntities,\n  documentId,\n  hideRating = false,\n  parentIndex,\n}: Props) => {\n  const [hoverIndex, setHover] = useState<number | undefined>(undefined)\n  const { feedback, updateFeedback, deleteFeedback } = useFeedback(sentenceId, resultIndex)\n  const [anchorEl, setAnchorEl] = useState<HTMLElement | null>(null)\n  const { sentence, headline } = useUniqueDetections(sentenceEntities, headlineEntities)\n  const { addByIds } = useCqsByIdsContext()\n  const open = Boolean(anchorEl)\n\n  useEffect(() => {\n    addByIds(\n      sentenceEntities.concat(headlineEntities).map(item => ({\n        queryType: item.queryType,\n        key: item.key,\n      })),\n    )\n  }, [sentenceEntities, headlineEntities, addByIds])\n\n  return (\n    <>\n      <FeedbackContainer>\n        <div style={{ display: \"flex\", alignItems: \"baseline\" }}>\n          <Typography color=\"textSecondary\" fontSize={12} style={{ marginRight: 16 }}>\n            {`#${parentIndex === undefined ? \"\" : parentIndex + 1 + \"-\"}${resultIndex + 1}`}\n          </Typography>\n          <Link\n            component=\"button\"\n            onClick={event => {\n              setAnchorEl(event.currentTarget)\n              event.stopPropagation()\n            }}\n          >\n            {sentence.entities.length +\n              sentence.topics.length +\n              headline.entities.length +\n              headline.topics.length}{\" \"}\n            detections\n          </Link>\n          <Link\n            onClick={event => {\n              event.stopPropagation()\n            }}\n            fontSize={12}\n            href={getManagementConsoleHref(documentId)}\n            target=\"_blank\"\n          >\n            MC\n          </Link>\n        </div>\n        {!hideRating ? (\n          <div>\n            <LabelContainer>\n              {hoverIndex !== undefined ? LABELS[hoverIndex - 1] : \"\"}\n            </LabelContainer>\n\n            <Rating\n              name={`ranking-feedback-${sentenceId}`}\n              value={feedback}\n              precision={0.5}\n              onClick={event => {\n                event.stopPropagation()\n              }}\n              onChange={(_, newValue) => {\n                if (newValue) {\n                  return updateFeedback(newValue)\n                }\n                deleteFeedback()\n                return\n              }}\n              onChangeActive={(event, newHover) => {\n                setHover(newHover * 2)\n              }}\n            />\n          </div>\n        ) : null}\n      </FeedbackContainer>\n      <Popover\n        open={open}\n        anchorEl={anchorEl}\n        onClose={(event: SyntheticEvent) => {\n          setAnchorEl(null)\n          event.stopPropagation()\n        }}\n        onClick={event => event?.stopPropagation()}\n        sx={{ marginTop: \"6px\" }}\n        anchorOrigin={{ vertical: \"bottom\", horizontal: \"left\" }}\n      >\n        <StoryCardRankingDetections sentence={sentence} headline={headline} />\n      </Popover>\n    </>\n  )\n}\n"],"names":["StoryCardRanking","LABELS","getManagementConsoleHref","documentId","sentenceId","resultIndex","sentenceEntities","headlineEntities","hideRating","parentIndex","hoverIndex","setHover","useState","undefined","feedback","updateFeedback","deleteFeedback","useFeedback","anchorEl","setAnchorEl","sentence","headline","useUniqueDetections","addByIds","useCqsByIdsContext","open","Boolean","useEffect","concat","map","item","queryType","key","FeedbackContainer","div","style","display","alignItems","Typography","color","fontSize","marginRight","Link","component","onClick","event","currentTarget","stopPropagation","entities","length","topics","href","target","LabelContainer","Rating","name","value","precision","onChange","_","newValue","onChangeActive","newHover","Popover","onClose","sx","marginTop","anchorOrigin","vertical","horizontal","StoryCardRankingDetections"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
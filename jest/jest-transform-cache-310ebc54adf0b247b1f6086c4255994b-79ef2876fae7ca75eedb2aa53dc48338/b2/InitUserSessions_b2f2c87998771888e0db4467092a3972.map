{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/apps/client-web/src/app/InitUserSessions.tsx"],"sourcesContent":["import { useEffect, useMemo } from \"react\"\nimport { getUnixTime } from \"date-fns\"\nimport { useUser } from \"@clerk/clerk-react\"\nimport { datadogRum } from \"@datadog/browser-rum\"\nimport { adapters } from \"@rp/adapters\"\nimport { useAccount } from \"@rp/react/common/providers\"\nimport { useDeviceInfo } from \"@rp/react/web/common/hooks\"\nimport {\n  identifyDatadogUser,\n  identifyHotjar,\n  identifySentryUser,\n  tagManagerEvents,\n} from \"@rp/react/web/common/vendors/utils\"\n\nexport function useInitUserSessions() {\n  const { isMobile } = useDeviceInfo()\n  const { user } = useUser()\n  const { quota } = useAccount()\n  const companyName = user?.organizationMemberships[0]?.organization.name ?? \"\"\n  const companyId = user?.organizationMemberships[0]?.organization.id ?? \"\"\n  const userId = user?.id ?? \"\"\n  const userEmail = user?.primaryEmailAddress?.emailAddress ?? \"\"\n  const userName = user?.fullName ?? \"\"\n  const userCreatedAt = getUnixTime(new Date(user?.createdAt ?? \"\"))\n  const firstName = user?.firstName ?? \"\"\n  const lastName = user?.lastName ?? \"\"\n  const subscriptionStatus = quota?.subscriptionStatus ?? \"\"\n  const subscriptionSource = quota?.subscriptionSource ?? \"\"\n  const subscriptionRenewalDate = quota?.subscriptionRenewalDate?.toString() ?? \"\"\n\n  const { hasEntitlement } = useAccount()\n\n  const enableIntercomLauncher = hasEntitlement(\"support:intercom\")\n\n  const tagManagerUser = useMemo(() => {\n    return {\n      userId,\n      // intercomHash: user.id, // This makes the connection insecure and should be fixed!\n      userName,\n      userEmail,\n      userCreatedAt,\n      subscriptionStatus,\n      subscriptionSource,\n      subscriptionRenewalDate,\n      ...(companyId ? { companyId } : {}), // Intercom does not like empty strings\n      ...(companyName ? { companyName } : {}), // Intercom does not like empty strings\n    }\n  }, [\n    userId,\n    userName,\n    userEmail,\n    userCreatedAt,\n    companyId,\n    companyName,\n    subscriptionStatus,\n    subscriptionSource,\n    subscriptionRenewalDate,\n  ])\n\n  const hotjarUser = useMemo(() => {\n    return {\n      userEmail,\n      firstName,\n      lastName,\n      companyName,\n    }\n  }, [userEmail, firstName, lastName, companyName])\n\n  const sentryUser = useMemo(() => {\n    return {\n      id: userId,\n      companyId,\n    }\n  }, [companyId, userId])\n\n  const dataDogUser = useMemo(() => {\n    return {\n      id: userId,\n      companyId,\n    }\n  }, [userId, companyId])\n\n  useEffect(() => {\n    if (!tagManagerUser.userId) return\n    tagManagerEvents.login(tagManagerUser)\n    identifyHotjar(hotjarUser)\n    identifySentryUser(sentryUser)\n    identifyDatadogUser(dataDogUser)\n\n    return () => {\n      tagManagerEvents.logout()\n      adapters.customerIo.logout()\n      datadogRum.clearUser()\n    }\n  }, [tagManagerUser, hotjarUser, sentryUser, dataDogUser])\n\n  useEffect(() => {\n    if (!enableIntercomLauncher) {\n      return\n    }\n\n    isMobile ? tagManagerEvents.isMobile() : tagManagerEvents.isDesktop()\n  }, [enableIntercomLauncher, isMobile])\n\n  return null\n}\n"],"names":["useInitUserSessions","user","quota","isMobile","useDeviceInfo","useUser","useAccount","companyName","organizationMemberships","organization","name","companyId","id","userId","userEmail","primaryEmailAddress","emailAddress","userName","fullName","userCreatedAt","getUnixTime","Date","createdAt","firstName","lastName","subscriptionStatus","subscriptionSource","subscriptionRenewalDate","toString","hasEntitlement","enableIntercomLauncher","tagManagerUser","useMemo","hotjarUser","sentryUser","dataDogUser","useEffect","tagManagerEvents","login","identifyHotjar","identifySentryUser","identifyDatadogUser","logout","adapters","customerIo","datadogRum","clearUser","isDesktop"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
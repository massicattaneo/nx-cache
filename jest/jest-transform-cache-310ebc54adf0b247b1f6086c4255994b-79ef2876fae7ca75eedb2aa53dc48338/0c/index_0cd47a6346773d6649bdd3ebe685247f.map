{"version":3,"sources":["../../src/utils/index.ts","../../src/utils/noop.ts","../../src/utils/createDeferredPromise.ts","../../src/utils/instance.ts","../../src/utils/runtimeEnvironment.ts","../../src/utils/logErrorInDevMode.ts","../../src/utils/runWithExponentialBackOff.ts","../../src/utils/handleValueOrFn.ts","../../src/utils/fastDeepMerge.ts"],"sourcesContent":["export * from './createDeferredPromise';\nexport { isStaging } from './instance';\nexport { logErrorInDevMode } from './logErrorInDevMode';\nexport { noop } from './noop';\nexport * from './runWithExponentialBackOff';\nexport * from './runtimeEnvironment';\nexport { handleValueOrFn } from './handleValueOrFn';\nexport { fastDeepMergeAndReplace, fastDeepMergeAndKeep } from './fastDeepMerge';\n","export const noop = (..._args: any[]): void => {\n  // do nothing.\n};\n","import { noop } from './noop';\n\ntype Callback = (val?: any) => void;\n\n/**\n * Create a promise that can be resolved or rejected from\n * outside the Promise constructor callback\n */\nexport const createDeferredPromise = () => {\n  let resolve: Callback = noop;\n  let reject: Callback = noop;\n  const promise = new Promise((res, rej) => {\n    resolve = res;\n    reject = rej;\n  });\n  return { promise, resolve, reject };\n};\n","/**\n * Check if the frontendApi ends with a staging domain\n */\nexport function isStaging(frontendApi: string): boolean {\n  return (\n    frontendApi.endsWith('.lclstage.dev') ||\n    frontendApi.endsWith('.stgstage.dev') ||\n    frontendApi.endsWith('.clerkstage.dev') ||\n    frontendApi.endsWith('.accountsstage.dev')\n  );\n}\n","export const isDevelopmentEnvironment = (): boolean => {\n  try {\n    return process.env.NODE_ENV === 'development';\n    // eslint-disable-next-line no-empty\n  } catch {}\n\n  // TODO: add support for import.meta.env.DEV that is being used by vite\n\n  return false;\n};\n\nexport const isTestEnvironment = (): boolean => {\n  try {\n    return process.env.NODE_ENV === 'test';\n    // eslint-disable-next-line no-empty\n  } catch {}\n\n  // TODO: add support for import.meta.env.DEV that is being used by vite\n  return false;\n};\n\nexport const isProductionEnvironment = (): boolean => {\n  try {\n    return process.env.NODE_ENV === 'production';\n    // eslint-disable-next-line no-empty\n  } catch {}\n\n  // TODO: add support for import.meta.env.DEV that is being used by vite\n  return false;\n};\n","import { isDevelopmentEnvironment } from './runtimeEnvironment';\n\nexport const logErrorInDevMode = (message: string) => {\n  if (isDevelopmentEnvironment()) {\n    console.error(`Clerk: ${message}`);\n  }\n};\n","type Milliseconds = number;\n\ntype BackoffOptions = Partial<{\n  firstDelay: Milliseconds;\n  maxDelay: Milliseconds;\n  timeMultiple: number;\n  shouldRetry: (error: unknown, iterationsCount: number) => boolean;\n}>;\n\nconst defaultOptions: Required<BackoffOptions> = {\n  firstDelay: 125,\n  maxDelay: 0,\n  timeMultiple: 2,\n  shouldRetry: () => true,\n};\n\nconst sleep = async (ms: Milliseconds) => new Promise(s => setTimeout(s, ms));\n\nconst createExponentialDelayAsyncFn = (opts: {\n  firstDelay: Milliseconds;\n  maxDelay: Milliseconds;\n  timeMultiple: number;\n}) => {\n  let timesCalled = 0;\n\n  const calculateDelayInMs = () => {\n    const constant = opts.firstDelay;\n    const base = opts.timeMultiple;\n    const delay = constant * Math.pow(base, timesCalled);\n    return Math.min(opts.maxDelay || delay, delay);\n  };\n\n  return async (): Promise<void> => {\n    await sleep(calculateDelayInMs());\n    timesCalled++;\n  };\n};\n\nexport const runWithExponentialBackOff = async <T>(\n  callback: () => T | Promise<T>,\n  options: BackoffOptions = {},\n): Promise<T> => {\n  let iterationsCount = 0;\n  const { shouldRetry, firstDelay, maxDelay, timeMultiple } = {\n    ...defaultOptions,\n    ...options,\n  };\n  const delay = createExponentialDelayAsyncFn({ firstDelay, maxDelay, timeMultiple });\n\n  while (true) {\n    try {\n      return await callback();\n    } catch (e) {\n      iterationsCount++;\n      if (!shouldRetry(e, iterationsCount)) {\n        throw e;\n      }\n      await delay();\n    }\n  }\n};\n","type VOrFnReturnsV<T> = T | undefined | ((v: URL) => T);\nexport function handleValueOrFn<T>(value: VOrFnReturnsV<T>, url: URL): T | undefined;\nexport function handleValueOrFn<T>(value: VOrFnReturnsV<T>, url: URL, defaultValue: T): T;\nexport function handleValueOrFn<T>(value: VOrFnReturnsV<T>, url: URL, defaultValue?: unknown): unknown {\n  if (typeof value === 'function') {\n    return (value as (v: URL) => T)(url);\n  }\n\n  if (typeof value !== 'undefined') {\n    return value;\n  }\n\n  if (typeof defaultValue !== 'undefined') {\n    return defaultValue;\n  }\n\n  return undefined;\n}\n","/**\n * Merges 2 objects without creating new object references\n * The merged props will appear on the `target` object\n * If `target` already has a value for a given key it will not be overwritten\n */\nexport const fastDeepMergeAndReplace = (\n  source: Record<any, any> | undefined | null,\n  target: Record<any, any> | undefined | null,\n) => {\n  if (!source || !target) {\n    return;\n  }\n\n  for (const key in source) {\n    if (Object.prototype.hasOwnProperty.call(source, key) && source[key] !== null && typeof source[key] === `object`) {\n      if (target[key] === undefined) {\n        target[key] = new (Object.getPrototypeOf(source[key]).constructor)();\n      }\n      fastDeepMergeAndReplace(source[key], target[key]);\n    } else if (Object.prototype.hasOwnProperty.call(source, key)) {\n      target[key] = source[key];\n    }\n  }\n};\n\nexport const fastDeepMergeAndKeep = (\n  source: Record<any, any> | undefined | null,\n  target: Record<any, any> | undefined | null,\n) => {\n  if (!source || !target) {\n    return;\n  }\n\n  for (const key in source) {\n    if (Object.prototype.hasOwnProperty.call(source, key) && source[key] !== null && typeof source[key] === `object`) {\n      if (target[key] === undefined) {\n        target[key] = new (Object.getPrototypeOf(source[key]).constructor)();\n      }\n      fastDeepMergeAndKeep(source[key], target[key]);\n    } else if (Object.prototype.hasOwnProperty.call(source, key) && target[key] === undefined) {\n      target[key] = source[key];\n    }\n  }\n};\n"],"names":["utils_exports","__export","createDeferredPromise","fastDeepMergeAndKeep","fastDeepMergeAndReplace","handleValueOrFn","isDevelopmentEnvironment","isProductionEnvironment","isStaging","isTestEnvironment","logErrorInDevMode","noop","runWithExponentialBackOff","module","exports","__toCommonJS","_args","resolve","reject","promise","Promise","res","rej","frontendApi","endsWith","process","env","NODE_ENV","message","console","error","defaultOptions","firstDelay","maxDelay","timeMultiple","shouldRetry","sleep","ms","s","setTimeout","createExponentialDelayAsyncFn","opts","timesCalled","calculateDelayInMs","constant","base","delay","Math","pow","min","callback","options","iterationsCount","e","value","url","defaultValue","source","target","key","Object","prototype","hasOwnProperty","call","getPrototypeOf","constructor"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/common/utils/src/lib/clerk.ts"],"sourcesContent":["import { z } from \"zod\"\nimport { OrganizationMembershipResource, UserResource } from \"@clerk/types\"\nimport { ClerkApList } from \"@rp/common/api-types\"\n\nconst UnsafeMetadataSchema = z.object({\n  requireOnboarding: z.boolean().default(false),\n  source: z.enum([\"web-client\", \"native-client\"]).optional(),\n  initialLogin: z.boolean().optional(),\n  initialLoginId: z.string().uuid().optional(),\n  legalAcceptedAt: z.string().optional(),\n  marketingAccepted: z.boolean().optional(),\n  acceptedFree: z.boolean().optional(),\n  acceptedCookies: z.array(z.string()).default([]).optional(),\n})\n\ntype UnsafeClerkMetadata = z.infer<typeof UnsafeMetadataSchema>\n\nconst PublicMetadataSchema = z.object({\n  self_registered: z.boolean().optional(),\n  ap: z.array(z.nativeEnum(ClerkApList)).optional(),\n  legalAcceptedAt: z.string().optional(),\n  marketingAccepted: z.boolean().optional(),\n})\n\nfunction transformUnsafeMetadata(metadata: UserResource[\"unsafeMetadata\"]) {\n  try {\n    return UnsafeMetadataSchema.parse(metadata)\n  } catch (e) {\n    return {\n      requireOnboarding: false,\n      source: undefined,\n      initialLogin: z.boolean().optional(),\n      initialLoginId: z.string().uuid().optional(),\n      acceptedFree: z.boolean().optional(),\n      acceptedCookies: [],\n      legalAcceptedAt: z.string().optional(),\n      marketingAccepted: z.boolean().optional(),\n    }\n  }\n}\n\nfunction transformPublicMetadata(metadata: UserResource[\"publicMetadata\"]) {\n  try {\n    return PublicMetadataSchema.parse(metadata)\n  } catch {\n    return {}\n  }\n}\n\nconst getOwnerInfo = (\n  user: UserResource | null | undefined,\n  orgUser: OrganizationMembershipResource | undefined,\n  userIsOwner: boolean,\n) => {\n  // if (!user) return { displayName: \"\", name: \"\", avatar: \"\" }\n  const orgName = `${orgUser?.publicUserData?.firstName} ${orgUser?.publicUserData?.lastName}`\n\n  if (user && userIsOwner) {\n    return {\n      displayName: \"You\",\n      name: user.fullName ?? \"You\",\n      avatar: user.imageUrl,\n    }\n  }\n\n  if (orgUser?.publicUserData) {\n    return { displayName: orgName, name: orgName, avatar: orgUser.publicUserData.imageUrl }\n  }\n\n  return {\n    displayName: \"Anonymous User\",\n    name: \"\",\n    avatar: \"\",\n  }\n}\n\nexport { transformUnsafeMetadata, transformPublicMetadata, getOwnerInfo }\nexport type { UnsafeClerkMetadata }\n"],"names":["getOwnerInfo","transformPublicMetadata","transformUnsafeMetadata","UnsafeMetadataSchema","z","object","requireOnboarding","boolean","default","source","enum","optional","initialLogin","initialLoginId","string","uuid","legalAcceptedAt","marketingAccepted","acceptedFree","acceptedCookies","array","PublicMetadataSchema","self_registered","ap","nativeEnum","ClerkApList","metadata","parse","e","undefined","user","orgUser","userIsOwner","orgName","publicUserData","firstName","lastName","displayName","name","fullName","avatar","imageUrl"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;;;;;;;;IA4E2DA,YAAY;eAAZA;;IAAzBC,uBAAuB;eAAvBA;;IAAzBC,uBAAuB;eAAvBA;;;qBA5ES;0BAEU;AAE5B,MAAMC,uBAAuBC,MAAC,CAACC,MAAM,CAAC;IACpCC,mBAAmBF,MAAC,CAACG,OAAO,GAAGC,OAAO,CAAC;IACvCC,QAAQL,MAAC,CAACM,IAAI,CAAC;QAAC;QAAc;KAAgB,EAAEC,QAAQ;IACxDC,cAAcR,MAAC,CAACG,OAAO,GAAGI,QAAQ;IAClCE,gBAAgBT,MAAC,CAACU,MAAM,GAAGC,IAAI,GAAGJ,QAAQ;IAC1CK,iBAAiBZ,MAAC,CAACU,MAAM,GAAGH,QAAQ;IACpCM,mBAAmBb,MAAC,CAACG,OAAO,GAAGI,QAAQ;IACvCO,cAAcd,MAAC,CAACG,OAAO,GAAGI,QAAQ;IAClCQ,iBAAiBf,MAAC,CAACgB,KAAK,CAAChB,MAAC,CAACU,MAAM,IAAIN,OAAO,CAAC,EAAE,EAAEG,QAAQ;AAC3D;AAIA,MAAMU,uBAAuBjB,MAAC,CAACC,MAAM,CAAC;IACpCiB,iBAAiBlB,MAAC,CAACG,OAAO,GAAGI,QAAQ;IACrCY,IAAInB,MAAC,CAACgB,KAAK,CAAChB,MAAC,CAACoB,UAAU,CAACC,qBAAW,GAAGd,QAAQ;IAC/CK,iBAAiBZ,MAAC,CAACU,MAAM,GAAGH,QAAQ;IACpCM,mBAAmBb,MAAC,CAACG,OAAO,GAAGI,QAAQ;AACzC;AAEA,SAAST,wBAAwBwB,QAAwC;IACvE,IAAI;QACF,OAAOvB,qBAAqBwB,KAAK,CAACD;IACpC,EAAE,OAAOE,GAAG;QACV,OAAO;YACLtB,mBAAmB;YACnBG,QAAQoB;YACRjB,cAAcR,MAAC,CAACG,OAAO,GAAGI,QAAQ;YAClCE,gBAAgBT,MAAC,CAACU,MAAM,GAAGC,IAAI,GAAGJ,QAAQ;YAC1CO,cAAcd,MAAC,CAACG,OAAO,GAAGI,QAAQ;YAClCQ,iBAAiB,EAAE;YACnBH,iBAAiBZ,MAAC,CAACU,MAAM,GAAGH,QAAQ;YACpCM,mBAAmBb,MAAC,CAACG,OAAO,GAAGI,QAAQ;QACzC;IACF;AACF;AAEA,SAASV,wBAAwByB,QAAwC;IACvE,IAAI;QACF,OAAOL,qBAAqBM,KAAK,CAACD;IACpC,EAAE,UAAM;QACN,OAAO,CAAC;IACV;AACF;AAEA,MAAM1B,eAAe,CACnB8B,MACAC,SACAC;QAGmBD,yBAAsCA;IADzD,8DAA8D;IAC9D,MAAME,UAAU,CAAC,EAAEF,oBAAAA,+BAAAA,0BAAAA,QAASG,cAAc,cAAvBH,8CAAAA,wBAAyBI,SAAS,CAAC,CAAC,EAAEJ,oBAAAA,+BAAAA,2BAAAA,QAASG,cAAc,cAAvBH,+CAAAA,yBAAyBK,QAAQ,CAAC,CAAC;IAE5F,IAAIN,QAAQE,aAAa;YAGfF;QAFR,OAAO;YACLO,aAAa;YACbC,MAAMR,CAAAA,iBAAAA,KAAKS,QAAQ,cAAbT,4BAAAA,iBAAiB;YACvBU,QAAQV,KAAKW,QAAQ;QACvB;IACF;IAEA,IAAIV,oBAAAA,8BAAAA,QAASG,cAAc,EAAE;QAC3B,OAAO;YAAEG,aAAaJ;YAASK,MAAML;YAASO,QAAQT,QAAQG,cAAc,CAACO,QAAQ;QAAC;IACxF;IAEA,OAAO;QACLJ,aAAa;QACbC,MAAM;QACNE,QAAQ;IACV;AACF"}
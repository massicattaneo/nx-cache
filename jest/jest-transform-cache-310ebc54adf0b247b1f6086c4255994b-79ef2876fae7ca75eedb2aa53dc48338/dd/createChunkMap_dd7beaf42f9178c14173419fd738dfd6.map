{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/common/hooks/src/lib/useChat/createChunkMap.ts"],"sourcesContent":["import { StoredAuditTrace } from \"@rp/react/tanstack-api/chat\"\nimport {\n  LlmDocumentSource,\n  LlmSourcesMessage,\n  isLlmDocumentSource,\n} from \"@rp/react/tanstack-api/llm-summary\"\nimport { ChunkMap, ExternalMap } from \"./useChat.types\"\n\nconst createChunkMap = (\n  traces: Array<StoredAuditTrace>,\n  sources?: LlmSourcesMessage[\"originSources\"],\n) => {\n  const chunkMap: ChunkMap = {}\n  const externalMap: ExternalMap = {}\n\n  const sourcesMap: Record<string, LlmDocumentSource> = {}\n\n  if (sources) {\n    for (const source of sources) {\n      if (isLlmDocumentSource(source)) {\n        sourcesMap[source.id] = source\n      }\n    }\n  }\n\n  for (const trace of traces) {\n    for (const result of trace.results) {\n      if (result.type === \"EXTERNAL\") {\n        for (const externalStory of result.values) {\n          if (externalStory.id !== undefined) {\n            externalMap[externalStory.id] ??= externalStory\n          }\n        }\n      }\n\n      if (result.type === \"CQS\") {\n        for (const cqsStory of result.values) {\n          for (const chunk of cqsStory.chunks) {\n            if (chunk.id !== undefined) {\n              chunkMap[chunk.id] ??= {\n                ...chunk,\n                parent: cqsStory,\n                relatedSource: sourcesMap[cqsStory.id],\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  return { chunkMap, externalMap }\n}\n\nexport { createChunkMap }\n"],"names":["createChunkMap","traces","sources","chunkMap","externalMap","sourcesMap","source","isLlmDocumentSource","id","trace","result","results","type","externalStory","values","undefined","cqsStory","chunk","chunks","parent","relatedSource"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAsDSA;;;eAAAA;;;4BAjDF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGP,MAAMA,iBAAiB,CACrBC,QACAC;IAEA,MAAMC,WAAqB,CAAC;IAC5B,MAAMC,cAA2B,CAAC;IAElC,MAAMC,aAAgD,CAAC;IAEvD,IAAIH,SAAS;QACX,KAAK,MAAMI,UAAUJ,QAAS;YAC5B,IAAIK,IAAAA,+BAAmB,EAACD,SAAS;gBAC/BD,UAAU,CAACC,OAAOE,EAAE,CAAC,GAAGF;YAC1B;QACF;IACF;IAEA,KAAK,MAAMG,SAASR,OAAQ;QAC1B,KAAK,MAAMS,UAAUD,MAAME,OAAO,CAAE;YAClC,IAAID,OAAOE,IAAI,KAAK,YAAY;gBAC9B,KAAK,MAAMC,iBAAiBH,OAAOI,MAAM,CAAE;oBACzC,IAAID,cAAcL,EAAE,KAAKO,WAAW;4BAClCX,cAAYS;;wBAAZT,MAAAA,eAAAA,YAAW,CAACS,oBAAAA,cAAcL,EAAE,CAAC,iCAA7BJ,YAAW,CAACS,kBAAiB,GAAKA;oBACpC;gBACF;YACF;YAEA,IAAIH,OAAOE,IAAI,KAAK,OAAO;gBACzB,KAAK,MAAMI,YAAYN,OAAOI,MAAM,CAAE;oBACpC,KAAK,MAAMG,SAASD,SAASE,MAAM,CAAE;wBACnC,IAAID,MAAMT,EAAE,KAAKO,WAAW;gCAC1BZ,WAASc;;4BAATd,OAAAA,YAAAA,SAAQ,CAACc,YAAAA,MAAMT,EAAE,CAAC,mCAAlBL,SAAQ,CAACc,UAAS,GAAK,wCAClBA;gCACHE,QAAQH;gCACRI,eAAef,UAAU,CAACW,SAASR,EAAE,CAAC;;wBAE1C;oBACF;gBACF;YACF;QACF;IACF;IAEA,OAAO;QAAEL;QAAUC;IAAY;AACjC"}
{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/common/composite-components/src/WatchlistMenu/WatchlistMenu.tsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\"\nimport { CqsItem, Watchlist } from \"@rp/common/api-types\"\nimport { useCqsByIdsContext } from \"@rp/react/tanstack-api/cqs-by-ids\"\nimport { RPTooltip } from \"@rp/react/web/common/base-components\"\nimport { useSnackbar } from \"@rp/react/web/common/providers\"\nimport { WatchlistsFilled } from \"@rp/react/web/icons\"\nimport {\n  Box,\n  CircularProgress,\n  ClickAwayListener,\n  IconButton,\n  SvgIcon,\n} from \"@rp/react/web/mui/core\"\nimport { CreateWatchlistButton } from \"./CreateWatchlistButton\"\nimport { WatchlistList } from \"./WatchlistList\"\n// Types\nimport { PopperStyled, WatchlistMenuContainer } from \"./WatchlistMenu.styles\"\nimport { HandleOpenModalProps } from \"./WatchlistMenu.types\"\nimport { useAddEntities } from \"./watchlist.helpers\"\n\ntype Props = {\n  filter: Array<CqsItem | { key: string }>\n  showWatchlistIcon?: boolean\n  iconSize?: number\n  zIndex?: number\n  onAddToWatchlist?: (watchlist: Watchlist) => void\n  onHandleOpenModal: HandleOpenModalProps\n}\n\nconst WatchlistMenu = ({\n  filter,\n  iconSize = 14,\n  zIndex,\n  onAddToWatchlist,\n  onHandleOpenModal,\n}: Props) => {\n  const { enqueueSuccess, enqueueError, enqueueInfo } = useSnackbar()\n  const [anchorEl, setAnchorEl] = useState<HTMLButtonElement | undefined>(undefined)\n  const handleOpen = (event: React.MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget)\n  }\n\n  const handleClose = () => {\n    setAnchorEl(undefined)\n  }\n  const { addByIds, ids } = useCqsByIdsContext()\n\n  useEffect(() => {\n    addByIds(filter)\n  }, [addByIds, filter])\n\n  const itemsToAdd = filter\n    .filter(({ key }) => ids[key] !== undefined)\n    .map(({ key }) => ({\n      ...ids[key].data,\n    }))\n\n  const { addEntities, isLoading } = useAddEntities({\n    onSuccess: onAddToWatchlist,\n    enqueueSuccess,\n    enqueueError,\n    enqueueInfo,\n  })\n\n  const handleWatchlistClick = (watchlistId: string, watchlistName: string) => {\n    addEntities(watchlistId, itemsToAdd, watchlistName)\n    handleClose()\n  }\n\n  const open = anchorEl !== undefined\n\n  return (\n    <Box\n      sx={{\n        width: \"30px\",\n        height: \"30px\",\n        display: \"flex\",\n        alignItems: \"center\",\n        justifyContent: \"center\",\n      }}\n    >\n      {isLoading ? (\n        <CircularProgress\n          size={20}\n          data-testid=\"loading-watchlist-menu\"\n          sx={theme => ({ \"& svg\": { color: `${theme.palette.primary.main} !important` } })}\n        />\n      ) : (\n        <RPTooltip title=\"Add to Watchlist\" placement=\"top\">\n          <IconButton\n            size=\"small\"\n            onClick={handleOpen}\n            sx={{\n              display: open ? \"flex !important\" : undefined,\n            }}\n            data-testid=\"add-to-watchlist-button\"\n          >\n            <SvgIcon component={WatchlistsFilled} inheritViewBox sx={{ height: iconSize }} />\n          </IconButton>\n        </RPTooltip>\n      )}\n      <PopperStyled\n        open={open}\n        anchorEl={anchorEl}\n        transformOrigin={{\n          vertical: \"top\",\n          horizontal: \"center\",\n        }}\n        zIndex={zIndex}\n      >\n        <ClickAwayListener\n          onClickAway={e => {\n            e.preventDefault()\n            handleClose()\n          }}\n        >\n          <WatchlistMenuContainer>\n            <WatchlistList\n              onWatchlistClick={(id: string, name: string) => handleWatchlistClick(id, name)}\n            />\n            <CreateWatchlistButton\n              filter={itemsToAdd}\n              onClick={handleClose}\n              onHandleOpenModal={onHandleOpenModal}\n            />\n          </WatchlistMenuContainer>\n        </ClickAwayListener>\n      </PopperStyled>\n    </Box>\n  )\n}\n\nexport { WatchlistMenu }\n"],"names":["WatchlistMenu","filter","iconSize","zIndex","onAddToWatchlist","onHandleOpenModal","enqueueSuccess","enqueueError","enqueueInfo","useSnackbar","anchorEl","setAnchorEl","useState","undefined","handleOpen","event","currentTarget","handleClose","addByIds","ids","useCqsByIdsContext","useEffect","itemsToAdd","key","map","data","addEntities","isLoading","useAddEntities","onSuccess","handleWatchlistClick","watchlistId","watchlistName","open","Box","sx","width","height","display","alignItems","justifyContent","CircularProgress","size","data-testid","theme","color","palette","primary","main","RPTooltip","title","placement","IconButton","onClick","SvgIcon","component","WatchlistsFilled","inheritViewBox","PopperStyled","transformOrigin","vertical","horizontal","ClickAwayListener","onClickAway","e","preventDefault","WatchlistMenuContainer","WatchlistList","onWatchlistClick","id","name","CreateWatchlistButton"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAoISA;;;eAAAA;;;;+DApIkC;0BAER;gCACT;2BACE;uBACK;sBAO1B;uCAC+B;+BACR;qCAEuB;kCAEtB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAW/B,MAAMA,gBAAgB,CAAC,EACrBC,MAAM,EACNC,WAAW,EAAE,EACbC,MAAM,EACNC,gBAAgB,EAChBC,iBAAiB,EACX;IACN,MAAM,EAAEC,cAAc,EAAEC,YAAY,EAAEC,WAAW,EAAE,GAAGC,IAAAA,sBAAW;IACjE,MAAM,CAACC,UAAUC,YAAY,GAAGC,IAAAA,eAAQ,EAAgCC;IACxE,MAAMC,aAAa,CAACC;QAClBJ,YAAYI,MAAMC,aAAa;IACjC;IAEA,MAAMC,cAAc;QAClBN,YAAYE;IACd;IACA,MAAM,EAAEK,QAAQ,EAAEC,GAAG,EAAE,GAAGC,IAAAA,4BAAkB;IAE5CC,IAAAA,gBAAS,EAAC;QACRH,SAASjB;IACX,GAAG;QAACiB;QAAUjB;KAAO;IAErB,MAAMqB,aAAarB,OAChBA,MAAM,CAAC,CAAC,EAAEsB,GAAG,EAAE,GAAKJ,GAAG,CAACI,IAAI,KAAKV,WACjCW,GAAG,CAAC,CAAC,EAAED,GAAG,EAAE,GAAM,mBACdJ,GAAG,CAACI,IAAI,CAACE,IAAI;IAGpB,MAAM,EAAEC,WAAW,EAAEC,SAAS,EAAE,GAAGC,IAAAA,gCAAc,EAAC;QAChDC,WAAWzB;QACXE;QACAC;QACAC;IACF;IAEA,MAAMsB,uBAAuB,CAACC,aAAqBC;QACjDN,YAAYK,aAAaT,YAAYU;QACrCf;IACF;IAEA,MAAMgB,OAAOvB,aAAaG;IAE1B,qBACE,sBAACqB,SAAG;QACFC,IAAI;YACFC,OAAO;YACPC,QAAQ;YACRC,SAAS;YACTC,YAAY;YACZC,gBAAgB;QAClB;;YAECb,0BACC,qBAACc,sBAAgB;gBACfC,MAAM;gBACNC,eAAY;gBACZR,IAAIS,CAAAA,QAAU,CAAA;wBAAE,SAAS;4BAAEC,OAAO,CAAC,EAAED,MAAME,OAAO,CAACC,OAAO,CAACC,IAAI,CAAC,WAAW,CAAC;wBAAC;oBAAE,CAAA;+BAGjF,qBAACC,yBAAS;gBAACC,OAAM;gBAAmBC,WAAU;0BAC5C,cAAA,qBAACC,gBAAU;oBACTV,MAAK;oBACLW,SAASvC;oBACTqB,IAAI;wBACFG,SAASL,OAAO,oBAAoBpB;oBACtC;oBACA8B,eAAY;8BAEZ,cAAA,qBAACW,aAAO;wBAACC,WAAWC,uBAAgB;wBAAEC,cAAc;wBAACtB,IAAI;4BAAEE,QAAQnC;wBAAS;;;;0BAIlF,qBAACwD,iCAAY;gBACXzB,MAAMA;gBACNvB,UAAUA;gBACViD,iBAAiB;oBACfC,UAAU;oBACVC,YAAY;gBACd;gBACA1D,QAAQA;0BAER,cAAA,qBAAC2D,uBAAiB;oBAChBC,aAAaC,CAAAA;wBACXA,EAAEC,cAAc;wBAChBhD;oBACF;8BAEA,cAAA,sBAACiD,2CAAsB;;0CACrB,qBAACC,4BAAa;gCACZC,kBAAkB,CAACC,IAAYC,OAAiBxC,qBAAqBuC,IAAIC;;0CAE3E,qBAACC,4CAAqB;gCACpBtE,QAAQqB;gCACR+B,SAASpC;gCACTZ,mBAAmBA;;;;;;;;AAOjC"}
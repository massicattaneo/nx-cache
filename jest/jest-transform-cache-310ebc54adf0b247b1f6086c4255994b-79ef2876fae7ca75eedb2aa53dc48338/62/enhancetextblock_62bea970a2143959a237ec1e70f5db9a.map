{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/common/rpjson/src/lib/document-enhancer/enhance-text-block.ts"],"sourcesContent":["import { TextBlock } from \"@rp/react/rpjson/types\"\nimport {\n  EnhanceBlockOptions,\n  EnhancedDocumentTypes,\n  EnhancedTextBlock,\n} from \"@rp/react/rpjson/types\"\nimport { generateEventId } from \"../helpers/generate-event-id\"\n\nexport const enhanceTextBlock = (\n  block: TextBlock,\n  options: EnhanceBlockOptions,\n): EnhancedTextBlock => {\n  return {\n    ...block,\n    type: block.type || EnhancedDocumentTypes.PARAGRAPH,\n    id: options.idIterator(),\n    textStartAt: options.textStartAt,\n    tree: options.tree.slice(0),\n    sentences:\n      block.sentences?.map(sent => {\n        return { ...sent, sentenceNumber: options.sentenceIterator() }\n      }) ?? [],\n    entities: [\n      ...(block.entities?.map(item => ({\n        id: options.idIterator(),\n        queryType: \"entity\" as const,\n        key: item.rp_entity_id,\n        start: item.start,\n        end: item.end,\n      })) ?? []),\n      ...(block.events?.map(item => {\n        const event = (options.rpjson?.analytics.events || []).find(\n          el => el.event_similarity_key === item.event_similarity_key,\n        )\n        return {\n          id: options.idIterator(),\n          queryType: \"rp_topic\" as const,\n          key: generateEventId(event),\n          start: item.start,\n          end: item.end,\n        }\n      }) ?? []),\n    ],\n    paragraphNumber: options.paragraphNumber,\n  }\n}\n"],"names":["enhanceTextBlock","block","options","type","EnhancedDocumentTypes","PARAGRAPH","id","idIterator","textStartAt","tree","slice","sentences","map","sent","sentenceNumber","sentenceIterator","entities","item","queryType","key","rp_entity_id","start","end","events","event","rpjson","analytics","find","el","event_similarity_key","generateEventId","paragraphNumber"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAQaA;;;eAAAA;;;uBAHN;iCACyB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEzB,MAAMA,mBAAmB,CAC9BC,OACAC;QASID,kBAIIA,iBAOAA;QAXJA,sBAIIA,qBAOAA;IAlBR,OAAO,wCACFA;QACHE,MAAMF,MAAME,IAAI,IAAIC,4BAAqB,CAACC,SAAS;QACnDC,IAAIJ,QAAQK,UAAU;QACtBC,aAAaN,QAAQM,WAAW;QAChCC,MAAMP,QAAQO,IAAI,CAACC,KAAK,CAAC;QACzBC,WACEV,CAAAA,wBAAAA,mBAAAA,MAAMU,SAAS,cAAfV,uCAAAA,iBAAiBW,GAAG,CAACC,CAAAA;YACnB,OAAO,wCAAKA;gBAAMC,gBAAgBZ,QAAQa,gBAAgB;;QAC5D,gBAFAd,kCAAAA,uBAEM,EAAE;QACVe,UAAU;eACJf,CAAAA,uBAAAA,kBAAAA,MAAMe,QAAQ,cAAdf,sCAAAA,gBAAgBW,GAAG,CAACK,CAAAA,OAAS,CAAA;oBAC/BX,IAAIJ,QAAQK,UAAU;oBACtBW,WAAW;oBACXC,KAAKF,KAAKG,YAAY;oBACtBC,OAAOJ,KAAKI,KAAK;oBACjBC,KAAKL,KAAKK,GAAG;gBACf,CAAA,gBANIrB,iCAAAA,sBAMG,EAAE;eACLA,CAAAA,qBAAAA,gBAAAA,MAAMsB,MAAM,cAAZtB,oCAAAA,cAAcW,GAAG,CAACK,CAAAA;oBACLf;gBAAf,MAAMsB,QAAQ,AAACtB,CAAAA,EAAAA,kBAAAA,QAAQuB,MAAM,cAAdvB,sCAAAA,gBAAgBwB,SAAS,CAACH,MAAM,KAAI,EAAE,AAAD,EAAGI,IAAI,CACzDC,CAAAA,KAAMA,GAAGC,oBAAoB,KAAKZ,KAAKY,oBAAoB;gBAE7D,OAAO;oBACLvB,IAAIJ,QAAQK,UAAU;oBACtBW,WAAW;oBACXC,KAAKW,IAAAA,gCAAe,EAACN;oBACrBH,OAAOJ,KAAKI,KAAK;oBACjBC,KAAKL,KAAKK,GAAG;gBACf;YACF,gBAXIrB,+BAAAA,oBAWE,EAAE;SACT;QACD8B,iBAAiB7B,QAAQ6B,eAAe;;AAE5C"}
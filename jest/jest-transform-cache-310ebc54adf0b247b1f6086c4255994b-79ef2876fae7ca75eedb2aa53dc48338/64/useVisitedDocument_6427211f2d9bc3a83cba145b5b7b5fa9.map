{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/common/hooks/src/useVisitedDocument.ts"],"sourcesContent":["import { useAtom } from \"jotai\"\nimport { atomWithStorage } from \"jotai/utils\"\nimport { useUser } from \"@clerk/clerk-react\"\n\ntype VisitedDocument = {\n  [key: string]: {\n    timestamp: number\n    userId: string\n  }\n}\n\nconst visitedDocumentAtom = atomWithStorage<VisitedDocument>(\"visitedDocuments\", {})\n// Remove 90 days old documents\nvisitedDocumentAtom.onMount = setAtom => {\n  const now = new Date().getTime()\n  setAtom(old => {\n    const newVisitedDocuments = Object.entries(old).filter(([_, value]) => {\n      const { timestamp } = value\n      return now - timestamp < 90 * 24 * 60 * 60 * 1000\n    })\n    return Object.fromEntries(newVisitedDocuments)\n  })\n}\n\nconst useVisitedDocument = (documentId: string) => {\n  const [docs] = useAtom(visitedDocumentAtom)\n  const { user } = useUser()\n\n  const isVisited =\n    docs[documentId] && docs?.[documentId]?.userId === user?.primaryEmailAddress?.emailAddress\n\n  return isVisited\n}\n\nexport { visitedDocumentAtom }\nexport type { VisitedDocument }\nexport { useVisitedDocument }\n"],"names":["useVisitedDocument","visitedDocumentAtom","atomWithStorage","onMount","setAtom","now","Date","getTime","old","newVisitedDocuments","Object","entries","filter","_","value","timestamp","fromEntries","documentId","docs","user","useAtom","useUser","isVisited","userId","primaryEmailAddress","emailAddress"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;;;;;;;;IAoCSA,kBAAkB;eAAlBA;;IAFAC,mBAAmB;eAAnBA;;;uBAlCe;uBACQ;4BACR;AASxB,MAAMA,sBAAsBC,IAAAA,sBAAe,EAAkB,oBAAoB,CAAC;AAClF,+BAA+B;AAC/BD,oBAAoBE,OAAO,GAAGC,CAAAA;IAC5B,MAAMC,MAAM,IAAIC,OAAOC,OAAO;IAC9BH,QAAQI,CAAAA;QACN,MAAMC,sBAAsBC,OAAOC,OAAO,CAACH,KAAKI,MAAM,CAAC,CAAC,CAACC,GAAGC,MAAM;YAChE,MAAM,EAAEC,SAAS,EAAE,GAAGD;YACtB,OAAOT,MAAMU,YAAY,KAAK,KAAK,KAAK,KAAK;QAC/C;QACA,OAAOL,OAAOM,WAAW,CAACP;IAC5B;AACF;AAEA,MAAMT,qBAAqB,CAACiB;QAKJC,kBAA+BC;IAJrD,MAAM,CAACD,KAAK,GAAGE,IAAAA,cAAO,EAACnB;IACvB,MAAM,EAAEkB,IAAI,EAAE,GAAGE,IAAAA,mBAAO;IAExB,MAAMC,YACJJ,IAAI,CAACD,WAAW,IAAIC,CAAAA,iBAAAA,4BAAAA,mBAAAA,IAAM,CAACD,WAAW,cAAlBC,uCAAAA,iBAAoBK,MAAM,OAAKJ,iBAAAA,4BAAAA,4BAAAA,KAAMK,mBAAmB,cAAzBL,gDAAAA,0BAA2BM,YAAY;IAE5F,OAAOH;AACT"}
{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/tanstack-api/brief/src/briefReport/briefReport.services.ts"],"sourcesContent":["import { AxiosError, AxiosResponse } from \"axios\"\nimport { generatePath } from \"react-router-dom\"\nimport { axiosClient } from \"@rp/react/axios-client\"\nimport { BriefAPIError, BriefReport, BriefReportGetResponse } from \"../brief.types\"\nimport { BRIEF_REPORT_HISTORICAL_PATH, BRIEF_REPORT_LATEST_PATH } from \"./briefReport.routes\"\n\n// TODO: remove once DS layer fixes issue with markdown formatting in overview\n// FIXME: the \\2022 remove is an emergency fix for a change in the response - they\n// should send not standard markdown for the bullet point and we are already changing\n// it to the char they want in the UI\nconst transformMarkdown = (markdown: string): string =>\n  markdown.replace(/\\n\\n/gm, \"\\n\").replace(/\\u2022/gm, \"*\")\n\nconst loadLatestBriefReport = async (\n  briefId: string | undefined,\n): Promise<BriefReportGetResponse | null> => {\n  if (!briefId) return null\n\n  const response = await axiosClient.get<BriefReportGetResponse>(\n    generatePath(BRIEF_REPORT_LATEST_PATH, { briefId }),\n    { validateStatus: null },\n  )\n\n  const { data } = response\n\n  if (response?.status === 404) {\n    throw new Error(response.data.errorCode)\n  }\n\n  if (!data.report) {\n    throw new Error(BriefAPIError.BRIEF_REPORT_STILL_LOADING)\n  }\n\n  const cleanedData = {\n    ...data,\n    report: {\n      ...data.report,\n      introduction: transformMarkdown(data.report.introduction),\n      entityReports: data.report.entityReports.map(entityReport => ({\n        ...entityReport,\n        cleanFinalReport: transformMarkdown(entityReport.cleanFinalReport),\n      })),\n    },\n  }\n\n  return cleanedData\n}\n\nconst loadHistoricalBriefReport = async (\n  briefId: string | undefined,\n  reportId: string | undefined,\n): Promise<BriefReport | null> => {\n  if (!briefId || !reportId) return null\n\n  const response: AxiosResponse<BriefReport & { errorCode?: string }, AxiosError> =\n    await axiosClient.get(generatePath(BRIEF_REPORT_HISTORICAL_PATH, { briefId, reportId }), {\n      validateStatus: null,\n    })\n\n  if (response.status === 404) {\n    throw new Error(response.data.errorCode)\n  }\n\n  const { data } = response\n\n  const cleanedData = {\n    ...data,\n    introduction: transformMarkdown(data.introduction),\n    entityReports: data.entityReports.map(entityReport => ({\n      ...entityReport,\n      cleanFinalReport: transformMarkdown(entityReport.cleanFinalReport),\n    })),\n  }\n\n  return cleanedData\n}\n\nexport { loadLatestBriefReport, loadHistoricalBriefReport }\n"],"names":["loadHistoricalBriefReport","loadLatestBriefReport","transformMarkdown","markdown","replace","briefId","response","axiosClient","get","generatePath","BRIEF_REPORT_LATEST_PATH","validateStatus","data","status","Error","errorCode","report","BriefAPIError","BRIEF_REPORT_STILL_LOADING","cleanedData","introduction","entityReports","map","entityReport","cleanFinalReport","reportId","BRIEF_REPORT_HISTORICAL_PATH"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;;;;;;;;IA6EgCA,yBAAyB;eAAzBA;;IAAvBC,qBAAqB;eAArBA;;;gCA5EoB;6BACD;4BACuC;mCACI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEvE,8EAA8E;AAC9E,kFAAkF;AAClF,qFAAqF;AACrF,qCAAqC;AACrC,MAAMC,oBAAoB,CAACC,WACzBA,SAASC,OAAO,CAAC,UAAU,MAAMA,OAAO,CAAC,YAAY;AAEvD,MAAMH,wBAAwB,OAC5BI;IAEA,IAAI,CAACA,SAAS,OAAO;IAErB,MAAMC,WAAW,MAAMC,wBAAW,CAACC,GAAG,CACpCC,IAAAA,4BAAY,EAACC,2CAAwB,EAAE;QAAEL;IAAQ,IACjD;QAAEM,gBAAgB;IAAK;IAGzB,MAAM,EAAEC,IAAI,EAAE,GAAGN;IAEjB,IAAIA,CAAAA,qBAAAA,+BAAAA,SAAUO,MAAM,MAAK,KAAK;QAC5B,MAAM,IAAIC,MAAMR,SAASM,IAAI,CAACG,SAAS;IACzC;IAEA,IAAI,CAACH,KAAKI,MAAM,EAAE;QAChB,MAAM,IAAIF,MAAMG,yBAAa,CAACC,0BAA0B;IAC1D;IAEA,MAAMC,cAAc,wCACfP;QACHI,QAAQ,wCACHJ,KAAKI,MAAM;YACdI,cAAclB,kBAAkBU,KAAKI,MAAM,CAACI,YAAY;YACxDC,eAAeT,KAAKI,MAAM,CAACK,aAAa,CAACC,GAAG,CAACC,CAAAA,eAAiB,wCACzDA;oBACHC,kBAAkBtB,kBAAkBqB,aAAaC,gBAAgB;;;;IAKvE,OAAOL;AACT;AAEA,MAAMnB,4BAA4B,OAChCK,SACAoB;IAEA,IAAI,CAACpB,WAAW,CAACoB,UAAU,OAAO;IAElC,MAAMnB,WACJ,MAAMC,wBAAW,CAACC,GAAG,CAACC,IAAAA,4BAAY,EAACiB,+CAA4B,EAAE;QAAErB;QAASoB;IAAS,IAAI;QACvFd,gBAAgB;IAClB;IAEF,IAAIL,SAASO,MAAM,KAAK,KAAK;QAC3B,MAAM,IAAIC,MAAMR,SAASM,IAAI,CAACG,SAAS;IACzC;IAEA,MAAM,EAAEH,IAAI,EAAE,GAAGN;IAEjB,MAAMa,cAAc,wCACfP;QACHQ,cAAclB,kBAAkBU,KAAKQ,YAAY;QACjDC,eAAeT,KAAKS,aAAa,CAACC,GAAG,CAACC,CAAAA,eAAiB,wCAClDA;gBACHC,kBAAkBtB,kBAAkBqB,aAAaC,gBAAgB;;;IAIrE,OAAOL;AACT"}
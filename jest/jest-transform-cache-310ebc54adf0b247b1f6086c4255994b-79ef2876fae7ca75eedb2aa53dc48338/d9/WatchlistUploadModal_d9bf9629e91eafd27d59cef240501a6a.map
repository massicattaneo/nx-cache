{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/watchlists/src/lib/WatchlistUploadModal/WatchlistUploadModal.tsx"],"sourcesContent":["import { RefObject } from \"react\"\nimport { Watchlist } from \"@rp/common/api-types\"\nimport { watchlistCustomerIo } from \"@rp/react/common/customer-io\"\nimport {\n  BatchEntitySuggestion,\n  WatchlistBatchSuggestionPostResponseExtended,\n} from \"@rp/react/tanstack-api/suggestion\"\nimport { UploadInputRef } from \"@rp/react/web/common/base-components\"\nimport { useSnackbar } from \"@rp/react/web/common/providers\"\nimport { Box } from \"@rp/react/web/mui/core\"\nimport { WatchlistUploadModalContainer } from \"./WatchlistUploadModalContainer\"\n\ntype Props = {\n  onAdd: (ids: Array<BatchEntitySuggestion>) => Promise<Watchlist | undefined>\n  open: boolean\n  setOpen: (open: boolean) => void\n  watchlist: Watchlist\n  buttonRef: RefObject<UploadInputRef | null>\n  isUploading: boolean\n  onDropFiles: (files: Array<File>) => void\n  uploadedData: WatchlistBatchSuggestionPostResponseExtended | null\n  error: Error | null\n}\n\nexport const WatchlistUploadModal = ({\n  onAdd,\n  open,\n  setOpen,\n  watchlist,\n  buttonRef,\n  isUploading,\n  onDropFiles,\n  uploadedData,\n  error,\n}: Props) => {\n  const { enqueueSuccess } = useSnackbar()\n  if (!open) return null\n  return (\n    <WatchlistUploadModalContainer\n      onSubmit={async (entities, stats) => {\n        const ids = entities.map(entity => entity?.key ?? \"\")\n        setOpen(false)\n        const updatedWatchlist = await onAdd(entities)\n        if (ids.length > 0) {\n          enqueueSuccess(\n            <Box>\n              {ids.length} {ids.length === 1 ? \"entity was\" : \"entities were\"} added to{\" \"}\n              <Box component=\"span\" fontWeight={700}>\n                {watchlist.name}\n              </Box>\n              .\n            </Box>,\n          )\n        }\n        if (!uploadedData) return\n        if (!updatedWatchlist) return\n        watchlistCustomerIo.uploadModal.sendSubmit({\n          watchlistId: updatedWatchlist.id,\n          previousItems: watchlist.items.length,\n          submitted: uploadedData.submitted,\n          conflicts: uploadedData.submitted - uploadedData.matched,\n          conflictsUnresolved: stats.conflicts.unresolved,\n          conflictsResolved: stats.conflicts.resolved,\n          conflictsDeleted: stats.conflicts.deleted,\n          matched: uploadedData.matched,\n          matchedUnmodified: stats.matched.unmodified,\n          matchedModified: stats.matched.modified,\n          matchedDeleted: stats.matched.deleted,\n          addedItems: ids.length,\n        })\n        watchlistCustomerIo.uploadModal.reset()\n      }}\n      watchlist={watchlist}\n      error={error}\n      onBrowse={() => {\n        buttonRef.current?.open().then(() => {\n          watchlistCustomerIo.uploadModal.setUploadMethod(\"browseFromModal\")\n        })\n      }}\n      isUploading={isUploading}\n      open={open}\n      onClose={() => {\n        watchlistCustomerIo.uploadModal.sendCancel({\n          submitted: uploadedData ? uploadedData.submitted : undefined,\n          conflicts: uploadedData ? uploadedData.submitted - uploadedData.matched : undefined,\n          matched: uploadedData ? uploadedData.matched : undefined,\n          previousItems: watchlist.items.length,\n          watchlistId: watchlist.id,\n        })\n        watchlistCustomerIo.uploadModal.reset()\n        setOpen(false)\n      }}\n      onDropFiles={onDropFiles}\n      data={uploadedData}\n      onFilesRejected={({ error }) => {\n        watchlistCustomerIo.uploadModal.setUploadMethod(\"dropOnModal\")\n        watchlistCustomerIo.uploadModal.sendError(watchlist.id, error)\n      }}\n    />\n  )\n}\n"],"names":["WatchlistUploadModal","onAdd","open","setOpen","watchlist","buttonRef","isUploading","onDropFiles","uploadedData","error","enqueueSuccess","useSnackbar","WatchlistUploadModalContainer","onSubmit","entities","stats","ids","map","entity","key","updatedWatchlist","length","Box","component","fontWeight","name","watchlistCustomerIo","uploadModal","sendSubmit","watchlistId","id","previousItems","items","submitted","conflicts","matched","conflictsUnresolved","unresolved","conflictsResolved","resolved","conflictsDeleted","deleted","matchedUnmodified","unmodified","matchedModified","modified","matchedDeleted","addedItems","reset","onBrowse","current","then","setUploadMethod","onClose","sendCancel","undefined","data","onFilesRejected","sendError"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAwBaA;;;eAAAA;;;;4BAtBuB;2BAMR;sBACR;+CAC0B;AAcvC,MAAMA,uBAAuB,CAAC,EACnCC,KAAK,EACLC,IAAI,EACJC,OAAO,EACPC,SAAS,EACTC,SAAS,EACTC,WAAW,EACXC,WAAW,EACXC,YAAY,EACZC,KAAK,EACC;IACN,MAAM,EAAEC,cAAc,EAAE,GAAGC,IAAAA,sBAAW;IACtC,IAAI,CAACT,MAAM,OAAO;IAClB,qBACE,qBAACU,4DAA6B;QAC5BC,UAAU,OAAOC,UAAUC;YACzB,MAAMC,MAAMF,SAASG,GAAG,CAACC,CAAAA;oBAAUA;uBAAAA,CAAAA,cAAAA,mBAAAA,6BAAAA,OAAQC,GAAG,cAAXD,yBAAAA,cAAe;YAAC;YACnDf,QAAQ;YACR,MAAMiB,mBAAmB,MAAMnB,MAAMa;YACrC,IAAIE,IAAIK,MAAM,GAAG,GAAG;gBAClBX,6BACE,sBAACY,SAAG;;wBACDN,IAAIK,MAAM;wBAAC;wBAAEL,IAAIK,MAAM,KAAK,IAAI,eAAe;wBAAgB;wBAAU;sCAC1E,qBAACC,SAAG;4BAACC,WAAU;4BAAOC,YAAY;sCAC/BpB,UAAUqB,IAAI;;wBACX;;;YAIZ;YACA,IAAI,CAACjB,cAAc;YACnB,IAAI,CAACY,kBAAkB;YACvBM,+BAAmB,CAACC,WAAW,CAACC,UAAU,CAAC;gBACzCC,aAAaT,iBAAiBU,EAAE;gBAChCC,eAAe3B,UAAU4B,KAAK,CAACX,MAAM;gBACrCY,WAAWzB,aAAayB,SAAS;gBACjCC,WAAW1B,aAAayB,SAAS,GAAGzB,aAAa2B,OAAO;gBACxDC,qBAAqBrB,MAAMmB,SAAS,CAACG,UAAU;gBAC/CC,mBAAmBvB,MAAMmB,SAAS,CAACK,QAAQ;gBAC3CC,kBAAkBzB,MAAMmB,SAAS,CAACO,OAAO;gBACzCN,SAAS3B,aAAa2B,OAAO;gBAC7BO,mBAAmB3B,MAAMoB,OAAO,CAACQ,UAAU;gBAC3CC,iBAAiB7B,MAAMoB,OAAO,CAACU,QAAQ;gBACvCC,gBAAgB/B,MAAMoB,OAAO,CAACM,OAAO;gBACrCM,YAAY/B,IAAIK,MAAM;YACxB;YACAK,+BAAmB,CAACC,WAAW,CAACqB,KAAK;QACvC;QACA5C,WAAWA;QACXK,OAAOA;QACPwC,UAAU;gBACR5C;aAAAA,qBAAAA,UAAU6C,OAAO,cAAjB7C,yCAAAA,mBAAmBH,IAAI,GAAGiD,IAAI,CAAC;gBAC7BzB,+BAAmB,CAACC,WAAW,CAACyB,eAAe,CAAC;YAClD;QACF;QACA9C,aAAaA;QACbJ,MAAMA;QACNmD,SAAS;YACP3B,+BAAmB,CAACC,WAAW,CAAC2B,UAAU,CAAC;gBACzCrB,WAAWzB,eAAeA,aAAayB,SAAS,GAAGsB;gBACnDrB,WAAW1B,eAAeA,aAAayB,SAAS,GAAGzB,aAAa2B,OAAO,GAAGoB;gBAC1EpB,SAAS3B,eAAeA,aAAa2B,OAAO,GAAGoB;gBAC/CxB,eAAe3B,UAAU4B,KAAK,CAACX,MAAM;gBACrCQ,aAAazB,UAAU0B,EAAE;YAC3B;YACAJ,+BAAmB,CAACC,WAAW,CAACqB,KAAK;YACrC7C,QAAQ;QACV;QACAI,aAAaA;QACbiD,MAAMhD;QACNiD,iBAAiB,CAAC,EAAEhD,KAAK,EAAE;YACzBiB,+BAAmB,CAACC,WAAW,CAACyB,eAAe,CAAC;YAChD1B,+BAAmB,CAACC,WAAW,CAAC+B,SAAS,CAACtD,UAAU0B,EAAE,EAAErB;QAC1D;;AAGN"}
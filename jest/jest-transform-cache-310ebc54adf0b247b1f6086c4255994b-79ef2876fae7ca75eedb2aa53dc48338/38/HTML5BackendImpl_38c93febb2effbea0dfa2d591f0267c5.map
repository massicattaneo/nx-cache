{"version":3,"sources":["../src/HTML5BackendImpl.ts"],"sourcesContent":["import type {\n\tBackend,\n\tDragDropActions,\n\tDragDropManager,\n\tDragDropMonitor,\n\tHandlerRegistry,\n\tIdentifier,\n\tUnsubscribe,\n\tXYCoord,\n} from 'dnd-core'\n\nimport { EnterLeaveCounter } from './EnterLeaveCounter.js'\nimport {\n\tcreateNativeDragSource,\n\tmatchNativeItemType,\n} from './NativeDragSources/index.js'\nimport type { NativeDragSource } from './NativeDragSources/NativeDragSource.js'\nimport * as NativeTypes from './NativeTypes.js'\nimport {\n\tgetDragPreviewOffset,\n\tgetEventClientOffset,\n\tgetNodeClientOffset,\n} from './OffsetUtils.js'\nimport { OptionsReader } from './OptionsReader.js'\nimport type { HTML5BackendContext, HTML5BackendOptions } from './types.js'\n\ntype RootNode = Node & { __isReactDndBackendSetUp: boolean | undefined }\n\nexport class HTML5BackendImpl implements Backend {\n\tprivate options: OptionsReader\n\n\t// React-Dnd Components\n\tprivate actions: DragDropActions\n\tprivate monitor: DragDropMonitor\n\tprivate registry: HandlerRegistry\n\n\t// Internal State\n\tprivate enterLeaveCounter: EnterLeaveCounter\n\n\tprivate sourcePreviewNodes: Map<string, Element> = new Map()\n\tprivate sourcePreviewNodeOptions: Map<string, any> = new Map()\n\tprivate sourceNodes: Map<string, Element> = new Map()\n\tprivate sourceNodeOptions: Map<string, any> = new Map()\n\n\tprivate dragStartSourceIds: string[] | null = null\n\tprivate dropTargetIds: string[] = []\n\tprivate dragEnterTargetIds: string[] = []\n\tprivate currentNativeSource: NativeDragSource | null = null\n\tprivate currentNativeHandle: Identifier | null = null\n\tprivate currentDragSourceNode: Element | null = null\n\tprivate altKeyPressed = false\n\tprivate mouseMoveTimeoutTimer: number | null = null\n\tprivate asyncEndDragFrameId: number | null = null\n\tprivate dragOverTargetIds: string[] | null = null\n\n\tprivate lastClientOffset: XYCoord | null = null\n\tprivate hoverRafId: number | null = null\n\n\tpublic constructor(\n\t\tmanager: DragDropManager,\n\t\tglobalContext?: HTML5BackendContext,\n\t\toptions?: HTML5BackendOptions,\n\t) {\n\t\tthis.options = new OptionsReader(globalContext, options)\n\t\tthis.actions = manager.getActions()\n\t\tthis.monitor = manager.getMonitor()\n\t\tthis.registry = manager.getRegistry()\n\t\tthis.enterLeaveCounter = new EnterLeaveCounter(this.isNodeInDocument)\n\t}\n\n\t/**\n\t * Generate profiling statistics for the HTML5Backend.\n\t */\n\tpublic profile(): Record<string, number> {\n\t\treturn {\n\t\t\tsourcePreviewNodes: this.sourcePreviewNodes.size,\n\t\t\tsourcePreviewNodeOptions: this.sourcePreviewNodeOptions.size,\n\t\t\tsourceNodeOptions: this.sourceNodeOptions.size,\n\t\t\tsourceNodes: this.sourceNodes.size,\n\t\t\tdragStartSourceIds: this.dragStartSourceIds?.length || 0,\n\t\t\tdropTargetIds: this.dropTargetIds.length,\n\t\t\tdragEnterTargetIds: this.dragEnterTargetIds.length,\n\t\t\tdragOverTargetIds: this.dragOverTargetIds?.length || 0,\n\t\t}\n\t}\n\n\t// public for test\n\tpublic get window(): Window | undefined {\n\t\treturn this.options.window\n\t}\n\tpublic get document(): Document | undefined {\n\t\treturn this.options.document\n\t}\n\t/**\n\t * Get the root element to use for event subscriptions\n\t */\n\tprivate get rootElement(): Node | undefined {\n\t\treturn this.options.rootElement as Node\n\t}\n\n\tpublic setup(): void {\n\t\tconst root = this.rootElement as RootNode | undefined\n\t\tif (root === undefined) {\n\t\t\treturn\n\t\t}\n\n\t\tif (root.__isReactDndBackendSetUp) {\n\t\t\tthrow new Error('Cannot have two HTML5 backends at the same time.')\n\t\t}\n\t\troot.__isReactDndBackendSetUp = true\n\t\tthis.addEventListeners(root)\n\t}\n\n\tpublic teardown(): void {\n\t\tconst root = this.rootElement as RootNode\n\t\tif (root === undefined) {\n\t\t\treturn\n\t\t}\n\n\t\troot.__isReactDndBackendSetUp = false\n\t\tthis.removeEventListeners(this.rootElement as Element)\n\t\tthis.clearCurrentDragSourceNode()\n\t\tif (this.asyncEndDragFrameId) {\n\t\t\tthis.window?.cancelAnimationFrame(this.asyncEndDragFrameId)\n\t\t}\n\t}\n\n\tpublic connectDragPreview(\n\t\tsourceId: string,\n\t\tnode: Element,\n\t\toptions: any,\n\t): Unsubscribe {\n\t\tthis.sourcePreviewNodeOptions.set(sourceId, options)\n\t\tthis.sourcePreviewNodes.set(sourceId, node)\n\n\t\treturn (): void => {\n\t\t\tthis.sourcePreviewNodes.delete(sourceId)\n\t\t\tthis.sourcePreviewNodeOptions.delete(sourceId)\n\t\t}\n\t}\n\n\tpublic connectDragSource(\n\t\tsourceId: string,\n\t\tnode: Element,\n\t\toptions: any,\n\t): Unsubscribe {\n\t\tthis.sourceNodes.set(sourceId, node)\n\t\tthis.sourceNodeOptions.set(sourceId, options)\n\n\t\tconst handleDragStart = (e: any) => this.handleDragStart(e, sourceId)\n\t\tconst handleSelectStart = (e: any) => this.handleSelectStart(e)\n\n\t\tnode.setAttribute('draggable', 'true')\n\t\tnode.addEventListener('dragstart', handleDragStart)\n\t\tnode.addEventListener('selectstart', handleSelectStart)\n\n\t\treturn (): void => {\n\t\t\tthis.sourceNodes.delete(sourceId)\n\t\t\tthis.sourceNodeOptions.delete(sourceId)\n\n\t\t\tnode.removeEventListener('dragstart', handleDragStart)\n\t\t\tnode.removeEventListener('selectstart', handleSelectStart)\n\t\t\tnode.setAttribute('draggable', 'false')\n\t\t}\n\t}\n\n\tpublic connectDropTarget(targetId: string, node: HTMLElement): Unsubscribe {\n\t\tconst handleDragEnter = (e: DragEvent) => this.handleDragEnter(e, targetId)\n\t\tconst handleDragOver = (e: DragEvent) => this.handleDragOver(e, targetId)\n\t\tconst handleDrop = (e: DragEvent) => this.handleDrop(e, targetId)\n\n\t\tnode.addEventListener('dragenter', handleDragEnter)\n\t\tnode.addEventListener('dragover', handleDragOver)\n\t\tnode.addEventListener('drop', handleDrop)\n\n\t\treturn (): void => {\n\t\t\tnode.removeEventListener('dragenter', handleDragEnter)\n\t\t\tnode.removeEventListener('dragover', handleDragOver)\n\t\t\tnode.removeEventListener('drop', handleDrop)\n\t\t}\n\t}\n\n\tprivate addEventListeners(target: Node) {\n\t\t// SSR Fix (https://github.com/react-dnd/react-dnd/pull/813\n\t\tif (!target.addEventListener) {\n\t\t\treturn\n\t\t}\n\t\ttarget.addEventListener(\n\t\t\t'dragstart',\n\t\t\tthis.handleTopDragStart as EventListener,\n\t\t)\n\t\ttarget.addEventListener('dragstart', this.handleTopDragStartCapture, true)\n\t\ttarget.addEventListener('dragend', this.handleTopDragEndCapture, true)\n\t\ttarget.addEventListener(\n\t\t\t'dragenter',\n\t\t\tthis.handleTopDragEnter as EventListener,\n\t\t)\n\t\ttarget.addEventListener(\n\t\t\t'dragenter',\n\t\t\tthis.handleTopDragEnterCapture as EventListener,\n\t\t\ttrue,\n\t\t)\n\t\ttarget.addEventListener(\n\t\t\t'dragleave',\n\t\t\tthis.handleTopDragLeaveCapture as EventListener,\n\t\t\ttrue,\n\t\t)\n\t\ttarget.addEventListener('dragover', this.handleTopDragOver as EventListener)\n\t\ttarget.addEventListener(\n\t\t\t'dragover',\n\t\t\tthis.handleTopDragOverCapture as EventListener,\n\t\t\ttrue,\n\t\t)\n\t\ttarget.addEventListener('drop', this.handleTopDrop as EventListener)\n\t\ttarget.addEventListener(\n\t\t\t'drop',\n\t\t\tthis.handleTopDropCapture as EventListener,\n\t\t\ttrue,\n\t\t)\n\t}\n\n\tprivate removeEventListeners(target: Node) {\n\t\t// SSR Fix (https://github.com/react-dnd/react-dnd/pull/813\n\t\tif (!target.removeEventListener) {\n\t\t\treturn\n\t\t}\n\t\ttarget.removeEventListener('dragstart', this.handleTopDragStart as any)\n\t\ttarget.removeEventListener(\n\t\t\t'dragstart',\n\t\t\tthis.handleTopDragStartCapture,\n\t\t\ttrue,\n\t\t)\n\t\ttarget.removeEventListener('dragend', this.handleTopDragEndCapture, true)\n\t\ttarget.removeEventListener(\n\t\t\t'dragenter',\n\t\t\tthis.handleTopDragEnter as EventListener,\n\t\t)\n\t\ttarget.removeEventListener(\n\t\t\t'dragenter',\n\t\t\tthis.handleTopDragEnterCapture as EventListener,\n\t\t\ttrue,\n\t\t)\n\t\ttarget.removeEventListener(\n\t\t\t'dragleave',\n\t\t\tthis.handleTopDragLeaveCapture as EventListener,\n\t\t\ttrue,\n\t\t)\n\t\ttarget.removeEventListener(\n\t\t\t'dragover',\n\t\t\tthis.handleTopDragOver as EventListener,\n\t\t)\n\t\ttarget.removeEventListener(\n\t\t\t'dragover',\n\t\t\tthis.handleTopDragOverCapture as EventListener,\n\t\t\ttrue,\n\t\t)\n\t\ttarget.removeEventListener('drop', this.handleTopDrop as EventListener)\n\t\ttarget.removeEventListener(\n\t\t\t'drop',\n\t\t\tthis.handleTopDropCapture as EventListener,\n\t\t\ttrue,\n\t\t)\n\t}\n\n\tprivate getCurrentSourceNodeOptions() {\n\t\tconst sourceId = this.monitor.getSourceId() as string\n\t\tconst sourceNodeOptions = this.sourceNodeOptions.get(sourceId)\n\n\t\treturn {\n\t\t\tdropEffect: this.altKeyPressed ? 'copy' : 'move',\n\t\t\t...(sourceNodeOptions || {}),\n\t\t}\n\t}\n\n\tprivate getCurrentDropEffect() {\n\t\tif (this.isDraggingNativeItem()) {\n\t\t\t// It makes more sense to default to 'copy' for native resources\n\t\t\treturn 'copy'\n\t\t}\n\n\t\treturn this.getCurrentSourceNodeOptions().dropEffect\n\t}\n\n\tprivate getCurrentSourcePreviewNodeOptions() {\n\t\tconst sourceId = this.monitor.getSourceId() as string\n\t\tconst sourcePreviewNodeOptions = this.sourcePreviewNodeOptions.get(sourceId)\n\n\t\treturn {\n\t\t\tanchorX: 0.5,\n\t\t\tanchorY: 0.5,\n\t\t\tcaptureDraggingState: false,\n\t\t\t...(sourcePreviewNodeOptions || {}),\n\t\t}\n\t}\n\n\tprivate getSourceClientOffset = (sourceId: string): XYCoord | null => {\n\t\tconst source = this.sourceNodes.get(sourceId)\n\t\treturn (source && getNodeClientOffset(source as HTMLElement)) || null\n\t}\n\n\tprivate isDraggingNativeItem() {\n\t\tconst itemType = this.monitor.getItemType()\n\t\treturn Object.keys(NativeTypes).some(\n\t\t\t(key: string) => (NativeTypes as any)[key] === itemType,\n\t\t)\n\t}\n\n\tprivate beginDragNativeItem(type: string, dataTransfer?: DataTransfer) {\n\t\tthis.clearCurrentDragSourceNode()\n\n\t\tthis.currentNativeSource = createNativeDragSource(type, dataTransfer)\n\t\tthis.currentNativeHandle = this.registry.addSource(\n\t\t\ttype,\n\t\t\tthis.currentNativeSource,\n\t\t)\n\t\tthis.actions.beginDrag([this.currentNativeHandle])\n\t}\n\n\tprivate endDragNativeItem = (): void => {\n\t\tif (!this.isDraggingNativeItem()) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.actions.endDrag()\n\t\tif (this.currentNativeHandle) {\n\t\t\tthis.registry.removeSource(this.currentNativeHandle)\n\t\t}\n\t\tthis.currentNativeHandle = null\n\t\tthis.currentNativeSource = null\n\t}\n\n\tprivate isNodeInDocument = (node: Node | null | undefined): boolean => {\n\t\t// Check the node either in the main document or in the current context\n\t\treturn Boolean(\n\t\t\tnode &&\n\t\t\t\tthis.document &&\n\t\t\t\tthis.document.body &&\n\t\t\t\tthis.document.body.contains(node),\n\t\t)\n\t}\n\n\tprivate endDragIfSourceWasRemovedFromDOM = (): void => {\n\t\tconst node = this.currentDragSourceNode\n\t\tif (node == null || this.isNodeInDocument(node)) {\n\t\t\treturn\n\t\t}\n\n\t\tif (this.clearCurrentDragSourceNode() && this.monitor.isDragging()) {\n\t\t\tthis.actions.endDrag()\n\t\t}\n\t\tthis.cancelHover()\n\t}\n\n\tprivate setCurrentDragSourceNode(node: Element | null) {\n\t\tthis.clearCurrentDragSourceNode()\n\t\tthis.currentDragSourceNode = node\n\n\t\t// A timeout of > 0 is necessary to resolve Firefox issue referenced\n\t\t// See:\n\t\t//   * https://github.com/react-dnd/react-dnd/pull/928\n\t\t//   * https://github.com/react-dnd/react-dnd/issues/869\n\t\tconst MOUSE_MOVE_TIMEOUT = 1000\n\n\t\t// Receiving a mouse event in the middle of a dragging operation\n\t\t// means it has ended and the drag source node disappeared from DOM,\n\t\t// so the browser didn't dispatch the dragend event.\n\t\t//\n\t\t// We need to wait before we start listening for mousemove events.\n\t\t// This is needed because the drag preview needs to be drawn or else it fires an 'mousemove' event\n\t\t// immediately in some browsers.\n\t\t//\n\t\t// See:\n\t\t//   * https://github.com/react-dnd/react-dnd/pull/928\n\t\t//   * https://github.com/react-dnd/react-dnd/issues/869\n\t\t//\n\t\tthis.mouseMoveTimeoutTimer = setTimeout(() => {\n\t\t\treturn this.rootElement?.addEventListener(\n\t\t\t\t'mousemove',\n\t\t\t\tthis.endDragIfSourceWasRemovedFromDOM,\n\t\t\t\ttrue,\n\t\t\t)\n\t\t}, MOUSE_MOVE_TIMEOUT) as any as number\n\t}\n\n\tprivate clearCurrentDragSourceNode() {\n\t\tif (this.currentDragSourceNode) {\n\t\t\tthis.currentDragSourceNode = null\n\n\t\t\tif (this.rootElement) {\n\t\t\t\tthis.window?.clearTimeout(this.mouseMoveTimeoutTimer || undefined)\n\t\t\t\tthis.rootElement.removeEventListener(\n\t\t\t\t\t'mousemove',\n\t\t\t\t\tthis.endDragIfSourceWasRemovedFromDOM,\n\t\t\t\t\ttrue,\n\t\t\t\t)\n\t\t\t}\n\n\t\t\tthis.mouseMoveTimeoutTimer = null\n\t\t\treturn true\n\t\t}\n\n\t\treturn false\n\t}\n\n\tprivate scheduleHover = (dragOverTargetIds: string[] | null) => {\n\t\tif (\n\t\t\tthis.hoverRafId === null &&\n\t\t\ttypeof requestAnimationFrame !== 'undefined'\n\t\t) {\n\t\t\tthis.hoverRafId = requestAnimationFrame(() => {\n\t\t\t\tif (this.monitor.isDragging()) {\n\t\t\t\t\tthis.actions.hover(dragOverTargetIds || [], {\n\t\t\t\t\t\tclientOffset: this.lastClientOffset,\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tthis.hoverRafId = null\n\t\t\t})\n\t\t}\n\t}\n\n\tprivate cancelHover = () => {\n\t\tif (\n\t\t\tthis.hoverRafId !== null &&\n\t\t\ttypeof cancelAnimationFrame !== 'undefined'\n\t\t) {\n\t\t\tcancelAnimationFrame(this.hoverRafId)\n\t\t\tthis.hoverRafId = null\n\t\t}\n\t}\n\n\tpublic handleTopDragStartCapture = (): void => {\n\t\tthis.clearCurrentDragSourceNode()\n\t\tthis.dragStartSourceIds = []\n\t}\n\n\tpublic handleDragStart(e: DragEvent, sourceId: string): void {\n\t\tif (e.defaultPrevented) {\n\t\t\treturn\n\t\t}\n\n\t\tif (!this.dragStartSourceIds) {\n\t\t\tthis.dragStartSourceIds = []\n\t\t}\n\t\tthis.dragStartSourceIds.unshift(sourceId)\n\t}\n\n\tpublic handleTopDragStart = (e: DragEvent): void => {\n\t\tif (e.defaultPrevented) {\n\t\t\treturn\n\t\t}\n\n\t\tconst { dragStartSourceIds } = this\n\t\tthis.dragStartSourceIds = null\n\n\t\tconst clientOffset = getEventClientOffset(e)\n\n\t\t// Avoid crashing if we missed a drop event or our previous drag died\n\t\tif (this.monitor.isDragging()) {\n\t\t\tthis.actions.endDrag()\n\t\t\tthis.cancelHover()\n\t\t}\n\n\t\t// Don't publish the source just yet (see why below)\n\t\tthis.actions.beginDrag(dragStartSourceIds || [], {\n\t\t\tpublishSource: false,\n\t\t\tgetSourceClientOffset: this.getSourceClientOffset,\n\t\t\tclientOffset,\n\t\t})\n\n\t\tconst { dataTransfer } = e\n\t\tconst nativeType = matchNativeItemType(dataTransfer)\n\n\t\tif (this.monitor.isDragging()) {\n\t\t\tif (dataTransfer && typeof dataTransfer.setDragImage === 'function') {\n\t\t\t\t// Use custom drag image if user specifies it.\n\t\t\t\t// If child drag source refuses drag but parent agrees,\n\t\t\t\t// use parent's node as drag image. Neither works in IE though.\n\t\t\t\tconst sourceId: string = this.monitor.getSourceId() as string\n\t\t\t\tconst sourceNode = this.sourceNodes.get(sourceId)\n\t\t\t\tconst dragPreview = this.sourcePreviewNodes.get(sourceId) || sourceNode\n\n\t\t\t\tif (dragPreview) {\n\t\t\t\t\tconst { anchorX, anchorY, offsetX, offsetY } =\n\t\t\t\t\t\tthis.getCurrentSourcePreviewNodeOptions()\n\t\t\t\t\tconst anchorPoint = { anchorX, anchorY }\n\t\t\t\t\tconst offsetPoint = { offsetX, offsetY }\n\t\t\t\t\tconst dragPreviewOffset = getDragPreviewOffset(\n\t\t\t\t\t\tsourceNode as HTMLElement,\n\t\t\t\t\t\tdragPreview as HTMLElement,\n\t\t\t\t\t\tclientOffset,\n\t\t\t\t\t\tanchorPoint,\n\t\t\t\t\t\toffsetPoint,\n\t\t\t\t\t)\n\n\t\t\t\t\tdataTransfer.setDragImage(\n\t\t\t\t\t\tdragPreview,\n\t\t\t\t\t\tdragPreviewOffset.x,\n\t\t\t\t\t\tdragPreviewOffset.y,\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\t// Firefox won't drag without setting data\n\t\t\t\tdataTransfer?.setData('application/json', {} as any)\n\t\t\t} catch (err) {\n\t\t\t\t// IE doesn't support MIME types in setData\n\t\t\t}\n\n\t\t\t// Store drag source node so we can check whether\n\t\t\t// it is removed from DOM and trigger endDrag manually.\n\t\t\tthis.setCurrentDragSourceNode(e.target as Element)\n\n\t\t\t// Now we are ready to publish the drag source.. or are we not?\n\t\t\tconst { captureDraggingState } = this.getCurrentSourcePreviewNodeOptions()\n\t\t\tif (!captureDraggingState) {\n\t\t\t\t// Usually we want to publish it in the next tick so that browser\n\t\t\t\t// is able to screenshot the current (not yet dragging) state.\n\t\t\t\t//\n\t\t\t\t// It also neatly avoids a situation where render() returns null\n\t\t\t\t// in the same tick for the source element, and browser freaks out.\n\t\t\t\tsetTimeout(() => this.actions.publishDragSource(), 0)\n\t\t\t} else {\n\t\t\t\t// In some cases the user may want to override this behavior, e.g.\n\t\t\t\t// to work around IE not supporting custom drag previews.\n\t\t\t\t//\n\t\t\t\t// When using a custom drag layer, the only way to prevent\n\t\t\t\t// the default drag preview from drawing in IE is to screenshot\n\t\t\t\t// the dragging state in which the node itself has zero opacity\n\t\t\t\t// and height. In this case, though, returning null from render()\n\t\t\t\t// will abruptly end the dragging, which is not obvious.\n\t\t\t\t//\n\t\t\t\t// This is the reason such behavior is strictly opt-in.\n\t\t\t\tthis.actions.publishDragSource()\n\t\t\t}\n\t\t} else if (nativeType) {\n\t\t\t// A native item (such as URL) dragged from inside the document\n\t\t\tthis.beginDragNativeItem(nativeType)\n\t\t} else if (\n\t\t\tdataTransfer &&\n\t\t\t!dataTransfer.types &&\n\t\t\t((e.target && !(e.target as Element).hasAttribute) ||\n\t\t\t\t!(e.target as Element).hasAttribute('draggable'))\n\t\t) {\n\t\t\t// Looks like a Safari bug: dataTransfer.types is null, but there was no draggable.\n\t\t\t// Just let it drag. It's a native type (URL or text) and will be picked up in\n\t\t\t// dragenter handler.\n\t\t\treturn\n\t\t} else {\n\t\t\t// If by this time no drag source reacted, tell browser not to drag.\n\t\t\te.preventDefault()\n\t\t}\n\t}\n\n\tpublic handleTopDragEndCapture = (): void => {\n\t\tif (this.clearCurrentDragSourceNode() && this.monitor.isDragging()) {\n\t\t\t// Firefox can dispatch this event in an infinite loop\n\t\t\t// if dragend handler does something like showing an alert.\n\t\t\t// Only proceed if we have not handled it already.\n\t\t\tthis.actions.endDrag()\n\t\t}\n\t\tthis.cancelHover()\n\t}\n\n\tpublic handleTopDragEnterCapture = (e: DragEvent): void => {\n\t\tthis.dragEnterTargetIds = []\n\n\t\tif (this.isDraggingNativeItem()) {\n\t\t\tthis.currentNativeSource?.loadDataTransfer(e.dataTransfer)\n\t\t}\n\n\t\tconst isFirstEnter = this.enterLeaveCounter.enter(e.target)\n\t\tif (!isFirstEnter || this.monitor.isDragging()) {\n\t\t\treturn\n\t\t}\n\n\t\tconst { dataTransfer } = e\n\t\tconst nativeType = matchNativeItemType(dataTransfer)\n\n\t\tif (nativeType) {\n\t\t\t// A native item (such as file or URL) dragged from outside the document\n\t\t\tthis.beginDragNativeItem(nativeType, dataTransfer as DataTransfer)\n\t\t}\n\t}\n\n\tpublic handleDragEnter(_e: DragEvent, targetId: string): void {\n\t\tthis.dragEnterTargetIds.unshift(targetId)\n\t}\n\n\tpublic handleTopDragEnter = (e: DragEvent): void => {\n\t\tconst { dragEnterTargetIds } = this\n\t\tthis.dragEnterTargetIds = []\n\n\t\tif (!this.monitor.isDragging()) {\n\t\t\t// This is probably a native item type we don't understand.\n\t\t\treturn\n\t\t}\n\n\t\tthis.altKeyPressed = e.altKey\n\n\t\t// If the target changes position as the result of `dragenter`, `dragover` might still\n\t\t// get dispatched despite target being no longer there. The easy solution is to check\n\t\t// whether there actually is a target before firing `hover`.\n\t\tif (dragEnterTargetIds.length > 0) {\n\t\t\tthis.actions.hover(dragEnterTargetIds, {\n\t\t\t\tclientOffset: getEventClientOffset(e),\n\t\t\t})\n\t\t}\n\n\t\tconst canDrop = dragEnterTargetIds.some((targetId) =>\n\t\t\tthis.monitor.canDropOnTarget(targetId),\n\t\t)\n\n\t\tif (canDrop) {\n\t\t\t// IE requires this to fire dragover events\n\t\t\te.preventDefault()\n\t\t\tif (e.dataTransfer) {\n\t\t\t\te.dataTransfer.dropEffect = this.getCurrentDropEffect()\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic handleTopDragOverCapture = (e: DragEvent): void => {\n\t\tthis.dragOverTargetIds = []\n\n\t\tif (this.isDraggingNativeItem()) {\n\t\t\tthis.currentNativeSource?.loadDataTransfer(e.dataTransfer)\n\t\t}\n\t}\n\n\tpublic handleDragOver(_e: DragEvent, targetId: string): void {\n\t\tif (this.dragOverTargetIds === null) {\n\t\t\tthis.dragOverTargetIds = []\n\t\t}\n\t\tthis.dragOverTargetIds.unshift(targetId)\n\t}\n\n\tpublic handleTopDragOver = (e: DragEvent): void => {\n\t\tconst { dragOverTargetIds } = this\n\t\tthis.dragOverTargetIds = []\n\n\t\tif (!this.monitor.isDragging()) {\n\t\t\t// This is probably a native item type we don't understand.\n\t\t\t// Prevent default \"drop and blow away the whole document\" action.\n\t\t\te.preventDefault()\n\t\t\tif (e.dataTransfer) {\n\t\t\t\te.dataTransfer.dropEffect = 'none'\n\t\t\t}\n\t\t\treturn\n\t\t}\n\n\t\tthis.altKeyPressed = e.altKey\n\t\tthis.lastClientOffset = getEventClientOffset(e)\n\n\t\tthis.scheduleHover(dragOverTargetIds)\n\n\t\tconst canDrop = (dragOverTargetIds || []).some((targetId) =>\n\t\t\tthis.monitor.canDropOnTarget(targetId),\n\t\t)\n\n\t\tif (canDrop) {\n\t\t\t// Show user-specified drop effect.\n\t\t\te.preventDefault()\n\t\t\tif (e.dataTransfer) {\n\t\t\t\te.dataTransfer.dropEffect = this.getCurrentDropEffect()\n\t\t\t}\n\t\t} else if (this.isDraggingNativeItem()) {\n\t\t\t// Don't show a nice cursor but still prevent default\n\t\t\t// \"drop and blow away the whole document\" action.\n\t\t\te.preventDefault()\n\t\t} else {\n\t\t\te.preventDefault()\n\t\t\tif (e.dataTransfer) {\n\t\t\t\te.dataTransfer.dropEffect = 'none'\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic handleTopDragLeaveCapture = (e: DragEvent): void => {\n\t\tif (this.isDraggingNativeItem()) {\n\t\t\te.preventDefault()\n\t\t}\n\n\t\tconst isLastLeave = this.enterLeaveCounter.leave(e.target)\n\t\tif (!isLastLeave) {\n\t\t\treturn\n\t\t}\n\n\t\tif (this.isDraggingNativeItem()) {\n\t\t\tsetTimeout(() => this.endDragNativeItem(), 0)\n\t\t}\n\t\tthis.cancelHover()\n\t}\n\n\tpublic handleTopDropCapture = (e: DragEvent): void => {\n\t\tthis.dropTargetIds = []\n\n\t\tif (this.isDraggingNativeItem()) {\n\t\t\te.preventDefault()\n\t\t\tthis.currentNativeSource?.loadDataTransfer(e.dataTransfer)\n\t\t} else if (matchNativeItemType(e.dataTransfer)) {\n\t\t\t// Dragging some elements, like <a> and <img> may still behave like a native drag event,\n\t\t\t// even if the current drag event matches a user-defined type.\n\t\t\t// Stop the default behavior when we're not expecting a native item to be dropped.\n\n\t\t\te.preventDefault()\n\t\t}\n\n\t\tthis.enterLeaveCounter.reset()\n\t}\n\n\tpublic handleDrop(_e: DragEvent, targetId: string): void {\n\t\tthis.dropTargetIds.unshift(targetId)\n\t}\n\n\tpublic handleTopDrop = (e: DragEvent): void => {\n\t\tconst { dropTargetIds } = this\n\t\tthis.dropTargetIds = []\n\n\t\tthis.actions.hover(dropTargetIds, {\n\t\t\tclientOffset: getEventClientOffset(e),\n\t\t})\n\t\tthis.actions.drop({ dropEffect: this.getCurrentDropEffect() })\n\n\t\tif (this.isDraggingNativeItem()) {\n\t\t\tthis.endDragNativeItem()\n\t\t} else if (this.monitor.isDragging()) {\n\t\t\tthis.actions.endDrag()\n\t\t}\n\t\tthis.cancelHover()\n\t}\n\n\tpublic handleSelectStart = (e: DragEvent): void => {\n\t\tconst target = e.target as HTMLElement & { dragDrop: () => void }\n\n\t\t// Only IE requires us to explicitly say\n\t\t// we want drag drop operation to start\n\t\tif (typeof target.dragDrop !== 'function') {\n\t\t\treturn\n\t\t}\n\n\t\t// Inputs and textareas should be selectable\n\t\tif (\n\t\t\ttarget.tagName === 'INPUT' ||\n\t\t\ttarget.tagName === 'SELECT' ||\n\t\t\ttarget.tagName === 'TEXTAREA' ||\n\t\t\ttarget.isContentEditable\n\t\t) {\n\t\t\treturn\n\t\t}\n\n\t\t// For other targets, ask IE\n\t\t// to enable drag and drop\n\t\te.preventDefault()\n\t\ttarget.dragDrop()\n\t}\n}\n"],"names":["HTML5BackendImpl","_defineProperty","obj","key","value","profile","ref","ref1","sourcePreviewNodes","size","sourcePreviewNodeOptions","sourceNodeOptions","sourceNodes","dragStartSourceIds","length","dropTargetIds","dragEnterTargetIds","dragOverTargetIds","window","options","document","rootElement","setup","root","undefined","__isReactDndBackendSetUp","Error","addEventListeners","teardown","removeEventListeners","clearCurrentDragSourceNode","asyncEndDragFrameId","cancelAnimationFrame","connectDragPreview","sourceId","node","set","delete","connectDragSource","handleDragStart","e","handleSelectStart","setAttribute","addEventListener","removeEventListener","connectDropTarget","targetId","handleDragEnter","handleDragOver","handleDrop","target","handleTopDragStart","handleTopDragStartCapture","handleTopDragEndCapture","handleTopDragEnter","handleTopDragEnterCapture","handleTopDragLeaveCapture","handleTopDragOver","handleTopDragOverCapture","handleTopDrop","handleTopDropCapture","getCurrentSourceNodeOptions","monitor","getSourceId","get","_objectSpread","dropEffect","altKeyPressed","getCurrentDropEffect","isDraggingNativeItem","getCurrentSourcePreviewNodeOptions","anchorX","anchorY","captureDraggingState","itemType","getItemType","Object","keys","NativeTypes","some","beginDragNativeItem","type","dataTransfer","currentNativeSource","createNativeDragSource","currentNativeHandle","registry","addSource","actions","beginDrag","setCurrentDragSourceNode","currentDragSourceNode","MOUSE_MOVE_TIMEOUT","mouseMoveTimeoutTimer","setTimeout","endDragIfSourceWasRemovedFromDOM","clearTimeout","defaultPrevented","unshift","_e","constructor","manager","globalContext","Map","lastClientOffset","hoverRafId","getSourceClientOffset","source","getNodeClientOffset","endDragNativeItem","endDrag","removeSource","isNodeInDocument","Boolean","body","contains","isDragging","cancelHover","scheduleHover","requestAnimationFrame","hover","clientOffset","getEventClientOffset","publishSource","nativeType","matchNativeItemType","setDragImage","sourceNode","dragPreview","offsetX","offsetY","anchorPoint","offsetPoint","dragPreviewOffset","getDragPreviewOffset","x","y","setData","err","publishDragSource","types","hasAttribute","preventDefault","loadDataTransfer","isFirstEnter","enterLeaveCounter","enter","altKey","canDrop","canDropOnTarget","isLastLeave","leave","reset","drop","dragDrop","tagName","isContentEditable","OptionsReader","getActions","getMonitor","getRegistry","EnterLeaveCounter"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
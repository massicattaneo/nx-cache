{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/watchlists/src/lib/WatchlistUploadModal/WatchlistUploadData.tsx"],"sourcesContent":["import { useEffect, useMemo, useRef, useState } from \"react\"\nimport { Watchlist } from \"@rp/common/api-types\"\nimport { isDefined } from \"@rp/common/utils\"\nimport { WatchlistBatchSuggestionPostResponseExtended } from \"@rp/react/tanstack-api/suggestion\"\nimport { Box, Button, Typography } from \"@rp/react/web/mui/core\"\nimport { InfoOutlined } from \"@rp/react/web/mui/icons\"\nimport { RowItem } from \"./WatchlistUploadColumns\"\nimport { WatchlistUploadDataSection } from \"./WatchlistUploadDataSection\"\nimport { OnSubmit } from \"./WatchlistUploadModalContainer\"\n\ntype Props = {\n  data: WatchlistBatchSuggestionPostResponseExtended\n  onClose: () => void\n  onSubmit: OnSubmit\n  watchlist: Watchlist\n}\n\nexport const WATCHLIST_MODAL_SCROLLABLE_ID = \"watchlist-modal-scrollable\"\n\nexport const extendItems = (\n  data: WatchlistBatchSuggestionPostResponseExtended[\"entities\"],\n  watchlist: Watchlist,\n): Array<RowItem[\"data\"]> => {\n  return data.map(item => ({\n    ...item,\n    isInWatchlist: watchlist.items.includes(item.data?.key ?? \"\"),\n  }))\n}\n\nexport const WatchlistUploadData = ({ data: rawData, onClose, watchlist, onSubmit }: Props) => {\n  const ref = useRef<HTMLDivElement>(null)\n  const scroll = useRef(0)\n  const [data, setData] = useState<Array<RowItem[\"data\"]>>(\n    extendItems(\n      rawData.entities.filter(data => !data.isConflict),\n      watchlist,\n    ),\n  )\n  const [conflicts, setConflicts] = useState<Array<RowItem[\"data\"]>>(\n    extendItems(\n      rawData.entities.filter(data => data.isConflict),\n      watchlist,\n    ),\n  )\n\n  const originalConflicts = rawData.entities.filter(i => i.isConflict).length\n\n  useEffect(() => {\n    const current = ref.current\n    if (!current) return\n    current?.scrollTo(0, 0)\n    const handler = () => {\n      scroll.current = ref.current?.scrollTop ?? 0\n    }\n    current.addEventListener(\"scroll\", handler)\n    return () => {\n      current.removeEventListener(\"scroll\", handler)\n    }\n  }, [])\n\n  const toAdd = [\n    ...data.filter(i => !i.isInWatchlist && !i.isDeleted),\n    ...conflicts.filter(i => !i.isConflict && !i.isInWatchlist && !i.isDeleted),\n  ]\n\n  const excludeIds = useMemo(() => {\n    return [\n      ...watchlist.items,\n      ...data.filter(i => !i.isDeleted).map(i => i.data?.key ?? \"\"),\n      ...conflicts.filter(i => !i.isDeleted).map(i => i.data?.key ?? \"\"),\n    ]\n  }, [conflicts, data, watchlist.items])\n\n  return (\n    <Box>\n      <Box sx={{ display: \"flex\", gap: 1 }}>\n        <Typography sx={{ fontSize: 14, color: \"grey.300\" }}>\n          {data.length} {data.length === 1 ? \"entity\" : \"entities\"} found\n        </Typography>\n        {originalConflicts > 0 && (\n          <>\n            <Typography sx={{ fontSize: 14, color: \"grey.300\" }}>|</Typography>\n            <Typography\n              onClick={() => {\n                const el = ref.current?.querySelector(\".conflicts\")\n                el?.scrollIntoView({ behavior: \"smooth\", block: \"start\" })\n              }}\n              sx={{\n                cursor: \"pointer\",\n                fontSize: 14,\n                color: \"error.light\",\n                display: \"flex\",\n                alignItems: \"center\",\n              }}\n            >\n              <InfoOutlined sx={{ fontSize: 14, mr: 0.5 }} />\n              {originalConflicts} conflict{originalConflicts === 1 ? \"\" : \"s\"}\n            </Typography>\n          </>\n        )}\n      </Box>\n      <Box sx={{ mt: 2 }}>\n        <Box>\n          <Box\n            ref={ref}\n            id={WATCHLIST_MODAL_SCROLLABLE_ID}\n            sx={theme => ({\n              height: \"calc(450px)\",\n              overflowY: \"auto\",\n              ...theme.scrollbarStyles,\n            })}\n          >\n            <WatchlistUploadDataSection\n              labels={[\"match\", \"matches\"]}\n              onSortChange={() => ref.current?.scrollTo(0, scroll.current)}\n              data={data}\n              setData={setData}\n              watchlist={watchlist}\n              excludeIds={excludeIds}\n            />\n            {conflicts.filter(item => !item.isDeleted).length ? (\n              <>\n                <Box sx={{ pb: 6 }} />\n                <WatchlistUploadDataSection\n                  labels={[\"conflict\", \"conflicts\"]}\n                  labelClassName=\"conflicts\"\n                  onSortChange={() => ref.current?.scrollTo(0, scroll.current)}\n                  data={conflicts}\n                  setData={setConflicts}\n                  watchlist={watchlist}\n                  excludeIds={excludeIds}\n                />\n              </>\n            ) : null}\n          </Box>\n          <Box sx={{ display: \"flex\", justifyContent: \"flex-end\", mt: 2, gap: 2 }}>\n            <Button\n              onClick={onClose}\n              variant=\"text\"\n              color=\"inherit\"\n              data-testid=\"dialog-close-button\"\n            >\n              Cancel\n            </Button>\n            <Button\n              role=\"form-submit\"\n              onClick={() => {\n                onSubmit(toAdd.map(i => i.data).filter(isDefined), {\n                  conflicts: {\n                    deleted: conflicts.filter(i => i.isDeleted).length,\n                    resolved: conflicts.filter(i => !i.isConflict && !i.isDeleted).length,\n                    unresolved: conflicts.filter(i => i.isConflict && !i.isDeleted).length,\n                  },\n                  matched: {\n                    deleted: data.filter(i => i.isDeleted).length,\n                    modified: data.filter(i => i.isModified && !i.isDeleted).length,\n                    unmodified: data.filter(i => !i.isModified && !i.isDeleted).length,\n                  },\n                })\n              }}\n              autoFocus\n              variant=\"contained\"\n              type=\"submit\"\n            >\n              {toAdd.length === 0\n                ? \"Done\"\n                : `Add ${toAdd.length} ${toAdd.length === 1 ? \"entity\" : \"entities\"}`}\n            </Button>\n          </Box>\n        </Box>\n      </Box>\n    </Box>\n  )\n}\n"],"names":["WATCHLIST_MODAL_SCROLLABLE_ID","WatchlistUploadData","extendItems","data","watchlist","map","item","isInWatchlist","items","includes","key","rawData","onClose","onSubmit","ref","useRef","scroll","setData","useState","entities","filter","isConflict","conflicts","setConflicts","originalConflicts","i","length","useEffect","current","scrollTo","handler","scrollTop","addEventListener","removeEventListener","toAdd","isDeleted","excludeIds","useMemo","Box","sx","display","gap","Typography","fontSize","color","onClick","el","querySelector","scrollIntoView","behavior","block","cursor","alignItems","InfoOutlined","mr","mt","id","theme","height","overflowY","scrollbarStyles","WatchlistUploadDataSection","labels","onSortChange","pb","labelClassName","justifyContent","Button","variant","data-testid","role","isDefined","deleted","resolved","unresolved","matched","modified","isModified","unmodified","autoFocus","type"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
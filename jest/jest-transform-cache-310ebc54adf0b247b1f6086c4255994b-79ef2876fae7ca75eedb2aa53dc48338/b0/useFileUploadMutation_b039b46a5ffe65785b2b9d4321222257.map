{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/tanstack-api/file/src/hooks/useFileUploadMutation.ts"],"sourcesContent":["import axios from \"axios\"\nimport { adapters } from \"@rp/adapters\"\nimport { NativeFile } from \"@rp/common/utils\"\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\"\nimport { filesQueryKeys } from \"../utils\"\n\ninterface IArgs {\n  location: string\n  file: File | NativeFile\n  src: string\n}\n\nconst useFileUploadMutation = (updateProgress: (id: string, value: number) => void) => {\n  const queryClient = useQueryClient()\n\n  return useMutation({\n    mutationFn: async ({ file, src, location }: IArgs) => {\n      const data = adapters.file.formatData(file)\n      const res = await axios.put(location, data, {\n        onUploadProgress: ev => updateProgress(src, Math.round((ev.loaded * 100) / ev.total)),\n        headers: {\n          \"x-amz-server-side-encryption\": \"AES256\",\n        },\n      })\n\n      updateProgress(src, 100)\n      return res\n    },\n    retry: true,\n    retryDelay: attemptIndex => Math.min(2000 * 1.5 ** attemptIndex, 5000),\n    onSuccess: async () => {\n      // Refresh the files for My files table\n      queryClient.refetchQueries({\n        queryKey: [\"files-quota\"],\n      })\n      queryClient.refetchQueries({ queryKey: filesQueryKeys.file, exact: true })\n      queryClient.refetchQueries({ queryKey: filesQueryKeys.paginated() })\n    },\n  })\n}\n\nexport { useFileUploadMutation }\n"],"names":["useFileUploadMutation","updateProgress","queryClient","useQueryClient","useMutation","mutationFn","file","src","location","data","adapters","formatData","res","axios","put","onUploadProgress","ev","Math","round","loaded","total","headers","retry","retryDelay","attemptIndex","min","onSuccess","refetchQueries","queryKey","filesQueryKeys","exact","paginated"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAyCSA;;;eAAAA;;;8DAzCS;0BACO;4BAEmB;uBACb;;;;;;AAQ/B,MAAMA,wBAAwB,CAACC;IAC7B,MAAMC,cAAcC,IAAAA,0BAAc;IAElC,OAAOC,IAAAA,uBAAW,EAAC;QACjBC,YAAY,OAAO,EAAEC,IAAI,EAAEC,GAAG,EAAEC,QAAQ,EAAS;YAC/C,MAAMC,OAAOC,kBAAQ,CAACJ,IAAI,CAACK,UAAU,CAACL;YACtC,MAAMM,MAAM,MAAMC,cAAK,CAACC,GAAG,CAACN,UAAUC,MAAM;gBAC1CM,kBAAkBC,CAAAA,KAAMf,eAAeM,KAAKU,KAAKC,KAAK,CAAC,AAACF,GAAGG,MAAM,GAAG,MAAOH,GAAGI,KAAK;gBACnFC,SAAS;oBACP,gCAAgC;gBAClC;YACF;YAEApB,eAAeM,KAAK;YACpB,OAAOK;QACT;QACAU,OAAO;QACPC,YAAYC,CAAAA,eAAgBP,KAAKQ,GAAG,CAAC,OAAO,OAAOD,cAAc;QACjEE,WAAW;YACT,uCAAuC;YACvCxB,YAAYyB,cAAc,CAAC;gBACzBC,UAAU;oBAAC;iBAAc;YAC3B;YACA1B,YAAYyB,cAAc,CAAC;gBAAEC,UAAUC,qBAAc,CAACvB,IAAI;gBAAEwB,OAAO;YAAK;YACxE5B,YAAYyB,cAAc,CAAC;gBAAEC,UAAUC,qBAAc,CAACE,SAAS;YAAG;QACpE;IACF;AACF"}
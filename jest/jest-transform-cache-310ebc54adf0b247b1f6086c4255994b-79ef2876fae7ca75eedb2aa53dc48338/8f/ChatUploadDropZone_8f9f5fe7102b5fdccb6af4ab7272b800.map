{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/chat/src/lib/ChatUploadDropZone/ChatUploadDropZone.tsx"],"sourcesContent":["import { useCallback } from \"react\"\nimport { FileRejection } from \"react-dropzone\"\nimport { adapters } from \"@rp/adapters\"\nimport { Uploadable } from \"@rp/common/utils\"\nimport { useUploadFilesContext } from \"@rp/react/common/providers\"\nimport { useQuota } from \"@rp/react/tanstack-api/file\"\nimport { DropZone } from \"@rp/react/web/common/base-components\"\nimport { ContactSupport } from \"@rp/react/web/common/providers\"\nimport { useSnackbar } from \"@rp/react/web/common/providers\"\nimport { ChatUploadOverlay } from \"./ChatUploadOverlay\"\n\ntype Props = {\n  children: React.ReactNode\n  beforeDrop?: (files: Array<File>) => Promise<void>\n  onDropFiles?: (files: Array<Uploadable>) => void\n  onFileId?: (src: string, fileId: string) => void\n  multiple?: boolean\n  disabled?: boolean\n  chatId: string | undefined\n}\n\nconst ChatUploadDropZone = ({\n  children,\n  onDropFiles,\n  onFileId,\n  beforeDrop = async () => {},\n  multiple = false,\n  disabled = false,\n  chatId,\n}: Props) => {\n  const { enqueueError } = useSnackbar()\n  const { addToUploadQueue } = useUploadFilesContext()\n  const { isOverLimit } = useQuota()\n\n  const onDrop = useCallback(\n    (acceptedFiles: Array<File>) => {\n      if (isOverLimit) return\n      beforeDrop(acceptedFiles).then(() => {\n        const list = addToUploadQueue(acceptedFiles, {\n          onFileId,\n          location: chatId ? \"activeChatModal\" : \"mainChatModal\",\n        })\n        onDropFiles?.(list)\n      })\n    },\n    [addToUploadQueue, beforeDrop, chatId, isOverLimit, onDropFiles, onFileId],\n  )\n\n  const onDropRejected = useCallback(\n    (rejectedFiles: Array<FileRejection>) => {\n      // Invalid formats\n      const files: Array<string> = [\n        ...new Set<string>(rejectedFiles.map((file: FileRejection) => file.file.type)),\n      ]\n      const notSupported = files.join(\" ,\").replace(/application|\\/|image/gi, \"\")\n      if (rejectedFiles.length > 1 && !multiple) {\n        enqueueError(\"You can only upload one file at a time.\")\n        return\n      }\n      // Error Snackbar\n      enqueueError(\n        `The files format ${notSupported} are not supported.`,\n        {\n          autoHideDuration: 5000,\n        },\n        { action: <ContactSupport /> },\n      )\n    },\n    [enqueueError, multiple],\n  )\n\n  return (\n    <DropZone\n      onDrop={onDrop}\n      onDropRejected={onDropRejected}\n      Overlay={<ChatUploadOverlay isOverLimit={isOverLimit} />}\n      multiple={multiple}\n      disabled={disabled}\n      accept={adapters.file.getTaExtension().join(\", \")}\n    >\n      {children}\n    </DropZone>\n  )\n}\nexport { ChatUploadDropZone }\n"],"names":["ChatUploadDropZone","children","onDropFiles","onFileId","beforeDrop","multiple","disabled","chatId","enqueueError","useSnackbar","addToUploadQueue","useUploadFilesContext","isOverLimit","useQuota","onDrop","useCallback","acceptedFiles","then","list","location","onDropRejected","rejectedFiles","files","Set","map","file","type","notSupported","join","replace","length","autoHideDuration","action","ContactSupport","DropZone","Overlay","ChatUploadOverlay","accept","adapters","getTaExtension"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAoFSA;;;eAAAA;;;;uBApFmB;0BAEH;2BAEa;sBACb;gCACA;4BACM;mCAEG;AAYlC,MAAMA,qBAAqB,CAAC,EAC1BC,QAAQ,EACRC,WAAW,EACXC,QAAQ,EACRC,aAAa,WAAa,CAAC,EAC3BC,WAAW,KAAK,EAChBC,WAAW,KAAK,EAChBC,MAAM,EACA;IACN,MAAM,EAAEC,YAAY,EAAE,GAAGC,IAAAA,uBAAW;IACpC,MAAM,EAAEC,gBAAgB,EAAE,GAAGC,IAAAA,gCAAqB;IAClD,MAAM,EAAEC,WAAW,EAAE,GAAGC,IAAAA,cAAQ;IAEhC,MAAMC,SAASC,IAAAA,kBAAW,EACxB,CAACC;QACC,IAAIJ,aAAa;QACjBR,WAAWY,eAAeC,IAAI,CAAC;YAC7B,MAAMC,OAAOR,iBAAiBM,eAAe;gBAC3Cb;gBACAgB,UAAUZ,SAAS,oBAAoB;YACzC;YACAL,wBAAAA,kCAAAA,YAAcgB;QAChB;IACF,GACA;QAACR;QAAkBN;QAAYG;QAAQK;QAAaV;QAAaC;KAAS;IAG5E,MAAMiB,iBAAiBL,IAAAA,kBAAW,EAChC,CAACM;QACC,kBAAkB;QAClB,MAAMC,QAAuB;eACxB,IAAIC,IAAYF,cAAcG,GAAG,CAAC,CAACC,OAAwBA,KAAKA,IAAI,CAACC,IAAI;SAC7E;QACD,MAAMC,eAAeL,MAAMM,IAAI,CAAC,MAAMC,OAAO,CAAC,0BAA0B;QACxE,IAAIR,cAAcS,MAAM,GAAG,KAAK,CAACzB,UAAU;YACzCG,aAAa;YACb;QACF;QACA,iBAAiB;QACjBA,aACE,CAAC,iBAAiB,EAAEmB,aAAa,mBAAmB,CAAC,EACrD;YACEI,kBAAkB;QACpB,GACA;YAAEC,sBAAQ,qBAACC,0BAAc;QAAI;IAEjC,GACA;QAACzB;QAAcH;KAAS;IAG1B,qBACE,qBAAC6B,wBAAQ;QACPpB,QAAQA;QACRM,gBAAgBA;QAChBe,uBAAS,qBAACC,oCAAiB;YAACxB,aAAaA;;QACzCP,UAAUA;QACVC,UAAUA;QACV+B,QAAQC,kBAAQ,CAACb,IAAI,CAACc,cAAc,GAAGX,IAAI,CAAC;kBAE3C3B;;AAGP"}
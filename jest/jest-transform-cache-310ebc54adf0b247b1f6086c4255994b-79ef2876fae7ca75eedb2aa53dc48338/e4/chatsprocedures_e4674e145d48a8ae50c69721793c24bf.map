{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/development/src/lib/trpc/bigdata-api/procedures/user-data/chats-procedures.ts"],"sourcesContent":["import { z } from \"zod\"\nimport { bigdataSchemas } from \"@rp/common/contracts\"\nimport { TRPCError } from \"@trpc/server\"\nimport { generateChat } from \"../../../../database/generators/generateChat\"\nimport { bigdataApiProcedure } from \"../../bigdata-api-procedure\"\n\nexport const userDataChatsProcedures = {\n  list: bigdataApiProcedure\n    .meta({ openapi: { method: \"GET\", path: \"/user-data/chats\" } })\n    .input(bigdataSchemas.st_user_chats_ListUserChatsRequest)\n    .output(\n      z.union([\n        bigdataSchemas.st_user_chats_ListUserChatResponse,\n        bigdataSchemas.st_user_chats_PaginatedListUserChatResponse,\n      ]),\n    )\n    .query(async ({ ctx, input }) => {\n      const items = await ctx.db.collection(\"chats\").find()\n      if (input?.limit) return { items }\n      return items\n    }),\n  create: bigdataApiProcedure\n    .meta({ openapi: { method: \"POST\", path: \"/user-data/chats\" } })\n    .input(bigdataSchemas.st_user_chats_CreateUserChatWithoutUserId)\n    .output(bigdataSchemas.st_user_chats_UserChatResponse)\n    .mutation(({ ctx, input }) => ctx.db.collection(\"chats\").insertOne(generateChat(input))),\n  id: bigdataApiProcedure\n    .meta({ openapi: { method: \"GET\", path: \"/user-data/chats/:id\" } })\n    .input(z.object({ id: z.string() }))\n    .output(bigdataSchemas.st_user_chats_UserChatResponse)\n    .query(async ({ ctx, input }) => {\n      const chat = await ctx.db.collection(\"chats\").findOne({ id: input.id })\n      if (!chat) throw new TRPCError({ code: \"NOT_FOUND\" })\n      return chat\n    }),\n  patch: bigdataApiProcedure\n    .meta({ openapi: { method: \"PATCH\", path: \"/user-data/chats/:id\" } })\n    .input(z.object({ id: z.string(), name: z.string().optional() }))\n    .output(bigdataSchemas.st_user_chats_UserChatUpdatedResponse)\n    .mutation(async opts => {\n      const { id, ...chat } = opts.input\n      const ret = await opts.ctx.db.collection(\"chats\").updateOne({ id }, chat)\n      if (!ret) throw new TRPCError({ code: \"NOT_FOUND\" })\n      return ret\n    }),\n  delete: bigdataApiProcedure\n    .meta({ openapi: { method: \"DELETE\", path: \"/user-data/chats/:id\" } })\n    .input(z.object({ id: z.string() }))\n    .output(z.object({ id: z.string() }))\n    .mutation(async opts => {\n      await opts.ctx.db.collection(\"chats\").deleteOne({ id: opts.input.id })\n      return { id: opts.input.id }\n    }),\n  share: bigdataApiProcedure\n    .meta({ openapi: { method: \"POST\", path: \"/user-data/chats/:id/share\" } })\n    .input(z.object({ id: z.string(), public: z.boolean() }))\n    .output(bigdataSchemas.st_user_chats_UserChatSharedResponse)\n    .mutation(async opts => {\n      const chat = await opts.ctx.db\n        .collection(\"chats\")\n        .updateOne({ id: opts.input.id }, { isPublic: opts.input.public })\n      if (!chat) throw new TRPCError({ code: \"NOT_FOUND\" })\n      return chat\n    }),\n}\n"],"names":["userDataChatsProcedures","list","bigdataApiProcedure","meta","openapi","method","path","input","bigdataSchemas","st_user_chats_ListUserChatsRequest","output","z","union","st_user_chats_ListUserChatResponse","st_user_chats_PaginatedListUserChatResponse","query","ctx","items","db","collection","find","limit","create","st_user_chats_CreateUserChatWithoutUserId","st_user_chats_UserChatResponse","mutation","insertOne","generateChat","id","object","string","chat","findOne","TRPCError","code","patch","name","optional","st_user_chats_UserChatUpdatedResponse","opts","ret","updateOne","delete","deleteOne","share","public","boolean","st_user_chats_UserChatSharedResponse","isPublic"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
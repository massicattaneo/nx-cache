{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/node_modules/mdast-util-to-markdown/lib/handle/link.js"],"sourcesContent":["/**\n * @typedef {import('mdast').Link} Link\n * @typedef {import('mdast').Parents} Parents\n * @typedef {import('../types.js').Exit} Exit\n * @typedef {import('../types.js').Info} Info\n * @typedef {import('../types.js').State} State\n */\n\nimport {checkQuote} from '../util/check-quote.js'\nimport {formatLinkAsAutolink} from '../util/format-link-as-autolink.js'\n\nlink.peek = linkPeek\n\n/**\n * @param {Link} node\n * @param {Parents | undefined} _\n * @param {State} state\n * @param {Info} info\n * @returns {string}\n */\nexport function link(node, _, state, info) {\n  const quote = checkQuote(state)\n  const suffix = quote === '\"' ? 'Quote' : 'Apostrophe'\n  const tracker = state.createTracker(info)\n  /** @type {Exit} */\n  let exit\n  /** @type {Exit} */\n  let subexit\n\n  if (formatLinkAsAutolink(node, state)) {\n    // Hide the fact that we’re in phrasing, because escapes don’t work.\n    const stack = state.stack\n    state.stack = []\n    exit = state.enter('autolink')\n    let value = tracker.move('<')\n    value += tracker.move(\n      state.containerPhrasing(node, {\n        before: value,\n        after: '>',\n        ...tracker.current()\n      })\n    )\n    value += tracker.move('>')\n    exit()\n    state.stack = stack\n    return value\n  }\n\n  exit = state.enter('link')\n  subexit = state.enter('label')\n  let value = tracker.move('[')\n  value += tracker.move(\n    state.containerPhrasing(node, {\n      before: value,\n      after: '](',\n      ...tracker.current()\n    })\n  )\n  value += tracker.move('](')\n  subexit()\n\n  if (\n    // If there’s no url but there is a title…\n    (!node.url && node.title) ||\n    // If there are control characters or whitespace.\n    /[\\0- \\u007F]/.test(node.url)\n  ) {\n    subexit = state.enter('destinationLiteral')\n    value += tracker.move('<')\n    value += tracker.move(\n      state.safe(node.url, {before: value, after: '>', ...tracker.current()})\n    )\n    value += tracker.move('>')\n  } else {\n    // No whitespace, raw is prettier.\n    subexit = state.enter('destinationRaw')\n    value += tracker.move(\n      state.safe(node.url, {\n        before: value,\n        after: node.title ? ' ' : ')',\n        ...tracker.current()\n      })\n    )\n  }\n\n  subexit()\n\n  if (node.title) {\n    subexit = state.enter(`title${suffix}`)\n    value += tracker.move(' ' + quote)\n    value += tracker.move(\n      state.safe(node.title, {\n        before: value,\n        after: quote,\n        ...tracker.current()\n      })\n    )\n    value += tracker.move(quote)\n    subexit()\n  }\n\n  value += tracker.move(')')\n\n  exit()\n  return value\n}\n\n/**\n * @param {Link} node\n * @param {Parents | undefined} _\n * @param {State} state\n * @returns {string}\n */\nfunction linkPeek(node, _, state) {\n  return formatLinkAsAutolink(node, state) ? '<' : '['\n}\n"],"names":["link","peek","linkPeek","node","_","state","info","quote","checkQuote","suffix","tracker","createTracker","exit","subexit","formatLinkAsAutolink","stack","enter","value","move","containerPhrasing","before","after","current","url","title","test","safe"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"AAAA;;;;;;CAMC;;;;+BAceA;;;eAAAA;;;4BAZS;sCACU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEnCA,KAAKC,IAAI,GAAGC;AASL,SAASF,KAAKG,IAAI,EAAEC,CAAC,EAAEC,KAAK,EAAEC,IAAI;IACvC,MAAMC,QAAQC,IAAAA,sBAAU,EAACH;IACzB,MAAMI,SAASF,UAAU,MAAM,UAAU;IACzC,MAAMG,UAAUL,MAAMM,aAAa,CAACL;IACpC,iBAAiB,GACjB,IAAIM;IACJ,iBAAiB,GACjB,IAAIC;IAEJ,IAAIC,IAAAA,0CAAoB,EAACX,MAAME,QAAQ;QACrC,oEAAoE;QACpE,MAAMU,QAAQV,MAAMU,KAAK;QACzBV,MAAMU,KAAK,GAAG,EAAE;QAChBH,OAAOP,MAAMW,KAAK,CAAC;QACnB,IAAIC,QAAQP,QAAQQ,IAAI,CAAC;QACzBD,SAASP,QAAQQ,IAAI,CACnBb,MAAMc,iBAAiB,CAAChB,MAAM;YAC5BiB,QAAQH;YACRI,OAAO;WACJX,QAAQY,OAAO;QAGtBL,SAASP,QAAQQ,IAAI,CAAC;QACtBN;QACAP,MAAMU,KAAK,GAAGA;QACd,OAAOE;IACT;IAEAL,OAAOP,MAAMW,KAAK,CAAC;IACnBH,UAAUR,MAAMW,KAAK,CAAC;IACtB,IAAIC,QAAQP,QAAQQ,IAAI,CAAC;IACzBD,SAASP,QAAQQ,IAAI,CACnBb,MAAMc,iBAAiB,CAAChB,MAAM;QAC5BiB,QAAQH;QACRI,OAAO;OACJX,QAAQY,OAAO;IAGtBL,SAASP,QAAQQ,IAAI,CAAC;IACtBL;IAEA,IAEE,AADA,0CAA0C;IACzC,CAACV,KAAKoB,GAAG,IAAIpB,KAAKqB,KAAK,IACxB,iDAAiD;IACjD,eAAeC,IAAI,CAACtB,KAAKoB,GAAG,GAC5B;QACAV,UAAUR,MAAMW,KAAK,CAAC;QACtBC,SAASP,QAAQQ,IAAI,CAAC;QACtBD,SAASP,QAAQQ,IAAI,CACnBb,MAAMqB,IAAI,CAACvB,KAAKoB,GAAG,EAAE;YAACH,QAAQH;YAAOI,OAAO;WAAQX,QAAQY,OAAO;QAErEL,SAASP,QAAQQ,IAAI,CAAC;IACxB,OAAO;QACL,kCAAkC;QAClCL,UAAUR,MAAMW,KAAK,CAAC;QACtBC,SAASP,QAAQQ,IAAI,CACnBb,MAAMqB,IAAI,CAACvB,KAAKoB,GAAG,EAAE;YACnBH,QAAQH;YACRI,OAAOlB,KAAKqB,KAAK,GAAG,MAAM;WACvBd,QAAQY,OAAO;IAGxB;IAEAT;IAEA,IAAIV,KAAKqB,KAAK,EAAE;QACdX,UAAUR,MAAMW,KAAK,CAAC,CAAC,KAAK,EAAEP,OAAO,CAAC;QACtCQ,SAASP,QAAQQ,IAAI,CAAC,MAAMX;QAC5BU,SAASP,QAAQQ,IAAI,CACnBb,MAAMqB,IAAI,CAACvB,KAAKqB,KAAK,EAAE;YACrBJ,QAAQH;YACRI,OAAOd;WACJG,QAAQY,OAAO;QAGtBL,SAASP,QAAQQ,IAAI,CAACX;QACtBM;IACF;IAEAI,SAASP,QAAQQ,IAAI,CAAC;IAEtBN;IACA,OAAOK;AACT;AAEA;;;;;CAKC,GACD,SAASf,SAASC,IAAI,EAAEC,CAAC,EAAEC,KAAK;IAC9B,OAAOS,IAAAA,0CAAoB,EAACX,MAAME,SAAS,MAAM;AACnD"}
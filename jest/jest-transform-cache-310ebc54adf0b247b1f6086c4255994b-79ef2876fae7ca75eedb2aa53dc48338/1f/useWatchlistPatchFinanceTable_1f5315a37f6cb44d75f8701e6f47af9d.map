{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/watchlists/src/lib/hooks/useWatchlistPatchFinanceTable.ts"],"sourcesContent":["import { useCallback } from \"react\"\nimport { Watchlist } from \"@rp/common/api-types\"\nimport { SnackbarEnqueueAction } from \"@rp/react/common/types\"\nimport {\n  EnhancedSuggestion,\n  EntitySuggestion,\n  isEntitySuggestion,\n} from \"@rp/react/tanstack-api/suggestion\"\nimport { useCreateWatchlist, usePatchWatchlist } from \"@rp/react/tanstack-api/watchlist\"\n\ntype Params = {\n  onCreateSuccess?: (id: string) => void\n  onPatchSuccess?: () => void\n  onPatchError?: SnackbarEnqueueAction\n  onCreationError?: SnackbarEnqueueAction\n}\n\nexport const useWatchlistPatchFinanceTable = ({\n  onPatchSuccess,\n  onCreateSuccess,\n  onPatchError,\n  onCreationError,\n}: Params = {}) => {\n  const { mutateAsync: saveWatchlist, isPending: isCreating } = useCreateWatchlist({\n    enqueueError: onCreationError,\n  })\n  const { mutateAsync: updateWatchlist, isPending } = usePatchWatchlist({\n    enqueueError: onPatchError,\n  })\n  const addEntities = useCallback(\n    async (\n      watchlist: Watchlist,\n      entities: Array<EnhancedSuggestion> | Array<EntitySuggestion>,\n    ): Promise<Watchlist> => {\n      const items = entities.filter(isEntitySuggestion).map(({ key }) => key)\n      if (watchlist.isClientWatchlist === true) {\n        const saved = await saveWatchlist({\n          name: watchlist.name,\n          items,\n        })\n        onCreateSuccess?.(saved.id)\n        return saved\n      } else {\n        // Update the watchlist\n        await updateWatchlist({ id: watchlist.id, items: [...watchlist.items, ...items] })\n        // Refetch the financial data once the watchlist has been updated\n        onPatchSuccess?.()\n        return { ...watchlist, items: [...watchlist.items, ...items] }\n      }\n    },\n    [saveWatchlist, onCreateSuccess, updateWatchlist, onPatchSuccess],\n  )\n\n  const removeEntity = useCallback(\n    async (watchlist: Watchlist, entityId: string) => {\n      if (!watchlist || isPending || watchlist.isClientWatchlist === true) return\n      const items = watchlist.items.filter(id => id !== entityId)\n      // Update the watchlist\n      await updateWatchlist({ id: watchlist.id, items })\n      // Refetch the financial data once the watchlist has been updated\n      onPatchSuccess?.()\n    },\n    [onPatchSuccess, isPending, updateWatchlist],\n  )\n\n  return {\n    removeEntity,\n    addEntities,\n    isCreating,\n  }\n}\n"],"names":["useWatchlistPatchFinanceTable","onPatchSuccess","onCreateSuccess","onPatchError","onCreationError","mutateAsync","saveWatchlist","isPending","isCreating","useCreateWatchlist","enqueueError","updateWatchlist","usePatchWatchlist","addEntities","useCallback","watchlist","entities","items","filter","isEntitySuggestion","map","key","isClientWatchlist","saved","name","id","removeEntity","entityId"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAiBaA;;;eAAAA;;;uBAjBe;4BAOrB;2BAC+C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAS/C,MAAMA,gCAAgC,CAAC,EAC5CC,cAAc,EACdC,eAAe,EACfC,YAAY,EACZC,eAAe,EACR,GAAG,CAAC,CAAC;IACZ,MAAM,EAAEC,aAAaC,aAAa,EAAEC,WAAWC,UAAU,EAAE,GAAGC,IAAAA,6BAAkB,EAAC;QAC/EC,cAAcN;IAChB;IACA,MAAM,EAAEC,aAAaM,eAAe,EAAEJ,SAAS,EAAE,GAAGK,IAAAA,4BAAiB,EAAC;QACpEF,cAAcP;IAChB;IACA,MAAMU,cAAcC,IAAAA,kBAAW,EAC7B,OACEC,WACAC;QAEA,MAAMC,QAAQD,SAASE,MAAM,CAACC,8BAAkB,EAAEC,GAAG,CAAC,CAAC,EAAEC,GAAG,EAAE,GAAKA;QACnE,IAAIN,UAAUO,iBAAiB,KAAK,MAAM;YACxC,MAAMC,QAAQ,MAAMjB,cAAc;gBAChCkB,MAAMT,UAAUS,IAAI;gBACpBP;YACF;YACAf,4BAAAA,sCAAAA,gBAAkBqB,MAAME,EAAE;YAC1B,OAAOF;QACT,OAAO;YACL,uBAAuB;YACvB,MAAMZ,gBAAgB;gBAAEc,IAAIV,UAAUU,EAAE;gBAAER,OAAO;uBAAIF,UAAUE,KAAK;uBAAKA;iBAAM;YAAC;YAChF,iEAAiE;YACjEhB,2BAAAA,qCAAAA;YACA,OAAO,wCAAKc;gBAAWE,OAAO;uBAAIF,UAAUE,KAAK;uBAAKA;iBAAM;;QAC9D;IACF,GACA;QAACX;QAAeJ;QAAiBS;QAAiBV;KAAe;IAGnE,MAAMyB,eAAeZ,IAAAA,kBAAW,EAC9B,OAAOC,WAAsBY;QAC3B,IAAI,CAACZ,aAAaR,aAAaQ,UAAUO,iBAAiB,KAAK,MAAM;QACrE,MAAML,QAAQF,UAAUE,KAAK,CAACC,MAAM,CAACO,CAAAA,KAAMA,OAAOE;QAClD,uBAAuB;QACvB,MAAMhB,gBAAgB;YAAEc,IAAIV,UAAUU,EAAE;YAAER;QAAM;QAChD,iEAAiE;QACjEhB,2BAAAA,qCAAAA;IACF,GACA;QAACA;QAAgBM;QAAWI;KAAgB;IAG9C,OAAO;QACLe;QACAb;QACAL;IACF;AACF"}
{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/common/files/src/lib/useFileActions.tsx"],"sourcesContent":["import { useCallback } from \"react\"\nimport { useNavigate } from \"react-router-dom\"\nimport { isFileStatusCompleted } from \"@rp/common/utils\"\nimport { DownloadFormat, FileRowType, removeFileExtension } from \"@rp/common/utils\"\nimport { ChatFileContext } from \"@rp/react/common/hooks\"\nimport { usePatchFile } from \"@rp/react/tanstack-api/file\"\nimport { ShareIcon } from \"@rp/react/web/common/base-components\"\nimport { useHashParams } from \"@rp/react/web/common/hooks\"\nimport { useDocumentViewerData, useModal } from \"@rp/react/web/common/providers\"\nimport { Actions } from \"@rp/react/web/common/types\"\nimport {\n  ChatBubbleOutline,\n  Close,\n  Delete,\n  Download,\n  Edit,\n  OpenInNew,\n  RemoveRedEye,\n} from \"@rp/react/web/mui/icons\"\nimport { CHAT_ROUTE } from \"@rp/react/web/router\"\nimport * as URLS from \"@rp/react/web/router\"\nimport { downloadFile } from \"./downloadFile\"\n\ntype FileActions = Record<\n  \"download\" | \"share\" | \"remove\" | \"rename\" | \"view\" | \"chat\" | \"open\" | \"close\",\n  Actions<FileRowType>[number]\n>\n\ntype UseFileActionsProps = {\n  isForFilesPage?: boolean\n}\n\nconst useFileActions = ({ isForFilesPage = false }: Partial<UseFileActionsProps> = {}) => {\n  const { setDocumentData, removeDocumentData } = useDocumentViewerData()\n  const [, setHashParams] = useHashParams()\n  const navigate = useNavigate()\n\n  const {\n    deleteFilesModal: { handleOpen: handleOpenDeleteFiles },\n    editFileNameModal: { handleOpen: handleOpenEditText },\n    shareInfoModal: { handleOpen: openInfoModal },\n  } = useModal()\n\n  const openDocumentViewer = (file: FileRowType) => {\n    if (isFileStatusCompleted(file.status)) {\n      setDocumentData({\n        documentId: file.id,\n      })\n\n      if (isForFilesPage) {\n        navigate(URLS.FILES_ID_ROUTE.replace(\":id\", file.id))\n        setHashParams({ private: \"true\" })\n      } else {\n        setHashParams({ document: file.id, private: \"true\" })\n      }\n    }\n  }\n\n  const closeDocumentViewer = () => {\n    removeDocumentData()\n    navigate(URLS.FILES_ROUTE, { replace: true })\n  }\n\n  // ****************\n  // Action Controls\n  // ****************\n  const onDownload = (file: FileRowType, downloadFormat: DownloadFormat) => {\n    downloadFile(file, downloadFormat)\n    // TODO\n    // setIsHover({})\n  }\n\n  const onEdit = (file: FileRowType) => {\n    handleOpenEditText({\n      value: removeFileExtension(file.name),\n      description: \"Choose a name for this file\",\n      id: file.id,\n      editHook: usePatchFile,\n    })\n  }\n\n  const deleteFiles = (filesIds: Array<string>) => {\n    return new Promise(resolve => {\n      handleOpenDeleteFiles({ filesIds, onSuccess: () => resolve(undefined) })\n    })\n  }\n\n  const chatWithFiles = useCallback(\n    (filesIds: Array<string>) => {\n      const state: ChatFileContext = { filesIds }\n      navigate(CHAT_ROUTE, { state })\n    },\n    [navigate],\n  )\n\n  const actions = {\n    open: {\n      id: \"open\",\n      label: \"Open\",\n      icon: <OpenInNew />,\n      onClick: file => openDocumentViewer(file),\n    },\n    close: {\n      id: \"close\",\n      label: \"Close\",\n      icon: <Close />,\n      onClick: closeDocumentViewer,\n    },\n    download: {\n      id: \"download\",\n      label: \"Download\",\n      icon: <Download />,\n      onClick: () => {},\n      nestedActions: [\n        { id: \"original\", label: \"Original\", onClick: file => onDownload(file, null), icon: null },\n        {\n          id: \"annotated\",\n          label: \"Annotations\",\n          onClick: file => onDownload(file, \"annotated\"),\n          icon: null,\n        },\n      ],\n    },\n    rename: {\n      id: \"rename\",\n      label: \"Rename\",\n      icon: <Edit />,\n      onClick: file => onEdit(file),\n    },\n    remove: {\n      id: \"remove\",\n      label: \"Delete\",\n      icon: <Delete />,\n      onClick: file => {\n        return new Promise(resolve => {\n          handleOpenDeleteFiles({ filesIds: [file.id], onSuccess: () => resolve(undefined) })\n        })\n      },\n    },\n    view: {\n      id: \"view\",\n      label: \"View\",\n      icon: <RemoveRedEye />,\n      onClick: file => openDocumentViewer(file),\n    },\n    chat: {\n      id: \"chat\",\n      label: \"Chat\",\n      icon: <ChatBubbleOutline />,\n      onClick: file => {\n        const state: ChatFileContext = { filesIds: [file.id] }\n        navigate(CHAT_ROUTE, { state })\n      },\n    },\n    share: {\n      id: \"share\",\n      label: \"Share\",\n      icon: file => (\n        <ShareIcon size={24} shared={!!(file.sharedWith && file.sharedWith.length > 0)} />\n      ),\n      onClick: file => {\n        const data = {\n          ...file,\n          dataType: \"file\" as const,\n        }\n        openInfoModal(data)\n      },\n    },\n  } satisfies FileActions\n\n  return { actions, openDocumentViewer, deleteFiles, chatWithFiles }\n}\n\nexport { useFileActions }\n"],"names":["useFileActions","isForFilesPage","setDocumentData","removeDocumentData","useDocumentViewerData","setHashParams","useHashParams","navigate","useNavigate","deleteFilesModal","handleOpen","handleOpenDeleteFiles","editFileNameModal","handleOpenEditText","shareInfoModal","openInfoModal","useModal","openDocumentViewer","file","isFileStatusCompleted","status","documentId","id","URLS","FILES_ID_ROUTE","replace","private","document","closeDocumentViewer","FILES_ROUTE","onDownload","downloadFormat","downloadFile","onEdit","value","removeFileExtension","name","description","editHook","usePatchFile","deleteFiles","filesIds","Promise","resolve","onSuccess","undefined","chatWithFiles","useCallback","state","CHAT_ROUTE","actions","open","label","icon","OpenInNew","onClick","close","Close","download","Download","nestedActions","rename","Edit","remove","Delete","view","RemoveRedEye","chat","ChatBubbleOutline","share","ShareIcon","size","shared","sharedWith","length","data","dataType"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
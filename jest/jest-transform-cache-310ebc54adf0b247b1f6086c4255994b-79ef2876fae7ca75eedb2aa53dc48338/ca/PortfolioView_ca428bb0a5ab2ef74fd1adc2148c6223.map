{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/apps/client-web/src/app/components/Hub/Watchlists/PortfolioView/PortfolioView.tsx"],"sourcesContent":["import { useCallback, useEffect, useState } from \"react\"\nimport { Link, generatePath, useLocation, useNavigate } from \"react-router-dom\"\nimport { useUser } from \"@clerk/clerk-react\"\nimport { ChatFileContext } from \"@rp/react/common/hooks\"\nimport { useAccount } from \"@rp/react/common/providers\"\nimport { useCqsByIdsContext } from \"@rp/react/tanstack-api/cqs-by-ids\"\nimport { useWatchlist } from \"@rp/react/tanstack-api/watchlist\"\nimport { RPTooltip } from \"@rp/react/web/common/base-components\"\nimport { ShareIcon } from \"@rp/react/web/common/base-components\"\nimport { LoadingSpinner } from \"@rp/react/web/common/base-components\"\nimport { MaxWidthContainer } from \"@rp/react/web/common/composite-components\"\nimport { HtmlPageHead } from \"@rp/react/web/common/header-components\"\nimport { Header, SearchBar } from \"@rp/react/web/common/layout\"\nimport { useSnackbar } from \"@rp/react/web/common/providers\"\nimport { WatchlistInfo } from \"@rp/react/web/common/watchlist-editor\"\nimport { RunSearchIcon } from \"@rp/react/web/icons\"\nimport { Box, Button, IconButton, SvgIcon, Typography } from \"@rp/react/web/mui/core\"\nimport { ArrowBack, ChatBubbleOutline, Search } from \"@rp/react/web/mui/icons\"\nimport { CHAT_ROUTE, WATCHLISTS_ROUTE, WATCHLIST_EDIT } from \"@rp/react/web/router\"\nimport { useWatchlistsActions } from \"@rp/react/web/watchlists\"\nimport { useGetBackButtonUrl } from \"../../../../pages/WatchlistEditor/useGetBackButtonUrl\"\nimport { PortfolioActionsMenu } from \"./PortfolioActionsMenu\"\nimport { InputContainerStyled, WatchListEditorStyled } from \"./PortfolioView.styles\"\nimport { ItemsCount, WatchlistsTable } from \"./WatchlistsTable\"\n\ntype Props = {\n  id: string\n}\n\nconst PortfolioView = ({ id }: Props) => {\n  const { isLoading: isLoadingWatchlist, data, error } = useWatchlist(id)\n  const { search, share } = useWatchlistsActions()\n  const { enqueueError } = useSnackbar()\n  const { items = [], name = \"\" } = data ?? {}\n  const { user } = useUser()\n  const { state } = useLocation()\n  const navigate = useNavigate()\n  const { canShare, hasEntitlement } = useAccount()\n\n  const { ids, addByIds } = useCqsByIdsContext()\n  const [filterTerm, setFilterTerm] = useState(\"\")\n\n  const editable =\n    data && (data.ownerUserId === user?.id || data.shared.company.permission === \"write\")\n  const isRunSearchDisabled = items.length === 0\n  const isPublic = data?.shared.company.permission !== \"undefined\"\n\n  useEffect(() => {\n    //TODO this logic should be revised when watchlist is updated\n    addByIds(items.map(key => ({ key, queryType: key.length === 6 ? \"entity\" : \"rp_topic\" })))\n  }, [items, addByIds])\n\n  useEffect(() => {\n    if (error) {\n      enqueueError(\"Watchlist does not exist\")\n      navigate(WATCHLISTS_ROUTE)\n    }\n  }, [error, enqueueError, navigate])\n\n  const isListLoading = items.some(item => ids[item]?.isLoading ?? true)\n  const isLoading = isLoadingWatchlist || isListLoading\n\n  const mappedItems = items.map(item => ids[item]?.data).filter(item => item?.name)\n\n  const filteredSelectedEntities = mappedItems.filter(result =>\n    result.name.toLowerCase().includes(filterTerm.toLowerCase()),\n  )\n\n  const navigationUrl = useGetBackButtonUrl(\n    { userId: user?.id, userEmail: user?.primaryEmailAddress?.emailAddress },\n    { ownerId: data?.ownerUserId },\n  )\n\n  const handleRunSearch = () => {\n    if (data) search.onClick(data)\n  }\n\n  const handleShare = useCallback(() => {\n    if (data) share.onClick(data)\n  }, [data, share])\n\n  const handleChat = async () => {\n    if (!data) return\n    const state: ChatFileContext = { watchlistIds: [data.id] }\n    navigate(CHAT_ROUTE, { state })\n  }\n\n  return (\n    <>\n      <HtmlPageHead title={`${name} | Watchlist`} />\n      <Header\n        leftColumns={6}\n        rightColumns={6}\n        leftContent={\n          <Box sx={{ display: \"flex\", alignItems: \"center\", gap: 1, minWidth: 0 }}>\n            <Link to={navigationUrl}>\n              <IconButton size=\"small\">\n                <ArrowBack />\n              </IconButton>\n            </Link>\n            <Typography\n              variant=\"h6\"\n              fontWeight={700}\n              sx={{ overflow: \"hidden\", textOverflow: \"ellipsis\", whiteSpace: \"nowrap\" }}\n            >\n              {name}\n            </Typography>\n          </Box>\n        }\n        rightContent={\n          <Box sx={{ display: \"flex\", gap: 1, alignItems: \"center\" }}>\n            {data ? (\n              <WatchlistInfo ownerName={data.ownerName} lastUpdated={data.lastUpdated} />\n            ) : null}\n            {canShare ? (\n              <RPTooltip title=\"Share\">\n                <IconButton onClick={handleShare}>\n                  <ShareIcon\n                    shared={isPublic && !isLoading}\n                    size={24}\n                    sx={{ color: isPublic && !isLoading ? undefined : \"grey.300\" }}\n                  />\n                </IconButton>\n              </RPTooltip>\n            ) : null}\n            <RPTooltip title=\"Chat\">\n              <IconButton onClick={handleChat}>\n                <ChatBubbleOutline sx={{ height: 24, width: 24, color: \"grey.300\" }} />\n              </IconButton>\n            </RPTooltip>\n            {hasEntitlement(\"search\") && (\n              <RPTooltip title={isRunSearchDisabled ? \"\" : \"Run search\"}>\n                <span>\n                  <IconButton onClick={handleRunSearch} disabled={isRunSearchDisabled}>\n                    <SvgIcon\n                      component={RunSearchIcon}\n                      inheritViewBox\n                      sx={{\n                        height: 24,\n                        width: 24,\n                        color: isRunSearchDisabled ? \"text.disabled\" : \"grey.300\",\n                      }}\n                    />\n                  </IconButton>\n                </span>\n              </RPTooltip>\n            )}\n            {data ? <PortfolioActionsMenu watchlist={data} editable={!!editable} /> : null}\n          </Box>\n        }\n      />\n      <MaxWidthContainer>\n        {isLoadingWatchlist ? (\n          <LoadingSpinner />\n        ) : (\n          <WatchListEditorStyled color=\"text.primary\" data-testid=\"container\">\n            <InputContainerStyled>\n              <Box\n                sx={{\n                  display: \"flex\",\n                  alignItems: \"center\",\n                  gap: \"10px\",\n                  mb: \"10px\",\n                  width: \"100%\",\n                  justifyContent: \"space-between\",\n                }}\n              >\n                <Box sx={{ color: \"text.secondary\" }}>\n                  {filteredSelectedEntities.length > 0 ? (\n                    <ItemsCount items={filteredSelectedEntities} total={mappedItems.length} />\n                  ) : null}\n                </Box>\n                <Box sx={{ display: \"flex\", gap: 1.5, flexShrink: 0 }}>\n                  {user?.id === data?.ownerUserId || data?.shared.company.permission === \"write\" ? (\n                    <Button\n                      variant=\"text-outlined\"\n                      size=\"small\"\n                      component={Link}\n                      to={generatePath(WATCHLIST_EDIT, { id })}\n                      state={state}\n                      sx={{ height: \"38px\", whiteSpace: \"nowrap\", minWidth: \"fit-content\" }}\n                    >\n                      EDIT WATCHLIST\n                    </Button>\n                  ) : null}\n                  <SearchBar\n                    size=\"small\"\n                    placeholder=\"Find an entity\"\n                    variant=\"outlined\"\n                    sx={{ \".MuiInputBase-root\": { height: \"38px\" } }}\n                    InputProps={{\n                      startAdornment: <Search />,\n                    }}\n                    value={filterTerm}\n                    onChange={e => {\n                      setFilterTerm(e.target.value)\n                    }}\n                  />\n                </Box>\n              </Box>\n            </InputContainerStyled>\n\n            {mappedItems.length > 0 && (\n              <WatchlistsTable\n                loading={isLoading}\n                totalEntities={mappedItems.length}\n                selectedEntities={filteredSelectedEntities}\n                filterTerm={filterTerm}\n                onShare={handleShare}\n                isPublic={isPublic}\n              />\n            )}\n\n            {!isLoading && items.length === 0 && (\n              <Typography variant=\"subtitle2\" color=\"textSecondary\">\n                This Watchlist is empty\n              </Typography>\n            )}\n          </WatchListEditorStyled>\n        )}\n      </MaxWidthContainer>\n    </>\n  )\n}\n\nexport { PortfolioView }\n"],"names":["PortfolioView","id","user","isLoading","isLoadingWatchlist","data","error","useWatchlist","search","share","useWatchlistsActions","enqueueError","useSnackbar","items","name","useUser","state","useLocation","navigate","useNavigate","canShare","hasEntitlement","useAccount","ids","addByIds","useCqsByIdsContext","filterTerm","setFilterTerm","useState","editable","ownerUserId","shared","company","permission","isRunSearchDisabled","length","isPublic","useEffect","map","key","queryType","WATCHLISTS_ROUTE","isListLoading","some","item","mappedItems","filter","filteredSelectedEntities","result","toLowerCase","includes","navigationUrl","useGetBackButtonUrl","userId","userEmail","primaryEmailAddress","emailAddress","ownerId","handleRunSearch","onClick","handleShare","useCallback","handleChat","watchlistIds","CHAT_ROUTE","HtmlPageHead","title","Header","leftColumns","rightColumns","leftContent","Box","sx","display","alignItems","gap","minWidth","Link","to","IconButton","size","ArrowBack","Typography","variant","fontWeight","overflow","textOverflow","whiteSpace","rightContent","WatchlistInfo","ownerName","lastUpdated","RPTooltip","ShareIcon","color","undefined","ChatBubbleOutline","height","width","span","disabled","SvgIcon","component","RunSearchIcon","inheritViewBox","PortfolioActionsMenu","watchlist","MaxWidthContainer","LoadingSpinner","WatchListEditorStyled","data-testid","InputContainerStyled","mb","justifyContent","ItemsCount","total","flexShrink","Button","generatePath","WATCHLIST_EDIT","SearchBar","placeholder","InputProps","startAdornment","Search","value","onChange","e","target","WatchlistsTable","loading","totalEntities","selectedEntities","onShare"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
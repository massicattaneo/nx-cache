{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/apps/client-web/src/app/pages/Files/FilesPage.tsx"],"sourcesContent":["// Packages\nimport { useCallback, useRef, useState } from \"react\"\nimport { useTranslation } from \"react-i18next\"\nimport { useParams, useSearchParams } from \"react-router-dom\"\nimport { FILES_FEATURE_NAME } from \"@rp/common/settings\"\nimport { useAccount } from \"@rp/react/common/providers\"\nimport { useInvalidateSharedFiles, useQuota } from \"@rp/react/tanstack-api/file\"\nimport { PageWrapperStyled, UploadInputRef } from \"@rp/react/web/common/base-components\"\nimport { HubFileToggleTabs, QuotaReachedMessage } from \"@rp/react/web/common/composite-components\"\nimport { UploadFiles, useFileActions } from \"@rp/react/web/common/files\"\nimport { HtmlPageHead } from \"@rp/react/web/common/header-components\"\nimport { useReplaceSearchParam } from \"@rp/react/web/common/hooks\"\nimport { useDeviceInfo } from \"@rp/react/web/common/hooks\"\nimport { HeaderButton } from \"@rp/react/web/common/layout\"\nimport { useModal } from \"@rp/react/web/common/providers\"\nimport { DocumentViewerPage } from \"@rp/react/web/document-viewer\"\nimport { Box } from \"@rp/react/web/mui/core\"\n// Components\nimport { Attachment, FileUploadOutlined } from \"@rp/react/web/mui/icons\"\nimport Files from \"../../components/Hub/Files\"\nimport { SelectedFile } from \"../../components/Hub/Files/Files\"\nimport { HubHeader } from \"../../components/Hub/HubHeader/HubHeader\"\n// Styles\nimport { FilesMobileHeader } from \"./FileMobileHeader\"\n\nconst PRIVATE_FILES = \"private-files\"\nconst SHARED_FILES = \"shared-files\"\n\nconst tabValues = {\n  [PRIVATE_FILES]: 0,\n  [SHARED_FILES]: 1,\n} as const\n\ntype TabValue = typeof tabValues[keyof typeof tabValues]\n\n// =================\n// Hub Page\n// =================\n\nfunction UploadFileButton({\n  onSuccess,\n  disableUpload,\n}: {\n  onSuccess: () => void\n  disableUpload: boolean\n}) {\n  const ref = useRef<UploadInputRef>(null)\n  const {\n    planComparisonModal: { handleOpen: planComparisonHandleOpen },\n  } = useModal()\n  const handleClick = () => {\n    disableUpload ? planComparisonHandleOpen(FILES_FEATURE_NAME) : ref.current?.open()\n  }\n\n  return (\n    <HeaderButton key=\"header-button\" onClick={handleClick} startIcon={<FileUploadOutlined />}>\n      Upload File\n      <UploadFiles\n        location=\"filesPage\"\n        multiple\n        ref={ref}\n        onSubmit={() => {\n          onSuccess()\n        }}\n      />\n    </HeaderButton>\n  )\n}\n\nfunction FilesHeader({\n  value,\n  selected,\n  filterTerm,\n  disableUpload,\n  handleChange,\n  planComparisonHandleOpen,\n}: {\n  value: number\n  selected: Array<SelectedFile>\n  filterTerm: string\n  disableUpload: boolean\n  handleChange: (newValue: TabValue) => void\n  planComparisonHandleOpen: (newValue: string) => void\n}) {\n  const { isMobile } = useDeviceInfo()\n  const { id = \"\" } = useParams()\n  const { deleteFiles, chatWithFiles } = useFileActions()\n  const [_, setSearchParams] = useSearchParams()\n\n  const { hasEntitlement } = useAccount()\n\n  const { t } = useTranslation()\n  const findFilesPlaceholder = t(\n    value === tabValues[PRIVATE_FILES]\n      ? \"filePage.findMyFilesPlaceholder\"\n      : \"filePage.findSharedWithMePlaceholder\",\n  )\n\n  const onFileUpload = () => {\n    if (disableUpload) {\n      planComparisonHandleOpen(FILES_FEATURE_NAME)\n    }\n    window.scrollTo({ top: 0, behavior: \"smooth\" })\n    handleChange(tabValues[PRIVATE_FILES])\n  }\n\n  const setFilterTerm = useCallback(\n    (term: string) => {\n      setSearchParams(\n        (prev: URLSearchParams & { find?: string }) => {\n          const { find: _, ...rest } = prev\n          return term.length ? { ...rest, find: term } : rest\n        },\n        { replace: true },\n      )\n    },\n    [setSearchParams],\n  )\n\n  const headerItems: Array<React.ReactElement> = []\n  if (hasEntitlement(\"file:upload\")) {\n    headerItems.push(\n      <UploadFileButton\n        key=\"upload-file-button\"\n        onSuccess={onFileUpload}\n        disableUpload={disableUpload}\n      />,\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <FilesMobileHeader\n        id={id}\n        page=\"Files\"\n        label=\"Files\"\n        filterTerm={filterTerm}\n        setFilterTerm={setFilterTerm}\n        placeholder={findFilesPlaceholder}\n        onClick={disableUpload ? undefined : \"uploadFiles\"}\n        buttonLabel=\"Upload File\"\n        icon={{\n          Icon: Attachment,\n          IconButton: FileUploadOutlined,\n        }}\n        onDeleteClick={\n          selected.length\n            ? () => {\n                deleteFiles(selected.filter(i => !i.shared).map(i => i.id))\n              }\n            : undefined\n        }\n        onChatClick={selected.length ? () => chatWithFiles(selected.map(i => i.id)) : undefined}\n        onFileUpload={onFileUpload}\n      />\n    )\n  }\n\n  return (\n    <HubHeader\n      id={id}\n      label=\"Files\"\n      page=\"Files\"\n      filterTerm={filterTerm}\n      setFilterTerm={setFilterTerm}\n      placeholder={findFilesPlaceholder}\n      rightItems={headerItems}\n    />\n  )\n}\n\nconst FilesPage = () => {\n  const {\n    planComparisonModal: { handleOpen: planComparisonHandleOpen },\n  } = useModal()\n  const { isMobile } = useDeviceInfo()\n\n  const [selected, setSelected] = useState<Array<SelectedFile>>([])\n  const invalidateSharedFiles = useInvalidateSharedFiles()\n\n  const { disableUpload } = useQuota()\n  const [searchParams] = useSearchParams()\n  const { canShare } = useAccount()\n\n  const [tab, setTab] = useState<TabValue>(() => {\n    const key = searchParams.get(\"tab\") ?? \"\"\n    return tabValues[key as keyof typeof tabValues] ?? tabValues[PRIVATE_FILES]\n  })\n\n  const filterTerm = searchParams.get(\"find\") ?? \"\"\n  const replace = useReplaceSearchParam()\n\n  const handleChange = (newValue: number) => {\n    if (newValue === tabValues[PRIVATE_FILES]) {\n      replace(() => undefined)\n    }\n\n    if (newValue === tabValues[SHARED_FILES]) {\n      replace(() => SHARED_FILES)\n      invalidateSharedFiles()\n    }\n\n    setTab(newValue as TabValue)\n  }\n\n  return (\n    <PageWrapperStyled>\n      <HtmlPageHead title=\"Files\" />\n      <FilesHeader\n        value={tab}\n        selected={selected}\n        filterTerm={filterTerm}\n        disableUpload={disableUpload}\n        handleChange={handleChange}\n        planComparisonHandleOpen={planComparisonHandleOpen}\n      />\n\n      <DocumentViewerPage\n        rpjsonHeaderOffset={isMobile ? 0 : undefined}\n        pdfHeaderOffset={56}\n        disableCheckbox\n        backTitle=\"Back to Files\"\n        contentContainerProps={{ sx: { display: \"flex\" } }}\n      >\n        <Box sx={{ width: \"100%\", position: \"relative\" }}>\n          <Box sx={{ position: \"relative\", pt: 2 }}>\n            {canShare ? (\n              <HubFileToggleTabs size=\"small\" value={tab} setValue={handleChange} />\n            ) : null}\n\n            <QuotaReachedMessage\n              sx={{ mt: canShare ? 2 : 0 }}\n              onClick={() => {\n                planComparisonHandleOpen(FILES_FEATURE_NAME)\n              }}\n            />\n          </Box>\n\n          {tab === tabValues[PRIVATE_FILES] && (\n            <Files\n              selected={selected}\n              setSelected={setSelected}\n              disableUpload={disableUpload}\n              filterTerm={filterTerm}\n            />\n          )}\n          {tab === tabValues[SHARED_FILES] && (\n            <Files\n              selected={selected}\n              setSelected={setSelected}\n              disableUpload={disableUpload}\n              filterTerm={filterTerm}\n              shared\n            />\n          )}\n        </Box>\n      </DocumentViewerPage>\n    </PageWrapperStyled>\n  )\n}\n\nexport { FilesPage }\n"],"names":["FilesPage","PRIVATE_FILES","SHARED_FILES","tabValues","UploadFileButton","onSuccess","disableUpload","ref","useRef","planComparisonModal","handleOpen","planComparisonHandleOpen","useModal","handleClick","FILES_FEATURE_NAME","current","open","HeaderButton","onClick","startIcon","FileUploadOutlined","UploadFiles","location","multiple","onSubmit","FilesHeader","value","selected","filterTerm","handleChange","isMobile","useDeviceInfo","id","useParams","deleteFiles","chatWithFiles","useFileActions","_","setSearchParams","useSearchParams","hasEntitlement","useAccount","t","useTranslation","findFilesPlaceholder","onFileUpload","window","scrollTo","top","behavior","setFilterTerm","useCallback","term","prev","find","rest","length","replace","headerItems","push","FilesMobileHeader","page","label","placeholder","undefined","buttonLabel","icon","Icon","Attachment","IconButton","onDeleteClick","filter","i","shared","map","onChatClick","HubHeader","rightItems","setSelected","useState","invalidateSharedFiles","useInvalidateSharedFiles","useQuota","searchParams","canShare","tab","setTab","key","get","useReplaceSearchParam","newValue","PageWrapperStyled","HtmlPageHead","title","DocumentViewerPage","rpjsonHeaderOffset","pdfHeaderOffset","disableCheckbox","backTitle","contentContainerProps","sx","display","Box","width","position","pt","HubFileToggleTabs","size","setValue","QuotaReachedMessage","mt","Files"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
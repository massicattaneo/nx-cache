{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/common/hooks/src/useStopWatch.ts"],"sourcesContent":["import { useEffect, useRef } from \"react\"\nimport useWindowFocus from \"./useWindowFocus\"\n\ntype Props = {\n  autoStart?: boolean\n  keepBlurredTime?: boolean\n}\n\ntype Times = {\n  start: number\n  stop: number\n  isRunning: boolean\n  totalTime: number\n  marks: Record<string, number>\n  blurred: Array<Array<number>>\n}\n\nconst initialState: Times = {\n  start: 0,\n  stop: 0,\n  isRunning: false,\n  totalTime: 0,\n  marks: {},\n  blurred: [],\n}\n\n// What is blurred time?\n// Blurred time is the time that the window is not focused.\n// This is useful for tracking how much time a user is actually\n// interacting with the app.\n// Blurred is an array of arrays. Each array is the time the user lost focus\n// and the time they returned. ie: [[time left, time returned], [time left, time returned]]\n\nconst calcTimeBlurred = (blurred: Array<Array<number>>) => {\n  return blurred.reduce((acc, [start, stop]) => acc + (stop - start), 0)\n}\n\nconst useStopWatch = ({ autoStart = false, keepBlurredTime = false }: Partial<Props> = {}) => {\n  const timesRef = useRef({ ...initialState })\n  const isWindowFocused = useWindowFocus()\n\n  useEffect(() => {\n    if (isWindowFocused && timesRef.current.blurred.length > 0) {\n      timesRef.current.blurred[timesRef.current.blurred.length - 1][1] = Date.now()\n    }\n\n    if (!isWindowFocused) {\n      timesRef.current.blurred.push([Date.now(), Date.now()])\n    }\n  }, [isWindowFocused])\n\n  // Start the timer\n  const start = () => {\n    timesRef.current = { ...timesRef.current, start: Date.now(), isRunning: true }\n  }\n  // Stop the timer\n  const stop = () => {\n    const timeBlurred = keepBlurredTime ? 0 : calcTimeBlurred(timesRef.current.blurred)\n    return (timesRef.current = {\n      ...timesRef.current,\n      stop: Date.now(),\n      isRunning: false,\n      totalTime: Date.now() - timesRef.current.start - timeBlurred,\n    })\n  }\n  // Mark a point in time\n  const mark = (name: string) => {\n    timesRef.current = {\n      ...timesRef.current,\n      marks: {\n        ...timesRef.current.marks,\n        [name]: Date.now(),\n      },\n    }\n  }\n  // Reset the timer\n  const reset = () => {\n    timesRef.current = { ...initialState }\n  }\n\n  // Start the timer if autoStart is true\n  if (autoStart && !timesRef.current.isRunning) {\n    start()\n  }\n\n  return { times: timesRef, start, stop, mark, reset }\n}\n\nexport { useStopWatch }\n"],"names":["useStopWatch","initialState","start","stop","isRunning","totalTime","marks","blurred","calcTimeBlurred","reduce","acc","autoStart","keepBlurredTime","timesRef","useRef","isWindowFocused","useWindowFocus","useEffect","current","length","Date","now","push","timeBlurred","mark","name","reset","times"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAwFSA;;;eAAAA;;;uBAxFyB;uEACP;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgB3B,MAAMC,eAAsB;IAC1BC,OAAO;IACPC,MAAM;IACNC,WAAW;IACXC,WAAW;IACXC,OAAO,CAAC;IACRC,SAAS,EAAE;AACb;AAEA,wBAAwB;AACxB,2DAA2D;AAC3D,+DAA+D;AAC/D,4BAA4B;AAC5B,4EAA4E;AAC5E,2FAA2F;AAE3F,MAAMC,kBAAkB,CAACD;IACvB,OAAOA,QAAQE,MAAM,CAAC,CAACC,KAAK,CAACR,OAAOC,KAAK,GAAKO,MAAOP,CAAAA,OAAOD,KAAI,GAAI;AACtE;AAEA,MAAMF,eAAe,CAAC,EAAEW,YAAY,KAAK,EAAEC,kBAAkB,KAAK,EAAkB,GAAG,CAAC,CAAC;IACvF,MAAMC,WAAWC,IAAAA,aAAM,EAAC,mBAAKb;IAC7B,MAAMc,kBAAkBC,IAAAA,uBAAc;IAEtCC,IAAAA,gBAAS,EAAC;QACR,IAAIF,mBAAmBF,SAASK,OAAO,CAACX,OAAO,CAACY,MAAM,GAAG,GAAG;YAC1DN,SAASK,OAAO,CAACX,OAAO,CAACM,SAASK,OAAO,CAACX,OAAO,CAACY,MAAM,GAAG,EAAE,CAAC,EAAE,GAAGC,KAAKC,GAAG;QAC7E;QAEA,IAAI,CAACN,iBAAiB;YACpBF,SAASK,OAAO,CAACX,OAAO,CAACe,IAAI,CAAC;gBAACF,KAAKC,GAAG;gBAAID,KAAKC,GAAG;aAAG;QACxD;IACF,GAAG;QAACN;KAAgB;IAEpB,kBAAkB;IAClB,MAAMb,QAAQ;QACZW,SAASK,OAAO,GAAG,wCAAKL,SAASK,OAAO;YAAEhB,OAAOkB,KAAKC,GAAG;YAAIjB,WAAW;;IAC1E;IACA,iBAAiB;IACjB,MAAMD,OAAO;QACX,MAAMoB,cAAcX,kBAAkB,IAAIJ,gBAAgBK,SAASK,OAAO,CAACX,OAAO;QAClF,OAAQM,SAASK,OAAO,GAAG,wCACtBL,SAASK,OAAO;YACnBf,MAAMiB,KAAKC,GAAG;YACdjB,WAAW;YACXC,WAAWe,KAAKC,GAAG,KAAKR,SAASK,OAAO,CAAChB,KAAK,GAAGqB;;IAErD;IACA,uBAAuB;IACvB,MAAMC,OAAO,CAACC;QACZZ,SAASK,OAAO,GAAG,wCACdL,SAASK,OAAO;YACnBZ,OAAO,wCACFO,SAASK,OAAO,CAACZ,KAAK;gBACzB,CAACmB,KAAK,EAAEL,KAAKC,GAAG;;;IAGtB;IACA,kBAAkB;IAClB,MAAMK,QAAQ;QACZb,SAASK,OAAO,GAAG,mBAAKjB;IAC1B;IAEA,uCAAuC;IACvC,IAAIU,aAAa,CAACE,SAASK,OAAO,CAACd,SAAS,EAAE;QAC5CF;IACF;IAEA,OAAO;QAAEyB,OAAOd;QAAUX;QAAOC;QAAMqB;QAAME;IAAM;AACrD"}
{"version":3,"sources":["../src/deriveState.ts"],"sourcesContent":["import type {\n  ActiveSessionResource,\n  InitialState,\n  OrganizationCustomPermissionKey,\n  OrganizationCustomRoleKey,\n  OrganizationResource,\n  Resources,\n  UserResource,\n} from '@clerk/types';\n\n/**\n * Derives authentication state based on the current rendering context (SSR or client-side).\n */\nexport const deriveState = (clerkLoaded: boolean, state: Resources, initialState: InitialState | undefined) => {\n  if (!clerkLoaded && initialState) {\n    return deriveFromSsrInitialState(initialState);\n  }\n  return deriveFromClientSideState(state);\n};\n\nconst deriveFromSsrInitialState = (initialState: InitialState) => {\n  const userId = initialState.userId;\n  const user = initialState.user as UserResource;\n  const sessionId = initialState.sessionId;\n  const session = initialState.session as ActiveSessionResource;\n  const organization = initialState.organization as OrganizationResource;\n  const orgId = initialState.orgId;\n  const orgRole = initialState.orgRole as OrganizationCustomRoleKey;\n  const orgPermissions = initialState.orgPermissions as OrganizationCustomPermissionKey[];\n  const orgSlug = initialState.orgSlug;\n  const actor = initialState.actor;\n  const factorVerificationAge = initialState.factorVerificationAge;\n\n  return {\n    userId,\n    user,\n    sessionId,\n    session,\n    organization,\n    orgId,\n    orgRole,\n    orgPermissions,\n    orgSlug,\n    actor,\n    factorVerificationAge,\n  };\n};\n\nconst deriveFromClientSideState = (state: Resources) => {\n  const userId: string | null | undefined = state.user ? state.user.id : state.user;\n  const user = state.user;\n  const sessionId: string | null | undefined = state.session ? state.session.id : state.session;\n  const session = state.session;\n  const factorVerificationAge: [number, number] | null = state.session ? state.session.factorVerificationAge : null;\n  const actor = session?.actor;\n  const organization = state.organization;\n  const orgId: string | null | undefined = state.organization ? state.organization.id : state.organization;\n  const orgSlug = organization?.slug;\n  const membership = organization\n    ? user?.organizationMemberships?.find(om => om.organization.id === orgId)\n    : organization;\n  const orgPermissions = membership ? membership.permissions : membership;\n  const orgRole = membership ? membership.role : membership;\n\n  return {\n    userId,\n    user,\n    sessionId,\n    session,\n    organization,\n    orgId,\n    orgRole,\n    orgSlug,\n    orgPermissions,\n    actor,\n    factorVerificationAge,\n  };\n};\n"],"names":["deriveState_exports","__export","deriveState","module","exports","__toCommonJS","clerkLoaded","state","initialState","deriveFromSsrInitialState","deriveFromClientSideState","userId","user","sessionId","session","organization","orgId","orgRole","orgPermissions","orgSlug","actor","factorVerificationAge","id","slug","membership","organizationMemberships","find","om","permissions","role"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAAA,sBAAA,CAAA;AAAAC,SAAAD,qBAAA;IAAAE,aAAA,IAAAA;AAAA;AAAAC,OAAAC,OAAA,GAAAC,aAAAL;AAaO,IAAME,cAAc,CAACI,aAAsBC,OAAkBC;IAClE,IAAI,CAACF,eAAeE,cAAc;QAChC,OAAOC,0BAA0BD;IACnC;IACA,OAAOE,0BAA0BH;AACnC;AAEA,IAAME,4BAA4B,CAACD;IACjC,MAAMG,SAASH,aAAaG,MAAA;IAC5B,MAAMC,OAAOJ,aAAaI,IAAA;IAC1B,MAAMC,YAAYL,aAAaK,SAAA;IAC/B,MAAMC,UAAUN,aAAaM,OAAA;IAC7B,MAAMC,eAAeP,aAAaO,YAAA;IAClC,MAAMC,QAAQR,aAAaQ,KAAA;IAC3B,MAAMC,UAAUT,aAAaS,OAAA;IAC7B,MAAMC,iBAAiBV,aAAaU,cAAA;IACpC,MAAMC,UAAUX,aAAaW,OAAA;IAC7B,MAAMC,QAAQZ,aAAaY,KAAA;IAC3B,MAAMC,wBAAwBb,aAAaa,qBAAA;IAE3C,OAAO;QACLV;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;IACF;AACF;AAEA,IAAMX,4BAA4B,CAACH;QAW7BK;IAVJ,MAAMD,SAAoCJ,MAAMK,IAAA,GAAOL,MAAMK,IAAA,CAAKU,EAAA,GAAKf,MAAMK,IAAA;IAC7E,MAAMA,OAAOL,MAAMK,IAAA;IACnB,MAAMC,YAAuCN,MAAMO,OAAA,GAAUP,MAAMO,OAAA,CAAQQ,EAAA,GAAKf,MAAMO,OAAA;IACtF,MAAMA,UAAUP,MAAMO,OAAA;IACtB,MAAMO,wBAAiDd,MAAMO,OAAA,GAAUP,MAAMO,OAAA,CAAQO,qBAAA,GAAwB;IAC7G,MAAMD,QAAQN,oBAAAA,8BAAAA,QAASM,KAAA;IACvB,MAAML,eAAeR,MAAMQ,YAAA;IAC3B,MAAMC,QAAmCT,MAAMQ,YAAA,GAAeR,MAAMQ,YAAA,CAAaO,EAAA,GAAKf,MAAMQ,YAAA;IAC5F,MAAMI,UAAUJ,yBAAAA,mCAAAA,aAAcQ,IAAA;IAC9B,MAAMC,aAAaT,eACfH,iBAAAA,4BAAAA,gCAAAA,KAAMa,uBAAA,cAANb,oDAAAA,8BAA+Bc,IAAA,CAAK,CAAAC,KAAMA,GAAGZ,YAAA,CAAaO,EAAA,KAAON,SACjED;IACJ,MAAMG,iBAAiBM,aAAaA,WAAWI,WAAA,GAAcJ;IAC7D,MAAMP,UAAUO,aAAaA,WAAWK,IAAA,GAAOL;IAE/C,OAAO;QACLb;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAE;QACAD;QACAE;QACAC;IACF;AACF"}
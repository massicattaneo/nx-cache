{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/common/base-components/src/CustomSelectArea/CustomSelectArea.tsx"],"sourcesContent":["import { useEffect, useRef, useState } from \"react\"\nimport { Box } from \"@rp/react/web/mui/core\"\n\ntype SelectionState = {\n  x: number\n  y: number\n  text: string | undefined\n}\n\ntype Props = {\n  children: React.ReactNode\n  renderPopup: (selectionState: SelectionState) => React.ReactNode\n  safeAreaTop?: number\n  anchorTop?: number\n}\n\nfunction CustomSelectArea({ children, renderPopup, safeAreaTop = 0, anchorTop = 8 }: Props) {\n  const [selectionState, setSelectionState] = useState<SelectionState>({\n    x: 0,\n    y: 0,\n    text: undefined,\n  })\n\n  const containerRef = useRef<HTMLDivElement>(null)\n  const modalRef = useRef<HTMLDivElement>(null)\n\n  useEffect(() => {\n    function handleSelectionChange() {\n      const selection = document.getSelection()\n      const range = selection?.rangeCount && selection?.getRangeAt(0)\n      const selectedText = range?.toString()\n      if (\n        !range ||\n        !selectedText ||\n        selectedText?.length === 0 ||\n        !containerRef.current ||\n        !containerRef.current.contains(selection?.anchorNode ?? null)\n      ) {\n        setSelectionState(prev => ({ ...prev, text: undefined }))\n        return\n      }\n\n      const clientRect = range.getBoundingClientRect()\n      const modalRect = modalRef.current?.getBoundingClientRect()\n      const containerRect = containerRef.current?.getBoundingClientRect()\n\n      const topContainer = containerRect?.top ?? 0\n      const leftContainer = containerRect?.left ?? 0\n      const topOffset = modalRect?.height ?? 0\n      const leftOffset = (modalRect?.width ?? 0) / 2\n\n      const xPosition = clientRect.left - leftContainer - leftOffset + clientRect.width * 0.5\n      const yPosition = clientRect.top - topContainer\n\n      setSelectionState({\n        x: xPosition,\n        y:\n          yPosition +\n          (clientRect.top < topOffset + safeAreaTop ? topOffset : -topOffset - anchorTop),\n        text: selection?.toString(),\n      })\n    }\n\n    document.addEventListener(\"selectionchange\", handleSelectionChange)\n\n    return () => document.removeEventListener(\"selectionchange\", handleSelectionChange)\n  }, [safeAreaTop, anchorTop])\n\n  return (\n    <Box ref={containerRef} sx={{ position: \"relative\", minWidth: 0 }}>\n      <Box\n        ref={modalRef}\n        sx={{\n          top: 0,\n          left: 0,\n          position: \"absolute\",\n          zIndex: 1000,\n          transform: `translate(${selectionState.x}px, ${selectionState.y}px)`,\n          transition: \"all 0.2s ease-out\",\n          opacity: selectionState.text === undefined ? 0 : 1,\n          pointerEvents: selectionState.text ? undefined : \"none\",\n        }}\n      >\n        {renderPopup(selectionState)}\n      </Box>\n      {children}\n    </Box>\n  )\n}\n\nexport { CustomSelectArea }\n"],"names":["CustomSelectArea","children","renderPopup","safeAreaTop","anchorTop","selectionState","setSelectionState","useState","x","y","text","undefined","containerRef","useRef","modalRef","useEffect","handleSelectionChange","selection","document","getSelection","range","rangeCount","getRangeAt","selectedText","toString","length","current","contains","anchorNode","prev","clientRect","getBoundingClientRect","modalRect","containerRect","topContainer","top","leftContainer","left","topOffset","height","leftOffset","width","xPosition","yPosition","addEventListener","removeEventListener","Box","ref","sx","position","minWidth","zIndex","transform","transition","opacity","pointerEvents"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
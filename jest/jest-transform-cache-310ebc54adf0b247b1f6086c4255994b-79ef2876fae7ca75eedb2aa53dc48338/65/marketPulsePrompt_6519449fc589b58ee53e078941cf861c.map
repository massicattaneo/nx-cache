{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/development/src/lib/trpc/chat-ws-api/marketPulsePrompt.ts"],"sourcesContent":["import { format } from \"date-fns\"\nimport { dbGenerators } from \"../../../database\"\nimport { generateChatMessages } from \"../../database/generators/generateChat\"\nimport { ChatResponseHandler } from \"./chat-handlers.type\"\n\nexport const marketPulsePrompt: ChatResponseHandler = async ({\n  inputMessage,\n  requestId,\n  files,\n}) => {\n  const date = format(Date.now(), \"MMM dd, yyyy\")\n  const content = `#  MORNING DIGEST\\n## ${date}\\n\\n### TOP HEADLINES\\n* **The The Associated Press Co.** is talking with Twitter Inc. about a potential acquisition.`\n  const interaction = dbGenerators.generateChatInteraction({\n    inputMessage,\n    content,\n  })\n  const queries = [{ query: \"Highlights from European market trading sessions\", query_id: 0 }]\n  const messages = generateChatMessages({\n    requestId,\n    interaction,\n    content,\n    queries,\n    files: files.filter(item => item.rpjson),\n  })\n  return {\n    messages: [\n      messages.status(\"Routing your query to the appropriate data source\"),\n      messages.status(\"Searching ...\"),\n      messages.statusQuery(),\n      ...messages.auditTraces(),\n      messages.statusConcluding(),\n      ...messages.next((content, cqsFiles) =>\n        content.split(\"\\n\").map((content, index, array) => {\n          const [file1, file2] = cqsFiles\n          if (index === array.length - 1 && file1 && file2) {\n            const text = `${content} \\`:ref[LIST:[CQS:${file1.rpjson?.document.rp_document_id}-0][CQS:${file1.rpjson?.document.rp_document_id}-1][CQS:${file2.rpjson?.document.rp_document_id}-0]]\\` `\n            return { content: text }\n          }\n          return { content: content + \"\\n\" }\n        }),\n      ),\n      messages.sources([\n        {\n          type: \"EXTERNAL\",\n          name: \"Associated Press News\",\n          hd: \"Read the latest headlines, breaking news, and videos at APNews.com\",\n          url: \"https://apnews.com/\",\n          faviconUrl: \"https://apnews.com/favicon.ico\",\n        },\n      ]),\n      messages.complete(),\n    ],\n    interaction,\n  }\n}\n"],"names":["marketPulsePrompt","inputMessage","requestId","files","date","format","Date","now","content","interaction","dbGenerators","generateChatInteraction","queries","query","query_id","messages","generateChatMessages","filter","item","rpjson","status","statusQuery","auditTraces","statusConcluding","next","cqsFiles","split","map","index","array","file1","file2","length","text","document","rp_document_id","sources","type","name","hd","url","faviconUrl","complete"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAKaA;;;eAAAA;;;yBALU;0BACM;8BACQ;AAG9B,MAAMA,oBAAyC,OAAO,EAC3DC,YAAY,EACZC,SAAS,EACTC,KAAK,EACN;IACC,MAAMC,OAAOC,IAAAA,eAAM,EAACC,KAAKC,GAAG,IAAI;IAChC,MAAMC,UAAU,CAAC,sBAAsB,EAAEJ,KAAK,qHAAqH,CAAC;IACpK,MAAMK,cAAcC,sBAAY,CAACC,uBAAuB,CAAC;QACvDV;QACAO;IACF;IACA,MAAMI,UAAU;QAAC;YAAEC,OAAO;YAAoDC,UAAU;QAAE;KAAE;IAC5F,MAAMC,WAAWC,IAAAA,kCAAoB,EAAC;QACpCd;QACAO;QACAD;QACAI;QACAT,OAAOA,MAAMc,MAAM,CAACC,CAAAA,OAAQA,KAAKC,MAAM;IACzC;IACA,OAAO;QACLJ,UAAU;YACRA,SAASK,MAAM,CAAC;YAChBL,SAASK,MAAM,CAAC;YAChBL,SAASM,WAAW;eACjBN,SAASO,WAAW;YACvBP,SAASQ,gBAAgB;eACtBR,SAASS,IAAI,CAAC,CAAChB,SAASiB,WACzBjB,QAAQkB,KAAK,CAAC,MAAMC,GAAG,CAAC,CAACnB,SAASoB,OAAOC;oBACvC,MAAM,CAACC,OAAOC,MAAM,GAAGN;oBACvB,IAAIG,UAAUC,MAAMG,MAAM,GAAG,KAAKF,SAASC,OAAO;4BACJD,eAAgDA,gBAAgDC;wBAA5I,MAAME,OAAO,CAAC,EAAEzB,QAAQ,kBAAkB,GAAEsB,gBAAAA,MAAMX,MAAM,cAAZW,oCAAAA,cAAcI,QAAQ,CAACC,cAAc,CAAC,QAAQ,GAAEL,iBAAAA,MAAMX,MAAM,cAAZW,qCAAAA,eAAcI,QAAQ,CAACC,cAAc,CAAC,QAAQ,GAAEJ,gBAAAA,MAAMZ,MAAM,cAAZY,oCAAAA,cAAcG,QAAQ,CAACC,cAAc,CAAC,OAAO,CAAC;wBAC1L,OAAO;4BAAE3B,SAASyB;wBAAK;oBACzB;oBACA,OAAO;wBAAEzB,SAASA,UAAU;oBAAK;gBACnC;YAEFO,SAASqB,OAAO,CAAC;gBACf;oBACEC,MAAM;oBACNC,MAAM;oBACNC,IAAI;oBACJC,KAAK;oBACLC,YAAY;gBACd;aACD;YACD1B,SAAS2B,QAAQ;SAClB;QACDjC;IACF;AACF"}
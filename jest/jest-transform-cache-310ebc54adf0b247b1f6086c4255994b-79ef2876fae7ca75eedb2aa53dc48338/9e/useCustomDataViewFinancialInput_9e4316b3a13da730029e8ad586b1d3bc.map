{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/watchlists/src/lib/WatchlistDataTabs/CustomDataView/hooks/useCustomDataViewFinancialInput.ts"],"sourcesContent":["import { useMemo } from \"react\"\nimport { CqsItem } from \"@rp/common/api-types\"\nimport { ColumnDef } from \"@tanstack/react-table\"\nimport { FinanceDataTabs } from \"../../../hooks/useWatchlistsFinanceDataTabNavigation\"\nimport { WatchlistDataTabsTableEntity } from \"../../WatchlistDataTabsTable.types\"\nimport { watchlistDataTables } from \"../../tables\"\nimport { useCustomColumns } from \"./useCustomColumns\"\n\nexport function useCustomDataViewFinancialInput(dataTab: FinanceDataTabs) {\n  const { customColumns } = useCustomColumns()\n\n  // Dynamic financial data input for custom tab\n  const financialDataInput = useMemo(() => {\n    const tableInput = watchlistDataTables[dataTab].financialDataInput\n\n    if (dataTab === \"custom\" && customColumns.length > 0) {\n      // For custom tab, aggregate data requirements from all selected custom columns\n      return (entityIds: Array<CqsItem>) => {\n        const endpointsSet = new Set<string>()\n        let extraFinanceData = {}\n\n        // Collect requirements from each custom column\n        customColumns.forEach(customCol => {\n          const sourceTable = watchlistDataTables[customCol.sourceTab as FinanceDataTabs]\n          if (sourceTable) {\n            const sourceColumn = sourceTable.columns.find(\n              (colDef: ColumnDef<WatchlistDataTabsTableEntity>) => {\n                return (\n                  colDef.meta?.endpoint === customCol.endpoint &&\n                  colDef.meta?.columnKeys?.includes(customCol.columnKey)\n                )\n              },\n            )\n\n            if (sourceColumn?.meta?.endpoint) {\n              endpointsSet.add(sourceColumn.meta.endpoint)\n\n              // Include extraFinanceData if the column has it\n              if (sourceColumn.meta.extraFinanceData) {\n                const extra = sourceColumn.meta.extraFinanceData(\n                  entityIds.map(entity => entity.key),\n                )\n                extraFinanceData = { ...extraFinanceData, ...extra }\n              }\n            }\n          }\n        })\n\n        // Build the financial data input\n        const endpoints = Array.from(endpointsSet)\n        const endpointInput = endpoints.reduce((acc, endpoint) => {\n          return {\n            ...acc,\n            [endpoint]: {\n              entityIds: entityIds.map(entity => entity.key),\n            },\n          }\n        }, {})\n\n        return {\n          ...endpointInput,\n          ...extraFinanceData,\n        }\n      }\n    }\n\n    return tableInput\n  }, [dataTab, customColumns])\n\n  return { financialDataInput }\n}\n"],"names":["useCustomDataViewFinancialInput","dataTab","customColumns","useCustomColumns","financialDataInput","useMemo","tableInput","watchlistDataTables","length","entityIds","endpointsSet","Set","extraFinanceData","forEach","customCol","sourceTable","sourceTab","sourceColumn","columns","find","colDef","meta","endpoint","columnKeys","includes","columnKey","add","extra","map","entity","key","endpoints","Array","from","endpointInput","reduce","acc"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAQgBA;;;eAAAA;;;uBARQ;wBAKY;kCACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAE1B,SAASA,gCAAgCC,OAAwB;IACtE,MAAM,EAAEC,aAAa,EAAE,GAAGC,IAAAA,kCAAgB;IAE1C,8CAA8C;IAC9C,MAAMC,qBAAqBC,IAAAA,cAAO,EAAC;QACjC,MAAMC,aAAaC,2BAAmB,CAACN,QAAQ,CAACG,kBAAkB;QAElE,IAAIH,YAAY,YAAYC,cAAcM,MAAM,GAAG,GAAG;YACpD,+EAA+E;YAC/E,OAAO,CAACC;gBACN,MAAMC,eAAe,IAAIC;gBACzB,IAAIC,mBAAmB,CAAC;gBAExB,+CAA+C;gBAC/CV,cAAcW,OAAO,CAACC,CAAAA;oBACpB,MAAMC,cAAcR,2BAAmB,CAACO,UAAUE,SAAS,CAAoB;oBAC/E,IAAID,aAAa;4BAUXE;wBATJ,MAAMA,eAAeF,YAAYG,OAAO,CAACC,IAAI,CAC3C,CAACC;gCAEGA,cACAA,yBAAAA;4BAFF,OACEA,EAAAA,eAAAA,OAAOC,IAAI,cAAXD,mCAAAA,aAAaE,QAAQ,MAAKR,UAAUQ,QAAQ,MAC5CF,gBAAAA,OAAOC,IAAI,cAAXD,qCAAAA,0BAAAA,cAAaG,UAAU,cAAvBH,8CAAAA,wBAAyBI,QAAQ,CAACV,UAAUW,SAAS;wBAEzD;wBAGF,IAAIR,yBAAAA,oCAAAA,qBAAAA,aAAcI,IAAI,cAAlBJ,yCAAAA,mBAAoBK,QAAQ,EAAE;4BAChCZ,aAAagB,GAAG,CAACT,aAAaI,IAAI,CAACC,QAAQ;4BAE3C,gDAAgD;4BAChD,IAAIL,aAAaI,IAAI,CAACT,gBAAgB,EAAE;gCACtC,MAAMe,QAAQV,aAAaI,IAAI,CAACT,gBAAgB,CAC9CH,UAAUmB,GAAG,CAACC,CAAAA,SAAUA,OAAOC,GAAG;gCAEpClB,mBAAmB,mBAAKA,kBAAqBe;4BAC/C;wBACF;oBACF;gBACF;gBAEA,iCAAiC;gBACjC,MAAMI,YAAYC,MAAMC,IAAI,CAACvB;gBAC7B,MAAMwB,gBAAgBH,UAAUI,MAAM,CAAC,CAACC,KAAKd;oBAC3C,OAAO,wCACFc;wBACH,CAACd,SAAS,EAAE;4BACVb,WAAWA,UAAUmB,GAAG,CAACC,CAAAA,SAAUA,OAAOC,GAAG;wBAC/C;;gBAEJ,GAAG,CAAC;gBAEJ,OAAO,mBACFI,eACAtB;YAEP;QACF;QAEA,OAAON;IACT,GAAG;QAACL;QAASC;KAAc;IAE3B,OAAO;QAAEE;IAAmB;AAC9B"}
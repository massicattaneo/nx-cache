{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/tanstack-api/chat/src/enrichEngineCharWidgetSpec.ts"],"sourcesContent":["import pako from \"pako\"\nimport { axiosClient } from \"@rp/react/axios-client\"\nimport { QueryClient } from \"@tanstack/react-query\"\nimport { SeededInteraction, UserInteraction } from \"./chat.types\"\n\nconst retrieveEngineChartWidgetSpec = (widgetSpecUrl: string) => {\n  return async () => {\n    const { data } = await axiosClient.get(widgetSpecUrl, {\n      responseType: \"arraybuffer\",\n      withCredentials: false,\n    })\n    return data\n  }\n}\n\nexport const enrichEngineCharWidgetSpec = async (\n  queryClient: QueryClient,\n  interaction: UserInteraction | SeededInteraction,\n) => {\n  if (\n    interaction.responseBlock !== undefined &&\n    interaction.responseBlock.type === \"ENGINE\" &&\n    interaction.responseBlock.widgetSpecUrl\n  ) {\n    const { widgetSpecUrl } = interaction.responseBlock\n    const widgetSpec = await queryClient\n      .fetchQuery({\n        queryKey: [\"engine-chart-widget-spec\", widgetSpecUrl],\n        queryFn: retrieveEngineChartWidgetSpec(widgetSpecUrl),\n      })\n      .then(arr => JSON.parse(pako.inflate(arr, { to: \"string\" })))\n      .catch(() => ({}))\n\n    Object.assign(interaction.responseBlock, { widgetSpec })\n  }\n  return interaction\n}\n"],"names":["enrichEngineCharWidgetSpec","retrieveEngineChartWidgetSpec","widgetSpecUrl","data","axiosClient","get","responseType","withCredentials","queryClient","interaction","responseBlock","undefined","type","widgetSpec","fetchQuery","queryKey","queryFn","then","arr","JSON","parse","pako","inflate","to","catch","Object","assign"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAeaA;;;eAAAA;;;6DAfI;6BACW;;;;;;AAI5B,MAAMC,gCAAgC,CAACC;IACrC,OAAO;QACL,MAAM,EAAEC,IAAI,EAAE,GAAG,MAAMC,wBAAW,CAACC,GAAG,CAACH,eAAe;YACpDI,cAAc;YACdC,iBAAiB;QACnB;QACA,OAAOJ;IACT;AACF;AAEO,MAAMH,6BAA6B,OACxCQ,aACAC;IAEA,IACEA,YAAYC,aAAa,KAAKC,aAC9BF,YAAYC,aAAa,CAACE,IAAI,KAAK,YACnCH,YAAYC,aAAa,CAACR,aAAa,EACvC;QACA,MAAM,EAAEA,aAAa,EAAE,GAAGO,YAAYC,aAAa;QACnD,MAAMG,aAAa,MAAML,YACtBM,UAAU,CAAC;YACVC,UAAU;gBAAC;gBAA4Bb;aAAc;YACrDc,SAASf,8BAA8BC;QACzC,GACCe,IAAI,CAACC,CAAAA,MAAOC,KAAKC,KAAK,CAACC,aAAI,CAACC,OAAO,CAACJ,KAAK;gBAAEK,IAAI;YAAS,KACxDC,KAAK,CAAC,IAAO,CAAA,CAAC,CAAA;QAEjBC,OAAOC,MAAM,CAACjB,YAAYC,aAAa,EAAE;YAAEG;QAAW;IACxD;IACA,OAAOJ;AACT"}
{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/common/watchlist-editor/src/WatchlistSuggestionList.mobile.tsx"],"sourcesContent":["import { useCallback, useMemo, useState } from \"react\"\nimport { Watchlist } from \"@rp/common/api-types\"\nimport { WATCHLIST_ENTITIES_FEATURE_NAME } from \"@rp/common/settings\"\nimport { formatNumber } from \"@rp/common/utils\"\nimport { useIsWatchlistEntityLimitMet } from \"@rp/react/common/hooks\"\nimport { useAccount } from \"@rp/react/common/providers\"\nimport { usePanelConfig } from \"@rp/react/tanstack-api/discovery-panel-config\"\nimport {\n  WatchlistAutosuggestPostResponse,\n  isEnhancedCqsItemSuggestion,\n} from \"@rp/react/tanstack-api/suggestion\"\nimport { InfiniteList } from \"@rp/react/web/common/composite-components\"\nimport { useModal } from \"@rp/react/web/common/providers\"\nimport { Box, Typography } from \"@rp/react/web/mui/core\"\nimport { AddItemsButtonMobile } from \"./AddItemsButton\"\nimport { LoadingSuggestion } from \"./LoadingSuggestion\"\nimport { WatchlistEmptyPlaceholder } from \"./WatchlistEmptyPlaceholder\"\nimport { WatchlistSuggestionItemMobile } from \"./WatchlistSuggestionItem.mobile\"\nimport { getDisplayCategories } from \"./WatchlistSuggestionList\"\n\ntype Props = {\n  pages: Array<WatchlistAutosuggestPostResponse>\n  included: Array<string>\n  isLoading: boolean\n  onAddSuggestions: (ids: Array<string>) => void\n  categoryFilter?: string\n  isPatching?: boolean\n  fetchNextPage?: () => Promise<unknown>\n  hasMore?: boolean\n  hasFilter?: boolean\n  watchlist: Watchlist | undefined\n}\n\nconst MOBILE_MENU_HEIGHT = 28\n\nconst WatchlistSuggestionListMobile = ({\n  pages,\n  included,\n  isLoading,\n  onAddSuggestions,\n  categoryFilter,\n  isPatching,\n  fetchNextPage,\n  hasMore,\n  hasFilter,\n  watchlist,\n}: Props) => {\n  const {\n    planComparisonModal: { handleOpen: planComparisonHandleOpen },\n  } = useModal()\n\n  const suggestions = useMemo(\n    () =>\n      pages\n        .map(i => i.results)\n        .flat()\n        .filter(isEnhancedCqsItemSuggestion),\n    [pages],\n  )\n  const [selectedSuggestions, setSelectedSuggestions] = useState<Array<string>>([])\n  const { quota } = useAccount()\n  const isWatchlistEntityLimitMet = useIsWatchlistEntityLimitMet(\n    quota,\n    included.length + selectedSuggestions.length,\n  )\n  const { data: panelConfig } = usePanelConfig()\n  const [categoryFields] = useMemo(() => {\n    const categoryMap = getDisplayCategories(panelConfig?.discoveryPanelCategories ?? [])\n    return categoryFilter\n      ? [categoryMap[categoryFilter].fields, categoryMap[categoryFilter].title]\n      : [[], undefined]\n  }, [categoryFilter, panelConfig])\n\n  const addSelectedSuggestion = useCallback((key: string) => {\n    setSelectedSuggestions(prev => [...prev, key])\n  }, [])\n\n  const removeSelectedSuggestion = useCallback((key: string) => {\n    setSelectedSuggestions(prev => {\n      const filteredSuggestions = prev.filter(selectedKey => selectedKey !== key)\n      return filteredSuggestions\n    })\n  }, [])\n\n  const numOfResults = pages[0]?.count ?? 0\n  const hasResults = !(!isLoading && suggestions.length === 0)\n  return (\n    <Box sx={{ width: \"100%\", height: \"100%\" }}>\n      <Box\n        sx={{\n          position: \"sticky\",\n          height: MOBILE_MENU_HEIGHT,\n          justifyContent: \"space-between\",\n          alignItems: \"end\",\n          backgroundColor: \"surface.main\",\n          pt: 0,\n          pl: 2,\n          zIndex: 1,\n        }}\n      >\n        <Box\n          sx={{\n            display: \"flex\",\n            width: \"100%\",\n            alignItems: \"center\",\n            minHeight: 33,\n          }}\n        >\n          <Typography color=\"grey.300\" variant=\"caption\" sx={{ flexGrow: 1, whiteSpace: \"nowrap\" }}>\n            {isLoading\n              ? \"\"\n              : `Showing ${formatNumber(numOfResults)} item${numOfResults > 1 ? \"s\" : \"\"}`}\n          </Typography>\n          {!isLoading ? (\n            <AddItemsButtonMobile\n              amount={selectedSuggestions.length}\n              onClick={() => {\n                if (isWatchlistEntityLimitMet) {\n                  planComparisonHandleOpen(WATCHLIST_ENTITIES_FEATURE_NAME)\n                  return\n                }\n                setSelectedSuggestions([])\n                onAddSuggestions(selectedSuggestions)\n              }}\n              loading={isPatching}\n              watchlistItemsCount={watchlist?.items.length ?? 0}\n            />\n          ) : null}\n        </Box>\n      </Box>\n      {!hasResults ? (\n        <Box sx={{ display: \"flex\", alignItems: \"center\", height: \"calc(100% - 58px)\" }}>\n          <WatchlistEmptyPlaceholder\n            placeholder={\n              \"We couldn't find any results that match your search criteria. Please try again with different keywords.\"\n            }\n          />\n        </Box>\n      ) : null}\n\n      {hasResults ? (\n        isLoading ? (\n          new Array(20).fill(0).map((_, index) => {\n            return <LoadingSuggestion key={index} extraColumns={0} />\n          })\n        ) : (\n          <InfiniteList\n            items={suggestions.map(s => ({ ...s, id: s.id ?? s.key }))}\n            fetchNextPage={fetchNextPage}\n            hasMore={hasMore}\n            renderItem={suggestion => {\n              return (\n                <WatchlistSuggestionItemMobile\n                  hasFilter={hasFilter}\n                  disabled={isPatching}\n                  isLoading={false}\n                  key={suggestion.key}\n                  suggestion={suggestion}\n                  selected={\n                    included.includes(suggestion.key) ||\n                    selectedSuggestions.includes(suggestion.key)\n                  }\n                  included={included.includes(suggestion.key)}\n                  onChange={(key, value) =>\n                    value ? addSelectedSuggestion(key) : removeSelectedSuggestion(key)\n                  }\n                  categoryFilter={categoryFilter}\n                  fields={categoryFields}\n                />\n              )\n            }}\n          />\n        )\n      ) : null}\n    </Box>\n  )\n}\n\nexport { WatchlistSuggestionListMobile }\n"],"names":["WatchlistSuggestionListMobile","MOBILE_MENU_HEIGHT","pages","included","isLoading","onAddSuggestions","categoryFilter","isPatching","fetchNextPage","hasMore","hasFilter","watchlist","planComparisonModal","handleOpen","planComparisonHandleOpen","useModal","suggestions","useMemo","map","i","results","flat","filter","isEnhancedCqsItemSuggestion","selectedSuggestions","setSelectedSuggestions","useState","quota","useAccount","isWatchlistEntityLimitMet","useIsWatchlistEntityLimitMet","length","data","panelConfig","usePanelConfig","categoryFields","categoryMap","getDisplayCategories","discoveryPanelCategories","fields","title","undefined","addSelectedSuggestion","useCallback","key","prev","removeSelectedSuggestion","filteredSuggestions","selectedKey","numOfResults","count","hasResults","Box","sx","width","height","position","justifyContent","alignItems","backgroundColor","pt","pl","zIndex","display","minHeight","Typography","color","variant","flexGrow","whiteSpace","formatNumber","AddItemsButtonMobile","amount","onClick","WATCHLIST_ENTITIES_FEATURE_NAME","loading","watchlistItemsCount","items","WatchlistEmptyPlaceholder","placeholder","Array","fill","_","index","LoadingSuggestion","extraColumns","InfiniteList","s","id","renderItem","suggestion","WatchlistSuggestionItemMobile","disabled","selected","includes","onChange","value"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/rpql/src/lib/rpql-utils/generateMapBuilder.ts"],"sourcesContent":["import { RpqlFilter } from \"@rp/common/api-types\"\nimport { RpqlFilterMap, RpqlFlatFilter } from \"@rp/common/api-types\"\nimport { addFilterToMap } from \"./addFilterToMap\"\nimport { buildQueryFromMap } from \"./buildQueryFromMap\"\nimport { collectFiltersFromLogicalGroups } from \"./collectFiltersFromLogicalGroups\"\nimport { getFilterFromMap } from \"./getFilterFromMap\"\nimport { removeFiltersFromMap } from \"./removeFiltersFromMap\"\nimport { UpdateSignature, updateFilterInMap } from \"./updateFilterInMap\"\n\nexport const generateMapBuilder = (\n  root: string,\n  filterMap: RpqlFilterMap,\n  setFilterMap?: (filterMap: RpqlFilterMap) => void,\n) => {\n  return () => {\n    const errors: Array<string> = []\n    let builderMap = filterMap\n    return {\n      add: (parentId: string, filter: RpqlFilter) => {\n        const parent = getFilterFromMap(parentId, builderMap)\n        const { map, error } = addFilterToMap(builderMap, parent, filter)\n        if (error) {\n          errors.push(error)\n        }\n        builderMap = map\n      },\n      remove: (idToRemove: string) => {\n        const get = <TFilter extends RpqlFlatFilter>(id: string) =>\n          getFilterFromMap<TFilter>(id, builderMap)\n        const allFilters = collectFiltersFromLogicalGroups([idToRemove], get)\n        const { map, error } = removeFiltersFromMap(builderMap, allFilters, root)\n        if (error) {\n          errors.push(error)\n        }\n        builderMap = map\n      },\n      update: <TFilter extends RpqlFlatFilter>(\n        filterId: string,\n        update: UpdateSignature<TFilter>,\n      ) => {\n        const filter = getFilterFromMap<TFilter>(filterId, builderMap)\n        const { map, error } = updateFilterInMap(builderMap, filter, update)\n        if (error) {\n          errors.push(error)\n        }\n        builderMap = map\n      },\n      findChild: (condition: (filter: RpqlFlatFilter) => boolean) => {\n        return Object.values(builderMap).find(condition) || null\n      },\n      generate: () => {\n        if (errors.length) throw new Error(errors.toString())\n        setFilterMap?.(builderMap)\n        return buildQueryFromMap(root, builderMap)\n      },\n      build: () => {\n        if (errors.length) throw new Error(errors.toString())\n        return buildQueryFromMap(root, builderMap)\n      },\n      getFilterMap: () => builderMap,\n    }\n  }\n}\n"],"names":["generateMapBuilder","root","filterMap","setFilterMap","errors","builderMap","add","parentId","filter","parent","getFilterFromMap","map","error","addFilterToMap","push","remove","idToRemove","get","id","allFilters","collectFiltersFromLogicalGroups","removeFiltersFromMap","update","filterId","updateFilterInMap","findChild","condition","Object","values","find","generate","length","Error","toString","buildQueryFromMap","build","getFilterMap"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BASaA;;;eAAAA;;;gCAPkB;mCACG;iDACc;kCACf;sCACI;mCACc;AAE5C,MAAMA,qBAAqB,CAChCC,MACAC,WACAC;IAEA,OAAO;QACL,MAAMC,SAAwB,EAAE;QAChC,IAAIC,aAAaH;QACjB,OAAO;YACLI,KAAK,CAACC,UAAkBC;gBACtB,MAAMC,SAASC,IAAAA,kCAAgB,EAACH,UAAUF;gBAC1C,MAAM,EAAEM,GAAG,EAAEC,KAAK,EAAE,GAAGC,IAAAA,8BAAc,EAACR,YAAYI,QAAQD;gBAC1D,IAAII,OAAO;oBACTR,OAAOU,IAAI,CAACF;gBACd;gBACAP,aAAaM;YACf;YACAI,QAAQ,CAACC;gBACP,MAAMC,MAAM,CAAiCC,KAC3CR,IAAAA,kCAAgB,EAAUQ,IAAIb;gBAChC,MAAMc,aAAaC,IAAAA,gEAA+B,EAAC;oBAACJ;iBAAW,EAAEC;gBACjE,MAAM,EAAEN,GAAG,EAAEC,KAAK,EAAE,GAAGS,IAAAA,0CAAoB,EAAChB,YAAYc,YAAYlB;gBACpE,IAAIW,OAAO;oBACTR,OAAOU,IAAI,CAACF;gBACd;gBACAP,aAAaM;YACf;YACAW,QAAQ,CACNC,UACAD;gBAEA,MAAMd,SAASE,IAAAA,kCAAgB,EAAUa,UAAUlB;gBACnD,MAAM,EAAEM,GAAG,EAAEC,KAAK,EAAE,GAAGY,IAAAA,oCAAiB,EAACnB,YAAYG,QAAQc;gBAC7D,IAAIV,OAAO;oBACTR,OAAOU,IAAI,CAACF;gBACd;gBACAP,aAAaM;YACf;YACAc,WAAW,CAACC;gBACV,OAAOC,OAAOC,MAAM,CAACvB,YAAYwB,IAAI,CAACH,cAAc;YACtD;YACAI,UAAU;gBACR,IAAI1B,OAAO2B,MAAM,EAAE,MAAM,IAAIC,MAAM5B,OAAO6B,QAAQ;gBAClD9B,yBAAAA,mCAAAA,aAAeE;gBACf,OAAO6B,IAAAA,oCAAiB,EAACjC,MAAMI;YACjC;YACA8B,OAAO;gBACL,IAAI/B,OAAO2B,MAAM,EAAE,MAAM,IAAIC,MAAM5B,OAAO6B,QAAQ;gBAClD,OAAOC,IAAAA,oCAAiB,EAACjC,MAAMI;YACjC;YACA+B,cAAc,IAAM/B;QACtB;IACF;AACF"}
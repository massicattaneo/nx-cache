{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/apps/client-web/src/app/components/Hub/Files/FilesList/FilesListV2.tsx"],"sourcesContent":["import {\n  ChangeEvent,\n  Dispatch,\n  SetStateAction,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\"\nimport compact from \"lodash/compact\"\nimport { useParams } from \"react-router\"\nimport { MAX_SELECTABLE_FILES } from \"@rp/common/settings\"\nimport { useAccount } from \"@rp/react/common/providers\"\nimport { FILES_INFINITE_PAGE_SIZE, PrivateSharedContentOwner } from \"@rp/react/tanstack-api/file\"\nimport { LoadingSpinner, RPTooltip } from \"@rp/react/web/common/base-components\"\nimport {\n  FindNoResults,\n  HubSortableHeadCell,\n  HubTableRow,\n} from \"@rp/react/web/common/composite-components\"\nimport { InfiniteList } from \"@rp/react/web/common/composite-components\"\nimport { useFileActions, useFileList } from \"@rp/react/web/common/files\"\nimport { Box, Checkbox, IconButton, Typography } from \"@rp/react/web/mui/core\"\nimport { ChatBubbleOutline, Delete } from \"@rp/react/web/mui/icons\"\nimport { SelectItem } from \"../../../../pages/Files/FilesV2/filesPage.types\"\nimport { SelectedFile } from \"../Files\"\nimport { FilesListItemV2 } from \"./FilesListItemV2\"\nimport { FilesListNoUploaded } from \"./FilesListNoUploaded\"\nimport { COLUMNS_WIDTH, COLUMNS_WIDTH_MINIMAL, SORT_OPTIONS } from \"./filesList.constants\"\nimport { handleCheckboxChangeFunc } from \"./filesList.utils\"\nimport { useShouldUseMinimalList } from \"./hooks\"\n\ntype Props = {\n  filterTerm: string\n  selectedFiles: Array<SelectedFile>\n  setSelectedFiles: Dispatch<SetStateAction<Array<SelectedFile>>>\n  shared?: boolean\n  openChatPane: () => void\n  ownersSelected: Array<SelectItem>\n  ownersList: Array<PrivateSharedContentOwner> | undefined\n  isChatPaneOpen: boolean\n}\n\nfunction FilesListV2({\n  filterTerm,\n  selectedFiles,\n  shared = false,\n  setSelectedFiles,\n  openChatPane,\n  ownersSelected,\n  ownersList,\n  isChatPaneOpen,\n}: Props) {\n  const [state, setState] = useState(FILES_INFINITE_PAGE_SIZE)\n  const { actions, deleteFiles } = useFileActions({ isForFilesPage: true })\n  const {\n    uploading,\n    filteredFiles,\n    isLoadingFiles,\n    allFiles,\n    sortBy,\n    direction,\n    onChange,\n    completedFiltered,\n    hasNextPage,\n    fetchNextPage,\n    isFetchingNextPage,\n    isPlaceholderData,\n  } = useFileList({ filterTerm, ownership: \"all\", ownersSelected, ownersList })\n\n  const { setDivRef, shouldUseMinimalList } = useShouldUseMinimalList()\n  const columnsWidth = shouldUseMinimalList ? COLUMNS_WIDTH_MINIMAL : COLUMNS_WIDTH\n\n  const { hasEntitlement } = useAccount()\n  const { id: currentOpenDocumentID } = useParams()\n\n  useEffect(() => {\n    setState(FILES_INFINITE_PAGE_SIZE)\n  }, [filterTerm])\n\n  const handleCheckboxChange = useCallback(\n    (ev: ChangeEvent<HTMLInputElement>, val: boolean) =>\n      handleCheckboxChangeFunc({ ev, val, setSelectedFiles, completedFiltered, shared }),\n    [completedFiltered, setSelectedFiles, shared],\n  )\n\n  const shouldShowChatIcon = hasEntitlement(\"chat:file\")\n  const shouldShowDeleteIcon =\n    selectedFiles.every(file => !file.shared) && !shared && selectedFiles.length > 0\n  const shouldShowIconBox = shouldShowChatIcon || shouldShowDeleteIcon\n  const isChatDisabled = selectedFiles.length > MAX_SELECTABLE_FILES || isChatPaneOpen\n\n  const columns = useMemo(\n    () =>\n      compact([\n        {\n          node: (\n            <Checkbox\n              disabled={!!uploading.length}\n              checked={\n                selectedFiles.length === completedFiltered.length && completedFiltered.length > 0\n              }\n              onChange={handleCheckboxChange}\n            />\n          ),\n        },\n        {\n          node: <Typography sx={{ fontSize: 11, fontWeight: 700 }}>TYPE</Typography>,\n        },\n        {\n          node: (\n            <HubSortableHeadCell\n              label=\"NAME\"\n              value=\"name\"\n              onChange={onChange}\n              sortBy={sortBy}\n              direction={direction}\n              sortOptions={SORT_OPTIONS}\n              shouldPreventMobileFormat\n            />\n          ),\n        },\n        !shouldUseMinimalList && {\n          node: <Typography sx={{ fontSize: 11, fontWeight: 700 }}>OWNER</Typography>,\n        },\n        !shouldUseMinimalList && {\n          node: (\n            <HubSortableHeadCell\n              label=\"UPLOAD DATE\"\n              value=\"date\"\n              onChange={onChange}\n              sortBy={sortBy}\n              direction={direction}\n              sortOptions={SORT_OPTIONS}\n              defaultDirection=\"desc\"\n              shouldPreventMobileFormat\n            />\n          ),\n        },\n        !shouldUseMinimalList && {\n          node: (\n            <HubSortableHeadCell\n              label=\"FILE SIZE\"\n              value=\"size\"\n              onChange={onChange}\n              sortBy={sortBy}\n              direction={direction}\n              sortOptions={SORT_OPTIONS}\n              defaultDirection=\"desc\"\n              shouldPreventMobileFormat\n            />\n          ),\n        },\n        {\n          node: shouldShowIconBox ? (\n            <Box\n              sx={{\n                textAlign: \"right\",\n                width: \"90px\",\n                marginLeft: shouldUseMinimalList ? -5 : 2,\n              }}\n            >\n              {shouldShowChatIcon && (\n                <RPTooltip\n                  title={\n                    selectedFiles.length > MAX_SELECTABLE_FILES\n                      ? \"You can only add a maximum of 10 files\"\n                      : \"Chat\"\n                  }\n                  placement=\"top\"\n                >\n                  <span>\n                    <IconButton\n                      sx={{ mr: shouldUseMinimalList ? 0 : 1 }}\n                      onClick={openChatPane}\n                      disabled={isChatDisabled}\n                    >\n                      <ChatBubbleOutline />\n                    </IconButton>\n                  </span>\n                </RPTooltip>\n              )}\n              {shouldShowDeleteIcon ? (\n                <IconButton\n                  sx={{ p: \"5px\" }}\n                  onClick={() => {\n                    deleteFiles(selectedFiles.map(i => i.id)).then(() => {\n                      setSelectedFiles([])\n                    })\n                  }}\n                >\n                  <Delete />\n                </IconButton>\n              ) : (\n                <Box sx={{ width: 34, display: \"inline-block\" }} />\n              )}\n            </Box>\n          ) : (\n            <>&nbsp;</>\n          ),\n        },\n      ]),\n    [\n      completedFiltered.length,\n      deleteFiles,\n      direction,\n      handleCheckboxChange,\n      isChatDisabled,\n      onChange,\n      openChatPane,\n      selectedFiles,\n      setSelectedFiles,\n      shouldShowChatIcon,\n      shouldShowDeleteIcon,\n      shouldShowIconBox,\n      shouldUseMinimalList,\n      sortBy,\n      uploading.length,\n    ],\n  )\n\n  if (isLoadingFiles) return <LoadingSpinner />\n\n  if (filterTerm.length > 0 && filteredFiles.length === 0) {\n    return <FindNoResults text=\"No files found for your search.\" isLoading={isPlaceholderData} />\n  }\n\n  if (allFiles.length === 0) {\n    return <FilesListNoUploaded isLoading={isPlaceholderData} />\n  }\n\n  return (\n    <Box sx={{ width: 1, mt: 1 }} ref={setDivRef}>\n      <HubTableRow\n        sx={{\n          backgroundColor: \"transparent\",\n          gap: 0,\n          marginLeft: \"3px\",\n        }}\n        columnsWidth={columnsWidth}\n        columns={columns}\n        shouldPreventMobileFormat\n      />\n\n      <InfiniteList\n        state={state}\n        setState={setState}\n        rootMargin={\"0px 0px 300px 0px\"}\n        initialElements={FILES_INFINITE_PAGE_SIZE}\n        pageSize={FILES_INFINITE_PAGE_SIZE}\n        items={filteredFiles}\n        fetchNextPage={fetchNextPage}\n        hasMore={hasNextPage}\n        loading={isFetchingNextPage}\n        renderItem={item => (\n          <FilesListItemV2\n            shouldUseMinimalList={shouldUseMinimalList}\n            isThisFileOpen={currentOpenDocumentID === item.id}\n            shared={shared}\n            isPlaceholderData={isPlaceholderData}\n            filterTerm={filterTerm}\n            selectedFiles={selectedFiles}\n            setSelectedFiles={setSelectedFiles}\n            actions={actions}\n            item={item}\n            columnsWidth={columnsWidth}\n            openChatPane={openChatPane}\n          />\n        )}\n      />\n    </Box>\n  )\n}\n\nexport { FilesListV2 }\n"],"names":["FilesListV2","filterTerm","selectedFiles","shared","setSelectedFiles","openChatPane","ownersSelected","ownersList","isChatPaneOpen","state","setState","useState","FILES_INFINITE_PAGE_SIZE","actions","deleteFiles","useFileActions","isForFilesPage","uploading","filteredFiles","isLoadingFiles","allFiles","sortBy","direction","onChange","completedFiltered","hasNextPage","fetchNextPage","isFetchingNextPage","isPlaceholderData","useFileList","ownership","setDivRef","shouldUseMinimalList","useShouldUseMinimalList","columnsWidth","COLUMNS_WIDTH_MINIMAL","COLUMNS_WIDTH","hasEntitlement","useAccount","id","currentOpenDocumentID","useParams","useEffect","handleCheckboxChange","useCallback","ev","val","handleCheckboxChangeFunc","shouldShowChatIcon","shouldShowDeleteIcon","every","file","length","shouldShowIconBox","isChatDisabled","MAX_SELECTABLE_FILES","columns","useMemo","compact","node","Checkbox","disabled","checked","Typography","sx","fontSize","fontWeight","HubSortableHeadCell","label","value","sortOptions","SORT_OPTIONS","shouldPreventMobileFormat","defaultDirection","Box","textAlign","width","marginLeft","RPTooltip","title","placement","span","IconButton","mr","onClick","ChatBubbleOutline","p","map","i","then","Delete","display","LoadingSpinner","FindNoResults","text","isLoading","FilesListNoUploaded","mt","ref","HubTableRow","backgroundColor","gap","InfiniteList","rootMargin","initialElements","pageSize","items","hasMore","loading","renderItem","item","FilesListItemV2","isThisFileOpen"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
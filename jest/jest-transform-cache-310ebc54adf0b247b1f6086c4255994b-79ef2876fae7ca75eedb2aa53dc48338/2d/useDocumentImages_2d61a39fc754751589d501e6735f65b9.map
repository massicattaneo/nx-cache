{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/tanstack-api/document-images/src/useDocumentImages.ts"],"sourcesContent":["import { useEffect, useMemo, useState } from \"react\"\nimport { getApiEnvironmentConfig } from \"@rp/common/utils\"\nimport { axiosClient } from \"@rp/react/axios-client\"\nimport { useQueryClient } from \"@tanstack/react-query\"\n\ntype Ret = Record<string, Array<string> | undefined>\n\nconst useDocumentsImages = (ids: Array<string>) => {\n  const queryClient = useQueryClient()\n  const [isLoading, setIsLoading] = useState(true)\n  const [isFetching, setIsFetching] = useState(false)\n  const { url } = getApiEnvironmentConfig()\n\n  useEffect(() => {\n    const initialLoading =\n      !!ids\n        .map(id => queryClient.getQueryData<Array<string>>([\"documents-images\", id]))\n        .filter(val => !val).length || ids.length === 0\n    setIsLoading(initialLoading)\n  }, [ids, queryClient])\n\n  const data = useMemo(() => {\n    const init: Ret = {}\n    if (isLoading) return {}\n    return ids.reduce((acc, id) => {\n      return { ...acc, [id]: queryClient.getQueryData<Array<string>>([\"documents-images\", id]) }\n    }, init)\n  }, [ids, isLoading, queryClient])\n\n  if (isLoading && !isFetching && ids.length > 0) {\n    setIsFetching(true)\n    axiosClient.post<Ret>(`${url}/document/images`, { ids }).then(res => {\n      ids.forEach(id => {\n        queryClient.setQueryData([\"documents-images\", id], res.data[id] ?? [])\n      })\n      setIsFetching(false)\n      setIsLoading(false)\n    })\n  }\n\n  return {\n    isLoading,\n    data,\n  }\n}\n\nexport { useDocumentsImages }\n"],"names":["useDocumentsImages","ids","queryClient","useQueryClient","isLoading","setIsLoading","useState","isFetching","setIsFetching","url","getApiEnvironmentConfig","useEffect","initialLoading","map","id","getQueryData","filter","val","length","data","useMemo","init","reduce","acc","axiosClient","post","then","res","forEach","setQueryData"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BA8CSA;;;eAAAA;;;uBA9CoC;uBACL;6BACZ;4BACG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAI/B,MAAMA,qBAAqB,CAACC;IAC1B,MAAMC,cAAcC,IAAAA,0BAAc;IAClC,MAAM,CAACC,WAAWC,aAAa,GAAGC,IAAAA,eAAQ,EAAC;IAC3C,MAAM,CAACC,YAAYC,cAAc,GAAGF,IAAAA,eAAQ,EAAC;IAC7C,MAAM,EAAEG,GAAG,EAAE,GAAGC,IAAAA,8BAAuB;IAEvCC,IAAAA,gBAAS,EAAC;QACR,MAAMC,iBACJ,CAAC,CAACX,IACCY,GAAG,CAACC,CAAAA,KAAMZ,YAAYa,YAAY,CAAgB;gBAAC;gBAAoBD;aAAG,GAC1EE,MAAM,CAACC,CAAAA,MAAO,CAACA,KAAKC,MAAM,IAAIjB,IAAIiB,MAAM,KAAK;QAClDb,aAAaO;IACf,GAAG;QAACX;QAAKC;KAAY;IAErB,MAAMiB,OAAOC,IAAAA,cAAO,EAAC;QACnB,MAAMC,OAAY,CAAC;QACnB,IAAIjB,WAAW,OAAO,CAAC;QACvB,OAAOH,IAAIqB,MAAM,CAAC,CAACC,KAAKT;YACtB,OAAO,wCAAKS;gBAAK,CAACT,GAAG,EAAEZ,YAAYa,YAAY,CAAgB;oBAAC;oBAAoBD;iBAAG;;QACzF,GAAGO;IACL,GAAG;QAACpB;QAAKG;QAAWF;KAAY;IAEhC,IAAIE,aAAa,CAACG,cAAcN,IAAIiB,MAAM,GAAG,GAAG;QAC9CV,cAAc;QACdgB,wBAAW,CAACC,IAAI,CAAM,CAAC,EAAEhB,IAAI,gBAAgB,CAAC,EAAE;YAAER;QAAI,GAAGyB,IAAI,CAACC,CAAAA;YAC5D1B,IAAI2B,OAAO,CAACd,CAAAA;oBACyCa;gBAAnDzB,YAAY2B,YAAY,CAAC;oBAAC;oBAAoBf;iBAAG,EAAEa,CAAAA,eAAAA,IAAIR,IAAI,CAACL,GAAG,cAAZa,0BAAAA,eAAgB,EAAE;YACvE;YACAnB,cAAc;YACdH,aAAa;QACf;IACF;IAEA,OAAO;QACLD;QACAe;IACF;AACF"}
{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/chat/src/lib/Chat/ChatInput/ExtendableChatInput.tsx"],"sourcesContent":["import { Dispatch, SetStateAction, useCallback, useEffect, useRef, useState } from \"react\"\nimport { DatasetScope } from \"@rp/common/api-types\"\nimport { CHAT_INPUT_ID, SELECT_FILES_MODAL_CLASS_NAME, SIDEBAR_WIDTH } from \"@rp/common/settings\"\nimport { isFileStatusCompleted, isFileStatusError } from \"@rp/common/utils\"\nimport { UploadOptions } from \"@rp/common/utils\"\nimport { RPThemeProps } from \"@rp/react/theme\"\nimport { UploadInputRef } from \"@rp/react/web/common/base-components\"\nimport { UploadFiles } from \"@rp/react/web/common/files\"\nimport { useDeviceInfo } from \"@rp/react/web/common/hooks\"\nimport { useModal } from \"@rp/react/web/common/providers\"\nimport { Box, ClickAwayListener } from \"@rp/react/web/mui/core\"\nimport { useChatFiles } from \"../useChatFiles\"\nimport {\n  CHAT_INPUT_CONTAINER_CLASS_NAME,\n  CHAT_INPUT_WRAPPER_CLASS_NAME,\n  ChatInput,\n} from \"./ChatInput\"\nimport { DatasetPopper } from \"./DatasetPopper\"\nimport { MobileDatasetPopper } from \"./MobileDatasetPopper\"\nimport { getDefaultPrompt } from \"./getDefaultPrompt\"\n\nexport const CHAT_INPUT_HIDDEN_WRAPPER_CLASS_NAME = \"chat-input-hidden-wrapper\"\n\nconst getChatInputStyle = (isMobile: boolean, theme: RPThemeProps, isHomePageChat: boolean) => {\n  return {\n    mx: isHomePageChat && !isMobile ? 1.5 : 0,\n    width: `min(810px, 100dvw - ${isMobile ? 120 : SIDEBAR_WIDTH + 48}px)`,\n    [theme.breakpoints.down(\"sm\")]: {\n      width: `min(810px, 100dvw - ${isMobile ? 32 : SIDEBAR_WIDTH + 48}px)`,\n    },\n  }\n}\n\nconst isIncorrectWatchlistCombination = (\n  watchlistId: string | undefined,\n  selectedScope: DatasetScope | undefined,\n) => {\n  if (watchlistId === undefined) {\n    return true\n  }\n\n  const scopesWithDefault: Array<DatasetScope | undefined> = [\n    \"news\",\n    \"transcripts\",\n    \"filings\",\n    \"earnings_calls\",\n  ]\n  return selectedScope !== undefined && !scopesWithDefault.includes(selectedScope)\n}\n\ntype Props = {\n  onPromptSubmit: (prompt: string, defaultMessage?: boolean) => void\n  variant?: \"new\" | \"add\"\n  generating?: boolean\n  stopGenerating?: () => void\n  scope?: DatasetScope\n  setScope: (scope: DatasetScope | undefined) => void\n  filesIds: Array<string>\n  setFilesIds: Dispatch<SetStateAction<Array<string>>>\n  watchlistId: string | undefined\n  submitWatchlistId: Dispatch<SetStateAction<string | undefined>>\n  openScopeSelectorModal: () => void\n  sourceFilter: Partial<Record<string, boolean>>\n  enableFreeTier: boolean\n  location: UploadOptions[\"location\"]\n  isHomePageChat?: boolean\n  placeholder?: string\n  hideControls?: Array<\"source\" | \"watchlist\" | \"files\">\n  isValidPrompt?: boolean\n}\n\nconst ExtendableChatInput = ({\n  onPromptSubmit,\n  variant,\n  generating,\n  stopGenerating,\n  scope,\n  setScope,\n  filesIds,\n  setFilesIds,\n  watchlistId,\n  submitWatchlistId,\n  enableFreeTier,\n  sourceFilter,\n  location,\n  isHomePageChat = false,\n  placeholder = variant === \"add\" ? \"Ask a follow up\" : \"Ask a question\",\n  hideControls,\n  isValidPrompt = true,\n}: Props) => {\n  const { selectFilesModal, selectWatchlistModal } = useModal()\n  const { files: selectedFiles, isLoading: isLoadingFiles } = useChatFiles(filesIds)\n  const { handleOpen: handleOpenWatchlistModal } = selectWatchlistModal\n  const submitFileRef = useRef<UploadInputRef>(null)\n  const {\n    planComparisonModal: { handleOpen: planComparisonHandleOpen },\n  } = useModal()\n  const { isIOS, isMobile } = useDeviceInfo()\n  const [prompt, setPrompt] = useState(\"\")\n  const [filter, setFilter] = useState(\"\")\n  const [selectedScope, setSelectedScope] = useState<DatasetScope | undefined>()\n  const [isDatasetsOpen, setIsDatasetsOpen] = useState(false)\n\n  const inputContainerRef = useRef<HTMLDivElement | null>(null)\n  const inputFocusRef = useRef<HTMLTextAreaElement | null>(null)\n  const validPrompt = prompt.length > 0 && !prompt.match(/^\\s+$/)\n\n  const errorFiles = selectedFiles.filter(i => isFileStatusError(i.status)).length\n  const processingFiles = selectedFiles.filter(\n    i => !isFileStatusError(i.status) && !isFileStatusCompleted(i.status),\n  ).length\n  const blockForFiles =\n    selectedFiles.length === 0 ||\n    errorFiles === selectedFiles.length ||\n    processingFiles > 0 ||\n    isLoadingFiles\n  const hasFiles = selectedFiles.length > 0\n  const submitPromptDisabled =\n    (hasFiles && blockForFiles) ||\n    (!hasFiles && isIncorrectWatchlistCombination(watchlistId, scope) ? !validPrompt : false) ||\n    generating\n\n  // Make sure the input is focused when navigating to the chat page\n  useEffect(() => {\n    if (inputFocusRef.current && !isIOS && !isMobile) {\n      inputFocusRef.current.focus()\n    }\n  }, [isIOS, isMobile, variant])\n\n  const submitPrompt = () => {\n    if (submitPromptDisabled) {\n      return\n    }\n\n    if (isDatasetsOpen) {\n      setPrompt(\"\")\n      setIsDatasetsOpen(false)\n      return\n    }\n\n    const defaultPrompt = getDefaultPrompt(filesIds, watchlistId, scope)\n\n    const finalPrompt = !validPrompt ? defaultPrompt : prompt\n\n    onPromptSubmit(finalPrompt, !validPrompt)\n    setPrompt(\"\")\n    setIsDatasetsOpen(false)\n  }\n\n  const openWatchlistModal = useCallback(() => {\n    handleOpenWatchlistModal({\n      onSelectWatchlist: id => submitWatchlistId(id),\n      selectedWatchlist: watchlistId,\n    })\n  }, [handleOpenWatchlistModal, submitWatchlistId, watchlistId])\n\n  const handleKeyDown = (event: React.KeyboardEvent<HTMLTextAreaElement>) => {\n    if (event.key === \"@\" && prompt.length === 0 && filesIds.length === 0) {\n      setIsDatasetsOpen(true)\n      return\n    }\n\n    if (\n      selectedScope !== undefined &&\n      (event.key === \"Enter\" || (prompt.startsWith(\"@\") && event.key === \" \"))\n    ) {\n      event.preventDefault()\n      setScope(selectedScope)\n      setIsDatasetsOpen(false)\n      setPrompt(\"\")\n      return\n    }\n\n    if (event.key === \"Enter\" && !isMobile && event.shiftKey === false) {\n      event.preventDefault()\n      submitPrompt()\n    }\n  }\n\n  // Grow animation\n  const [multilineActive, setMultilineActive] = useState(false)\n\n  const inlineInputRef = useRef<HTMLDivElement>(null)\n\n  const resizeObserverRef = useRef(\n    new ResizeObserver(entries => {\n      const entry = entries[entries.length - 1]\n      const isMultiline = entry.borderBoxSize[0].blockSize > 64\n      setMultilineActive(isMultiline)\n    }),\n  )\n\n  useEffect(() => {\n    if (inlineInputRef.current) {\n      resizeObserverRef.current.observe(inlineInputRef.current)\n    }\n  }, [])\n\n  const textToDisplay = isDatasetsOpen ? filter : prompt\n  const setTextToDisplay = (prompt: string) => {\n    isDatasetsOpen ? setFilter(prompt) : setPrompt(prompt)\n  }\n\n  return (\n    <>\n      {isDatasetsOpen ? (\n        <Box\n          sx={{\n            overflowY: \"contained\",\n            height: 2000,\n            position: \"fixed\",\n            left: 0,\n            right: 0,\n            top: 0,\n            bottom: 0,\n            bgcolor: \"rgba(0, 0, 0, 0.30)\",\n            zIndex: 10,\n          }}\n        />\n      ) : null}\n      <ClickAwayListener onClickAway={() => setIsDatasetsOpen(false)}>\n        <Box\n          sx={theme => ({\n            display: \"flex\",\n            [`& .${CHAT_INPUT_WRAPPER_CLASS_NAME}`]: getChatInputStyle(\n              isMobile,\n              theme,\n              isHomePageChat,\n            ),\n            [`& .${CHAT_INPUT_CONTAINER_CLASS_NAME}`]: getChatInputStyle(\n              isMobile,\n              theme,\n              isHomePageChat,\n            ),\n          })}\n        >\n          <ChatInput\n            id={CHAT_INPUT_ID}\n            ref={inputContainerRef}\n            submitPrompt={submitPrompt}\n            setScope={setScope}\n            closeDatasetPopper={() => setIsDatasetsOpen(false)}\n            openDatasetPopper={() => setIsDatasetsOpen(true)}\n            prompt={textToDisplay}\n            setPrompt={setTextToDisplay}\n            variant={variant}\n            isValidPrompt={isValidPrompt && !submitPromptDisabled}\n            generating={generating}\n            handleKeyDown={handleKeyDown}\n            isDatasetsOpen={isDatasetsOpen}\n            stopGenerating={stopGenerating}\n            scope={scope}\n            multiline={multilineActive}\n            filesIds={filesIds}\n            setFilesIds={setFilesIds}\n            submitFileRef={submitFileRef}\n            inputRef={inputFocusRef}\n            handleOpenWatchlistModal={openWatchlistModal}\n            watchlistId={watchlistId}\n            setWatchlistId={submitWatchlistId}\n            isFreeTierEnabled={enableFreeTier}\n            placeholder={placeholder}\n            isHomePageChat={isHomePageChat}\n            hideControls={hideControls}\n          />\n          <UploadFiles\n            location={location}\n            onFileId={(src, fileId) => {\n              const isModalOpen =\n                document.querySelector(`.${SELECT_FILES_MODAL_CLASS_NAME}`) !== null\n              if (isModalOpen) {\n                selectFilesModal.setSelected(prev => {\n                  const filter = prev.filter(i => i !== src)\n                  return [...filter, fileId]\n                })\n              } else {\n                setFilesIds(prev => {\n                  const filter = prev.filter(i => i !== src)\n                  return [...filter, fileId]\n                })\n              }\n            }}\n            onSubmit={files =>\n              selectFilesModal.setSelected(prev => {\n                return [...prev, ...files.map(i => i.fileId)]\n              })\n            }\n            ref={submitFileRef}\n          />\n          {isMobile && isDatasetsOpen ? (\n            <MobileDatasetPopper\n              key={prompt}\n              initialFilter={prompt === \"@\" ? \"@\" : undefined}\n              open={isDatasetsOpen}\n              onClose={() => setIsDatasetsOpen(false)}\n              scope={scope}\n              setScope={setScope}\n              sourceFilter={sourceFilter}\n              enableFreeTier={enableFreeTier}\n            />\n          ) : (\n            <DatasetPopper\n              inputRef={inputContainerRef.current}\n              open={isDatasetsOpen}\n              filter={filter}\n              onOptionClick={({ scope, blocked }) => {\n                setIsDatasetsOpen(false)\n                if (blocked) {\n                  planComparisonHandleOpen(scope)\n                  return\n                }\n                setScope(scope)\n              }}\n              setSelectedDataset={setSelectedScope}\n              onClose={() => setIsDatasetsOpen(false)}\n              sourceFilter={sourceFilter}\n              enableFreeTier={enableFreeTier}\n              isHomePageChat={isHomePageChat}\n            />\n          )}\n          <Box\n            className={CHAT_INPUT_HIDDEN_WRAPPER_CLASS_NAME}\n            sx={theme => ({\n              position: \"absolute\",\n              width: \"98%\",\n              transform: \"translateX(100000px)\",\n              opacity: 0,\n              [`& .${CHAT_INPUT_WRAPPER_CLASS_NAME}`]: getChatInputStyle(\n                isMobile,\n                theme,\n                isHomePageChat,\n              ),\n              [`& .${CHAT_INPUT_CONTAINER_CLASS_NAME}`]: getChatInputStyle(\n                isMobile,\n                theme,\n                isHomePageChat,\n              ),\n            })}\n          >\n            {!isHomePageChat && (\n              <ChatInput\n                ref={inlineInputRef}\n                submitPrompt={submitPrompt}\n                setScope={setScope}\n                closeDatasetPopper={() => setIsDatasetsOpen(false)}\n                openDatasetPopper={() => setIsDatasetsOpen(true)}\n                prompt={textToDisplay}\n                setPrompt={setTextToDisplay}\n                variant={variant}\n                isValidPrompt={isValidPrompt && validPrompt}\n                generating={generating}\n                handleKeyDown={handleKeyDown}\n                isDatasetsOpen={isDatasetsOpen}\n                stopGenerating={stopGenerating}\n                scope={scope}\n                hidden\n                filesIds={filesIds}\n                setFilesIds={setFilesIds}\n                submitFileRef={submitFileRef}\n                handleOpenWatchlistModal={openWatchlistModal}\n                watchlistId={watchlistId}\n                setWatchlistId={submitWatchlistId}\n                isFreeTierEnabled={enableFreeTier}\n                placeholder={placeholder}\n                isHomePageChat={isHomePageChat}\n                hideControls={hideControls}\n              />\n            )}\n          </Box>\n        </Box>\n      </ClickAwayListener>\n    </>\n  )\n}\n\nexport { ExtendableChatInput }\n"],"names":["CHAT_INPUT_HIDDEN_WRAPPER_CLASS_NAME","ExtendableChatInput","getChatInputStyle","isMobile","theme","isHomePageChat","mx","width","SIDEBAR_WIDTH","breakpoints","down","isIncorrectWatchlistCombination","watchlistId","selectedScope","undefined","scopesWithDefault","includes","onPromptSubmit","variant","generating","stopGenerating","scope","setScope","filesIds","setFilesIds","submitWatchlistId","enableFreeTier","sourceFilter","location","placeholder","hideControls","isValidPrompt","selectFilesModal","selectWatchlistModal","useModal","files","selectedFiles","isLoading","isLoadingFiles","useChatFiles","handleOpen","handleOpenWatchlistModal","submitFileRef","useRef","planComparisonModal","planComparisonHandleOpen","isIOS","useDeviceInfo","prompt","setPrompt","useState","filter","setFilter","setSelectedScope","isDatasetsOpen","setIsDatasetsOpen","inputContainerRef","inputFocusRef","validPrompt","length","match","errorFiles","i","isFileStatusError","status","processingFiles","isFileStatusCompleted","blockForFiles","hasFiles","submitPromptDisabled","useEffect","current","focus","submitPrompt","defaultPrompt","getDefaultPrompt","finalPrompt","openWatchlistModal","useCallback","onSelectWatchlist","id","selectedWatchlist","handleKeyDown","event","key","startsWith","preventDefault","shiftKey","multilineActive","setMultilineActive","inlineInputRef","resizeObserverRef","ResizeObserver","entries","entry","isMultiline","borderBoxSize","blockSize","observe","textToDisplay","setTextToDisplay","Box","sx","overflowY","height","position","left","right","top","bottom","bgcolor","zIndex","ClickAwayListener","onClickAway","display","CHAT_INPUT_WRAPPER_CLASS_NAME","CHAT_INPUT_CONTAINER_CLASS_NAME","ChatInput","CHAT_INPUT_ID","ref","closeDatasetPopper","openDatasetPopper","multiline","inputRef","setWatchlistId","isFreeTierEnabled","UploadFiles","onFileId","src","fileId","isModalOpen","document","querySelector","SELECT_FILES_MODAL_CLASS_NAME","setSelected","prev","onSubmit","map","MobileDatasetPopper","initialFilter","open","onClose","DatasetPopper","onOptionClick","blocked","setSelectedDataset","className","transform","opacity","hidden"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
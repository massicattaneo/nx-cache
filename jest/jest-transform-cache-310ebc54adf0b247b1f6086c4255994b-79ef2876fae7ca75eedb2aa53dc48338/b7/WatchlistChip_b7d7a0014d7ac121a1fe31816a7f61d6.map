{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/cqs-query-bar/src/lib/chips/WatchlistChip.tsx"],"sourcesContent":["import { MouseEvent, forwardRef, useState } from \"react\"\nimport { RpqlFlatArrayIdFilter } from \"@rp/common/api-types\"\nimport { useWatchlist } from \"@rp/react/tanstack-api/watchlist\"\nimport { useDisableIOSTouch } from \"@rp/react/web/common/hooks\"\nimport { tagManagerEvents } from \"@rp/react/web/common/vendors/utils\"\nimport { QueryIcon } from \"@rp/react/web/icons\"\nimport { Popover } from \"@rp/react/web/mui/core\"\nimport { NameDisplay } from \"../NameDisplay\"\nimport { CqsQueryBarContext } from \"../cqs-query-bar.types\"\nimport { WatchlistDropdown } from \"../dropdowns/WatchlistDropdown\"\nimport { BaseChip } from \"./BaseChip\"\nimport { ChipLabel } from \"./Chip.styles\"\n\ntype WatchlistChipProps = {\n  filter: RpqlFlatArrayIdFilter\n  onRemove?: () => void\n  query?: CqsQueryBarContext\n}\n\nconst WatchlistChip = forwardRef<HTMLDivElement, WatchlistChipProps>(\n  ({ filter, onRemove, query }, ref) => {\n    const [anchorEl, setAnchorEl] = useState<HTMLElement | null>(null)\n    const data = useWatchlist(filter.value)\n    const open = Boolean(anchorEl)\n    useDisableIOSTouch(open)\n\n    useDisableIOSTouch(open)\n\n    const handleClick = (event: MouseEvent<HTMLElement>) => {\n      setAnchorEl(event.currentTarget)\n    }\n\n    const handleClose = () => {\n      setAnchorEl(null)\n    }\n\n    const handleOperationChange = (operation: string) => {\n      tagManagerEvents.queryRefinement({\n        action: \"changeOperation\",\n        component: \"queryBar\",\n        queryId: query?.id ?? \"\",\n        queryType: \"watchlist\",\n        savedStatus: query?.saveStatus ?? \"unsaved\",\n      })\n\n      query?.actions.expression.updateFilter(filter.id, filter => {\n        if (!Array.isArray(filter.value)) {\n          return {\n            ...filter,\n            operation,\n          }\n        }\n        return filter\n      })\n      handleClose()\n    }\n\n    return (\n      <>\n        <BaseChip\n          icon={<QueryIcon icon=\"watchlist\" />}\n          onRemove={onRemove}\n          clickable\n          onClick={handleClick}\n          selected={query && open}\n          ref={ref}\n        >\n          <ChipLabel>\n            <NameDisplay filterType=\"watchlist\" entityId={filter.value} data={data} />\n          </ChipLabel>\n        </BaseChip>\n        {query ? (\n          <Popover\n            open={open}\n            anchorEl={anchorEl}\n            onClose={handleClose}\n            anchorOrigin={{ vertical: \"bottom\", horizontal: \"left\" }}\n          >\n            <WatchlistDropdown filter={filter} onChange={handleOperationChange} />\n          </Popover>\n        ) : null}\n      </>\n    )\n  },\n)\n\nexport { WatchlistChip }\nexport type { WatchlistChipProps }\n"],"names":["WatchlistChip","forwardRef","filter","onRemove","query","ref","anchorEl","setAnchorEl","useState","data","useWatchlist","value","open","Boolean","useDisableIOSTouch","handleClick","event","currentTarget","handleClose","handleOperationChange","operation","tagManagerEvents","queryRefinement","action","component","queryId","id","queryType","savedStatus","saveStatus","actions","expression","updateFilter","Array","isArray","BaseChip","icon","QueryIcon","clickable","onClick","selected","ChipLabel","NameDisplay","filterType","entityId","Popover","onClose","anchorOrigin","vertical","horizontal","WatchlistDropdown","onChange"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAsFSA;;;eAAAA;;;;uBAtFwC;2BAEpB;uBACM;uBACF;uBACP;sBACF;6BACI;mCAEM;0BACT;4BACC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQ1B,MAAMA,8BAAgBC,IAAAA,iBAAU,EAC9B,CAAC,EAAEC,MAAM,EAAEC,QAAQ,EAAEC,KAAK,EAAE,EAAEC;IAC5B,MAAM,CAACC,UAAUC,YAAY,GAAGC,IAAAA,eAAQ,EAAqB;IAC7D,MAAMC,OAAOC,IAAAA,uBAAY,EAACR,OAAOS,KAAK;IACtC,MAAMC,OAAOC,QAAQP;IACrBQ,IAAAA,yBAAkB,EAACF;IAEnBE,IAAAA,yBAAkB,EAACF;IAEnB,MAAMG,cAAc,CAACC;QACnBT,YAAYS,MAAMC,aAAa;IACjC;IAEA,MAAMC,cAAc;QAClBX,YAAY;IACd;IAEA,MAAMY,wBAAwB,CAACC;YAIlBhB,WAEIA;QALfiB,uBAAgB,CAACC,eAAe,CAAC;YAC/BC,QAAQ;YACRC,WAAW;YACXC,SAASrB,CAAAA,YAAAA,kBAAAA,4BAAAA,MAAOsB,EAAE,cAATtB,uBAAAA,YAAa;YACtBuB,WAAW;YACXC,aAAaxB,CAAAA,oBAAAA,kBAAAA,4BAAAA,MAAOyB,UAAU,cAAjBzB,+BAAAA,oBAAqB;QACpC;QAEAA,kBAAAA,4BAAAA,MAAO0B,OAAO,CAACC,UAAU,CAACC,YAAY,CAAC9B,OAAOwB,EAAE,EAAExB,CAAAA;YAChD,IAAI,CAAC+B,MAAMC,OAAO,CAAChC,OAAOS,KAAK,GAAG;gBAChC,OAAO,wCACFT;oBACHkB;;YAEJ;YACA,OAAOlB;QACT;QACAgB;IACF;IAEA,qBACE;;0BACE,qBAACiB,kBAAQ;gBACPC,oBAAM,qBAACC,gBAAS;oBAACD,MAAK;;gBACtBjC,UAAUA;gBACVmC,SAAS;gBACTC,SAASxB;gBACTyB,UAAUpC,SAASQ;gBACnBP,KAAKA;0BAEL,cAAA,qBAACoC,qBAAS;8BACR,cAAA,qBAACC,wBAAW;wBAACC,YAAW;wBAAYC,UAAU1C,OAAOS,KAAK;wBAAEF,MAAMA;;;;YAGrEL,sBACC,qBAACyC,aAAO;gBACNjC,MAAMA;gBACNN,UAAUA;gBACVwC,SAAS5B;gBACT6B,cAAc;oBAAEC,UAAU;oBAAUC,YAAY;gBAAO;0BAEvD,cAAA,qBAACC,oCAAiB;oBAAChD,QAAQA;oBAAQiD,UAAUhC;;iBAE7C;;;AAGV"}
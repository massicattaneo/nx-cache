{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/chat/src/lib/Chat/Chat/ChatResponse/RealTimeAudit/SourceChip.tsx"],"sourcesContent":["import { useState } from \"react\"\nimport { createChunkMap } from \"@rp/react/common/hooks\"\nimport { DocumentIcon } from \"@rp/react/web/common/composite-components\"\nimport { useDeviceInfo, useHashParams } from \"@rp/react/web/common/hooks\"\nimport { useDocumentViewerData } from \"@rp/react/web/common/providers\"\nimport { Box, Typography } from \"@rp/react/web/mui/core\"\nimport { OnUserInteractionProps } from \"../ChatResponse\"\nimport { ExternalFavicon } from \"../ExternalFavicon\"\nimport { InlineAttributionListModal } from \"../InlineAttribution/InlineAttributionListModal\"\nimport {\n  getCqsInlineAttributionData,\n  getExternalInlineAttributionData,\n  groupInlineAttributions,\n} from \"../InlineAttribution/getInlineAttributionData\"\nimport { isExternalStory } from \"./QueryChip\"\nimport { SourceChipData } from \"./getSourcesForAudit\"\n\ntype Props = SourceChipData & {\n  chunkMap: ReturnType<typeof createChunkMap>[\"chunkMap\"]\n  externalMap: ReturnType<typeof createChunkMap>[\"externalMap\"]\n  onUserInteraction: (props: OnUserInteractionProps) => void\n}\n\nconst SourceChip = ({\n  label,\n  sourceId,\n  icon,\n  documents,\n  chunkMap,\n  externalMap,\n  onUserInteraction,\n}: Props) => {\n  const { isMobile } = useDeviceInfo()\n  const { setDocumentData } = useDocumentViewerData()\n  const [, setHashParams] = useHashParams()\n  const [showTooltip, setShowTooltip] = useState(false)\n  const [isModalOpen, setIsModalOpen] = useState(false)\n\n  if (documents.length === 0) {\n    return (\n      <Box\n        sx={{\n          display: \"flex\",\n          alignItems: \"center\",\n          bgcolor: showTooltip || isModalOpen ? \"elevation.dp06\" : \"overlay.surface\",\n          p: 1,\n          borderRadius: 1,\n          gap: 0.5,\n\n          \"& svg\": {\n            height: 16,\n            width: 16,\n          },\n        }}\n      >\n        {icon !== null ? (\n          <ExternalFavicon\n            faviconUrl={icon}\n            alt={label}\n            sx={{ height: 16, width: 16, display: \"flex\" }}\n          />\n        ) : (\n          <DocumentIcon documentScope=\"news\" srcKey={sourceId} />\n        )}\n\n        <Typography>{label}</Typography>\n      </Box>\n    )\n  }\n\n  const data = documents\n    .map(document => {\n      if (isExternalStory(document)) {\n        return getExternalInlineAttributionData({\n          id: document.id ?? \"\",\n          externalMap,\n          onUserInteraction,\n          setShowTooltip,\n        })\n      } else {\n        return document.chunks.map(chunk =>\n          getCqsInlineAttributionData({\n            id: chunk.id ?? \"\",\n            chunkMap,\n            setDocumentData,\n            setHashParams,\n            onUserInteraction,\n            setShowTooltip,\n          }),\n        )\n      }\n    })\n    .flat()\n\n  const groups = groupInlineAttributions(data)\n  const firstItem = groups[0].data[0]\n  const { onClick, url, hd, documentId } = firstItem\n\n  return (\n    <InlineAttributionListModal\n      disabled={false}\n      attributions={groups}\n      closeModal={() => setIsModalOpen(false)}\n      isOpen={isModalOpen}\n      showTooltip={showTooltip}\n      onOpenTooltip={() => {\n        setShowTooltip(true)\n        onUserInteraction({\n          action: \"preview\",\n          sourceUrl: url,\n          sourceTitle: hd,\n          documentId: documentId,\n          sourceId: firstItem.type === \"EXTERNAL\" ? null : firstItem.srcKey,\n          sourceName: firstItem.type === \"EXTERNAL\" ? null : firstItem.sourceName,\n          providerId: firstItem.type === \"EXTERNAL\" ? null : firstItem.rpProviderId,\n        })\n      }}\n      onCloseTooltip={() => setShowTooltip(false)}\n    >\n      <Box\n        onClick={ev => {\n          isMobile ? setIsModalOpen(true) : onClick(ev)\n        }}\n        sx={{\n          display: \"flex\",\n          alignItems: \"center\",\n          bgcolor: showTooltip || isModalOpen ? \"elevation.dp06\" : \"overlay.surface\",\n          p: 1,\n          borderRadius: 1,\n          gap: 0.5,\n          cursor: \"pointer\",\n          outline: \"1px solid\",\n          outlineColor: \"transparent\",\n\n          \"&:hover\": {\n            bgcolor: \"elevation.dp06\",\n            outlineColor: \"outline.border\",\n          },\n\n          \"& svg\": {\n            height: 16,\n            width: 16,\n          },\n        }}\n      >\n        {icon !== null ? (\n          <ExternalFavicon\n            faviconUrl={icon}\n            alt={label}\n            sx={{ height: 16, width: 16, display: \"flex\" }}\n          />\n        ) : (\n          <DocumentIcon documentScope=\"news\" srcKey={sourceId} />\n        )}\n\n        <Typography>{label}</Typography>\n      </Box>\n    </InlineAttributionListModal>\n  )\n}\nexport { SourceChip }\n"],"names":["SourceChip","label","sourceId","icon","documents","chunkMap","externalMap","onUserInteraction","isMobile","useDeviceInfo","setDocumentData","useDocumentViewerData","setHashParams","useHashParams","showTooltip","setShowTooltip","useState","isModalOpen","setIsModalOpen","length","Box","sx","display","alignItems","bgcolor","p","borderRadius","gap","height","width","ExternalFavicon","faviconUrl","alt","DocumentIcon","documentScope","srcKey","Typography","data","map","document","isExternalStory","getExternalInlineAttributionData","id","chunks","chunk","getCqsInlineAttributionData","flat","groups","groupInlineAttributions","firstItem","onClick","url","hd","documentId","InlineAttributionListModal","disabled","attributions","closeModal","isOpen","onOpenTooltip","action","sourceUrl","sourceTitle","type","sourceName","providerId","rpProviderId","onCloseTooltip","ev","cursor","outline","outlineColor"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
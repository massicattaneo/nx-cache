{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/common/watchlists/src/WatchlistCard/WatchlistCard.tsx"],"sourcesContent":["import { useState } from \"react\"\nimport { useLocation } from \"react-router-dom\"\nimport { useUser } from \"@clerk/clerk-react\"\nimport { Watchlist } from \"@rp/common/api-types\"\nimport { defaultWatchlistImage } from \"@rp/react/common/assets\"\nimport { getWatchlistOwnerInfo, usePerformanceIndicator } from \"@rp/react/common/watchlists\"\nimport { useFavoriteWatchlist, useUnfavoriteWatchlist } from \"@rp/react/tanstack-api/watchlist\"\nimport { UserAvatar } from \"@rp/react/web/common/base-components\"\nimport { EllipsisTooltip } from \"@rp/react/web/common/composite-components\"\nimport { useShareContext } from \"@rp/react/web/common/providers\"\nimport { Box, Button, styled } from \"@rp/react/web/mui/core\"\nimport { ImageNotSupported, Star, StarOutline } from \"@rp/react/web/mui/icons\"\nimport { hasPerformedSessionAction } from \"@rp/web/utils\"\nimport { WatchlistAverageChangePercentageChip } from \"../WatchlistAveragePercentageChange\"\nimport { WatchlistCardContainer } from \"./WatchlistCardContainer\"\nimport { WatchlistCardImage } from \"./WatchlistCardImage\"\nimport { WatchlistCardLoading } from \"./WatchlistCardLoading\"\n\ntype WatchlistCardProps = {\n  watchlist: Watchlist | undefined\n  onClick?: () => void\n  isFeatured?: boolean\n  showPerformance?: boolean\n  activeCard?: boolean\n}\n\nconst FavoriteButton = styled(Button)(({ theme }) => ({\n  position: \"absolute\",\n  top: 6,\n  right: 6,\n  borderRadius: 10,\n  opacity: 1,\n  transition: \"opacity 0.2s\",\n  minWidth: \"fit-content\",\n  padding: 4,\n  backgroundColor: theme.palette.primary.main,\n  color: theme.palette.primary.contrastText,\n  \"&:hover\": {\n    backgroundColor: theme.palette.primary.dark,\n  },\n}))\n\nexport const WatchlistCard = ({\n  watchlist,\n  showPerformance = false,\n  onClick,\n  activeCard,\n}: WatchlistCardProps) => {\n  const { cameFromLinkPathname } = useShareContext()\n  const { pathname } = useLocation()\n  const { mutate: mutateFavorite, isPending: isPendingFavorite } = useFavoriteWatchlist()\n  const { mutate: mutateUnfavorite, isPending: isPendingUnfavorite } = useUnfavoriteWatchlist()\n  const [ref, setRef] = useState<HTMLSpanElement | null>(null)\n\n  const titleHeight = ref?.getBoundingClientRect().height ?? 0\n  const { user } = useUser()\n  const { displayName, name, avatar } = getWatchlistOwnerInfo(watchlist, user)\n  const { average, isLoading: isLoadingAverage } = usePerformanceIndicator(\n    showPerformance ? watchlist?.id : undefined,\n  )\n  const isFavorite = watchlist?.isFavorite\n  const countAverage = !!average || isLoadingAverage\n  const handleFavoriteClick = (e: React.MouseEvent) => {\n    e.stopPropagation()\n    if (isPendingFavorite || isPendingUnfavorite) {\n      return\n    }\n    if (watchlist?.id) {\n      const send = hasPerformedSessionAction(\n        \"shared_link_favorited\",\n        pathname,\n        cameFromLinkPathname,\n      )\n      isFavorite\n        ? mutateUnfavorite(watchlist.id)\n        : mutateFavorite({\n            id: watchlist.id,\n            cameFromSharedLink: send,\n          })\n    }\n  }\n\n  if (!watchlist) {\n    return <WatchlistCardLoading />\n  }\n\n  return (\n    <WatchlistCardContainer\n      sx={{\n        cursor: onClick ? \"pointer\" : undefined,\n        \"&:hover\": {\n          backgroundColor: \"elevation.dp06\",\n        },\n        \"&:hover .hover-favorite\": {\n          opacity: 1,\n        },\n        border: activeCard ? `2px solid #4CA7F9` : null,\n      }}\n      onClick={onClick}\n      data-testid=\"watchlist-card\"\n    >\n      <WatchlistCardImage\n        fallback={\n          <Box\n            sx={{ height: \"100%\", display: \"flex\", alignItems: \"center\", justifyContent: \"center\" }}\n          >\n            <ImageNotSupported />\n          </Box>\n        }\n        src={watchlist.imageUrl ?? defaultWatchlistImage}\n        alt={watchlist.name}\n      />\n      <Box sx={{ height: \"52%\", display: \"block\" }}>\n        <Box sx={{ display: \"flex\", justifyContent: \"left\", mt: 0.5 }}>\n          <WatchlistAverageChangePercentageChip\n            hideBackground\n            isLoading={isLoadingAverage}\n            averageChangePercentage={average}\n          />\n        </Box>\n        <span ref={setRef}>\n          <EllipsisTooltip\n            vertical\n            numberOfLines={watchlist.description ? 2 : 4}\n            tooltipText={watchlist.name}\n            typographyProps={{\n              lineHeight: \"1.4\",\n              fontSize: 18,\n              fontWeight: 700,\n              mt: countAverage ? 0 : 1,\n            }}\n          >\n            {watchlist.name}\n          </EllipsisTooltip>\n        </span>\n        <EllipsisTooltip\n          vertical\n          numberOfLines={(titleHeight > 30 ? 4 : 5) - (countAverage ? 1 : 0)}\n          tooltipText={watchlist.description ?? \"\"}\n          typographyProps={{\n            lineHeight: \"1.3\",\n            fontSize: 14,\n            fontWeight: 400,\n            mt: 0.5,\n            color: \"text.secondary\",\n          }}\n        >\n          {watchlist.description ?? \"\"}\n        </EllipsisTooltip>\n      </Box>\n      <Box sx={{ display: \"flex\", alignItems: \"center\", gap: 1, mt: 1 }}>\n        <UserAvatar size={24} imgUrl={avatar} hasImage={!!avatar} ownerName={name} />{\" \"}\n        <EllipsisTooltip\n          tooltipText={displayName}\n          typographyProps={{ sx: { fontSize: 14, color: \"grey.300\" } }}\n        >\n          {displayName}\n        </EllipsisTooltip>\n      </Box>\n\n      <FavoriteButton\n        aria-label=\"favorite\"\n        className=\"hover-favorite\"\n        onClick={handleFavoriteClick}\n        sx={{\n          opacity: 0,\n          fontSize: 18,\n          boxShadow: \"0px 1px 5px 0px rgba(0, 0, 0, 0.2)\",\n        }}\n      >\n        {isFavorite ? <Star sx={{ fontSize: 20 }} /> : <StarOutline sx={{ fontSize: 20 }} />}\n      </FavoriteButton>\n    </WatchlistCardContainer>\n  )\n}\n"],"names":["WatchlistCard","FavoriteButton","styled","Button","theme","position","top","right","borderRadius","opacity","transition","minWidth","padding","backgroundColor","palette","primary","main","color","contrastText","dark","watchlist","showPerformance","onClick","activeCard","cameFromLinkPathname","useShareContext","pathname","useLocation","mutate","mutateFavorite","isPending","isPendingFavorite","useFavoriteWatchlist","mutateUnfavorite","isPendingUnfavorite","useUnfavoriteWatchlist","ref","setRef","useState","titleHeight","getBoundingClientRect","height","user","useUser","displayName","name","avatar","getWatchlistOwnerInfo","average","isLoading","isLoadingAverage","usePerformanceIndicator","id","undefined","isFavorite","countAverage","handleFavoriteClick","e","stopPropagation","send","hasPerformedSessionAction","cameFromSharedLink","WatchlistCardLoading","WatchlistCardContainer","sx","cursor","border","data-testid","WatchlistCardImage","fallback","Box","display","alignItems","justifyContent","ImageNotSupported","src","imageUrl","defaultWatchlistImage","alt","mt","WatchlistAverageChangePercentageChip","hideBackground","averageChangePercentage","span","EllipsisTooltip","vertical","numberOfLines","description","tooltipText","typographyProps","lineHeight","fontSize","fontWeight","gap","UserAvatar","size","imgUrl","hasImage","ownerName","aria-label","className","boxShadow","Star","StarOutline"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BA0CaA;;;eAAAA;;;;uBA1CY;gCACG;4BACJ;wBAEc;4BACyB;2BACF;gCAClC;qCACK;2BACA;sBACI;uBACiB;uBACX;kDACW;wCACd;oCACJ;sCACE;AAUrC,MAAMC,iBAAiBC,IAAAA,YAAM,EAACC,YAAM,EAAE,CAAC,EAAEC,KAAK,EAAE,GAAM,CAAA;QACpDC,UAAU;QACVC,KAAK;QACLC,OAAO;QACPC,cAAc;QACdC,SAAS;QACTC,YAAY;QACZC,UAAU;QACVC,SAAS;QACTC,iBAAiBT,MAAMU,OAAO,CAACC,OAAO,CAACC,IAAI;QAC3CC,OAAOb,MAAMU,OAAO,CAACC,OAAO,CAACG,YAAY;QACzC,WAAW;YACTL,iBAAiBT,MAAMU,OAAO,CAACC,OAAO,CAACI,IAAI;QAC7C;IACF,CAAA;AAEO,MAAMnB,gBAAgB,CAAC,EAC5BoB,SAAS,EACTC,kBAAkB,KAAK,EACvBC,OAAO,EACPC,UAAU,EACS;IACnB,MAAM,EAAEC,oBAAoB,EAAE,GAAGC,IAAAA,0BAAe;IAChD,MAAM,EAAEC,QAAQ,EAAE,GAAGC,IAAAA,2BAAW;IAChC,MAAM,EAAEC,QAAQC,cAAc,EAAEC,WAAWC,iBAAiB,EAAE,GAAGC,IAAAA,+BAAoB;IACrF,MAAM,EAAEJ,QAAQK,gBAAgB,EAAEH,WAAWI,mBAAmB,EAAE,GAAGC,IAAAA,iCAAsB;IAC3F,MAAM,CAACC,KAAKC,OAAO,GAAGC,IAAAA,eAAQ,EAAyB;QAEnCF;IAApB,MAAMG,cAAcH,CAAAA,oCAAAA,gBAAAA,0BAAAA,IAAKI,qBAAqB,GAAGC,MAAM,cAAnCL,+CAAAA,oCAAuC;IAC3D,MAAM,EAAEM,IAAI,EAAE,GAAGC,IAAAA,mBAAO;IACxB,MAAM,EAAEC,WAAW,EAAEC,IAAI,EAAEC,MAAM,EAAE,GAAGC,IAAAA,iCAAqB,EAAC3B,WAAWsB;IACvE,MAAM,EAAEM,OAAO,EAAEC,WAAWC,gBAAgB,EAAE,GAAGC,IAAAA,mCAAuB,EACtE9B,kBAAkBD,sBAAAA,gCAAAA,UAAWgC,EAAE,GAAGC;IAEpC,MAAMC,aAAalC,sBAAAA,gCAAAA,UAAWkC,UAAU;IACxC,MAAMC,eAAe,CAAC,CAACP,WAAWE;IAClC,MAAMM,sBAAsB,CAACC;QAC3BA,EAAEC,eAAe;QACjB,IAAI3B,qBAAqBG,qBAAqB;YAC5C;QACF;QACA,IAAId,sBAAAA,gCAAAA,UAAWgC,EAAE,EAAE;YACjB,MAAMO,OAAOC,IAAAA,gCAAyB,EACpC,yBACAlC,UACAF;YAEF8B,aACIrB,iBAAiBb,UAAUgC,EAAE,IAC7BvB,eAAe;gBACbuB,IAAIhC,UAAUgC,EAAE;gBAChBS,oBAAoBF;YACtB;QACN;IACF;IAEA,IAAI,CAACvC,WAAW;QACd,qBAAO,qBAAC0C,0CAAoB;IAC9B;QAyBW1C,qBA6BUA,wBASZA;IA7DT,qBACE,sBAAC2C,8CAAsB;QACrBC,IAAI;YACFC,QAAQ3C,UAAU,YAAY+B;YAC9B,WAAW;gBACTxC,iBAAiB;YACnB;YACA,2BAA2B;gBACzBJ,SAAS;YACX;YACAyD,QAAQ3C,aAAa,CAAC,iBAAiB,CAAC,GAAG;QAC7C;QACAD,SAASA;QACT6C,eAAY;;0BAEZ,qBAACC,sCAAkB;gBACjBC,wBACE,qBAACC,SAAG;oBACFN,IAAI;wBAAEvB,QAAQ;wBAAQ8B,SAAS;wBAAQC,YAAY;wBAAUC,gBAAgB;oBAAS;8BAEtF,cAAA,qBAACC,wBAAiB;;gBAGtBC,KAAKvD,CAAAA,sBAAAA,UAAUwD,QAAQ,cAAlBxD,iCAAAA,sBAAsByD,6BAAqB;gBAChDC,KAAK1D,UAAUyB,IAAI;;0BAErB,sBAACyB,SAAG;gBAACN,IAAI;oBAAEvB,QAAQ;oBAAO8B,SAAS;gBAAQ;;kCACzC,qBAACD,SAAG;wBAACN,IAAI;4BAAEO,SAAS;4BAAQE,gBAAgB;4BAAQM,IAAI;wBAAI;kCAC1D,cAAA,qBAACC,sEAAoC;4BACnCC,cAAc;4BACdhC,WAAWC;4BACXgC,yBAAyBlC;;;kCAG7B,qBAACmC;wBAAK/C,KAAKC;kCACT,cAAA,qBAAC+C,oCAAe;4BACdC,QAAQ;4BACRC,eAAelE,UAAUmE,WAAW,GAAG,IAAI;4BAC3CC,aAAapE,UAAUyB,IAAI;4BAC3B4C,iBAAiB;gCACfC,YAAY;gCACZC,UAAU;gCACVC,YAAY;gCACZb,IAAIxB,eAAe,IAAI;4BACzB;sCAECnC,UAAUyB,IAAI;;;kCAGnB,qBAACuC,oCAAe;wBACdC,QAAQ;wBACRC,eAAe,AAAC/C,CAAAA,cAAc,KAAK,IAAI,CAAA,IAAMgB,CAAAA,eAAe,IAAI,CAAA;wBAChEiC,aAAapE,CAAAA,yBAAAA,UAAUmE,WAAW,cAArBnE,oCAAAA,yBAAyB;wBACtCqE,iBAAiB;4BACfC,YAAY;4BACZC,UAAU;4BACVC,YAAY;4BACZb,IAAI;4BACJ9D,OAAO;wBACT;kCAECG,CAAAA,0BAAAA,UAAUmE,WAAW,cAArBnE,qCAAAA,0BAAyB;;;;0BAG9B,sBAACkD,SAAG;gBAACN,IAAI;oBAAEO,SAAS;oBAAQC,YAAY;oBAAUqB,KAAK;oBAAGd,IAAI;gBAAE;;kCAC9D,qBAACe,0BAAU;wBAACC,MAAM;wBAAIC,QAAQlD;wBAAQmD,UAAU,CAAC,CAACnD;wBAAQoD,WAAWrD;;oBAAS;kCAC9E,qBAACuC,oCAAe;wBACdI,aAAa5C;wBACb6C,iBAAiB;4BAAEzB,IAAI;gCAAE2B,UAAU;gCAAI1E,OAAO;4BAAW;wBAAE;kCAE1D2B;;;;0BAIL,qBAAC3C;gBACCkG,cAAW;gBACXC,WAAU;gBACV9E,SAASkC;gBACTQ,IAAI;oBACFvD,SAAS;oBACTkF,UAAU;oBACVU,WAAW;gBACb;0BAEC/C,2BAAa,qBAACgD,WAAI;oBAACtC,IAAI;wBAAE2B,UAAU;oBAAG;mCAAQ,qBAACY,kBAAW;oBAACvC,IAAI;wBAAE2B,UAAU;oBAAG;;;;;AAIvF"}
{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/common/composite-components/src/WatchlistMenu/watchlist.helpers.tsx"],"sourcesContent":["import { useCallback, useReducer } from \"react\"\nimport { CqsItem, Watchlist } from \"@rp/common/api-types\"\nimport { SnackbarEnqueueAction } from \"@rp/react/common/types\"\nimport { getWatchlistById } from \"@rp/react/tanstack-api/common\"\nimport { onWatchlistUpdateSuccess, patchWatchlist } from \"@rp/react/tanstack-api/watchlist\"\nimport { Typography } from \"@rp/react/web/mui/core\"\nimport { useQueryClient } from \"@tanstack/react-query\"\n\nenum FetchStates {\n  LOADING = \"LOADING\",\n  SUCCESS = \"SUCCESS\",\n  ERROR = \"ERROR\",\n}\n\ntype Status = {\n  isLoading: boolean\n  error: string | undefined\n}\n\ntype DispatchAction = {\n  fetchState: FetchStates\n  errorMessage?: string\n}\n\nconst updateQueryStatus = (state: Status, action: DispatchAction) => {\n  switch (action.fetchState) {\n    case FetchStates.LOADING:\n      return { isLoading: true, error: undefined }\n    case FetchStates.SUCCESS:\n      return { isLoading: false, error: undefined }\n    case FetchStates.ERROR:\n      return { isLoading: false, error: action.errorMessage }\n  }\n}\n\ntype AddEntitiesOptions = {\n  onSuccess?: (watchlist: Watchlist) => void\n  enqueueSuccess: SnackbarEnqueueAction\n  enqueueError: SnackbarEnqueueAction\n  enqueueInfo: SnackbarEnqueueAction\n}\n\nexport const useAddEntities = ({\n  onSuccess,\n  enqueueSuccess,\n  enqueueError,\n  enqueueInfo,\n}: AddEntitiesOptions) => {\n  const queryClient = useQueryClient()\n  const [queryState, dispatchQueryState] = useReducer(updateQueryStatus, {\n    isLoading: false,\n    error: undefined,\n  })\n\n  const addEntities = useCallback(\n    async (watchlistId: string, entities: Array<CqsItem>, watchlistName: string) => {\n      dispatchQueryState({ fetchState: FetchStates.LOADING })\n      try {\n        const { items, name } = await getWatchlistById(watchlistId)\n\n        const entitiesIds = entities.map(({ key }) => key)\n        const newEntityIds = [...new Set([...items, ...entitiesIds])]\n\n        const entitiesAdded = entities.filter(item => !items.includes(item.key))\n        const amountAdded = entitiesAdded.length\n\n        if (amountAdded === 0) {\n          enqueueInfo(\n            <Typography component=\"span\">\n              These items already exist in\n              <Typography component=\"span\" fontWeight=\"bold\">\n                {` ${name}`}\n              </Typography>\n            </Typography>,\n          )\n          dispatchQueryState({ fetchState: FetchStates.SUCCESS })\n\n          return\n        }\n        const data = await patchWatchlist({ id: watchlistId, items: newEntityIds })\n\n        enqueueSuccess(\n          <Typography component=\"span\" fontWeight=\"bold\">\n            {amountAdded >= 5\n              ? `${amountAdded} items `\n              : ` ${entitiesAdded.map(entity => entity.name).join(\", \")} `}\n            <Typography component=\"span\">added to</Typography>\n            {` ${name}`}\n          </Typography>,\n        )\n\n        dispatchQueryState({ fetchState: FetchStates.SUCCESS })\n        onWatchlistUpdateSuccess(queryClient)(data)\n        onSuccess?.(data)\n      } catch (error) {\n        dispatchQueryState({ fetchState: FetchStates.ERROR, errorMessage: String(error) })\n        enqueueError(\n          <Typography>\n            Error adding to\n            <Typography component=\"span\" sx={{ fontWeight: \"bold\" }}>\n              {watchlistName}\n            </Typography>\n          </Typography>,\n        )\n      }\n    },\n    [enqueueSuccess, queryClient, onSuccess, enqueueInfo, enqueueError],\n  )\n\n  return { addEntities, ...queryState }\n}\n"],"names":["useAddEntities","FetchStates","updateQueryStatus","state","action","fetchState","isLoading","error","undefined","errorMessage","onSuccess","enqueueSuccess","enqueueError","enqueueInfo","queryClient","useQueryClient","queryState","dispatchQueryState","useReducer","addEntities","useCallback","watchlistId","entities","watchlistName","items","name","getWatchlistById","entitiesIds","map","key","newEntityIds","Set","entitiesAdded","filter","item","includes","amountAdded","length","Typography","component","fontWeight","data","patchWatchlist","id","entity","join","onWatchlistUpdateSuccess","String","sx"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BA0CaA;;;eAAAA;;;;uBA1C2B;wBAGP;2BACwB;sBAC9B;4BACI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UAE1BC;;;;GAAAA,gBAAAA;AAgBL,MAAMC,oBAAoB,CAACC,OAAeC;IACxC,OAAQA,OAAOC,UAAU;QACvB;YACE,OAAO;gBAAEC,WAAW;gBAAMC,OAAOC;YAAU;QAC7C;YACE,OAAO;gBAAEF,WAAW;gBAAOC,OAAOC;YAAU;QAC9C;YACE,OAAO;gBAAEF,WAAW;gBAAOC,OAAOH,OAAOK,YAAY;YAAC;IAC1D;AACF;AASO,MAAMT,iBAAiB,CAAC,EAC7BU,SAAS,EACTC,cAAc,EACdC,YAAY,EACZC,WAAW,EACQ;IACnB,MAAMC,cAAcC,IAAAA,0BAAc;IAClC,MAAM,CAACC,YAAYC,mBAAmB,GAAGC,IAAAA,iBAAU,EAAChB,mBAAmB;QACrEI,WAAW;QACXC,OAAOC;IACT;IAEA,MAAMW,cAAcC,IAAAA,kBAAW,EAC7B,OAAOC,aAAqBC,UAA0BC;QACpDN,mBAAmB;YAAEZ,UAAU;QAAsB;QACrD,IAAI;YACF,MAAM,EAAEmB,KAAK,EAAEC,IAAI,EAAE,GAAG,MAAMC,IAAAA,wBAAgB,EAACL;YAE/C,MAAMM,cAAcL,SAASM,GAAG,CAAC,CAAC,EAAEC,GAAG,EAAE,GAAKA;YAC9C,MAAMC,eAAe;mBAAI,IAAIC,IAAI;uBAAIP;uBAAUG;iBAAY;aAAE;YAE7D,MAAMK,gBAAgBV,SAASW,MAAM,CAACC,CAAAA,OAAQ,CAACV,MAAMW,QAAQ,CAACD,KAAKL,GAAG;YACtE,MAAMO,cAAcJ,cAAcK,MAAM;YAExC,IAAID,gBAAgB,GAAG;gBACrBvB,0BACE,sBAACyB,gBAAU;oBAACC,WAAU;;wBAAO;sCAE3B,qBAACD,gBAAU;4BAACC,WAAU;4BAAOC,YAAW;sCACrC,CAAC,CAAC,EAAEf,KAAK,CAAC;;;;gBAIjBR,mBAAmB;oBAAEZ,UAAU;gBAAsB;gBAErD;YACF;YACA,MAAMoC,OAAO,MAAMC,IAAAA,yBAAc,EAAC;gBAAEC,IAAItB;gBAAaG,OAAOM;YAAa;YAEzEnB,6BACE,sBAAC2B,gBAAU;gBAACC,WAAU;gBAAOC,YAAW;;oBACrCJ,eAAe,IACZ,CAAC,EAAEA,YAAY,OAAO,CAAC,GACvB,CAAC,CAAC,EAAEJ,cAAcJ,GAAG,CAACgB,CAAAA,SAAUA,OAAOnB,IAAI,EAAEoB,IAAI,CAAC,MAAM,CAAC,CAAC;kCAC9D,qBAACP,gBAAU;wBAACC,WAAU;kCAAO;;oBAC5B,CAAC,CAAC,EAAEd,KAAK,CAAC;;;YAIfR,mBAAmB;gBAAEZ,UAAU;YAAsB;YACrDyC,IAAAA,mCAAwB,EAAChC,aAAa2B;YACtC/B,sBAAAA,gCAAAA,UAAY+B;QACd,EAAE,OAAOlC,OAAO;YACdU,mBAAmB;gBAAEZ,UAAU;gBAAqBI,cAAcsC,OAAOxC;YAAO;YAChFK,2BACE,sBAAC0B,gBAAU;;oBAAC;kCAEV,qBAACA,gBAAU;wBAACC,WAAU;wBAAOS,IAAI;4BAAER,YAAY;wBAAO;kCACnDjB;;;;QAIT;IACF,GACA;QAACZ;QAAgBG;QAAaJ;QAAWG;QAAaD;KAAa;IAGrE,OAAO;QAAEO;OAAgBH;AAC3B"}
{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/common/hooks/src/usePermissiveScrollTrigger.ts"],"sourcesContent":["import { MutableRefObject, useCallback, useEffect, useRef, useState } from \"react\"\n\ninterface UseScrollTriggerOptions {\n  disableHysteresis?: boolean\n  target?: HTMLElement | Window\n  threshold?: number\n  deltaTrigger?: number\n  deltaDelay?: number\n}\n\nfunction getScrollTop(target: HTMLElement | Window): number {\n  return target instanceof Window ? target.pageYOffset : target.scrollTop\n}\n\nfunction defaultTrigger(\n  store: MutableRefObject<number>,\n  options: Required<UseScrollTriggerOptions>,\n) {\n  const { disableHysteresis, threshold, target } = options\n  const previous = store.current\n\n  if (target) {\n    // eslint-disable-next-line no-param-reassign\n    store.current = getScrollTop(target)\n  }\n\n  if (!disableHysteresis && previous !== undefined) {\n    if (store.current < previous) {\n      return false\n    }\n  }\n\n  return store.current > threshold\n}\n\nexport function usePermissiveScrollTrigger(options: UseScrollTriggerOptions = {}) {\n  const target = options.target ?? window\n  const opt = {\n    target,\n    threshold: 0,\n    disableHysteresis: false,\n    deltaTrigger: 50,\n    deltaDelay: 100,\n    ...options,\n  }\n  const { target: _, ...rest } = opt\n  const store = useRef<number>(0)\n  const previous = useRef<number>(0)\n  const int = useRef<unknown>(null)\n  const [trigger, setTrigger] = useState(() => defaultTrigger(store, opt))\n  const deltaTrigger = opt.deltaTrigger\n  const check = useCallback(\n    function (validated: () => void) {\n      const delta = Math.abs(store.current - previous.current)\n      if (delta > deltaTrigger || getScrollTop(target) <= deltaTrigger) {\n        validated()\n      }\n    },\n    [deltaTrigger, target],\n  )\n  useEffect(() => {\n    const handleScroll = () => {\n      clearTimeout(typeof int.current === \"number\" ? int.current : undefined)\n      int.current = setTimeout(() => {\n        previous.current = getScrollTop(target)\n        check(() => setTrigger(defaultTrigger(store, opt)))\n      }, opt.deltaDelay)\n    }\n\n    handleScroll() // Re-evaluate trigger when dependencies change\n    target.addEventListener(\"scroll\", handleScroll, { passive: true })\n    return () => {\n      clearTimeout(typeof int.current === \"number\" ? int.current : undefined)\n      target.removeEventListener(\"scroll\", handleScroll)\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [target, defaultTrigger, JSON.stringify(rest), check])\n\n  return trigger\n}\n"],"names":["usePermissiveScrollTrigger","getScrollTop","target","Window","pageYOffset","scrollTop","defaultTrigger","store","options","disableHysteresis","threshold","previous","current","undefined","window","opt","deltaTrigger","deltaDelay","_","rest","useRef","int","trigger","setTrigger","useState","check","useCallback","validated","delta","Math","abs","useEffect","handleScroll","clearTimeout","setTimeout","addEventListener","passive","removeEventListener","JSON","stringify"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAmCgBA;;;eAAAA;;;uBAnC2D;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAU3E,SAASC,aAAaC,MAA4B;IAChD,OAAOA,kBAAkBC,SAASD,OAAOE,WAAW,GAAGF,OAAOG,SAAS;AACzE;AAEA,SAASC,eACPC,KAA+B,EAC/BC,OAA0C;IAE1C,MAAM,EAAEC,iBAAiB,EAAEC,SAAS,EAAER,MAAM,EAAE,GAAGM;IACjD,MAAMG,WAAWJ,MAAMK,OAAO;IAE9B,IAAIV,QAAQ;QACV,6CAA6C;QAC7CK,MAAMK,OAAO,GAAGX,aAAaC;IAC/B;IAEA,IAAI,CAACO,qBAAqBE,aAAaE,WAAW;QAChD,IAAIN,MAAMK,OAAO,GAAGD,UAAU;YAC5B,OAAO;QACT;IACF;IAEA,OAAOJ,MAAMK,OAAO,GAAGF;AACzB;AAEO,SAASV,2BAA2BQ,UAAmC,CAAC,CAAC;QAC/DA;IAAf,MAAMN,SAASM,CAAAA,kBAAAA,QAAQN,MAAM,cAAdM,6BAAAA,kBAAkBM;IACjC,MAAMC,MAAM;QACVb;QACAQ,WAAW;QACXD,mBAAmB;QACnBO,cAAc;QACdC,YAAY;OACTT;IAEL,MAAM,EAAEN,QAAQgB,CAAC,EAAW,GAAGH,KAATI,kCAASJ;QAAvBb;;IACR,MAAMK,QAAQa,IAAAA,aAAM,EAAS;IAC7B,MAAMT,WAAWS,IAAAA,aAAM,EAAS;IAChC,MAAMC,MAAMD,IAAAA,aAAM,EAAU;IAC5B,MAAM,CAACE,SAASC,WAAW,GAAGC,IAAAA,eAAQ,EAAC,IAAMlB,eAAeC,OAAOQ;IACnE,MAAMC,eAAeD,IAAIC,YAAY;IACrC,MAAMS,QAAQC,IAAAA,kBAAW,EACvB,SAAUC,SAAqB;QAC7B,MAAMC,QAAQC,KAAKC,GAAG,CAACvB,MAAMK,OAAO,GAAGD,SAASC,OAAO;QACvD,IAAIgB,QAAQZ,gBAAgBf,aAAaC,WAAWc,cAAc;YAChEW;QACF;IACF,GACA;QAACX;QAAcd;KAAO;IAExB6B,IAAAA,gBAAS,EAAC;QACR,MAAMC,eAAe;YACnBC,aAAa,OAAOZ,IAAIT,OAAO,KAAK,WAAWS,IAAIT,OAAO,GAAGC;YAC7DQ,IAAIT,OAAO,GAAGsB,WAAW;gBACvBvB,SAASC,OAAO,GAAGX,aAAaC;gBAChCuB,MAAM,IAAMF,WAAWjB,eAAeC,OAAOQ;YAC/C,GAAGA,IAAIE,UAAU;QACnB;QAEAe,eAAe,+CAA+C;;QAC9D9B,OAAOiC,gBAAgB,CAAC,UAAUH,cAAc;YAAEI,SAAS;QAAK;QAChE,OAAO;YACLH,aAAa,OAAOZ,IAAIT,OAAO,KAAK,WAAWS,IAAIT,OAAO,GAAGC;YAC7DX,OAAOmC,mBAAmB,CAAC,UAAUL;QACvC;IACA,uDAAuD;IACzD,GAAG;QAAC9B;QAAQI;QAAgBgC,KAAKC,SAAS,CAACpB;QAAOM;KAAM;IAExD,OAAOH;AACT"}
{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/apps/client-web/src/app/pages/Brief/BriefCreateOrEdit/BriefCreateOrEdit.tsx"],"sourcesContent":["import { useEffect } from \"react\"\nimport { useNavigate } from \"react-router-dom\"\nimport { BRIEF_CONFIG_LIMIT, BRIEF_FEATURE_NAME, HEADER_HEIGHT } from \"@rp/common/settings\"\nimport { useBriefConfigForm, useGetBriefInitialData } from \"@rp/react/common/brief\"\nimport { useIsBriefLimitMet } from \"@rp/react/common/hooks\"\nimport { useAccount } from \"@rp/react/common/providers\"\nimport { useUserBriefConfigs } from \"@rp/react/tanstack-api/brief\"\nimport { useWatchlist } from \"@rp/react/tanstack-api/watchlist\"\nimport {\n  BriefLimitReached,\n  BriefPageHeader,\n  useBriefCreateOrEditSteps,\n  useCreateBriefCallbacks,\n  useCreateBriefWatchlistCheck,\n} from \"@rp/react/web/brief\"\nimport {\n  CardGradientBackground,\n  LoadingSpinner,\n  PageWrapperStyled,\n} from \"@rp/react/web/common/base-components\"\nimport {\n  VERTICAL_SCROLL_STEP_CLASS_NAME,\n  VerticalScrollStepper,\n} from \"@rp/react/web/common/composite-components\"\nimport { HtmlPageHead } from \"@rp/react/web/common/header-components\"\nimport { useQueryParams } from \"@rp/react/web/common/hooks\"\nimport { useModal, useSnackbar } from \"@rp/react/web/common/providers\"\nimport { DocumentViewerPage } from \"@rp/react/web/document-viewer\"\nimport { Box, CircularProgress } from \"@rp/react/web/mui/core\"\nimport { BRIEF_ROUTE } from \"@rp/react/web/router\"\n\ntype BriefCreateOrEditProps = {\n  isEdit?: boolean\n}\n\nconst BriefCreateOrEdit = ({ isEdit = false }: BriefCreateOrEditProps) => {\n  const navigate = useNavigate()\n  const queryParams = useQueryParams()\n  const initialWatchlistId = queryParams.get(\"watchlist-id\")\n  const { form, initializeForm, setForm, setWatchlistId, setName } = useBriefConfigForm()\n  const { data: watchlist, isError, isLoading } = useWatchlist(initialWatchlistId ?? undefined)\n  const { enqueueError } = useSnackbar()\n  const { quota } = useAccount()\n\n  const {\n    planComparisonModal: { handleOpen: planComparisonHandleOpen },\n  } = useModal()\n\n  useEffect(() => {\n    if (isError) {\n      enqueueError(\"Unable to load indicated watchlist\")\n      navigate(BRIEF_ROUTE)\n    }\n  }, [enqueueError, isError, navigate])\n  const { data: briefConfigs } = useUserBriefConfigs()\n  const isAtBriefLimit = !isEdit && !!briefConfigs && briefConfigs.length >= BRIEF_CONFIG_LIMIT\n\n  const isLoadingWatchlistPreload = !!initialWatchlistId && !watchlist && isLoading\n  const { isLoadingInitialBriefData, initialBriefData } = useGetBriefInitialData({ isEdit })\n  const isLoadingBriefConfigPreload = isLoadingInitialBriefData && isEdit\n\n  useEffect(() => {\n    window.document.body.classList.add(\"scrollYlScroll\")\n    if (isEdit) {\n      if (!initialBriefData) return\n      setForm(initialBriefData)\n    } else {\n      initializeForm()\n      if (watchlist) {\n        setWatchlistId(watchlist.id)\n        setName(watchlist?.name ?? \"\")\n      }\n    }\n    return () => {\n      window.document.body.classList.remove(\"scrollYlScroll\")\n    }\n  }, [\n    initialBriefData,\n    initialWatchlistId,\n    initializeForm,\n    isEdit,\n    setForm,\n    setName,\n    setWatchlistId,\n    watchlist,\n  ])\n\n  const { step, activeStep, setActiveStep, numSteps } = useBriefCreateOrEditSteps({\n    isEdit,\n    initialWatchlistId,\n    isLoadingWatchlistPreload,\n  })\n\n  const { handleComplete, isSaving } = useCreateBriefCallbacks({ initialWatchlistId, isEdit })\n\n  const hasMetBriefLimit = useIsBriefLimitMet(quota, briefConfigs)\n\n  const { isLoadingWatchlistEntities, isFetchingWatchlistEntities, hasCompanies } =\n    useCreateBriefWatchlistCheck()\n\n  if (isLoadingBriefConfigPreload || isLoadingWatchlistPreload || isLoading) {\n    return <LoadingSpinner />\n  }\n\n  const submitText = isEdit ? \"Edit Brief\" : \"Create Brief\"\n  const isNextDisabled =\n    isSaving ||\n    step.getIsStepDisabled(form, hasCompanies) ||\n    isLoadingWatchlistEntities ||\n    isFetchingWatchlistEntities ||\n    isAtBriefLimit\n\n  return (\n    <PageWrapperStyled>\n      <HtmlPageHead title=\"Brief\" />\n      <BriefPageHeader\n        onBackButtonClick={() => navigate(-1)}\n        title={isEdit ? \"Edit Brief\" : \"New Brief\"}\n      />\n      <CardGradientBackground />\n\n      <DocumentViewerPage\n        contentContainerProps={{ style: { overflow: \"visible\" } }}\n        backTitle=\"\"\n        disableBackButton\n      >\n        {isAtBriefLimit ? (\n          <BriefLimitReached limit={BRIEF_CONFIG_LIMIT} />\n        ) : (\n          <Box\n            sx={{\n              [`& .${VERTICAL_SCROLL_STEP_CLASS_NAME}`]: {\n                paddingBottom: \"32px\",\n              },\n              [`& .${VERTICAL_SCROLL_STEP_CLASS_NAME}:last-of-type`]: {\n                paddingBottom: \"120px\",\n              },\n              marginBottom: activeStep === 0 ? \"60px\" : undefined,\n              paddingBottom: activeStep === 0 ? \"40px\" : undefined,\n            }}\n            role=\"article\"\n            aria-label=\"brief stepper container\"\n          >\n            <VerticalScrollStepper\n              activeStep={activeStep}\n              handleComplete={() => {\n                hasMetBriefLimit ? planComparisonHandleOpen(BRIEF_FEATURE_NAME) : handleComplete()\n              }}\n              completeButtonText={\n                isSaving ? <CircularProgress size={16} color=\"inherit\" /> : submitText\n              }\n              steps={numSteps}\n              title=\"Schedule a Brief\"\n              offsetTop={HEADER_HEIGHT}\n              nextDisabled={isNextDisabled}\n              onStepChange={setActiveStep}\n              isNextLoading={isFetchingWatchlistEntities}\n            >\n              {step.component}\n            </VerticalScrollStepper>\n          </Box>\n        )}\n      </DocumentViewerPage>\n    </PageWrapperStyled>\n  )\n}\n\nexport { BriefCreateOrEdit }\n"],"names":["BriefCreateOrEdit","isEdit","navigate","useNavigate","queryParams","useQueryParams","initialWatchlistId","get","form","initializeForm","setForm","setWatchlistId","setName","useBriefConfigForm","data","watchlist","isError","isLoading","useWatchlist","undefined","enqueueError","useSnackbar","quota","useAccount","planComparisonModal","handleOpen","planComparisonHandleOpen","useModal","useEffect","BRIEF_ROUTE","briefConfigs","useUserBriefConfigs","isAtBriefLimit","length","BRIEF_CONFIG_LIMIT","isLoadingWatchlistPreload","isLoadingInitialBriefData","initialBriefData","useGetBriefInitialData","isLoadingBriefConfigPreload","window","document","body","classList","add","id","name","remove","step","activeStep","setActiveStep","numSteps","useBriefCreateOrEditSteps","handleComplete","isSaving","useCreateBriefCallbacks","hasMetBriefLimit","useIsBriefLimitMet","isLoadingWatchlistEntities","isFetchingWatchlistEntities","hasCompanies","useCreateBriefWatchlistCheck","LoadingSpinner","submitText","isNextDisabled","getIsStepDisabled","PageWrapperStyled","HtmlPageHead","title","BriefPageHeader","onBackButtonClick","CardGradientBackground","DocumentViewerPage","contentContainerProps","style","overflow","backTitle","disableBackButton","BriefLimitReached","limit","Box","sx","VERTICAL_SCROLL_STEP_CLASS_NAME","paddingBottom","marginBottom","role","aria-label","VerticalScrollStepper","BRIEF_FEATURE_NAME","completeButtonText","CircularProgress","size","color","steps","offsetTop","HEADER_HEIGHT","nextDisabled","onStepChange","isNextLoading","component"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/apps/client-web/src/app/pages/Results/Results.tsx"],"sourcesContent":["import { useCallback, useEffect } from \"react\"\nimport { useNavigate } from \"react-router-dom\"\nimport { useUser } from \"@clerk/clerk-react\"\nimport { CqsItem } from \"@rp/common/api-types\"\nimport { useAddToWatchlistReset } from \"@rp/react/web/common/hooks\"\nimport { useDeviceInfo } from \"@rp/react/web/common/hooks\"\nimport { useModal } from \"@rp/react/web/common/providers\"\nimport { useQueryContext } from \"@rp/react/web/common/providers\"\nimport { tagManagerEvents } from \"@rp/react/web/common/vendors/utils\"\nimport { convertDiscoveryPanelItem } from \"@rp/react/web/cqs-query-context\"\nimport { useQueryClient } from \"@tanstack/react-query\"\nimport { ResultsLayout } from \"./ResultsLayout\"\nimport { ResultsLayoutMobile } from \"./ResultsLayout.mobile\"\n\nconst Results = () => {\n  const { isMobile } = useDeviceInfo()\n  const queryClient = useQueryClient()\n  const {\n    watchlistModal: { handleOpen: openWatchlistModal },\n  } = useModal()\n  const { user } = useUser()\n  const navigate = useNavigate()\n\n  const {\n    uiState: { isLoading, isError },\n    savedQuery: { id, name, query, saveStatus, shared, ownerUserId },\n    actions: { expression: queryCQSActions },\n    queryId,\n    searchQuery,\n  } = useQueryContext()\n  const handleAddToWatchlist = useAddToWatchlistReset(searchQuery.expression, queryId)\n\n  const editable = ownerUserId && user?.id === ownerUserId\n\n  const handleOnChange = useCallback(\n    (element: CqsItem) => {\n      const shouldRemove = element.queryRelationship === \"direct\"\n\n      tagManagerEvents.queryRefinement({\n        action: shouldRemove ? \"remove\" : \"add\",\n        component: \"documentPanel\",\n        queryId,\n        queryType: element.queryType,\n        savedStatus: saveStatus ?? \"unsaved\",\n      })\n\n      const filterItem = convertDiscoveryPanelItem(element)\n\n      if (shouldRemove) {\n        queryCQSActions.removeItem(filterItem)\n        return\n      }\n      queryCQSActions.addItem(filterItem)\n    },\n    [queryCQSActions, queryId, saveStatus],\n  )\n\n  const handleExclude = useCallback(\n    (element: CqsItem) => {\n      const shouldUpdate = element.queryRelationship === \"direct\"\n\n      tagManagerEvents.queryRefinement({\n        action: shouldUpdate ? \"changeOperation\" : \"add\",\n        component: \"discoveryPanel\",\n        queryId,\n        queryType: element.queryType,\n        savedStatus: saveStatus ?? \"unsaved\",\n      })\n\n      const filterItem = convertDiscoveryPanelItem(element)\n      queryCQSActions.excludeItemFromDP(filterItem, !shouldUpdate, () => {\n        navigate(-1)\n      })\n    },\n    [navigate, queryCQSActions, queryId, saveStatus],\n  )\n\n  useEffect(() => {\n    return () => {\n      // This ensure that every time we revisit a query we refetch the data\n      queryClient.removeQueries({\n        queryKey: [\"query\", id],\n      })\n    }\n  }, [id, queryClient])\n\n  return isMobile ? (\n    <ResultsLayoutMobile\n      handleOnChange={handleOnChange}\n      handleOnExclude={handleExclude}\n      expression={query.expression}\n      name={name}\n      saveStatus={saveStatus}\n      onAddToWatchlist={handleAddToWatchlist}\n      isPublic={shared?.company && shared.company.permission !== \"undefined\"}\n      onHandleOpenModal={openWatchlistModal}\n      editable={!!editable}\n    />\n  ) : (\n    <ResultsLayout\n      handleOnChange={handleOnChange}\n      handleOnExclude={handleExclude}\n      saveStatus={saveStatus}\n      name={name}\n      editable={!!editable}\n      expression={query.expression}\n      isLoading={isLoading}\n      isError={isError}\n      onAddToWatchlist={handleAddToWatchlist}\n      onHandleOpenModal={openWatchlistModal}\n    />\n  )\n}\n\nexport { Results }\n"],"names":["Results","isMobile","useDeviceInfo","queryClient","useQueryClient","watchlistModal","handleOpen","openWatchlistModal","useModal","user","useUser","navigate","useNavigate","uiState","isLoading","isError","savedQuery","id","name","query","saveStatus","shared","ownerUserId","actions","expression","queryCQSActions","queryId","searchQuery","useQueryContext","handleAddToWatchlist","useAddToWatchlistReset","editable","handleOnChange","useCallback","element","shouldRemove","queryRelationship","tagManagerEvents","queryRefinement","action","component","queryType","savedStatus","filterItem","convertDiscoveryPanelItem","removeItem","addItem","handleExclude","shouldUpdate","excludeItemFromDP","useEffect","removeQueries","queryKey","ResultsLayoutMobile","handleOnExclude","onAddToWatchlist","isPublic","company","permission","onHandleOpenModal","ResultsLayout"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAkHSA;;;eAAAA;;;;uBAlH8B;gCACX;4BACJ;uBAEe;2BAEd;uBAEQ;iCACS;4BACX;+BACD;qCACM;AAEpC,MAAMA,UAAU;IACd,MAAM,EAAEC,QAAQ,EAAE,GAAGC,IAAAA,oBAAa;IAClC,MAAMC,cAAcC,IAAAA,0BAAc;IAClC,MAAM,EACJC,gBAAgB,EAAEC,YAAYC,kBAAkB,EAAE,EACnD,GAAGC,IAAAA,mBAAQ;IACZ,MAAM,EAAEC,IAAI,EAAE,GAAGC,IAAAA,mBAAO;IACxB,MAAMC,WAAWC,IAAAA,2BAAW;IAE5B,MAAM,EACJC,SAAS,EAAEC,SAAS,EAAEC,OAAO,EAAE,EAC/BC,YAAY,EAAEC,EAAE,EAAEC,IAAI,EAAEC,KAAK,EAAEC,UAAU,EAAEC,MAAM,EAAEC,WAAW,EAAE,EAChEC,SAAS,EAAEC,YAAYC,eAAe,EAAE,EACxCC,OAAO,EACPC,WAAW,EACZ,GAAGC,IAAAA,0BAAe;IACnB,MAAMC,uBAAuBC,IAAAA,6BAAsB,EAACH,YAAYH,UAAU,EAAEE;IAE5E,MAAMK,WAAWT,eAAeb,CAAAA,iBAAAA,2BAAAA,KAAMQ,EAAE,MAAKK;IAE7C,MAAMU,iBAAiBC,IAAAA,kBAAW,EAChC,CAACC;QACC,MAAMC,eAAeD,QAAQE,iBAAiB,KAAK;QAEnDC,uBAAgB,CAACC,eAAe,CAAC;YAC/BC,QAAQJ,eAAe,WAAW;YAClCK,WAAW;YACXd;YACAe,WAAWP,QAAQO,SAAS;YAC5BC,aAAatB,uBAAAA,wBAAAA,aAAc;QAC7B;QAEA,MAAMuB,aAAaC,IAAAA,0CAAyB,EAACV;QAE7C,IAAIC,cAAc;YAChBV,gBAAgBoB,UAAU,CAACF;YAC3B;QACF;QACAlB,gBAAgBqB,OAAO,CAACH;IAC1B,GACA;QAAClB;QAAiBC;QAASN;KAAW;IAGxC,MAAM2B,gBAAgBd,IAAAA,kBAAW,EAC/B,CAACC;QACC,MAAMc,eAAed,QAAQE,iBAAiB,KAAK;QAEnDC,uBAAgB,CAACC,eAAe,CAAC;YAC/BC,QAAQS,eAAe,oBAAoB;YAC3CR,WAAW;YACXd;YACAe,WAAWP,QAAQO,SAAS;YAC5BC,aAAatB,uBAAAA,wBAAAA,aAAc;QAC7B;QAEA,MAAMuB,aAAaC,IAAAA,0CAAyB,EAACV;QAC7CT,gBAAgBwB,iBAAiB,CAACN,YAAY,CAACK,cAAc;YAC3DrC,SAAS,CAAC;QACZ;IACF,GACA;QAACA;QAAUc;QAAiBC;QAASN;KAAW;IAGlD8B,IAAAA,gBAAS,EAAC;QACR,OAAO;YACL,qEAAqE;YACrE/C,YAAYgD,aAAa,CAAC;gBACxBC,UAAU;oBAAC;oBAASnC;iBAAG;YACzB;QACF;IACF,GAAG;QAACA;QAAId;KAAY;IAEpB,OAAOF,yBACL,qBAACoD,wCAAmB;QAClBrB,gBAAgBA;QAChBsB,iBAAiBP;QACjBvB,YAAYL,MAAMK,UAAU;QAC5BN,MAAMA;QACNE,YAAYA;QACZmC,kBAAkB1B;QAClB2B,UAAUnC,CAAAA,mBAAAA,6BAAAA,OAAQoC,OAAO,KAAIpC,OAAOoC,OAAO,CAACC,UAAU,KAAK;QAC3DC,mBAAmBpD;QACnBwB,UAAU,CAAC,CAACA;uBAGd,qBAAC6B,4BAAa;QACZ5B,gBAAgBA;QAChBsB,iBAAiBP;QACjB3B,YAAYA;QACZF,MAAMA;QACNa,UAAU,CAAC,CAACA;QACZP,YAAYL,MAAMK,UAAU;QAC5BV,WAAWA;QACXC,SAASA;QACTwC,kBAAkB1B;QAClB8B,mBAAmBpD;;AAGzB"}
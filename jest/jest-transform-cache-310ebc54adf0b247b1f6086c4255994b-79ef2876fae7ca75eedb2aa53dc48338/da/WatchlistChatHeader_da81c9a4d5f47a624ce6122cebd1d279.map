{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/watchlists/src/lib/WatchlistChat/WatchlistChatHeader/WatchlistChatHeader.tsx"],"sourcesContent":["import { Dispatch, SetStateAction } from \"react\"\nimport { generatePath } from \"react-router-dom\"\nimport { useUser } from \"@clerk/clerk-react\"\nimport { CqsItem, Watchlist } from \"@rp/common/api-types\"\nimport { getShareObject } from \"@rp/common/utils\"\nimport { ChatObject, useShareChat } from \"@rp/react/tanstack-api/chat\"\nimport { useShareWatchlist } from \"@rp/react/tanstack-api/watchlist\"\nimport { useChatDataContext } from \"@rp/react/web/chat\"\nimport { CategoryIcon, EllipsisTooltip } from \"@rp/react/web/common/composite-components\"\nimport { useModal, useSnackbar } from \"@rp/react/web/common/providers\"\nimport { Box, Button, IconButton, lighten } from \"@rp/react/web/mui/core\"\nimport { Close, RestartAlt, Share } from \"@rp/react/web/mui/icons\"\nimport { CHAT_ID_ROUTE } from \"@rp/react/web/router\"\nimport { WATCHLIST_HEADER_HEIGHT } from \"../WatchlistChat\"\n\ntype Props = {\n  chat: ChatObject | undefined\n  selectedEntity: CqsItem | null\n  watchlistName: string\n  hasSelectedEntity: boolean\n  hasInteractions: boolean\n  onRestart: () => void\n  setIsChatCollapsed: Dispatch<SetStateAction<boolean>>\n  watchlist: Watchlist\n}\nexport function WatchlistChatHeader({\n  selectedEntity,\n  chat,\n  watchlistName,\n  hasInteractions,\n  onRestart,\n  hasSelectedEntity,\n  setIsChatCollapsed,\n  watchlist,\n}: Props) {\n  const { user: publicUserData } = useUser()\n  const {\n    ui: { isEditable },\n  } = useChatDataContext()\n  const {\n    shareModal: { handleOpen },\n  } = useModal()\n  const { mutateAsync } = useShareChat()\n  const { enqueueError } = useSnackbar()\n  const { mutateAsync: shareWatchlist } = useShareWatchlist({ enqueueError })\n\n  const { name } = selectedEntity || {}\n  const tooltipText = name ?? watchlistName\n  const title = `Chat with ${tooltipText}`\n  const showRestart = hasInteractions || hasSelectedEntity\n  const isOwner = watchlist.ownerUserId === publicUserData?.id\n\n  const onShareClick = async () => {\n    if (!chat || !watchlist.id) return\n\n    const isOwner = watchlist.ownerUserId === publicUserData?.id\n    const isShared =\n      watchlist.shared.isPublic || watchlist.shared.company.permission !== \"undefined\"\n    const isSharedWithOrg =\n      watchlist.shared.company.permission !== \"undefined\" && !watchlist.shared.isPublic\n    const sharingLevelText = watchlist.shared.isPublic\n      ? \"publicly\"\n      : watchlist.shared.company.permission !== \"undefined\"\n      ? \"within organization\"\n      : \"private\"\n\n    handleOpen({\n      data: {\n        isEditable,\n        shareObject: getShareObject({\n          shareObjectId: chat.id,\n          shareObjectType: \"chat\",\n          path: generatePath(CHAT_ID_ROUTE, { id: chat.id }),\n          name: chat.name,\n          infoMessage: isOwner\n            ? isShared\n              ? `Your ${watchlist.name} Watchlist is already shared ${sharingLevelText}`\n              : `This will also make your ${watchlist.name} Watchlist publicly accessible`\n            : `You don't own ${watchlist.name} Watchlist - current access: ${sharingLevelText}`,\n        }),\n        mutate: async ({ sharedStatus }) => {\n          await mutateAsync({ id: chat.id, isPublic: sharedStatus === \"Public\" })\n\n          if (isOwner) {\n            if (!isShared || isSharedWithOrg) {\n              await shareWatchlist({\n                id: watchlist.id,\n                sharedBody: { isPublic: true },\n              })\n            }\n          }\n        },\n        sharedStatus: chat.isPublic ? \"Public\" : \"Private\",\n        title: \"Share Chat\",\n        ownerUserId: chat.userId,\n        enabledOptions: [\"Private\", \"Public\"],\n      },\n    })\n  }\n\n  return (\n    <Box\n      sx={{\n        height: WATCHLIST_HEADER_HEIGHT - 1,\n        alignItems: \"center\",\n        display: \"flex\",\n        gap: 1,\n        px: 2,\n        borderBottom: `1px solid rgba(255, 255, 255, 0.16)`,\n        \"& svg\": { width: 20, height: 20 },\n      }}\n    >\n      {selectedEntity && <CategoryIcon cqsItem={selectedEntity} />}\n      <EllipsisTooltip\n        typographyProps={{\n          sx: {\n            fontSize: \"20px\",\n            fontWeight: 700,\n            color: \"text.primary\",\n            flexGrow: 1,\n          },\n        }}\n        tooltipText={tooltipText}\n      >\n        {title}\n      </EllipsisTooltip>\n\n      <Box sx={{ display: \"flex\", gap: 1, alignItems: \"center\", flexShrink: 0 }}>\n        {showRestart && (\n          <Button\n            variant=\"text-outlined-mono\"\n            startIcon={<RestartAlt sx={{ width: 24, height: 24 }} />}\n            aria-label=\"Restart\"\n            onClick={onRestart}\n            size=\"small\"\n            sx={theme => ({\n              height: 32,\n              backgroundColor: theme.palette.elevation.dp01,\n              borderRadius: \"8px\",\n              border: `1px solid ${theme.palette.outline.border}`,\n              \"& svg\": { width: 20, height: 20 },\n              \"&:hover\": { backgroundColor: lighten(theme.palette.elevation.dp01, 0.1) },\n            })}\n          >\n            New Chat\n          </Button>\n        )}\n\n        {(isOwner || watchlist.global?.status === \"published\") && chat && (\n          <IconButton\n            size=\"small\"\n            aria-label=\"Share chat\"\n            onClick={() => onShareClick()}\n            sx={theme => {\n              return {\n                width: 30,\n                height: 30,\n                backgroundColor: theme.palette.elevation.dp01,\n                borderRadius: \"8px\",\n                border: `1px solid ${theme.palette.outline.border}`,\n                \"& svg\": { width: 20, height: 20 },\n                \"&:hover\": {\n                  backgroundColor: lighten(theme.palette.elevation.dp01, 0.1),\n                  color: theme.palette.text.primary,\n                },\n                color: theme.palette.text.secondary,\n              }\n            }}\n          >\n            <Share sx={{ width: 24, height: 24 }} />\n          </IconButton>\n        )}\n        <IconButton\n          size=\"small\"\n          aria-label=\"Collapse chat\"\n          onClick={() => setIsChatCollapsed(prev => !prev)}\n          sx={theme => {\n            return {\n              width: 30,\n              height: 30,\n              backgroundColor: theme.palette.elevation.dp01,\n              borderRadius: \"8px\",\n              border: `1px solid ${theme.palette.outline.border}`,\n              \"& svg\": { width: 20, height: 20 },\n              \"&:hover\": {\n                backgroundColor: lighten(theme.palette.elevation.dp01, 0.1),\n                color: theme.palette.text.primary,\n              },\n              color: theme.palette.text.secondary,\n            }\n          }}\n        >\n          <Close sx={{ width: 24, height: 24 }} />\n        </IconButton>\n      </Box>\n    </Box>\n  )\n}\n"],"names":["WatchlistChatHeader","selectedEntity","chat","watchlistName","hasInteractions","onRestart","hasSelectedEntity","setIsChatCollapsed","watchlist","user","publicUserData","useUser","ui","isEditable","useChatDataContext","shareModal","handleOpen","useModal","mutateAsync","useShareChat","enqueueError","useSnackbar","shareWatchlist","useShareWatchlist","name","tooltipText","title","showRestart","isOwner","ownerUserId","id","onShareClick","isShared","shared","isPublic","company","permission","isSharedWithOrg","sharingLevelText","data","shareObject","getShareObject","shareObjectId","shareObjectType","path","generatePath","CHAT_ID_ROUTE","infoMessage","mutate","sharedStatus","sharedBody","userId","enabledOptions","Box","sx","height","WATCHLIST_HEADER_HEIGHT","alignItems","display","gap","px","borderBottom","width","CategoryIcon","cqsItem","EllipsisTooltip","typographyProps","fontSize","fontWeight","color","flexGrow","flexShrink","Button","variant","startIcon","RestartAlt","aria-label","onClick","size","theme","backgroundColor","palette","elevation","dp01","borderRadius","border","outline","lighten","global","status","IconButton","text","primary","secondary","Share","prev","Close"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/common/base-components/src/ActionsMenu/ActionsMenu.tsx"],"sourcesContent":["import { JSX, forwardRef, useCallback, useEffect, useRef, useState } from \"react\"\nimport { useDeviceInfo, useDisableIOSTouch } from \"@rp/react/web/common/hooks\"\nimport { Actions } from \"@rp/react/web/common/types\"\nimport {\n  Box,\n  ClickAwayListener,\n  IconButton,\n  Menu,\n  MenuItem,\n  MenuProps as MuiMenuProps,\n  SxProps,\n} from \"@rp/react/web/mui/core\"\nimport { ArrowRight, MoreVert } from \"@rp/react/web/mui/icons\"\nimport { RPTooltip } from \"../RPTooltip\"\n\ntype Props<TItem = unknown> = {\n  open: boolean\n  setOpen: (state: boolean) => void\n  actions: Actions<TItem>\n  item: TItem\n  anchorOrigin?: MuiMenuProps[\"anchorOrigin\"]\n  transformOrigin?: MuiMenuProps[\"transformOrigin\"]\n  onActionClick?: (action: Actions[number]) => void\n  title?: string\n  sxIconButton?: SxProps\n  openColor?: string\n}\n\ntype MenuProps<TItem = unknown> = Pick<\n  Props<TItem>,\n  \"actions\" | \"item\" | \"open\" | \"anchorOrigin\" | \"transformOrigin\" | \"onActionClick\"\n> & {\n  handleClose: () => void\n  anchorEl: Element | null\n  nested?: boolean\n}\ntype MenuItemProps<TItem> = Pick<Actions[number], \"nestedActions\" | \"onClick\" | \"label\"> & {\n  children: React.ReactNode\n  selected: boolean\n  onMouseEnter: () => void\n  handleClose: () => void\n  item: TItem\n  disabled?: boolean\n}\n\nconst NestedMenu = forwardRef<HTMLDivElement, MenuProps>(\n  (\n    {\n      actions,\n      item,\n      open,\n      handleClose,\n      onActionClick,\n      anchorEl,\n      nested,\n      anchorOrigin = { horizontal: \"center\", vertical: \"bottom\" },\n      transformOrigin = { horizontal: \"center\", vertical: \"top\" },\n    },\n    ref,\n  ) => {\n    const [selectedItem, setSelectedItem] = useState<string | null>(null)\n    const { isMobile } = useDeviceInfo()\n    const nestedAnchor = isMobile\n      ? { horizontal: \"left\" as const, vertical: \"top\" as const }\n      : { horizontal: \"right\" as const, vertical: \"top\" as const }\n    const nestedTransform = isMobile\n      ? { horizontal: \"right\" as const, vertical: \"top\" as const }\n      : { horizontal: \"left\" as const, vertical: \"top\" as const }\n    useEffect(() => {\n      return () => setSelectedItem(null)\n    }, [open])\n\n    return (\n      <Menu\n        variant=\"menu\"\n        onClick={e => e.stopPropagation()}\n        open={open}\n        anchorEl={anchorEl}\n        onClose={handleClose}\n        sx={{\n          \"& .MuiList-root\": { maxHeight: \"80vh\" },\n          pointerEvents: nested ? \"none\" : undefined,\n          mt: nested ? -1 : 0,\n          ul: { backgroundColor: \"elevation.dp06\" },\n        }}\n        ref={ref}\n        anchorOrigin={nested ? nestedAnchor : anchorOrigin}\n        transformOrigin={nested ? nestedTransform : transformOrigin}\n        hideBackdrop={nested}\n      >\n        <Box sx={{ pointerEvents: \"auto\" }}>\n          {actions.map(action => {\n            const {\n              id,\n              label,\n              icon,\n              onClick,\n              allowedAction,\n              disabledAction,\n              nestedActions,\n              color,\n            } = action\n            if (allowedAction?.(item)) return null\n            return (\n              <NestedMenuItem\n                key={id}\n                onClick={ev => {\n                  setSelectedItem(label)\n                  onClick(ev)\n                  onActionClick?.(action)\n                }}\n                label={label}\n                nestedActions={nestedActions}\n                selected={label === selectedItem}\n                onMouseEnter={() => setSelectedItem(label)}\n                handleClose={handleClose}\n                item={item}\n                disabled={disabledAction?.(item)}\n              >\n                <Box sx={{ display: \"flex\", gap: 1, color }}>\n                  {typeof icon === \"function\" ? icon(item) : icon}{\" \"}\n                  {typeof label === \"function\" ? label(item) : label}\n                </Box>\n                {nestedActions !== undefined ? <ArrowRight /> : null}\n              </NestedMenuItem>\n            )\n          })}\n        </Box>\n      </Menu>\n    )\n  },\n) as <T>(props: MenuProps<T> & { ref?: React.Ref<HTMLDivElement> }) => JSX.Element\n\nconst NestedMenuItem = <TItem,>({\n  children,\n  onClick,\n  nestedActions,\n  selected,\n  onMouseEnter,\n  handleClose,\n  item,\n  disabled,\n}: MenuItemProps<TItem>) => {\n  const ref = useRef<HTMLLIElement>(null)\n  const openSubmenu = nestedActions !== undefined && selected\n  return (\n    <>\n      <MenuItem\n        sx={{\n          display: \"flex\",\n          justifyContent: \"space-between\",\n          alignItems: \"center\",\n          gap: 2,\n          minHeight: \"32px\",\n          py: 1,\n          backgroundColor: \"elevation.dp06\",\n          \"& svg\": { color: \"text.secondary\" },\n        }}\n        onClick={() => {\n          !nestedActions?.length && handleClose()\n          onClick(item)\n        }}\n        onMouseEnter={onMouseEnter}\n        ref={ref}\n        disabled={disabled}\n      >\n        {children}\n      </MenuItem>\n      {nestedActions !== undefined ? (\n        <NestedMenu\n          actions={nestedActions}\n          item={item}\n          open={openSubmenu}\n          handleClose={handleClose}\n          anchorEl={ref.current}\n          nested\n        />\n      ) : null}\n    </>\n  )\n}\n\nconst ActionsMenu = <TItem,>({\n  open,\n  setOpen,\n  actions,\n  item,\n  anchorOrigin,\n  transformOrigin,\n  onActionClick,\n  title = \"More actions\",\n  sxIconButton,\n  openColor = \"primary.main\",\n}: Props<TItem>) => {\n  const [ref, setRef] = useState<HTMLButtonElement | null>(null)\n  const handleClose = useCallback(() => {\n    setOpen(false)\n  }, [setOpen])\n\n  useDisableIOSTouch(open)\n\n  return (\n    <>\n      <RPTooltip title={title}>\n        <IconButton\n          sx={sxIconButton}\n          ref={setRef}\n          size=\"small\"\n          onClick={e => {\n            e.stopPropagation()\n            setOpen(true)\n          }}\n        >\n          <MoreVert sx={{ color: open ? openColor : \"\" }} />\n        </IconButton>\n      </RPTooltip>\n      <ClickAwayListener onClickAway={handleClose}>\n        <NestedMenu\n          open={open}\n          actions={actions}\n          anchorOrigin={anchorOrigin}\n          transformOrigin={transformOrigin}\n          item={item}\n          handleClose={handleClose}\n          anchorEl={ref}\n          onActionClick={onActionClick}\n        />\n      </ClickAwayListener>\n    </>\n  )\n}\n\nexport { ActionsMenu }\n"],"names":["ActionsMenu","NestedMenu","forwardRef","actions","item","open","handleClose","onActionClick","anchorEl","nested","anchorOrigin","horizontal","vertical","transformOrigin","ref","selectedItem","setSelectedItem","useState","isMobile","useDeviceInfo","nestedAnchor","nestedTransform","useEffect","Menu","variant","onClick","e","stopPropagation","onClose","sx","maxHeight","pointerEvents","undefined","mt","ul","backgroundColor","hideBackdrop","Box","map","action","id","label","icon","allowedAction","disabledAction","nestedActions","color","NestedMenuItem","ev","selected","onMouseEnter","disabled","display","gap","ArrowRight","children","useRef","openSubmenu","MenuItem","justifyContent","alignItems","minHeight","py","length","current","setOpen","title","sxIconButton","openColor","setRef","useCallback","useDisableIOSTouch","RPTooltip","IconButton","size","MoreVert","ClickAwayListener","onClickAway"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}
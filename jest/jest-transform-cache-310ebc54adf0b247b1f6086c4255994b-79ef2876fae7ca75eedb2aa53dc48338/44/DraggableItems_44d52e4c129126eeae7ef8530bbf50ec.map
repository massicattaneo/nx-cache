{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/common/composite-components/src/ReOrderableList/DraggableItems.tsx"],"sourcesContent":["import { ForwardRefExoticComponent, useCallback, useEffect, useState } from \"react\"\nimport update from \"immutability-helper\"\nimport { useDrop } from \"react-dnd\"\nimport { useDeviceInfo } from \"@rp/react/web/common/hooks\"\nimport { DragOptions, DraggableItem, ItemTypes } from \"./DraggableItem\"\n\ntype Props<Item, CProps> = {\n  list: Array<Item>\n  ListItem: ForwardRefExoticComponent<\n    {\n      item: Item\n      dragOptions?: DragOptions\n      componentProps?: CProps\n    } & React.RefAttributes<unknown>\n  >\n  onDrop: (orderedList: Array<Item>) => void\n  disableDrag?: boolean\n  componentProps?: CProps\n}\n\nfunction hasChanges<Item>(cards: Array<Item>, list: Array<Item>) {\n  return JSON.stringify(cards) !== JSON.stringify(list)\n}\n\nfunction DraggableItems<Item extends { id: string }, CProps>({\n  list,\n  ListItem,\n  onDrop,\n  disableDrag,\n  componentProps,\n}: Props<Item, CProps>) {\n  const { isMobile } = useDeviceInfo()\n  const [cards, setCards] = useState(list)\n  const type = isMobile ? ItemTypes.MOBILE_CARD : ItemTypes.HUB_TABLE_ROW\n  const disableDragging = list.length <= 1 || disableDrag\n\n  useEffect(() => setCards(list), [list])\n\n  const moveCard = useCallback((dragIndex: number, hoverIndex: number) => {\n    setCards(prevCards =>\n      update(prevCards, {\n        $splice: [\n          [dragIndex, 1],\n          [hoverIndex, 0, prevCards[dragIndex]],\n        ],\n      }),\n    )\n  }, [])\n\n  const [_, drop] = useDrop({\n    accept: type,\n    drop() {\n      if (hasChanges(cards, list)) onDrop?.(cards)\n    },\n  })\n\n  useEffect(() => {\n    drop(window.document.body)\n  }, [drop])\n\n  const isDragging = hasChanges(cards, list)\n\n  return cards.map((row, index) => {\n    return (\n      <DraggableItem\n        key={row.id}\n        moveCard={moveCard}\n        index={index}\n        item={row}\n        disableDrag={disableDragging}\n        type={type}\n        onDrop={() => {\n          if (hasChanges(cards, list)) onDrop?.(cards)\n        }}\n        renderItem={(dragRef, dragOptions) => {\n          return (\n            <ListItem\n              ref={dragRef}\n              item={row}\n              dragOptions={{ ...dragOptions, isDragging }}\n              componentProps={componentProps}\n            />\n          )\n        }}\n      />\n    )\n  })\n}\n\nexport { DraggableItems }\n"],"names":["DraggableItems","hasChanges","cards","list","JSON","stringify","ListItem","onDrop","disableDrag","componentProps","isMobile","useDeviceInfo","setCards","useState","type","ItemTypes","MOBILE_CARD","HUB_TABLE_ROW","disableDragging","length","useEffect","moveCard","useCallback","dragIndex","hoverIndex","prevCards","update","$splice","_","drop","useDrop","accept","window","document","body","isDragging","map","row","index","DraggableItem","item","renderItem","dragRef","dragOptions","ref","id"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAyFSA;;;eAAAA;;;;uBAzFmE;2EACzD;0BACK;uBACM;+BACwB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgBtD,SAASC,WAAiBC,KAAkB,EAAEC,IAAiB;IAC7D,OAAOC,KAAKC,SAAS,CAACH,WAAWE,KAAKC,SAAS,CAACF;AAClD;AAEA,SAASH,eAAoD,EAC3DG,IAAI,EACJG,QAAQ,EACRC,MAAM,EACNC,WAAW,EACXC,cAAc,EACM;IACpB,MAAM,EAAEC,QAAQ,EAAE,GAAGC,IAAAA,oBAAa;IAClC,MAAM,CAACT,OAAOU,SAAS,GAAGC,IAAAA,eAAQ,EAACV;IACnC,MAAMW,OAAOJ,WAAWK,wBAAS,CAACC,WAAW,GAAGD,wBAAS,CAACE,aAAa;IACvE,MAAMC,kBAAkBf,KAAKgB,MAAM,IAAI,KAAKX;IAE5CY,IAAAA,gBAAS,EAAC,IAAMR,SAAST,OAAO;QAACA;KAAK;IAEtC,MAAMkB,WAAWC,IAAAA,kBAAW,EAAC,CAACC,WAAmBC;QAC/CZ,SAASa,CAAAA,YACPC,IAAAA,2BAAM,EAACD,WAAW;gBAChBE,SAAS;oBACP;wBAACJ;wBAAW;qBAAE;oBACd;wBAACC;wBAAY;wBAAGC,SAAS,CAACF,UAAU;qBAAC;iBACtC;YACH;IAEJ,GAAG,EAAE;IAEL,MAAM,CAACK,GAAGC,KAAK,GAAGC,IAAAA,iBAAO,EAAC;QACxBC,QAAQjB;QACRe;YACE,IAAI5B,WAAWC,OAAOC,OAAOI,mBAAAA,6BAAAA,OAASL;QACxC;IACF;IAEAkB,IAAAA,gBAAS,EAAC;QACRS,KAAKG,OAAOC,QAAQ,CAACC,IAAI;IAC3B,GAAG;QAACL;KAAK;IAET,MAAMM,aAAalC,WAAWC,OAAOC;IAErC,OAAOD,MAAMkC,GAAG,CAAC,CAACC,KAAKC;QACrB,qBACE,qBAACC,4BAAa;YAEZlB,UAAUA;YACViB,OAAOA;YACPE,MAAMH;YACN7B,aAAaU;YACbJ,MAAMA;YACNP,QAAQ;gBACN,IAAIN,WAAWC,OAAOC,OAAOI,mBAAAA,6BAAAA,OAASL;YACxC;YACAuC,YAAY,CAACC,SAASC;gBACpB,qBACE,qBAACrC;oBACCsC,KAAKF;oBACLF,MAAMH;oBACNM,aAAa,wCAAKA;wBAAaR;;oBAC/B1B,gBAAgBA;;YAGtB;WAlBK4B,IAAIQ,EAAE;IAqBjB;AACF"}
{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/development/src/lib/trpc/bigdata-api/procedures/cqs-procedures.ts"],"sourcesContent":["import { z } from \"zod\"\nimport { bigdataSchemas } from \"@rp/common/contracts\"\nimport { TRPCError } from \"@trpc/server\"\nimport { bigdataApiProcedure } from \"../bigdata-api-procedure\"\n\nexport const cqsProcedures = {\n  byIds: bigdataApiProcedure\n    .meta({ openapi: { method: \"POST\", path: \"/cqs/by-ids\" } })\n    .input(z.record(z.string(), bigdataSchemas.st_cqs_SuggestionItem))\n    .output(z.record(bigdataSchemas.st_cqs_DiscoveryPanelItem))\n    .query(async opts => {\n      return Object.values(opts.input).reduce(async (prev, { key }) => {\n        const acc = await prev\n        const item = await opts.ctx.db.collection(\"cqs\").findOne({ key })\n        if (!item) return acc\n        return { ...acc, [key]: item }\n      }, Promise.resolve({}))\n    }),\n  rankingProfiles: bigdataApiProcedure\n    .meta({ openapi: { method: \"GET\", path: \"/cqs/ranking_profiles\" } })\n    .input(z.object({}))\n    .output(bigdataSchemas.st_cqs_RankingResponse)\n    .query(async () => {\n      return { results: [\"stable\", \"experimental\", \"similarity\"] }\n    }),\n  rpjson: bigdataApiProcedure\n    .meta({ openapi: { method: \"GET\", path: \"/rpjson/:id\" } })\n    .input(z.object({ id: z.string() }))\n    .query(async ({ ctx, input }) => {\n      const file = await ctx.db\n        .collection(\"files\")\n        .findOne(item => item.rpjson?.document?.rp_document_id === input.id)\n      if (!file || !file.rpjson) throw new TRPCError({ code: \"NOT_FOUND\" })\n      return file.rpjson\n    }),\n}\n"],"names":["cqsProcedures","byIds","bigdataApiProcedure","meta","openapi","method","path","input","z","record","string","bigdataSchemas","st_cqs_SuggestionItem","output","st_cqs_DiscoveryPanelItem","query","opts","Object","values","reduce","prev","key","acc","item","ctx","db","collection","findOne","Promise","resolve","rankingProfiles","object","st_cqs_RankingResponse","results","rpjson","id","file","document","rp_document_id","TRPCError","code"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAKaA;;;eAAAA;;;qBALK;2BACa;wBACL;qCACU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAE7B,MAAMA,gBAAgB;IAC3BC,OAAOC,wCAAmB,CACvBC,IAAI,CAAC;QAAEC,SAAS;YAAEC,QAAQ;YAAQC,MAAM;QAAc;IAAE,GACxDC,KAAK,CAACC,MAAC,CAACC,MAAM,CAACD,MAAC,CAACE,MAAM,IAAIC,yBAAc,CAACC,qBAAqB,GAC/DC,MAAM,CAACL,MAAC,CAACC,MAAM,CAACE,yBAAc,CAACG,yBAAyB,GACxDC,KAAK,CAAC,OAAMC;QACX,OAAOC,OAAOC,MAAM,CAACF,KAAKT,KAAK,EAAEY,MAAM,CAAC,OAAOC,MAAM,EAAEC,GAAG,EAAE;YAC1D,MAAMC,MAAM,MAAMF;YAClB,MAAMG,OAAO,MAAMP,KAAKQ,GAAG,CAACC,EAAE,CAACC,UAAU,CAAC,OAAOC,OAAO,CAAC;gBAAEN;YAAI;YAC/D,IAAI,CAACE,MAAM,OAAOD;YAClB,OAAO,wCAAKA;gBAAK,CAACD,IAAI,EAAEE;;QAC1B,GAAGK,QAAQC,OAAO,CAAC,CAAC;IACtB;IACFC,iBAAiB5B,wCAAmB,CACjCC,IAAI,CAAC;QAAEC,SAAS;YAAEC,QAAQ;YAAOC,MAAM;QAAwB;IAAE,GACjEC,KAAK,CAACC,MAAC,CAACuB,MAAM,CAAC,CAAC,IAChBlB,MAAM,CAACF,yBAAc,CAACqB,sBAAsB,EAC5CjB,KAAK,CAAC;QACL,OAAO;YAAEkB,SAAS;gBAAC;gBAAU;gBAAgB;aAAa;QAAC;IAC7D;IACFC,QAAQhC,wCAAmB,CACxBC,IAAI,CAAC;QAAEC,SAAS;YAAEC,QAAQ;YAAOC,MAAM;QAAc;IAAE,GACvDC,KAAK,CAACC,MAAC,CAACuB,MAAM,CAAC;QAAEI,IAAI3B,MAAC,CAACE,MAAM;IAAG,IAChCK,KAAK,CAAC,OAAO,EAAES,GAAG,EAAEjB,KAAK,EAAE;QAC1B,MAAM6B,OAAO,MAAMZ,IAAIC,EAAE,CACtBC,UAAU,CAAC,SACXC,OAAO,CAACJ,CAAAA;gBAAQA,uBAAAA;mBAAAA,EAAAA,eAAAA,KAAKW,MAAM,cAAXX,oCAAAA,wBAAAA,aAAac,QAAQ,cAArBd,4CAAAA,sBAAuBe,cAAc,MAAK/B,MAAM4B,EAAE;;QACrE,IAAI,CAACC,QAAQ,CAACA,KAAKF,MAAM,EAAE,MAAM,IAAIK,iBAAS,CAAC;YAAEC,MAAM;QAAY;QACnE,OAAOJ,KAAKF,MAAM;IACpB;AACJ"}
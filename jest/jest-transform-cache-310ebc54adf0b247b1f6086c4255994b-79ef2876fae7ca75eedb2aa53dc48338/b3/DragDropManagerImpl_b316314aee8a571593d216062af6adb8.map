{"version":3,"sources":["../../src/classes/DragDropManagerImpl.ts"],"sourcesContent":["import type { Action, Store } from 'redux'\n\nimport { createDragDropActions } from '../actions/dragDrop/index.js'\nimport type {\n\tActionCreator,\n\tBackend,\n\tDragDropActions,\n\tDragDropManager,\n\tDragDropMonitor,\n\tHandlerRegistry,\n} from '../interfaces.js'\nimport type { State } from '../reducers/index.js'\nimport type { DragDropMonitorImpl } from './DragDropMonitorImpl.js'\n\nexport class DragDropManagerImpl implements DragDropManager {\n\tprivate store: Store<State>\n\tprivate monitor: DragDropMonitor\n\tprivate backend: Backend | undefined\n\tprivate isSetUp = false\n\n\tpublic constructor(store: Store<State>, monitor: DragDropMonitor) {\n\t\tthis.store = store\n\t\tthis.monitor = monitor\n\t\tstore.subscribe(this.handleRefCountChange)\n\t}\n\n\tpublic receiveBackend(backend: Backend): void {\n\t\tthis.backend = backend\n\t}\n\n\tpublic getMonitor(): DragDropMonitor {\n\t\treturn this.monitor\n\t}\n\n\tpublic getBackend(): Backend {\n\t\treturn this.backend as Backend\n\t}\n\n\tpublic getRegistry(): HandlerRegistry {\n\t\treturn (this.monitor as DragDropMonitorImpl).registry\n\t}\n\n\tpublic getActions(): DragDropActions {\n\t\t/* eslint-disable-next-line @typescript-eslint/no-this-alias */\n\t\tconst manager = this\n\t\tconst { dispatch } = this.store\n\n\t\tfunction bindActionCreator(actionCreator: ActionCreator<any>) {\n\t\t\treturn (...args: any[]) => {\n\t\t\t\tconst action = actionCreator.apply(manager, args as any)\n\t\t\t\tif (typeof action !== 'undefined') {\n\t\t\t\t\tdispatch(action)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst actions = createDragDropActions(this)\n\n\t\treturn Object.keys(actions).reduce(\n\t\t\t(boundActions: DragDropActions, key: string) => {\n\t\t\t\tconst action: ActionCreator<any> = (actions as any)[\n\t\t\t\t\tkey\n\t\t\t\t] as ActionCreator<any>\n\t\t\t\t;(boundActions as any)[key] = bindActionCreator(action)\n\t\t\t\treturn boundActions\n\t\t\t},\n\t\t\t{} as DragDropActions,\n\t\t)\n\t}\n\n\tpublic dispatch(action: Action<any>): void {\n\t\tthis.store.dispatch(action)\n\t}\n\n\tprivate handleRefCountChange = (): void => {\n\t\tconst shouldSetUp = this.store.getState().refCount > 0\n\t\tif (this.backend) {\n\t\t\tif (shouldSetUp && !this.isSetUp) {\n\t\t\t\tthis.backend.setup()\n\t\t\t\tthis.isSetUp = true\n\t\t\t} else if (!shouldSetUp && this.isSetUp) {\n\t\t\t\tthis.backend.teardown()\n\t\t\t\tthis.isSetUp = false\n\t\t\t}\n\t\t}\n\t}\n}\n"],"names":["DragDropManagerImpl","receiveBackend","backend","getMonitor","monitor","getBackend","getRegistry","registry","getActions","manager","dispatch","store","bindActionCreator","actionCreator","args","action","apply","actions","createDragDropActions","Object","keys","reduce","boundActions","key","constructor","isSetUp","handleRefCountChange","shouldSetUp","getState","refCount","setup","teardown","subscribe"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAcaA;;;eAAAA;;;uBAZyB;AAY/B,MAAMA;IAYZC,eAAsBC,OAAgB,EAAQ;QAC7C,IAAI,CAACA,OAAO,GAAGA;;IAGhBC,aAAqC;QACpC,OAAO,IAAI,CAACC,OAAO;;IAGpBC,aAA6B;QAC5B,OAAO,IAAI,CAACH,OAAO;;IAGpBI,cAAsC;QACrC,OAAO,IAAK,CAACF,OAAO,CAAyBG,QAAQ;;IAGtDC,aAAqC;QACpC,6DAAA,GACA,MAAMC,UAAU,IAAI;QACpB,MAAM,EAAEC,QAAQ,EAAE,GAAG,IAAI,CAACC,KAAK;QAE/B,SAASC,kBAAkBC,aAAiC;YAC3D,OAAO,CAAC,GAAGC;gBACV,MAAMC,SAASF,cAAcG,KAAK,CAACP,SAASK;gBAC5C,IAAI,OAAOC,WAAW,aAAa;oBAClCL,SAASK;;;;QAKZ,MAAME,UAAUC,IAAAA,4BAAqB,EAAC,IAAI;QAE1C,OAAOC,OAAOC,IAAI,CAACH,SAASI,MAAM,CACjC,CAACC,cAA+BC;YAC/B,MAAMR,SAA6BE,OAAQ,CAC1CM,IACA;YACAD,YAAa,CAASC,IAAI,GAAGX,kBAAkBG;YAChD,OAAOO;WAER,CAAA;;IAIFZ,SAAgBK,MAAmB,EAAQ;QAC1C,IAAI,CAACJ,KAAK,CAACD,QAAQ,CAACK;;IAnDrBS,YAAmBb,KAAmB,EAAEP,OAAwB,CAAE;QAFlE,IAAA,CAAQqB,OAAO,GAAG;QAwDlB,IAAA,CAAQC,oBAAoB,GAAG;YAC9B,MAAMC,cAAc,IAAI,CAAChB,KAAK,CAACiB,QAAQ,GAAGC,QAAQ,GAAG;YACrD,IAAI,IAAI,CAAC3B,OAAO,EAAE;gBACjB,IAAIyB,eAAe,CAAC,IAAI,CAACF,OAAO,EAAE;oBACjC,IAAI,CAACvB,OAAO,CAAC4B,KAAK;oBAClB,IAAI,CAACL,OAAO,GAAG;uBACT,IAAI,CAACE,eAAe,IAAI,CAACF,OAAO,EAAE;oBACxC,IAAI,CAACvB,OAAO,CAAC6B,QAAQ;oBACrB,IAAI,CAACN,OAAO,GAAG;;;;QA7DjB,IAAI,CAACd,KAAK,GAAGA;QACb,IAAI,CAACP,OAAO,GAAGA;QACfO,MAAMqB,SAAS,CAAC,IAAI,CAACN,oBAAoB"}
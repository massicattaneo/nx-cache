{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/common/providers/src/lib/UploadFilesProvider/uploadFileProviderUtils.ts"],"sourcesContent":["import { Dispatch, SetStateAction } from \"react\"\nimport { NativeFile, ServerFile, Uploadable, getUuid } from \"@rp/common/utils\"\nimport { IndexStatus, getIndexStatus } from \"@rp/react/tanstack-api/file\"\n\nexport const updateUploadFileProgress = (\n  setUploading: Dispatch<SetStateAction<Array<Uploadable>>>,\n): ((id: string, value: number) => void) => {\n  return (src: string, value: number) => {\n    setUploading(state =>\n      state.map(file => {\n        if (file.src === src) {\n          return {\n            ...file,\n            progress: value,\n            status: !value || value < 100 ? \"progress\" : \"analyzing\",\n          }\n        }\n        return file\n      }),\n    )\n  }\n}\n\nexport const recurrentCheckFileIndexStatus = async (id: string) => {\n  let status: IndexStatus[\"status\"] = \"INDEXED\"\n  do {\n    const index = await getIndexStatus(id).catch(() => ({ status: \"ANALYZING\" as const }))\n    status = index.status\n    await new Promise(resolve => setTimeout(resolve, 2000))\n  } while (status === \"ANALYZING\" || status === \"PENDING\")\n  return status\n}\n\nexport function createUploadableFromServerFile(file: ServerFile): Uploadable {\n  return {\n    src: file.file_id,\n    progress: 0,\n    status: \"analyzing\" as const,\n    fileId: file.file_id,\n    sharedWith: file.shared_with,\n    owner: file.owner,\n    file: {\n      name: file.file_name,\n      size: file.raw_size,\n      type: \"\",\n      lastModified: 0,\n    } as File,\n  }\n}\n\nexport const createServerFileFromUploadable = (\n  uploadable: Uploadable,\n  indexStatus: string,\n): ServerFile => {\n  return {\n    file_id: uploadable.fileId,\n    file_name: uploadable.file.name,\n    error: null,\n    folder_id: null,\n    raw_size: uploadable.file.size,\n    status: indexStatus === \"INDEXED\" ? \"COMPLETED\" : \"FAILED\",\n    tags: null,\n    trashed: false,\n    upload_ts: new Date().toISOString(),\n    shared_with: null,\n    owner: uploadable.owner,\n  }\n}\n\nexport const createNewUploadableFile = (file: File | NativeFile, owner: string): Uploadable => {\n  const src = getUuid()\n  return {\n    file,\n    src,\n    progress: 0,\n    status: \"pending\",\n    fileId: src,\n    owner,\n    sharedWith: null,\n  }\n}\n"],"names":["createNewUploadableFile","createServerFileFromUploadable","createUploadableFromServerFile","recurrentCheckFileIndexStatus","updateUploadFileProgress","setUploading","src","value","state","map","file","progress","status","id","index","getIndexStatus","catch","Promise","resolve","setTimeout","file_id","fileId","sharedWith","shared_with","owner","name","file_name","size","raw_size","type","lastModified","uploadable","indexStatus","error","folder_id","tags","trashed","upload_ts","Date","toISOString","getUuid"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;;;;;;;;IAqEaA,uBAAuB;eAAvBA;;IAnBAC,8BAA8B;eAA9BA;;IAjBGC,8BAA8B;eAA9BA;;IAVHC,6BAA6B;eAA7BA;;IAnBAC,wBAAwB;eAAxBA;;;uBAH+C;sBAChB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAErC,MAAMA,2BAA2B,CACtCC;IAEA,OAAO,CAACC,KAAaC;QACnBF,aAAaG,CAAAA,QACXA,MAAMC,GAAG,CAACC,CAAAA;gBACR,IAAIA,KAAKJ,GAAG,KAAKA,KAAK;oBACpB,OAAO,wCACFI;wBACHC,UAAUJ;wBACVK,QAAQ,CAACL,SAASA,QAAQ,MAAM,aAAa;;gBAEjD;gBACA,OAAOG;YACT;IAEJ;AACF;AAEO,MAAMP,gCAAgC,OAAOU;IAClD,IAAID,SAAgC;IACpC,GAAG;QACD,MAAME,QAAQ,MAAMC,IAAAA,oBAAc,EAACF,IAAIG,KAAK,CAAC,IAAO,CAAA;gBAAEJ,QAAQ;YAAqB,CAAA;QACnFA,SAASE,MAAMF,MAAM;QACrB,MAAM,IAAIK,QAAQC,CAAAA,UAAWC,WAAWD,SAAS;IACnD,QAASN,WAAW,eAAeA,WAAW,UAAU;IACxD,OAAOA;AACT;AAEO,SAASV,+BAA+BQ,IAAgB;IAC7D,OAAO;QACLJ,KAAKI,KAAKU,OAAO;QACjBT,UAAU;QACVC,QAAQ;QACRS,QAAQX,KAAKU,OAAO;QACpBE,YAAYZ,KAAKa,WAAW;QAC5BC,OAAOd,KAAKc,KAAK;QACjBd,MAAM;YACJe,MAAMf,KAAKgB,SAAS;YACpBC,MAAMjB,KAAKkB,QAAQ;YACnBC,MAAM;YACNC,cAAc;QAChB;IACF;AACF;AAEO,MAAM7B,iCAAiC,CAC5C8B,YACAC;IAEA,OAAO;QACLZ,SAASW,WAAWV,MAAM;QAC1BK,WAAWK,WAAWrB,IAAI,CAACe,IAAI;QAC/BQ,OAAO;QACPC,WAAW;QACXN,UAAUG,WAAWrB,IAAI,CAACiB,IAAI;QAC9Bf,QAAQoB,gBAAgB,YAAY,cAAc;QAClDG,MAAM;QACNC,SAAS;QACTC,WAAW,IAAIC,OAAOC,WAAW;QACjChB,aAAa;QACbC,OAAOO,WAAWP,KAAK;IACzB;AACF;AAEO,MAAMxB,0BAA0B,CAACU,MAAyBc;IAC/D,MAAMlB,MAAMkC,IAAAA,cAAO;IACnB,OAAO;QACL9B;QACAJ;QACAK,UAAU;QACVC,QAAQ;QACRS,QAAQf;QACRkB;QACAF,YAAY;IACd;AACF"}
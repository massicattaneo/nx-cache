{"version":3,"sources":["/Users/mcattaneo/workspace/frontend/libs/react/web/chat/src/lib/Chat/Chat/ChatResponse/InlineAttribution/InlineAttributionDisplay.tsx"],"sourcesContent":["import { useState } from \"react\"\nimport { getTimePassed } from \"@rp/common/utils\"\nimport { DocumentIcon } from \"@rp/react/web/common/composite-components\"\nimport { useSourceImage } from \"@rp/react/web/common/providers\"\nimport { Box, Button, IconButton, Skeleton, Typography, alpha } from \"@rp/react/web/mui/core\"\nimport { KeyboardArrowLeft, KeyboardArrowRight } from \"@rp/react/web/mui/icons\"\nimport { ExternalFavicon } from \"../ExternalFavicon\"\nimport { removeSnippetEllipsisSpace } from \"../removeSnippetEllipsisSpace\"\nimport { InlineAttributionSelector } from \"./InlineAttributionSelector\"\nimport { GroupedInlineAttributionList } from \"./getInlineAttributionData\"\n\ntype Props = {\n  attributions: GroupedInlineAttributionList\n  selectedAttribution: number\n  setSelectedAttribution: (index: number) => void\n}\nconst InlineAttributionDisplay = ({\n  attributions,\n  selectedAttribution,\n  setSelectedAttribution,\n}: Props) => {\n  const [selectedChunk, setSelectedChunk] = useState(0)\n  const matches = attributions[selectedAttribution].data\n  const data = matches[selectedChunk]\n  const { hd, sourceName, ts } = matches[0]\n\n  const setAttributionAndResetChunk = (id: number) => {\n    setSelectedChunk(0)\n    setSelectedAttribution(id)\n  }\n\n  const [relatedSource, documentScope, contentType, srcKey, language] =\n    data.type === \"CQS\"\n      ? [data.relatedSource, data.documentScope, data.contentType, data.srcKey, data.language]\n      : []\n  const [externalFavicon] = data.type === \"EXTERNAL\" ? [data.externalFavicon] : []\n\n  const { isLoaded, src, hasError } = useSourceImage(relatedSource ? [relatedSource] : [])\n\n  const image = isLoaded ? (\n    <img alt={hd} src={src} />\n  ) : (\n    <Skeleton height=\"100%\" sx={{ transform: \"none\" }} />\n  )\n\n  return (\n    <Box\n      sx={{\n        py: 2,\n        borderRadius: 2,\n        backgroundColor: \"elevation.dp03\",\n        \"& > p\": {\n          fontSize: 14,\n          mt: 1.5,\n        },\n      }}\n    >\n      {attributions.length > 1 ? (\n        <InlineAttributionSelector\n          attributions={attributions}\n          selectedIndex={selectedAttribution}\n          onClick={setAttributionAndResetChunk}\n        />\n      ) : null}\n      {relatedSource && !hasError && src !== \"\" ? (\n        <Box\n          sx={{\n            px: 2,\n          }}\n        >\n          <Box\n            sx={{\n              width: \"100%\",\n              height: 95,\n              mb: 1.5,\n              \"& img\": { objectFit: \"cover\", height: 1, width: 1, borderRadius: 2 },\n            }}\n          >\n            {image}\n          </Box>\n        </Box>\n      ) : null}\n      <Box\n        sx={{\n          display: \"flex\",\n          color: \"text.secondary\",\n          alignItems: \"center\",\n          px: 2,\n          \"& p\": {\n            fontSize: 12,\n            letterSpacing: 0.25,\n          },\n        }}\n      >\n        {documentScope ? (\n          <DocumentIcon\n            documentScope={documentScope}\n            contentType={contentType}\n            text={sourceName}\n            srcKey={srcKey}\n          />\n        ) : null}\n        {externalFavicon ? (\n          <Box\n            sx={{\n              display: \"flex\",\n              alignItems: \"center\",\n              gap: 0.5,\n              mr: 0.5,\n              overflow: \"hidden\",\n              \"& img, & svg\": {\n                height: 16,\n                width: 16,\n              },\n\n              \"& div\": {\n                display: \"flex\",\n              },\n            }}\n          >\n            <ExternalFavicon faviconUrl={externalFavicon} alt={sourceName} />\n            <Typography sx={{ whiteSpace: \"nowrap\", textOverflow: \"ellipsis\", overflow: \"hidden\" }}>\n              {sourceName}\n            </Typography>\n          </Box>\n        ) : null}\n        {ts ? <Typography sx={{ flexShrink: 0 }}>· {getTimePassed(ts)}</Typography> : null}\n        {language ? <Typography sx={{ ml: 0.5, flexShrink: 0 }}>· {language}</Typography> : null}\n      </Box>\n      <Typography\n        sx={{\n          px: 2,\n          fontWeight: 700,\n          lineHeight: \"20px\",\n          display: \"-webkit-box\",\n          overflowWrap: \"break-word\",\n          WebkitBoxOrient: \"vertical\",\n          WebkitLineClamp: 4,\n          overflow: \"hidden\",\n          color: \"text.primary\",\n        }}\n      >\n        {removeSnippetEllipsisSpace(hd)}\n      </Typography>\n      <Typography\n        sx={{\n          color: \"text.secondary\",\n          display: \"-webkit-box\",\n          overflowWrap: \"break-word\",\n          WebkitBoxOrient: \"vertical\",\n          WebkitLineClamp: 4,\n          overflow: \"hidden\",\n          px: 2,\n        }}\n      >\n        {removeSnippetEllipsisSpace(matches[selectedChunk].text)}\n      </Typography>\n      {matches.length > 1 ? (\n        <Box\n          sx={{\n            display: \"flex\",\n            justifyContent: \"space-between\",\n            alignItems: \"center\",\n            px: 0.75,\n          }}\n        >\n          <IconButton\n            aria-label=\"Previous chunk\"\n            size=\"small\"\n            onClick={() => setSelectedChunk(prev => Math.max(prev - 1, 0))}\n            onMouseDown={event => event.preventDefault()}\n            disabled={selectedChunk === 0}\n          >\n            <KeyboardArrowLeft />\n          </IconButton>\n          <Typography\n            sx={{\n              color: \"text.700\",\n              fontSize: 14,\n            }}\n          >\n            {selectedChunk + 1} of {matches.length}\n          </Typography>\n          <IconButton\n            aria-label=\"Next chunk\"\n            size=\"small\"\n            onClick={() => setSelectedChunk(prev => Math.min(prev + 1, matches.length - 1))}\n            onMouseDown={event => event.preventDefault()}\n            disabled={selectedChunk === matches.length - 1}\n          >\n            <KeyboardArrowRight />\n          </IconButton>\n        </Box>\n      ) : null}\n      <Box\n        sx={{\n          px: 2,\n        }}\n      >\n        <Button\n          onClick={matches[selectedChunk].onClick}\n          variant=\"contained-light\"\n          sx={theme => ({\n            color: \"primary.main\",\n            width: 1,\n            letterSpacing: 1,\n            mt: 2,\n            fontSize: 12,\n\n            \"&:hover\": {\n              backgroundColor: alpha(theme.palette.primary.main, 0.12),\n              outline: 1,\n              outlineColor: \"primary.main\",\n            },\n          })}\n        >\n          Read more\n        </Button>\n      </Box>\n    </Box>\n  )\n}\n\nexport { InlineAttributionDisplay }\n"],"names":["InlineAttributionDisplay","attributions","selectedAttribution","setSelectedAttribution","selectedChunk","setSelectedChunk","useState","matches","data","hd","sourceName","ts","setAttributionAndResetChunk","id","relatedSource","documentScope","contentType","srcKey","language","type","externalFavicon","isLoaded","src","hasError","useSourceImage","image","img","alt","Skeleton","height","sx","transform","Box","py","borderRadius","backgroundColor","fontSize","mt","length","InlineAttributionSelector","selectedIndex","onClick","px","width","mb","objectFit","display","color","alignItems","letterSpacing","DocumentIcon","text","gap","mr","overflow","ExternalFavicon","faviconUrl","Typography","whiteSpace","textOverflow","flexShrink","getTimePassed","ml","fontWeight","lineHeight","overflowWrap","WebkitBoxOrient","WebkitLineClamp","removeSnippetEllipsisSpace","justifyContent","IconButton","aria-label","size","prev","Math","max","onMouseDown","event","preventDefault","disabled","KeyboardArrowLeft","min","KeyboardArrowRight","Button","variant","theme","alpha","palette","primary","main","outline","outlineColor"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BA+NSA;;;eAAAA;;;;uBA/NgB;uBACK;qCACD;2BACE;sBACsC;uBACf;iCACtB;4CACW;2CACD;AAQ1C,MAAMA,2BAA2B,CAAC,EAChCC,YAAY,EACZC,mBAAmB,EACnBC,sBAAsB,EAChB;IACN,MAAM,CAACC,eAAeC,iBAAiB,GAAGC,IAAAA,eAAQ,EAAC;IACnD,MAAMC,UAAUN,YAAY,CAACC,oBAAoB,CAACM,IAAI;IACtD,MAAMA,OAAOD,OAAO,CAACH,cAAc;IACnC,MAAM,EAAEK,EAAE,EAAEC,UAAU,EAAEC,EAAE,EAAE,GAAGJ,OAAO,CAAC,EAAE;IAEzC,MAAMK,8BAA8B,CAACC;QACnCR,iBAAiB;QACjBF,uBAAuBU;IACzB;IAEA,MAAM,CAACC,eAAeC,eAAeC,aAAaC,QAAQC,SAAS,GACjEV,KAAKW,IAAI,KAAK,QACV;QAACX,KAAKM,aAAa;QAAEN,KAAKO,aAAa;QAAEP,KAAKQ,WAAW;QAAER,KAAKS,MAAM;QAAET,KAAKU,QAAQ;KAAC,GACtF,EAAE;IACR,MAAM,CAACE,gBAAgB,GAAGZ,KAAKW,IAAI,KAAK,aAAa;QAACX,KAAKY,eAAe;KAAC,GAAG,EAAE;IAEhF,MAAM,EAAEC,QAAQ,EAAEC,GAAG,EAAEC,QAAQ,EAAE,GAAGC,IAAAA,yBAAc,EAACV,gBAAgB;QAACA;KAAc,GAAG,EAAE;IAEvF,MAAMW,QAAQJ,yBACZ,qBAACK;QAAIC,KAAKlB;QAAIa,KAAKA;uBAEnB,qBAACM,cAAQ;QAACC,QAAO;QAAOC,IAAI;YAAEC,WAAW;QAAO;;IAGlD,qBACE,sBAACC,SAAG;QACFF,IAAI;YACFG,IAAI;YACJC,cAAc;YACdC,iBAAiB;YACjB,SAAS;gBACPC,UAAU;gBACVC,IAAI;YACN;QACF;;YAECpC,aAAaqC,MAAM,GAAG,kBACrB,qBAACC,oDAAyB;gBACxBtC,cAAcA;gBACduC,eAAetC;gBACfuC,SAAS7B;iBAET;YACHE,iBAAiB,CAACS,YAAYD,QAAQ,mBACrC,qBAACU,SAAG;gBACFF,IAAI;oBACFY,IAAI;gBACN;0BAEA,cAAA,qBAACV,SAAG;oBACFF,IAAI;wBACFa,OAAO;wBACPd,QAAQ;wBACRe,IAAI;wBACJ,SAAS;4BAAEC,WAAW;4BAAShB,QAAQ;4BAAGc,OAAO;4BAAGT,cAAc;wBAAE;oBACtE;8BAECT;;iBAGH;0BACJ,sBAACO,SAAG;gBACFF,IAAI;oBACFgB,SAAS;oBACTC,OAAO;oBACPC,YAAY;oBACZN,IAAI;oBACJ,OAAO;wBACLN,UAAU;wBACVa,eAAe;oBACjB;gBACF;;oBAEClC,8BACC,qBAACmC,iCAAY;wBACXnC,eAAeA;wBACfC,aAAaA;wBACbmC,MAAMzC;wBACNO,QAAQA;yBAER;oBACHG,gCACC,sBAACY,SAAG;wBACFF,IAAI;4BACFgB,SAAS;4BACTE,YAAY;4BACZI,KAAK;4BACLC,IAAI;4BACJC,UAAU;4BACV,gBAAgB;gCACdzB,QAAQ;gCACRc,OAAO;4BACT;4BAEA,SAAS;gCACPG,SAAS;4BACX;wBACF;;0CAEA,qBAACS,gCAAe;gCAACC,YAAYpC;gCAAiBO,KAAKjB;;0CACnD,qBAAC+C,gBAAU;gCAAC3B,IAAI;oCAAE4B,YAAY;oCAAUC,cAAc;oCAAYL,UAAU;gCAAS;0CAClF5C;;;yBAGH;oBACHC,mBAAK,sBAAC8C,gBAAU;wBAAC3B,IAAI;4BAAE8B,YAAY;wBAAE;;4BAAG;4BAAGC,IAAAA,oBAAa,EAAClD;;yBAAoB;oBAC7EO,yBAAW,sBAACuC,gBAAU;wBAAC3B,IAAI;4BAAEgC,IAAI;4BAAKF,YAAY;wBAAE;;4BAAG;4BAAG1C;;yBAAyB;;;0BAEtF,qBAACuC,gBAAU;gBACT3B,IAAI;oBACFY,IAAI;oBACJqB,YAAY;oBACZC,YAAY;oBACZlB,SAAS;oBACTmB,cAAc;oBACdC,iBAAiB;oBACjBC,iBAAiB;oBACjBb,UAAU;oBACVP,OAAO;gBACT;0BAECqB,IAAAA,sDAA0B,EAAC3D;;0BAE9B,qBAACgD,gBAAU;gBACT3B,IAAI;oBACFiB,OAAO;oBACPD,SAAS;oBACTmB,cAAc;oBACdC,iBAAiB;oBACjBC,iBAAiB;oBACjBb,UAAU;oBACVZ,IAAI;gBACN;0BAEC0B,IAAAA,sDAA0B,EAAC7D,OAAO,CAACH,cAAc,CAAC+C,IAAI;;YAExD5C,QAAQ+B,MAAM,GAAG,kBAChB,sBAACN,SAAG;gBACFF,IAAI;oBACFgB,SAAS;oBACTuB,gBAAgB;oBAChBrB,YAAY;oBACZN,IAAI;gBACN;;kCAEA,qBAAC4B,gBAAU;wBACTC,cAAW;wBACXC,MAAK;wBACL/B,SAAS,IAAMpC,iBAAiBoE,CAAAA,OAAQC,KAAKC,GAAG,CAACF,OAAO,GAAG;wBAC3DG,aAAaC,CAAAA,QAASA,MAAMC,cAAc;wBAC1CC,UAAU3E,kBAAkB;kCAE5B,cAAA,qBAAC4E,wBAAiB;;kCAEpB,sBAACvB,gBAAU;wBACT3B,IAAI;4BACFiB,OAAO;4BACPX,UAAU;wBACZ;;4BAEChC,gBAAgB;4BAAE;4BAAKG,QAAQ+B,MAAM;;;kCAExC,qBAACgC,gBAAU;wBACTC,cAAW;wBACXC,MAAK;wBACL/B,SAAS,IAAMpC,iBAAiBoE,CAAAA,OAAQC,KAAKO,GAAG,CAACR,OAAO,GAAGlE,QAAQ+B,MAAM,GAAG;wBAC5EsC,aAAaC,CAAAA,QAASA,MAAMC,cAAc;wBAC1CC,UAAU3E,kBAAkBG,QAAQ+B,MAAM,GAAG;kCAE7C,cAAA,qBAAC4C,yBAAkB;;;iBAGrB;0BACJ,qBAAClD,SAAG;gBACFF,IAAI;oBACFY,IAAI;gBACN;0BAEA,cAAA,qBAACyC,YAAM;oBACL1C,SAASlC,OAAO,CAACH,cAAc,CAACqC,OAAO;oBACvC2C,SAAQ;oBACRtD,IAAIuD,CAAAA,QAAU,CAAA;4BACZtC,OAAO;4BACPJ,OAAO;4BACPM,eAAe;4BACfZ,IAAI;4BACJD,UAAU;4BAEV,WAAW;gCACTD,iBAAiBmD,IAAAA,WAAK,EAACD,MAAME,OAAO,CAACC,OAAO,CAACC,IAAI,EAAE;gCACnDC,SAAS;gCACTC,cAAc;4BAChB;wBACF,CAAA;8BACD;;;;;AAMT"}